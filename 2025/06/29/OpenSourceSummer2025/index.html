<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>开源之夏NowInOpenHarmony | XBXyftx</title><meta name="author" content="XBXyftx"><meta name="copyright" content="XBXyftx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="开源之夏2025项目开发笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="开源之夏NowInOpenHarmony">
<meta property="og:url" content="https://xbxyftx.top/2025/06/29/OpenSourceSummer2025/index.html">
<meta property="og:site_name" content="XBXyftx">
<meta property="og:description" content="开源之夏2025项目开发笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xbxyftx.top/imgs/ArticleTopImgs/OpenSourceSummerTopImg.png">
<meta property="article:published_time" content="2025-06-29T06:01:21.000Z">
<meta property="article:modified_time" content="2025-09-25T16:29:45.175Z">
<meta property="article:author" content="XBXyftx">
<meta property="article:tag" content="鸿蒙">
<meta property="article:tag" content="技术向">
<meta property="article:tag" content="项目">
<meta property="article:tag" content="开源之夏">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xbxyftx.top/imgs/ArticleTopImgs/OpenSourceSummerTopImg.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "开源之夏NowInOpenHarmony",
  "url": "https://xbxyftx.top/2025/06/29/OpenSourceSummer2025/",
  "image": "https://xbxyftx.top/imgs/ArticleTopImgs/OpenSourceSummerTopImg.png",
  "datePublished": "2025-06-29T06:01:21.000Z",
  "dateModified": "2025-09-25T16:29:45.175Z",
  "author": [
    {
      "@type": "Person",
      "name": "XBXyftx",
      "url": "https://github.com/XBXyftx"
    }
  ]
}</script><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://xbxyftx.top/2025/06/29/OpenSourceSummer2025/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="/css/typewriter-effect.css"><link rel="stylesheet" href="/css/entrance-popup.css"><link rel="stylesheet" href="/css/lazy-loading.css"><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":2000,"languages":{"author":"作者: XBXyftx","link":"链接: ","source":"来源: XBXyftx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: '/',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '开源之夏NowInOpenHarmony',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post',
  typewriter: '🦋 这篇文章将会记录我的开源之夏2025项目开发笔记，记录我参与NowInOpenHarmony项目的完整历程。在这三个月的时间里，我将深入探索鸿蒙生态系统的奥秘，从初学者到贡献者的蜕变过程。我会详细记录每一次代码提交背后的思考，每一个技术难题的攻克过程，以及与导师协作的珍贵经历。从环境搭建到功能实现，从bug调试到性能优化，从技术分享到项目总结，这里将会是我技术成长轨迹的完整呈现。我相信这段开源贡献的经历不仅会提升我的编程技能和项目管理能力，更会让我深刻理解开源精神的价值所在。这将会成为我大学期间最具意义的技术实践，也是我走向更广阔技术世界的重要里程碑。'
}</script><script src="/js/nyan.js"></script><script>localStorage.setItem('theme','dark')</script><script>document.documentElement.setAttribute('data-theme', 'dark');</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/transpancy.css"><script> // 强制锁定为暗黑模式 localStorage.setItem('theme', 'dark'); // 防止其他脚本覆盖模式 document.documentElement.setAttribute('data-theme', 'dark'); </script><link rel="stylesheet" href="/css/styles.css"><script> document.querySelectorAll('#post-comment').forEach(el => { el.style.backgroundColor = 'rgba(255, 255, 255, 0.6)'; }); </script><link rel="twikoo" href="/css/twikoo.css"><link rel="stylesheet" href="/css/rightmenu.css"><link rel="stylesheet" href="/css/sequential-loader.css"><script src="/js/sequential-loader-config.js"></script><script src="/js/sequential-image-loader.js" defer></script><script src="/js/sequential-integration.js" defer></script><script src="/js/custom-lightbox.js" defer></script><script src="/js/nyan.js"></script><script src="/js/header-universe.js"></script><!-- 新增缓存管理脚本 - 已禁用Service Worker--><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="cat__scene"><div class="cat__main"><div class="cat__body"></div><div class="cat__body"></div><div class="cat__tail"></div><div class="cat__head"></div></div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
      setTimeout(() => {
        $loadingBox.style.display = 'none'
      }, 800)
    },
    initLoading: () => {
      $loadingBox.style.display = 'flex'
      $loadingBox.classList.remove('loaded')
      $body.style.overflow = 'hidden'
    }
  }

  preloader.initLoading()
  
  // 设置10秒超时
  const loadingTimeout = setTimeout(() => {
    preloader.endLoading()
  }, 10000)
  
  window.addEventListener('load', () => {
    clearTimeout(loadingTimeout)
    preloader.endLoading()
  })

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(https://bu.dusays.com/2025/07/04/6867890f5d403.png);"></div><div class="entrance-popup" id="entrance-popup"><div class="popup-content"><div class="popup-header"><span class="popup-title">温馨提示</span><span class="popup-close">×</span></div><div class="popup-body"><div class="popup-text"></div></div></div><div class="popup-overlay"></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-close-btn"><i class="fas fa-times"></i></div><div class="avatar-img text-center"><img src="/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 文库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/coffer/"><i class="fa-fw fa-solid fa-key"></i><span> 秘密基地</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-i"></i><span> Myself</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/swiper/"><i class="fa-fw fa-solid fa-star-of-david"></i><span> 昨日重现</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-solid fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/LianlianKan/"><i class="fa-fw fa-solid fa-gamepad"></i><span> 连连看</span></a></div><div class="menus_item"><a class="site-page" href="/MarkdownPreview/"><i class="fa-fw fa-solid fa-file-code"></i><span> MD在线编辑器</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/imgs/ArticleTopImgs/OpenSourceSummerTopImg.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.png" alt="Logo"><span class="site-name">XBXyftx</span></a><a class="nav-page-title" href="/"><span class="site-name">开源之夏NowInOpenHarmony</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 文库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/coffer/"><i class="fa-fw fa-solid fa-key"></i><span> 秘密基地</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-i"></i><span> Myself</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/swiper/"><i class="fa-fw fa-solid fa-star-of-david"></i><span> 昨日重现</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-solid fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/LianlianKan/"><i class="fa-fw fa-solid fa-gamepad"></i><span> 连连看</span></a></div><div class="menus_item"><a class="site-page" href="/MarkdownPreview/"><i class="fa-fw fa-solid fa-file-code"></i><span> MD在线编辑器</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">开源之夏NowInOpenHarmony</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-06-29T06:01:21.000Z" title="发表于 2025-06-29 14:01:21">2025-06-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-25T16:29:45.175Z" title="更新于 2025-09-26 00:29:45">2025-09-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">91.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>389分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:100,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-09-26 00:29:45&quot;}" hidden></div><div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; margin: 20px 0; color: white; position: relative; overflow: hidden; transition: all 0.3s ease; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);" onmouseover="this.style.transform='translateY(-5px) scale(1.02)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.4)'; this.style.background='linear-gradient(135deg, #7c4dff 0%, #8e24aa 100%)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'; this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'">
  <div style="position: relative; z-index: 2;">
    <div style="display: flex; align-items: center; margin-bottom: 16px;">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="white" style="margin-right: 12px;">
        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
      </svg>
      <div style="margin: 0; font-size: 20px; font-weight: 600;">ifLabVibe/NowInOpenHarmony</div>
    </div>
    <p style="margin: 0 0 16px 0; opacity: 0.9; font-size: 14px;">🚀 基于OpenHarmony的资讯聚合应用 - 开源之夏2025项目</p>
    <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">OpenHarmony</span>
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">ArkTS</span>
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">Python</span>
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">FastAPI</span>
    </div>
    <a href="https://github.com/ifLabVibe/NowInOpenHarmony" target="_blank" style="display: inline-flex; align-items: center; background: rgba(255,255,255,0.2); color: white; text-decoration: none; padding: 10px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); font-weight: 500; transition: all 0.2s ease;" onclick="event.stopPropagation()" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 8px rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
      <svg width="16" height="16" viewbox="0 0 24 24" fill="white" style="margin-right: 8px;">
        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.30.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
      </svg>
      查看项目仓库
    </a>
  </div>
</div>

<div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 12px; padding: 20px; margin: 20px 0; color: white; position: relative; overflow: hidden; transition: all 0.3s ease; cursor: pointer; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-5px) scale(1.02)'; this.style.boxShadow='0 8px 25px rgba(40, 167, 69, 0.4)'; this.style.background='linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.3)'; this.style.background='linear-gradient(135deg, #28a745 0%, #20c997 100%)'">
  <div style="position: relative; z-index: 2;">
    <div style="display: flex; align-items: center; margin-bottom: 16px;">
      <svg width="24" height="24" viewbox="0 0 1056 1024" style="margin-right: 12px;" fill="none">
        <path d="M479.663158 988.429474c-90.004211-10.24-187.553684-48.505263-247.376842-96.471579-33.953684-26.947368-90.004211-88.387368-111.023158-120.724211-64.134737-99.166316-90.004211-222.046316-70.602105-333.608421 18.863158-107.250526 63.056842-191.326316 141.20421-267.856842 135.814737-133.12 353.010526-175.157895 527.090526-101.861053 57.128421 24.252632 112.101053 58.206316 134.736843 82.997895 44.193684 49.044211 28.025263 128.808421-31.258948 158.450526-25.330526 12.395789-72.218947 12.934737-90.543158 1.077895s-35.031579-44.193684-39.343158-77.069473c-2.155789-15.629474-4.850526-28.564211-5.389473-28.564211-1.077895 0-14.551579 7.545263-29.642106 16.168421-49.583158 29.103158-64.134737 33.414737-140.126315 38.265263-39.882105 2.155789-84.075789 5.928421-97.549474 8.084211-24.791579 3.233684-54.972632-1.077895-102.938947-16.168421l-25.330527-8.084211 1.077895 52.277895c0.538947 50.661053 0 53.355789-21.557895 98.088421-28.025263 58.206316-38.265263 93.237895-42.576842 144.976842-10.24 124.496842 57.667368 217.195789 186.47579 253.844211 83.536842 23.713684 221.507368 18.863158 296.421052-10.778948 71.68-28.564211 134.736842-94.854737 134.736842-142.282105 0-19.402105-24.791579-44.193684-51.738947-50.661053-11.317895-3.233684-54.433684-7.006316-95.393684-8.623158-86.770526-3.772632-147.132632-11.856842-163.84-22.635789s-25.330526-40.96-17.785263-63.59579c7.545263-23.713684 19.402105-33.953684 54.433684-46.888421 23.713684-9.162105 40.96-10.778947 109.945263-10.778947 146.593684 0 215.578947 18.324211 269.473684 72.218947 61.978947 62.517895 68.446316 157.372632 16.168421 241.448421-77.069474 123.418947-168.151579 194.021053-291.570526 225.818948-41.498947 11.317895-151.444211 18.324211-196.176842 12.934737z" fill="#D62240"/>
      </svg>
      <div style="margin: 0; font-size: 20px; font-weight: 600;">openharmony-sig/ostest_integration_test</div>
    </div>
    <p style="margin: 0 0 16px 0; opacity: 0.9; font-size: 14px;">🎉 项目已被收录至OpenHarmony SIG集成测试仓库</p>
    <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">✅ 官方收录</span>
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">🔬 集成测试</span>
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">OpenHarmony SIG</span>
    </div>
    <a href="https://gitcode.com/openharmony-sig/ostest_integration_test" target="_blank" style="display: inline-flex; align-items: center; background: rgba(255,255,255,0.2); color: white; text-decoration: none; padding: 10px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); font-weight: 500; transition: all 0.2s ease;" onclick="event.stopPropagation()" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 8px rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
      <svg width="16" height="16" viewbox="0 0 1056 1024" style="margin-right: 8px;" fill="none">
        <path d="M479.663158 988.429474c-90.004211-10.24-187.553684-48.505263-247.376842-96.471579-33.953684-26.947368-90.004211-88.387368-111.023158-120.724211-64.134737-99.166316-90.004211-222.046316-70.602105-333.608421 18.863158-107.250526 63.056842-191.326316 141.20421-267.856842 135.814737-133.12 353.010526-175.157895 527.090526-101.861053 57.128421 24.252632 112.101053 58.206316 134.736843 82.997895 44.193684 49.044211 28.025263 128.808421-31.258948 158.450526-25.330526 12.395789-72.218947 12.934737-90.543158 1.077895s-35.031579-44.193684-39.343158-77.069473c-2.155789-15.629474-4.850526-28.564211-5.389473-28.564211-1.077895 0-14.551579 7.545263-29.642106 16.168421-49.583158 29.103158-64.134737 33.414737-140.126315 38.265263-39.882105 2.155789-84.075789 5.928421-97.549474 8.084211-24.791579 3.233684-54.972632-1.077895-102.938947-16.168421l-25.330527-8.084211 1.077895 52.277895c0.538947 50.661053 0 53.355789-21.557895 98.088421-28.025263 58.206316-38.265263 93.237895-42.576842 144.976842-10.24 124.496842 57.667368 217.195789 186.47579 253.844211 83.536842 23.713684 221.507368 18.863158 296.421052-10.778948 71.68-28.564211 134.736842-94.854737 134.736842-142.282105 0-19.402105-24.791579-44.193684-51.738947-50.661053-11.317895-3.233684-54.433684-7.006316-95.393684-8.623158-86.770526-3.772632-147.132632-11.856842-163.84-22.635789s-25.330526-40.96-17.785263-63.59579c7.545263-23.713684 19.402105-33.953684 54.433684-46.888421 23.713684-9.162105 40.96-10.778947 109.945263-10.778947 146.593684 0 215.578947 18.324211 269.473684 72.218947 61.978947 62.517895 68.446316 157.372632 16.168421 241.448421-77.069474 123.418947-168.151579 194.021053-291.570526 225.818948-41.498947 11.317895-151.444211 18.324211-196.176842 12.934737z" fill="#D62240"/>
      </svg>
      查看官方仓库
    </a>
  </div>
</div>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我初次了解到开源之夏活动是在大一上半学期期间的第二届OpenHarmony技术峰会上，我听到了这个名字，当时的我对于OpenHarmony和OpenAtom都知之甚少，也没有能力去参与开源之夏的项目，所以也没有深入的了解。而真正的对开源之夏有所了解是发生在了大一下半学期的春耕校源行，在校源行的主会场，开放原子的工作人员也是介绍了一下开源之夏活动，我也是加入了活动群，但是并没有真正的报名参加，因为我依旧认为我没有能力承担独立的开发。而随着大二下的到来，我一直在由于大二升大三的这个暑假我是去实习还是在家里做项目，虽然手上有鸿小易这个待完善的项目，但我个人其实对如何继续完善它并没有很好的规划，我也担心我会不会因为这个项目的目标不明确而荒废一个假期。这个时候又是子安学长拯救了我，他推荐我去参与开源之夏，与此同时曾老师和开源协会团队也将开源之夏当做工作重点，我也因此决心要尝试去进行开源之夏的项目计划书的投递。</p>
<p>我登录到了开源之夏的活动官网，进行实名认证，提交了之后我就等着说审核完了再开始整项目计划书吧，结果第一次实名审核还没通过，有错。我只好修改再审，再审提交后没几天我们就全部结课了。我只好开始了期末复习，对于当时的我来说有一科“天书”我真是心里打鼓能不能过所以就全身心的投入到期末复习中，想着说等期末考完再投递。结果期末前三天我又突然担心起来会不会截止时间等不到我期末考完，于是又一次前往官网查看，结果发现还真等不到，我只好先放下手头的复习，因为那时各科复习都在稳步推进，“天书”也有了眉目，所以就花了5个小时左右，终于是把简历和项目计划书给整完了，期间还和导师通了几封邮件。有一说一这么晚才和导师联系而且我的项目计划书又是短时间干出来的，真怕过不了。</p>
<p>在期末考完之后我再次登录官网看会不会有什么进展，结果却看到了公告说时间延长了，到现在还没截止，哇我直接炸缸了。不过倒也还好，算是帮我省了点事，可以小小的放松一下了，期末周真的要死人了孩子。</p>
<p>随后又有几个兼职和老师的的项目机会横插在了我提交项目计划书到中选出结果的这段时间里。我内心也还是担心我无法中选，所以也先都拖着说等开源之夏的结果。就这样我怀着这种忐忑不安、但又充满希望的心境一路等待到了28号。</p>
<p><img src="https://bu.dusays.com/2025/06/29/686120088cd6b.png" alt="1751195653463.png"></p>
<p>邮箱的提示音将我悬着的心放了下来，紧接着，协议的签署、群聊的组建、其他项目安排的善后就接二连三的排了上来，像是梦一样的确认了我的中选，以及接下来三个月我生活的基调。</p>
<p><img src="https://bu.dusays.com/2025/06/29/686123033e689.png" alt="1751196415807.png"></p>
<p>我也是特意的问了一下老师能否写成博客文章的形式来进行记录，也是获得了老师的同意，要不没准这篇文章就胎死腹中了。</p>
<h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><h3 id="项目名称"><a href="#项目名称" class="headerlink" title="项目名称"></a>项目名称</h3><p>NowInOpenHarmony</p>
<h3 id="项目背景"><a href="#项目背景" class="headerlink" title="项目背景"></a>项目背景</h3><div class="note default flat"><p>目前OpenHarmony开源项目已成规模，生态日益繁荣，但与OpenHarmony相关的资讯平台多为网站且比较零散，另外OpenHarmony应用比较缺乏，应用生态是未来发展重点。结合上述两个现状，本选题目标为开发一款运行在OpenHarmony系统上的聚合OpenHarmony相关资讯的应用。</p>
</div>
<p>上面这段话是在开源之夏官网上的项目简介，我也算是深有感触，可能作为开发者有加入很多的开发者社群，还能算是能获取到比较丰富的OpenHarmony相关的资讯，但是作为普通用户，想要获取到OpenHarmony相关的资讯，却并不容易，而且OpenHarmony的应用生态也是比较缺乏的，所以这个项目也是很有意义的。</p>
<h3 id="项目目标"><a href="#项目目标" class="headerlink" title="项目目标"></a>项目目标</h3><div class="note default flat"><ol>
<li>使用ArkTS开发运行于OpenHarmony的资讯应用（内容包括OpenHarmony社区新闻、开发者论坛热门话题、版本发布信息等）；</li>
<li>资讯内容来源建议： 1）使用Web开发框架开发服务器聚合OpenHarmony资讯网站，为应用提供接口，2）应用直接通过OpenHarmony社区网站获取资讯并展示。</li>
</ol>
</div>
<p>所以现在的目标就很明确了要用py开发一个后端服务器来提供资讯内容，然后客户端通过网络请求来去获取到资讯内容，然后展示在界面上。</p>
<h2 id="项目时间规划"><a href="#项目时间规划" class="headerlink" title="项目时间规划"></a>项目时间规划</h2><div class="timeline green"><div class="timeline-item headline">
        <div class="timeline-item-title">
          <div class="item-circle"><p>2025</p>
</div>
        </div>
      </div><div class="timeline-item">
        <div class="timeline-item-title">
          <div class="item-circle"><p>07-07</p>
</div>
        </div>
        <div class="timeline-item-content"><p>7.7至7.13完成可行性验证以及方案设计（已经于7.13完成阶段进度汇报）√</p>
</div>
      </div><div class="timeline-item">
        <div class="timeline-item-title">
          <div class="item-circle"><p>07-14</p>
</div>
        </div>
        <div class="timeline-item-content"><p>7.14至7.27完成完成后端开发（完成）√</p>
</div>
      </div><div class="timeline-item">
        <div class="timeline-item-title">
          <div class="item-circle"><p>07-28</p>
</div>
        </div>
        <div class="timeline-item-content"><p>7.28至8.24完成鸿蒙端开发（完成，并最终优化中）√</p>
</div>
      </div><div class="timeline-item">
        <div class="timeline-item-title">
          <div class="item-circle"><p>08-24</p>
</div>
        </div>
        <div class="timeline-item-content"><p>8.24至结项完成最终调优与报告撰写（进行中）</p>
</div>
      </div></div>
<h2 id="核心问题"><a href="#核心问题" class="headerlink" title="核心问题"></a>核心问题</h2><p>通过对项目目标的分析我们可以分析出有三个核心问题，依次打通这三个核心问题我们就可以完成这个项目了。</p>
<h3 id="信息的获取"><a href="#信息的获取" class="headerlink" title="信息的获取"></a>信息的获取</h3><p>首先的问题就在于信息的获取。在官网上导师所提供的建议仅仅指出了信息的来源，但并没有说明我们该用什么手段获取到数据。我第一个想到的是爬虫，但不确定导师会不会去指定是用什么方式去进行数据的获取，所以我此前先给导师发了邮件进行询问，确认了可以使用爬虫的形式。</p>
<p>在确认了我中选之后我添加了老师的微信，而后面我和老师的微信沟通时老师又提出了可以参考此前的<code>TodayOpenHarmony</code>项目的形式直接使用<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-components-basic-web">web组件</a>来去展示现成的网页。不过我感觉这样的化可能界面的显示效果并不好，但我也还是先去分析一下<code>TodayOpenHarmony</code>的资讯获取形式吧。</p>
<h4 id="TodayOpenHarmony项目分析"><a href="#TodayOpenHarmony项目分析" class="headerlink" title="TodayOpenHarmony项目分析"></a>TodayOpenHarmony项目分析</h4><p>我们重点来看其资讯获取以及展示的形式，这是重点。整体采用了十分标准的<code>MVVM</code>架构，通过<code>ViewModel</code>来获取数据，然后通过<code>Model</code>来存储数据，最后通过<code>View</code>来展示数据。而数据获取的方式则是通过<code>web组件</code>来实现的，通过<code>web组件</code>来展示现成的网页。其数据来源部分的核心代码如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">NewsListData</span>: <span class="title class_">NewsItem</span>[] = [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">NewsItem</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;新闻&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;基于OpenHarmony的团结引擎应用开发赛&#x27;</span>,</span><br><span class="line">    <span class="attr">subtitle</span>: <span class="string">&#x27;促进万物互联产业的繁荣发展&#x27;</span>,</span><br><span class="line">    <span class="attr">image</span>: $r(<span class="string">&#x27;app.media.edu&#x27;</span>),</span><br><span class="line">    <span class="attr">timestamp</span>: <span class="string">&#x27;2024-03-11&#x27;</span>,</span><br><span class="line">    <span class="attr">views</span>: <span class="number">22500</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&#x27;https://www.openharmony.cn/unityEngine/illustrate&#x27;</span>,</span><br><span class="line">    <span class="attr">isLiked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">likeCount</span>: <span class="number">806</span>,</span><br><span class="line">    <span class="attr">isBookmarked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">isExpanded</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">readTime</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">commentCount</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">shareCount</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">tags</span>: [<span class="string">&#x27;开发大赛&#x27;</span>, <span class="string">&#x27;物联网&#x27;</span>],</span><br><span class="line">    <span class="attr">categoryId</span>: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">NewsItem</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;新闻&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;开源鸿蒙开发者大会2025&#x27;</span>,</span><br><span class="line">    <span class="attr">subtitle</span>: <span class="string">&#x27;展示开源鸿蒙操作系统的技术革新&#x27;</span>,</span><br><span class="line">    <span class="attr">image</span>: $r(<span class="string">&#x27;app.media.New&#x27;</span>),</span><br><span class="line">    <span class="attr">timestamp</span>: <span class="string">&#x27;2025-05-24&#x27;</span>,</span><br><span class="line">    <span class="attr">views</span>: <span class="number">23500</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&#x27;https://www.openharmony.cn/developer2025&#x27;</span>,</span><br><span class="line">    <span class="attr">isLiked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">likeCount</span>: <span class="number">7000</span>,</span><br><span class="line">    <span class="attr">isBookmarked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">isExpanded</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">readTime</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">commentCount</span>: <span class="number">0</span>,  <span class="comment">// 补充缺失字段</span></span><br><span class="line">    <span class="attr">shareCount</span>: <span class="number">0</span>,    <span class="comment">// 补充缺失字段</span></span><br><span class="line">    <span class="attr">tags</span>:[<span class="string">&#x27;HarmonyOS&#x27;</span>],         <span class="comment">// 补充默认值</span></span><br><span class="line">    <span class="attr">categoryId</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">NewsItem</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;活动&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;解决方案学生挑战赛&#x27;</span>,</span><br><span class="line">    <span class="attr">subtitle</span>: <span class="string">&#x27;线上&#x27;</span>,</span><br><span class="line">    <span class="attr">image</span>: $r(<span class="string">&#x27;app.media.student2&#x27;</span>),</span><br><span class="line">    <span class="attr">timestamp</span>: <span class="string">&#x27;2022-06-08&#x27;</span>,</span><br><span class="line">    <span class="attr">views</span>: <span class="number">2560</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&#x27;https://www.openharmony.cn/growthPlan/&#x27;</span>,</span><br><span class="line">    <span class="attr">isLiked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">likeCount</span>: <span class="number">2560</span>,</span><br><span class="line">    <span class="attr">isBookmarked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">isExpanded</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">readTime</span>: <span class="number">15</span>,</span><br><span class="line">    <span class="attr">tags</span>: [<span class="string">&#x27;大赛&#x27;</span>, <span class="string">&#x27;openharmony&#x27;</span>],</span><br><span class="line">    <span class="attr">commentCount</span>: <span class="number">0</span>,  <span class="comment">// 补充缺失字段</span></span><br><span class="line">    <span class="attr">shareCount</span>: <span class="number">0</span>,    <span class="comment">// 补充缺失字段</span></span><br><span class="line">    <span class="attr">categoryId</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">NewsItem</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;活动&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;OpenHarmony技术大会&#x27;</span>,</span><br><span class="line">    <span class="attr">subtitle</span>: <span class="string">&#x27;上海世博中心&#x27;</span>,</span><br><span class="line">    <span class="attr">image</span>: $r(<span class="string">&#x27;app.media.study&#x27;</span>),</span><br><span class="line">    <span class="attr">views</span>: <span class="number">2200</span>,</span><br><span class="line">    <span class="attr">likeCount</span>: <span class="number">4560</span>,</span><br><span class="line">    <span class="attr">isLiked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">timestamp</span>: <span class="string">&#x27;2024-10-12&#x27;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&#x27;https://www.openharmony.cn/technology/&#x27;</span>,</span><br><span class="line">    <span class="attr">isBookmarked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">readTime</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">commentCount</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">shareCount</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">tags</span>: [<span class="string">&#x27;大会&#x27;</span>, <span class="string">&#x27;openharmony&#x27;</span>],</span><br><span class="line">    <span class="attr">isExpanded</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">categoryId</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">LiveNewsItem</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;直播&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;创新赛赋能直播&#x27;</span>,</span><br><span class="line">    <span class="attr">subtitle</span>: <span class="string">&#x27;如何开发APP&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="string">&#x27;王工程师&#x27;</span>,</span><br><span class="line">    <span class="attr">views</span>: <span class="number">33500</span>,</span><br><span class="line">    <span class="attr">isLiving</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">image</span>: $r(<span class="string">&#x27;app.media.lives&#x27;</span>),</span><br><span class="line">    <span class="attr">timestamp</span>: <span class="string">&#x27;03-16 20:00&#x27;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&#x27;https://www.bilibili.com/video/BV18G411i7bR/?spm_id_from=333.999.0.0&amp;vd_source=791e4b558742fd98bce5bd7f4a0d2120&#x27;</span>,</span><br><span class="line">    <span class="attr">tags</span>: [<span class="string">&#x27;直播视频&#x27;</span>, <span class="string">&#x27;openharmony&#x27;</span>],</span><br><span class="line">    <span class="attr">categoryId</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">isLiked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">isBookmarked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">isExpanded</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">likeCount</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">readTime</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">commentCount</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">shareCount</span>: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">BlogPostItem</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;博客&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;分布式菜单创建点餐神器&#x27;</span>,</span><br><span class="line">    <span class="attr">subtitle</span>: <span class="string">&#x27;节省顾客时间&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="string">&#x27;张工程师&#x27;</span>,</span><br><span class="line">    <span class="attr">content</span>: <span class="string">&#x27;本文详细讲解如何利用分布式能力...&#x27;</span>,</span><br><span class="line">    <span class="attr">image</span>: $r(<span class="string">&#x27;app.media.bo&#x27;</span>),</span><br><span class="line">    <span class="attr">views</span>: <span class="number">27500</span>,</span><br><span class="line">    <span class="attr">likeCount</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="attr">isLiked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">timestamp</span>: <span class="string">&#x27;2022-02-16&#x27;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&#x27;https://mp.weixin.qq.com/s/WHN75mnzJ0NtbAwySlEDJw&#x27;</span>,</span><br><span class="line">    <span class="attr">isBookmarked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">readTime</span>: <span class="number">15</span>,</span><br><span class="line">    <span class="attr">commentCount</span>: <span class="number">12</span>,</span><br><span class="line">    <span class="attr">shareCount</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">tags</span>: [<span class="string">&#x27;文章&#x27;</span>, <span class="string">&#x27;应用&#x27;</span>],</span><br><span class="line">    <span class="attr">isExpanded</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">categoryId</span>: <span class="number">3</span>,</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">NewsItem</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">7</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;新闻&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;第二届创新应用挑战赛&#x27;</span>,</span><br><span class="line">    <span class="attr">subtitle</span>: <span class="string">&#x27;技术交锋创意迸发&#x27;</span>,</span><br><span class="line">    <span class="attr">image</span>: $r(<span class="string">&#x27;app.media.sai&#x27;</span>),</span><br><span class="line">    <span class="attr">views</span>: <span class="number">2370</span>,</span><br><span class="line">    <span class="attr">likeCount</span>: <span class="number">479</span>,</span><br><span class="line">    <span class="attr">isLiked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">timestamp</span>: <span class="string">&#x27;2024-10-21&#x27;</span>,</span><br><span class="line">    <span class="attr">link</span>:<span class="string">&#x27;https://www.openharmony.cn/innovationcompete/compete&#x27;</span>,</span><br><span class="line">    <span class="attr">isBookmarked</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">readTime</span>: <span class="number">15</span>,</span><br><span class="line">    <span class="attr">commentCount</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">shareCount</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">tags</span>: [<span class="string">&#x27;大赛&#x27;</span>],</span><br><span class="line">    <span class="attr">isExpanded</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">categoryId</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>enm，没错它使用的是静态常量数据，并没有进行任何的数据获取，所以对我们的项目参考价值不大，然后我们再来看一看他是怎么展示的资讯。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebView容器</span></span><br><span class="line"><span class="title class_">Web</span>(&#123;</span><br><span class="line">  <span class="attr">src</span>: <span class="variable language_">this</span>.<span class="property">url</span>,</span><br><span class="line">  <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">onPageBegin</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">onPageEnd</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">onErrorReceive</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[ERROR] 网页加载失败:&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">    prompt.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;加载失败，请检查网络或网址&#x27;</span> &#125;);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>它仅仅是将数据中的网页链接给到了web组件，然后通过web组件来展示网页，我们的项目会收集很多网页的信息，若是仅仅是将网页链接给到web组件而不是通过统一的数据格式来进行展示的话，我们整体的UI一致性以及美观度都会差一大截，所以我们需要将爬取的数据进行统一化的格式处理。</p>
<p>所以总体看下来这个项目对当前的项目参考意义不大。</p>
<h3 id="资讯内容传递的格式"><a href="#资讯内容传递的格式" class="headerlink" title="资讯内容传递的格式"></a>资讯内容传递的格式</h3><p>上文提到了直接才用展示网页的形式并不可取，所以我们就需要选择一种数据格式来进行前后端数据的传递。</p>
<h4 id="明确需求"><a href="#明确需求" class="headerlink" title="明确需求"></a>明确需求</h4><p>首先我们需要明确一下需求，对于当前项目我们首先需要用爬虫爬取各个论坛的资讯内容，这些博文内容都是图文混排，同时可能包含有视频，所以我们的数据格式需要在传递文本之外还需要传递图片以及视频的链接。</p>
<p>我首先想到的就是我的Markdown格式，因为我的博客以及鸿小易还有其他一些项目使用的都是Markdown格式，且Markdown支持原生的图片链接格式，但问题在于Markdown格式中没有原生的视频格式。只能使用内挂HTML标签的形式去进行视频的上传。我并不确定在使用OpenHarmony三方库进行md渲染时会不会出现问题，所以暂时作为备案。</p>
<p><img src="https://bu.dusays.com/2025/07/08/686ccccad10e7.png" alt="1751960773950.png"></p>
<p>随后就是当下最常用的json格式。json格式我可以采用两种形式，一种是将爬取的HTML文件直接作为一整个字段进行传输然后使用web组件进行渲染确实可以。不过这个方案需要注意整体UI界面的一致性，这一点可能需要针对不同的网站获取到的数据进行定制化的处理。因为各个网站的文章内容部分很有可能会插入一些其他的样式，链接标签等，同时又因为鸿蒙中的Web组件并没有提供很多的属性来通过ArkTS直接调整、改变HTML的结构以及样式，所以我们需要在后端就完成对HTML的格式化处理，这样在鸿蒙中直接展示的时候就不会出现样式错乱的问题。</p>
<p><img src="https://bu.dusays.com/2025/07/08/686cce2e7dcc0.png" alt="1751961129379.png"></p>
<p>还有一种方式就是用<code>type</code>字段以及<code>value</code>字段来进行当前数据类型的区分，可以设置一个枚举类型规定三种数据类型，分别是<code>text</code>、<code>image</code>、<code>video</code>，然后根据不同的类型来决定<code>value</code>字段的值该被渲染为什么样的组件，通过这样的对象数组形式，利用循环渲染成文本、视频、图片组件。这样既可以传递文章的内容也可以正确的传递文章的结构。先暂时采用这种方式，并进行可行性验证。</p>
<h3 id="资讯的渲染形式"><a href="#资讯的渲染形式" class="headerlink" title="资讯的渲染形式"></a>资讯的渲染形式</h3><h2 id="方案设计与可行性验证"><a href="#方案设计与可行性验证" class="headerlink" title="方案设计与可行性验证"></a>方案设计与可行性验证</h2><h3 id="咨询信息获取"><a href="#咨询信息获取" class="headerlink" title="咨询信息获取"></a>咨询信息获取</h3><h4 id="OpenHarmony官网资讯"><a href="#OpenHarmony官网资讯" class="headerlink" title="OpenHarmony官网资讯"></a>OpenHarmony官网资讯</h4><p>首先我们要针对不同的网站编写不同的爬虫，所以我们首先要确认目标网站。</p>
<p>首先是OpenHarmony的官网，官网提供有很多的相关资讯，大多是以微信公众号的形式展现的，整体格式比较规整，我们先来进行爬取的尝试。</p>
<p><img src="https://bu.dusays.com/2025/07/08/686d0149b1aa2.png" alt="1751974181082.png"></p>
<p>我找到了OpenHarmony官网的咨询页面，虽然咨询本身是很容易爬取的，但是要是想要自动爬取整个咨询页面的全部文章，我们就需要先获取到咨询页面的全部文章链接，然后针对每个链接进行爬取，最后将爬取到的数据整合到一起，所以我们需要先获取到咨询页面的全部文章链接。</p>
<p><img src="https://bu.dusays.com/2025/07/08/686d01d4c0807.png" alt="1751974351946.png"></p>
<p>找到目标点击结构，对其进行分析。但在展开其单个文章卡片的全部结构之后并没有找到<code>&lt;a&gt;</code>标签，所以我们不能直接去爬取<code>&lt;a&gt;</code>标签中所指向的目标链接，这是典型的SPA（单页应用）架构。</p>
<p><img src="https://bu.dusays.com/2025/07/08/686d02d5afee0.png" alt="1751974611565.png"></p>
<p>随后我改变了策略，转而模拟用户的点击行为并检测URL的变化以及检测网络请求，从网络请求的API的响应中获取URL。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># openHarmony官网爬虫</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin, urlparse</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试导入Selenium，如果失败则使用备用方案</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">    <span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line">    <span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line">    <span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line">    <span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line">    <span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException, NoSuchElementException</span><br><span class="line">    SELENIUM_AVAILABLE = <span class="literal">True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Selenium已安装，将使用JavaScript渲染功能&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    SELENIUM_AVAILABLE = <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Selenium未安装，将使用普通HTTP请求模式&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenHarmonyCrawler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.base_url = <span class="string">&quot;https://www.openharmony.cn&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.session = requests.Session()</span><br><span class="line">        <span class="variable language_">self</span>.session.headers.update(&#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置Chrome浏览器选项（仅在Selenium可用时）</span></span><br><span class="line">        <span class="keyword">if</span> SELENIUM_AVAILABLE:</span><br><span class="line">            <span class="variable language_">self</span>.chrome_options = Options()</span><br><span class="line">            <span class="variable language_">self</span>.chrome_options.add_argument(<span class="string">&#x27;--headless&#x27;</span>)  <span class="comment"># 无头模式</span></span><br><span class="line">            <span class="variable language_">self</span>.chrome_options.add_argument(<span class="string">&#x27;--no-sandbox&#x27;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.chrome_options.add_argument(<span class="string">&#x27;--disable-dev-shm-usage&#x27;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.chrome_options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.chrome_options.add_argument(<span class="string">&#x27;--window-size=1920,1080&#x27;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.chrome_options.add_argument(<span class="string">f&#x27;--user-agent=<span class="subst">&#123;self.session.headers[<span class="string">&quot;User-Agent&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.chrome_options = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.driver = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init_driver</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化浏览器驱动&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> SELENIUM_AVAILABLE:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Selenium不可用，跳过浏览器驱动初始化&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="variable language_">self</span>.driver = webdriver.Chrome(options=<span class="variable language_">self</span>.chrome_options)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;浏览器驱动初始化成功&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;浏览器驱动初始化失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请确保已安装Chrome浏览器和ChromeDriver&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close_driver</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;关闭浏览器驱动&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.driver:</span><br><span class="line">            <span class="variable language_">self</span>.driver.quit()</span><br><span class="line">            <span class="variable language_">self</span>.driver = <span class="literal">None</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;浏览器驱动已关闭&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_page_content</span>(<span class="params">self, url</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取页面内容&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = <span class="variable language_">self</span>.session.get(url, timeout=<span class="number">10</span>)</span><br><span class="line">            response.raise_for_status()</span><br><span class="line">            response.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;获取页面失败: <span class="subst">&#123;url&#125;</span>, 错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_page_content_with_js</span>(<span class="params">self, url, wait_element_class=<span class="literal">None</span>, timeout=<span class="number">10</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;使用Selenium获取JavaScript渲染后的页面内容&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> SELENIUM_AVAILABLE <span class="keyword">or</span> <span class="keyword">not</span> <span class="variable language_">self</span>.driver:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="variable language_">self</span>.driver.get(url)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 等待特定元素加载完成</span></span><br><span class="line">            <span class="keyword">if</span> wait_element_class:</span><br><span class="line">                wait = WebDriverWait(<span class="variable language_">self</span>.driver, timeout)</span><br><span class="line">                wait.until(EC.presence_of_element_located((By.CLASS_NAME, wait_element_class)))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                time.sleep(<span class="number">3</span>)  <span class="comment"># 默认等待3秒</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.driver.page_source</span><br><span class="line">        <span class="keyword">except</span> TimeoutException:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;页面加载超时: <span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;获取页面失败: <span class="subst">&#123;url&#125;</span>, 错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify_url_exists</span>(<span class="params">self, url</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;验证URL是否存在&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = <span class="variable language_">self</span>.session.head(url, timeout=<span class="number">5</span>)</span><br><span class="line">            <span class="keyword">return</span> response.status_code == <span class="number">200</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extract_articles_from_data_attributes</span>(<span class="params">self, soup</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;从data属性中提取文章信息&quot;&quot;&quot;</span></span><br><span class="line">        articles = []</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;尝试从data属性提取文章信息...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 查找包含data-v属性的content-item</span></span><br><span class="line">        content_items = soup.find_all(<span class="string">&#x27;li&#x27;</span>, class_=<span class="string">&#x27;content-item&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(content_items):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 查找文章标题</span></span><br><span class="line">                title_elem = item.find(class_=<span class="string">&#x27;item-title&#x27;</span>)</span><br><span class="line">                title = title_elem.get_text().strip() <span class="keyword">if</span> title_elem <span class="keyword">else</span> <span class="string">f&quot;文章<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 查找日期</span></span><br><span class="line">                date_elem = item.find(class_=<span class="string">&#x27;item-time&#x27;</span>)</span><br><span class="line">                date = date_elem.get_text().strip() <span class="keyword">if</span> date_elem <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 查找描述</span></span><br><span class="line">                desc_elem = item.find(class_=<span class="string">&#x27;item-info&#x27;</span>)</span><br><span class="line">                description = desc_elem.get_text().strip() <span class="keyword">if</span> desc_elem <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;找到文章: <span class="subst">&#123;title&#125;</span> - <span class="subst">&#123;date&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 尝试从元素属性中提取ID</span></span><br><span class="line">                article_id = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 检查data属性</span></span><br><span class="line">                <span class="keyword">for</span> attr_name, attr_value <span class="keyword">in</span> item.attrs.items():</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&#x27;id&#x27;</span> <span class="keyword">in</span> attr_name.lower() <span class="keyword">or</span> <span class="string">&#x27;key&#x27;</span> <span class="keyword">in</span> attr_name.lower():</span><br><span class="line">                        article_id = <span class="built_in">str</span>(attr_value)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 如果没找到ID，尝试从文本内容中提取</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> article_id:</span><br><span class="line">                    <span class="comment"># 使用标题和日期生成一个唯一标识</span></span><br><span class="line">                    content_hash = hashlib.md5((title + date).encode()).hexdigest()[:<span class="number">8</span>]</span><br><span class="line">                    article_id = content_hash</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 构造可能的文章URL（基于常见的URL模式）</span></span><br><span class="line">                possible_urls = [</span><br><span class="line">                    <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/newsDetail?id=<span class="subst">&#123;article_id&#125;</span>&quot;</span>,</span><br><span class="line">                    <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/newsDetail/<span class="subst">&#123;article_id&#125;</span>&quot;</span>,</span><br><span class="line">                    <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/news/detail/<span class="subst">&#123;article_id&#125;</span>&quot;</span>,</span><br><span class="line">                    <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/article/<span class="subst">&#123;article_id&#125;</span>&quot;</span>,</span><br><span class="line">                    <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/newList?id=3&amp;articleId=<span class="subst">&#123;article_id&#125;</span>&quot;</span>,</span><br><span class="line">                ]</span><br><span class="line"></span><br><span class="line">                articles.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;title&#x27;</span>: title,</span><br><span class="line">                    <span class="string">&#x27;date&#x27;</span>: date,</span><br><span class="line">                    <span class="string">&#x27;description&#x27;</span>: description,</span><br><span class="line">                    <span class="string">&#x27;possible_urls&#x27;</span>: possible_urls</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;处理第<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>个文章项失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> articles</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extract_article_links</span>(<span class="params">self, news_list_url</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;从资讯列表页面提取文章链接&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 首先尝试使用Selenium获取动态内容</span></span><br><span class="line">        content = <span class="variable language_">self</span>.get_page_content_with_js(news_list_url, timeout=<span class="number">15</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> content:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Selenium获取失败，尝试使用requests&quot;</span>)</span><br><span class="line">            content = <span class="variable language_">self</span>.get_page_content(news_list_url)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> content:</span><br><span class="line">                <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        soup = BeautifulSoup(content, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">        article_links = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 保存页面内容到文件以便调试</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;debug_page_js.html&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(content)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;JavaScript渲染后的页面内容已保存到 debug_page_js.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;正在查找文章链接...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 新增：尝试从data属性提取文章信息</span></span><br><span class="line">        articles_data = <span class="variable language_">self</span>.extract_articles_from_data_attributes(soup)</span><br><span class="line">        <span class="keyword">if</span> articles_data:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;从页面结构中提取到 <span class="subst">&#123;<span class="built_in">len</span>(articles_data)&#125;</span> 个文章信息&quot;</span>)</span><br><span class="line">            <span class="comment"># 先尝试验证这些URL是否有效</span></span><br><span class="line">            <span class="keyword">for</span> article <span class="keyword">in</span> articles_data:</span><br><span class="line">                <span class="keyword">for</span> url <span class="keyword">in</span> article[<span class="string">&#x27;possible_urls&#x27;</span>]:</span><br><span class="line">                    <span class="keyword">if</span> <span class="variable language_">self</span>.verify_url_exists(url):</span><br><span class="line">                        article_links.append(url)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;验证有效URL: <span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果还是没找到，使用Selenium处理JavaScript点击事件</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> article_links <span class="keyword">and</span> <span class="variable language_">self</span>.driver:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;使用Selenium处理JavaScript导航...&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 等待页面完全加载</span></span><br><span class="line">                time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 查找content-item元素</span></span><br><span class="line">                content_items = <span class="variable language_">self</span>.driver.find_elements(By.CLASS_NAME, <span class="string">&quot;content-item&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;找到 <span class="subst">&#123;<span class="built_in">len</span>(content_items)&#125;</span> 个content-item元素&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> i, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(content_items[:<span class="number">5</span>]):  <span class="comment"># 限制处理前5个</span></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;处理第 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span> 个content-item...&quot;</span>)</span><br><span class="line"></span><br><span class="line">                        <span class="comment"># 获取当前URL作为基准</span></span><br><span class="line">                        original_url = <span class="variable language_">self</span>.driver.current_url</span><br><span class="line"></span><br><span class="line">                        <span class="comment"># 滚动到元素可见</span></span><br><span class="line">                        <span class="variable language_">self</span>.driver.execute_script(<span class="string">&quot;arguments[0].scrollIntoView(true);&quot;</span>, item)</span><br><span class="line">                        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">                        <span class="comment"># 点击元素</span></span><br><span class="line">                        item.click()</span><br><span class="line">                        time.sleep(<span class="number">3</span>)  <span class="comment"># 等待页面跳转</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment"># 检查是否跳转到新页面</span></span><br><span class="line">                        new_url = <span class="variable language_">self</span>.driver.current_url</span><br><span class="line">                        <span class="keyword">if</span> new_url != original_url:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;  + 成功跳转到: <span class="subst">&#123;new_url&#125;</span>&quot;</span>)</span><br><span class="line">                            article_links.append(new_url)</span><br><span class="line"></span><br><span class="line">                            <span class="comment"># 返回列表页</span></span><br><span class="line">                            <span class="variable language_">self</span>.driver.back()</span><br><span class="line">                            time.sleep(<span class="number">3</span>)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;  - 点击无效，URL未改变&quot;</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;  - 处理第 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span> 个元素失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                        <span class="comment"># 如果出错，尝试返回列表页</span></span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            <span class="variable language_">self</span>.driver.get(news_list_url)</span><br><span class="line">                            time.sleep(<span class="number">3</span>)</span><br><span class="line">                        <span class="keyword">except</span>:</span><br><span class="line">                            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> article_links:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;通过点击事件找到 <span class="subst">&#123;<span class="built_in">len</span>(article_links)&#125;</span> 个链接&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Selenium点击处理失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果仍然没找到，尝试查找所有链接</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> article_links:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;最后尝试：查找所有链接...&quot;</span>)</span><br><span class="line">            all_links = soup.find_all(<span class="string">&#x27;a&#x27;</span>, href=<span class="literal">True</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;页面共有 <span class="subst">&#123;<span class="built_in">len</span>(all_links)&#125;</span> 个链接&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> all_links:</span><br><span class="line">                href = link.get(<span class="string">&#x27;href&#x27;</span>)</span><br><span class="line">                link_text = link.get_text().strip()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 检查链接文本是否像新闻标题</span></span><br><span class="line">                <span class="keyword">if</span> href <span class="keyword">and</span> link_text <span class="keyword">and</span> <span class="built_in">len</span>(link_text) &gt; <span class="number">5</span>:</span><br><span class="line">                    <span class="comment"># 检查是否为相对链接或包含新闻相关关键词</span></span><br><span class="line">                    <span class="keyword">if</span> (href.startswith(<span class="string">&#x27;/&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">                            <span class="built_in">any</span>(keyword <span class="keyword">in</span> href.lower() <span class="keyword">for</span> keyword <span class="keyword">in</span> [<span class="string">&#x27;news&#x27;</span>, <span class="string">&#x27;article&#x27;</span>, <span class="string">&#x27;detail&#x27;</span>]) <span class="keyword">or</span></span><br><span class="line">                            <span class="built_in">any</span>(keyword <span class="keyword">in</span> link_text <span class="keyword">for</span> keyword <span class="keyword">in</span> [<span class="string">&#x27;新闻&#x27;</span>, <span class="string">&#x27;资讯&#x27;</span>, <span class="string">&#x27;动态&#x27;</span>, <span class="string">&#x27;公告&#x27;</span>, <span class="string">&#x27;发布&#x27;</span>])):</span><br><span class="line"></span><br><span class="line">                        full_url = urljoin(<span class="variable language_">self</span>.base_url, href)</span><br><span class="line">                        article_links.append(full_url)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;  + 找到疑似新闻链接: <span class="subst">&#123;full_url&#125;</span> - <span class="subst">&#123;link_text[:<span class="number">50</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 去重并过滤</span></span><br><span class="line">        <span class="keyword">if</span> article_links:</span><br><span class="line">            unique_links = []</span><br><span class="line">            seen = <span class="built_in">set</span>()</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> article_links:</span><br><span class="line">                <span class="keyword">if</span> link <span class="keyword">not</span> <span class="keyword">in</span> seen <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">any</span>(exclude <span class="keyword">in</span> link <span class="keyword">for</span> exclude <span class="keyword">in</span> [<span class="string">&#x27;javascript:&#x27;</span>, <span class="string">&#x27;mailto:&#x27;</span>, <span class="string">&#x27;#&#x27;</span>]):</span><br><span class="line">                    unique_links.append(link)</span><br><span class="line">                    seen.add(link)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;去重后共有 <span class="subst">&#123;<span class="built_in">len</span>(unique_links)&#125;</span> 个文章链接&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> unique_links[:<span class="number">10</span>]  <span class="comment"># 最多返回10个链接</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未找到任何文章链接&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_article_content</span>(<span class="params">self, article_url</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;解析单个文章页面的内容&quot;&quot;&quot;</span></span><br><span class="line">        content = <span class="variable language_">self</span>.get_page_content(article_url)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> content:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        soup = BeautifulSoup(content, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">        result_data = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 根据页面结构寻找文章主体内容容器</span></span><br><span class="line">        article_container = (</span><br><span class="line">                soup.find(<span class="built_in">id</span>=<span class="string">&#x27;js_content&#x27;</span>) <span class="keyword">or</span>  <span class="comment"># 主要的文章内容容器</span></span><br><span class="line">                soup.find(class_=<span class="string">&#x27;rich_media_content&#x27;</span>) <span class="keyword">or</span>  <span class="comment"># 富媒体内容容器</span></span><br><span class="line">                soup.find(<span class="built_in">id</span>=<span class="string">&#x27;page-content&#x27;</span>) <span class="keyword">or</span>  <span class="comment"># 页面内容容器</span></span><br><span class="line">                soup.find(class_=<span class="string">&#x27;rich_media_area_primary&#x27;</span>) <span class="keyword">or</span>  <span class="comment"># 主要媒体区域</span></span><br><span class="line">                soup.find(class_=re.<span class="built_in">compile</span>(<span class="string">r&#x27;article|content|detail&#x27;</span>, re.I)) <span class="keyword">or</span></span><br><span class="line">                soup.find(<span class="string">&#x27;article&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">                soup.find(<span class="built_in">id</span>=re.<span class="built_in">compile</span>(<span class="string">r&#x27;article|content|detail&#x27;</span>, re.I))</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> article_container:</span><br><span class="line">            <span class="comment"># 如果没找到专门的容器，尝试查找包含文章内容的其他容器</span></span><br><span class="line">            article_container = soup.find(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> article_container:</span><br><span class="line">            <span class="comment"># 遍历容器中的所有元素</span></span><br><span class="line">            <span class="keyword">for</span> element <span class="keyword">in</span> article_container.find_all([<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;h2&#x27;</span>, <span class="string">&#x27;h3&#x27;</span>, <span class="string">&#x27;h4&#x27;</span>, <span class="string">&#x27;h5&#x27;</span>, <span class="string">&#x27;h6&#x27;</span>, <span class="string">&#x27;div&#x27;</span>, <span class="string">&#x27;img&#x27;</span>, <span class="string">&#x27;video&#x27;</span>]):</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 处理文本内容</span></span><br><span class="line">                <span class="keyword">if</span> element.name <span class="keyword">in</span> [<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;h2&#x27;</span>, <span class="string">&#x27;h3&#x27;</span>, <span class="string">&#x27;h4&#x27;</span>, <span class="string">&#x27;h5&#x27;</span>, <span class="string">&#x27;h6&#x27;</span>, <span class="string">&#x27;div&#x27;</span>]:</span><br><span class="line">                    text = element.get_text().strip()</span><br><span class="line">                    <span class="keyword">if</span> text <span class="keyword">and</span> <span class="built_in">len</span>(text) &gt; <span class="number">10</span>:  <span class="comment"># 过滤掉太短的文本</span></span><br><span class="line">                        result_data.append(&#123;</span><br><span class="line">                            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;value&quot;</span>: text</span><br><span class="line">                        &#125;)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 处理图片</span></span><br><span class="line">                <span class="keyword">elif</span> element.name == <span class="string">&#x27;img&#x27;</span>:</span><br><span class="line">                    img_src = element.get(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> img_src:</span><br><span class="line">                        <span class="comment"># 构造完整的图片URL</span></span><br><span class="line">                        img_url = urljoin(<span class="variable language_">self</span>.base_url, img_src)</span><br><span class="line">                        result_data.append(&#123;</span><br><span class="line">                            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;value&quot;</span>: img_url</span><br><span class="line">                        &#125;)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 处理视频</span></span><br><span class="line">                <span class="keyword">elif</span> element.name == <span class="string">&#x27;video&#x27;</span>:</span><br><span class="line">                    video_src = element.get(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> video_src:</span><br><span class="line">                        video_url = urljoin(<span class="variable language_">self</span>.base_url, video_src)</span><br><span class="line">                        result_data.append(&#123;</span><br><span class="line">                            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;video&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;value&quot;</span>: video_url</span><br><span class="line">                        &#125;)</span><br><span class="line">                    <span class="comment"># 检查video标签内的source元素</span></span><br><span class="line">                    source_elements = element.find_all(<span class="string">&#x27;source&#x27;</span>)</span><br><span class="line">                    <span class="keyword">for</span> source <span class="keyword">in</span> source_elements:</span><br><span class="line">                        video_src = source.get(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">                        <span class="keyword">if</span> video_src:</span><br><span class="line">                            video_url = urljoin(<span class="variable language_">self</span>.base_url, video_src)</span><br><span class="line">                            result_data.append(&#123;</span><br><span class="line">                                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;video&quot;</span>,</span><br><span class="line">                                <span class="string">&quot;value&quot;</span>: video_url</span><br><span class="line">                            &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result_data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">crawl_openharmony_news</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;爬取OpenHarmony资讯内容&quot;&quot;&quot;</span></span><br><span class="line">        news_list_url = <span class="string">&quot;https://www.openharmony.cn/newList?id=3&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;开始爬取资讯列表页面: <span class="subst">&#123;news_list_url&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化浏览器驱动</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.init_driver():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;无法初始化浏览器驱动，将使用普通requests方式&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 获取文章链接</span></span><br><span class="line">            article_links = <span class="variable language_">self</span>.extract_article_links(news_list_url)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> article_links:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;未找到任何文章链接&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;共找到 <span class="subst">&#123;<span class="built_in">len</span>(article_links)&#125;</span> 篇文章&quot;</span>)</span><br><span class="line"></span><br><span class="line">            all_articles_data = []</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 爬取每篇文章的内容</span></span><br><span class="line">            <span class="keyword">for</span> i, article_url <span class="keyword">in</span> <span class="built_in">enumerate</span>(article_links[:<span class="number">3</span>]):  <span class="comment"># 限制爬取前3篇文章，避免过度请求</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n正在爬取第 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span> 篇文章: <span class="subst">&#123;article_url&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                article_data = <span class="variable language_">self</span>.parse_article_content(article_url)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> article_data:</span><br><span class="line">                    article_info = &#123;</span><br><span class="line">                        <span class="string">&quot;url&quot;</span>: article_url,</span><br><span class="line">                        <span class="string">&quot;content&quot;</span>: article_data</span><br><span class="line">                    &#125;</span><br><span class="line">                    all_articles_data.append(article_info)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;成功解析文章，共 <span class="subst">&#123;<span class="built_in">len</span>(article_data)&#125;</span> 个内容块&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;文章内容解析失败&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 添加延迟避免请求过快</span></span><br><span class="line">                time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 输出JSON结果</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;爬取结果JSON:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">            json_output = json.dumps(all_articles_data, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span>(json_output)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> all_articles_data</span><br><span class="line"></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="comment"># 确保关闭浏览器驱动</span></span><br><span class="line">            <span class="variable language_">self</span>.close_driver()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;OpenHarmony官网新闻爬虫启动...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;注意：此脚本需要安装以下依赖:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  pip install requests beautifulsoup4 selenium&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  同时需要安装Chrome浏览器和ChromeDriver&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;如果没有安装，将自动回退到普通HTTP请求模式&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">    crawler = OpenHarmonyCrawler()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        results = crawler.crawl_openharmony_news()</span><br><span class="line">        <span class="keyword">if</span> results:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n爬取完成，共处理 <span class="subst">&#123;<span class="built_in">len</span>(results)&#125;</span> 篇文章&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n爬取完成，但未找到任何文章&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;爬取过程中出现错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">import</span> traceback</span><br><span class="line">        traceback.print_exc()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># 确保清理资源</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(crawler, <span class="string">&#x27;driver&#x27;</span>) <span class="keyword">and</span> crawler.driver:</span><br><span class="line">            crawler.close_driver()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">D:\Anaconda\python.exe D:\HarmonyAppS\NowInOpenHarmony\ostest_integration_test\scenario\NowInOpenHarmony\Server\OpenHarmonypy.py </span><br><span class="line">Selenium已安装，将使用JavaScript渲染功能</span><br><span class="line">OpenHarmony官网新闻爬虫启动...</span><br><span class="line">注意：此脚本需要安装以下依赖:</span><br><span class="line">  pip install requests beautifulsoup4 selenium</span><br><span class="line">  同时需要安装Chrome浏览器和ChromeDriver</span><br><span class="line">如果没有安装，将自动回退到普通HTTP请求模式</span><br><span class="line">--------------------------------------------------</span><br><span class="line">开始爬取资讯列表页面: https://www.openharmony.cn/newList?<span class="built_in">id</span>=<span class="number">3</span></span><br><span class="line">浏览器驱动初始化成功</span><br><span class="line">JavaScript渲染后的页面内容已保存到 debug_page_js.html</span><br><span class="line">正在查找文章链接...</span><br><span class="line">尝试从data属性提取文章信息...</span><br><span class="line">找到文章: 对话OpenHarmony开源先锋：如何用代码革新终端生态 - <span class="number">2025.02</span><span class="number">.28</span></span><br><span class="line">找到文章: <span class="number">12</span>强终极PK！第二届OpenHarmony创新应用挑战赛引爆开源热潮 - <span class="number">2025.02</span><span class="number">.24</span></span><br><span class="line">找到文章: 第二届OpenHarmony创新应用挑战赛决赛路演队伍揭晓 - <span class="number">2025.02</span><span class="number">.20</span></span><br><span class="line">找到文章: OpenHarmony社区<span class="number">2024</span>年度运营报告发布，致谢每一位生态共建者！ - <span class="number">2025.02</span><span class="number">.11</span></span><br><span class="line">找到文章: 开源鸿蒙社区恭祝全体开发者<span class="number">2025</span>新年快乐，新春大吉！ - <span class="number">2025.01</span><span class="number">.29</span></span><br><span class="line">找到文章: 共绘<span class="number">2025</span>年开源新蓝图，OpenHarmony社区项目管理委员会年度工作会议在深圳成功举办 - <span class="number">2025.01</span><span class="number">.27</span></span><br><span class="line">找到文章: 对话OpenHarmony开源先锋：如何用代码革新终端生态 - <span class="number">2025.02</span><span class="number">.28</span></span><br><span class="line">找到文章: <span class="number">12</span>强终极PK！第二届OpenHarmony创新应用挑战赛引爆开源热潮 - <span class="number">2025.02</span><span class="number">.24</span></span><br><span class="line">找到文章: 第二届OpenHarmony创新应用挑战赛决赛路演队伍揭晓 - <span class="number">2025.02</span><span class="number">.20</span></span><br><span class="line">找到文章: OpenHarmony社区<span class="number">2024</span>年度运营报告发布，致谢每一位生态共建者！ - <span class="number">2025.02</span><span class="number">.11</span></span><br><span class="line">找到文章: 开源鸿蒙社区恭祝全体开发者<span class="number">2025</span>新年快乐，新春大吉！ - <span class="number">2025.01</span><span class="number">.29</span></span><br><span class="line">找到文章: 共绘<span class="number">2025</span>年开源新蓝图，OpenHarmony社区项目管理委员会年度工作会议在深圳成功举办 - <span class="number">2025.01</span><span class="number">.27</span></span><br><span class="line">从页面结构中提取到 <span class="number">12</span> 个文章信息</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=6ffe8bf2</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=4846eac5</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=6cba5071</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=6f5b68a4</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=059ed888</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=4683d67c</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=6ffe8bf2</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=4846eac5</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=6cba5071</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=6f5b68a4</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=059ed888</span><br><span class="line">验证有效URL: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=4683d67c</span><br><span class="line">去重后共有 <span class="number">6</span> 个文章链接</span><br><span class="line">共找到 <span class="number">6</span> 篇文章</span><br><span class="line"></span><br><span class="line">正在爬取第 <span class="number">1</span> 篇文章: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=6ffe8bf2</span><br><span class="line">文章内容解析失败</span><br><span class="line"></span><br><span class="line">正在爬取第 <span class="number">2</span> 篇文章: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=4846eac5</span><br><span class="line">文章内容解析失败</span><br><span class="line"></span><br><span class="line">正在爬取第 <span class="number">3</span> 篇文章: https://www.openharmony.cn/newsDetail?<span class="built_in">id</span>=6cba5071</span><br><span class="line">文章内容解析失败</span><br><span class="line"></span><br><span class="line">==================================================</span><br><span class="line">爬取结果JSON:</span><br><span class="line">==================================================</span><br><span class="line">[]</span><br><span class="line">浏览器驱动已关闭</span><br><span class="line"></span><br><span class="line">爬取完成，但未找到任何文章</span><br><span class="line"></span><br><span class="line">进程已结束，退出代码为 <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>这一版的效果并不好，爬到了一些URL，但在访问之后都是404页面，所以需要进一步改进。</p>
<p>这主要是因为URL中的ID并非真实ID为了解决这个问题我再次对浏览器的网络请求进行抓包分析。</p>
<p><img src="https://bu.dusays.com/2025/07/08/686d0b7d8248c.png" alt="1751976824948.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;成功&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageSize&quot;</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="string">&quot;pageNum&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;totalPage&quot;</span>: <span class="number">68</span>,</span><br><span class="line">    <span class="string">&quot;totalNum&quot;</span>: <span class="number">407</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">1533</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: <span class="string">&quot;对话OpenHarmony开源先锋：如何用代码革新终端生态&quot;</span>,</span><br><span class="line">            <span class="string">&quot;source&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="string">&quot;2025年2月23日，由开放原子开源基金会主办的第二届OpenHarmony创新应用挑战赛决赛路演在北京圆满结束，作为第二届开放原子大赛的重要赛项之一，本届赛事汇聚全球418支团队，产出超过110个创新作品，集中展示了OpenHarmony在应用与游戏开发领域的前沿成果。&quot;</span>,</span><br><span class="line">            <span class="string">&quot;textDetails&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;backgroundImage&quot;</span>: <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E8%B5%84%E8%AE%AF/%E6%B4%BB%E5%8A%A8%E5%9B%9E%E9%A1%BE.png&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/cHsMzPTmoYec-_VL6VllBQ&quot;</span>,</span><br><span class="line">            <span class="string">&quot;advertiseImage&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;advertiseUrl&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;startTime&quot;</span>: <span class="string">&quot;2025.02.28&quot;</span>,</span><br><span class="line">            <span class="string">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;label&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;recommend&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;likesCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;shareCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;browseCount&quot;</span>: <span class="number">692</span>,</span><br><span class="line">            <span class="string">&quot;skip&quot;</span>: <span class="string">&quot;0&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">1532</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: <span class="string">&quot;12强终极PK！第二届OpenHarmony创新应用挑战赛引爆开源热潮&quot;</span>,</span><br><span class="line">            <span class="string">&quot;source&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="string">&quot;在智能化与万物互联的浪潮中，科技的每一次突破都可能颠覆未来格局。2024年10月21日，由开放原子开源基金会主办，OpenHarmony项目群工作委员会、厦门雅基软件有限公司联合承办的第二届OpenHarmony创新应用挑战赛正式启动。&quot;</span>,</span><br><span class="line">            <span class="string">&quot;textDetails&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;backgroundImage&quot;</span>: <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E8%B5%84%E8%AE%AF/%E6%B4%BB%E5%8A%A8%E5%9B%9E%E9%A1%BE.png&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/2EeeruCTcZEq1qbydrgsKw&quot;</span>,</span><br><span class="line">            <span class="string">&quot;advertiseImage&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;advertiseUrl&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;startTime&quot;</span>: <span class="string">&quot;2025.02.24&quot;</span>,</span><br><span class="line">            <span class="string">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;label&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;recommend&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;likesCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;shareCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;browseCount&quot;</span>: <span class="number">366</span>,</span><br><span class="line">            <span class="string">&quot;skip&quot;</span>: <span class="string">&quot;0&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">1531</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: <span class="string">&quot;第二届OpenHarmony创新应用挑战赛决赛路演队伍揭晓&quot;</span>,</span><br><span class="line">            <span class="string">&quot;source&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="string">&quot;第二届OpenHarmony创新应用挑战赛决赛路演队伍揭晓&quot;</span>,</span><br><span class="line">            <span class="string">&quot;textDetails&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;backgroundImage&quot;</span>: <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E8%B5%84%E8%AE%AF/%E6%B4%BB%E5%8A%A8%E5%9B%9E%E9%A1%BE.png&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/scsUs8XKUMWp_kelThSetA&quot;</span>,</span><br><span class="line">            <span class="string">&quot;advertiseImage&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;advertiseUrl&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;startTime&quot;</span>: <span class="string">&quot;2025.02.20&quot;</span>,</span><br><span class="line">            <span class="string">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;label&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;recommend&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;likesCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;shareCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;browseCount&quot;</span>: <span class="number">166</span>,</span><br><span class="line">            <span class="string">&quot;skip&quot;</span>: <span class="string">&quot;0&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">1530</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: <span class="string">&quot;OpenHarmony社区2024年度运营报告发布，致谢每一位生态共建者！&quot;</span>,</span><br><span class="line">            <span class="string">&quot;source&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="string">&quot;OpenHarmony社区2024年度运营报告发布！&quot;</span>,</span><br><span class="line">            <span class="string">&quot;textDetails&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;backgroundImage&quot;</span>: <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E8%B5%84%E8%AE%AF/%E6%B4%BB%E5%8A%A8%E5%9B%9E%E9%A1%BE.png&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/njNirZfZFhwztz9zNnuc-A&quot;</span>,</span><br><span class="line">            <span class="string">&quot;advertiseImage&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;advertiseUrl&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;startTime&quot;</span>: <span class="string">&quot;2025.02.11&quot;</span>,</span><br><span class="line">            <span class="string">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;label&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;recommend&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;likesCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;shareCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;browseCount&quot;</span>: <span class="number">121</span>,</span><br><span class="line">            <span class="string">&quot;skip&quot;</span>: <span class="string">&quot;0&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">1528</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: <span class="string">&quot;开源鸿蒙社区恭祝全体开发者2025新年快乐，新春大吉！&quot;</span>,</span><br><span class="line">            <span class="string">&quot;source&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="string">&quot;恭祝全体开发者2025新年快乐，新春大吉！&quot;</span>,</span><br><span class="line">            <span class="string">&quot;textDetails&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;backgroundImage&quot;</span>: <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E8%B5%84%E8%AE%AF/%E6%B4%BB%E5%8A%A8%E5%9B%9E%E9%A1%BE.png&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/fVn6brUk2EnPbUcc3pLeCA&quot;</span>,</span><br><span class="line">            <span class="string">&quot;advertiseImage&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;advertiseUrl&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;startTime&quot;</span>: <span class="string">&quot;2025.01.29&quot;</span>,</span><br><span class="line">            <span class="string">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;label&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;recommend&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;likesCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;shareCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;browseCount&quot;</span>: <span class="number">62</span>,</span><br><span class="line">            <span class="string">&quot;skip&quot;</span>: <span class="string">&quot;0&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">1527</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: <span class="string">&quot;共绘2025年开源新蓝图，OpenHarmony社区项目管理委员会年度工作会议在深圳成功举办&quot;</span>,</span><br><span class="line">            <span class="string">&quot;source&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="string">&quot;2025年1月12日上午，OpenHarmony社区项目管理委员会（PMC）（以下简称“PMC”）年度工作会议在深圳召开。本次会议全面总结了2024年PMC的工作及成果，以及明确了2025年PMC工作方向和重点工作，为OpenHarmony社区在2025年持续快速发展及繁荣打下厚实基础。&quot;</span>,</span><br><span class="line">            <span class="string">&quot;textDetails&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;backgroundImage&quot;</span>: <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E8%B5%84%E8%AE%AF/%E6%B4%BB%E5%8A%A8%E5%9B%9E%E9%A1%BE.png&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/0q1ThRgDGocGMWp1ufHHrA&quot;</span>,</span><br><span class="line">            <span class="string">&quot;advertiseImage&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;advertiseUrl&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;startTime&quot;</span>: <span class="string">&quot;2025.01.27&quot;</span>,</span><br><span class="line">            <span class="string">&quot;endTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">&quot;label&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;recommend&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;likesCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;shareCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;browseCount&quot;</span>: <span class="number">103</span>,</span><br><span class="line">            <span class="string">&quot;skip&quot;</span>: <span class="string">&quot;0&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获取这个对象数组之后我们就可以转变思路，先去访问<code>https://www.openharmony.cn/newList?id=3</code>这个网址去点击任意一个content-item后，通过网络监测获取最新响应数据，然后解析json获取目标URL，最后再访问这个URL获取最新内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenHarmonyCrawler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.base_url = <span class="string">&quot;https://www.openharmony.cn&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.session = requests.Session()</span><br><span class="line">        <span class="variable language_">self</span>.session.headers.update(&#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_page_content</span>(<span class="params">self, url</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = <span class="variable language_">self</span>.session.get(url, timeout=<span class="number">10</span>)</span><br><span class="line">            response.raise_for_status()</span><br><span class="line">            response.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;获取页面失败: <span class="subst">&#123;url&#125;</span>, 错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_article_content</span>(<span class="params">self, article_url</span>):</span><br><span class="line">        content = <span class="variable language_">self</span>.get_page_content(article_url)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> content:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        soup = BeautifulSoup(content, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">        result_data = []</span><br><span class="line">        article_container = (</span><br><span class="line">            soup.find(<span class="built_in">id</span>=<span class="string">&#x27;js_content&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">            soup.find(class_=<span class="string">&#x27;rich_media_content&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">            soup.find(<span class="built_in">id</span>=<span class="string">&#x27;page-content&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">            soup.find(class_=<span class="string">&#x27;rich_media_area_primary&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">            soup.find(class_=re.<span class="built_in">compile</span>(<span class="string">r&#x27;article|content|detail&#x27;</span>, re.I)) <span class="keyword">or</span></span><br><span class="line">            soup.find(<span class="string">&#x27;article&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">            soup.find(<span class="built_in">id</span>=re.<span class="built_in">compile</span>(<span class="string">r&#x27;article|content|detail&#x27;</span>, re.I))</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> article_container:</span><br><span class="line">            article_container = soup.find(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> article_container:</span><br><span class="line">            <span class="keyword">for</span> element <span class="keyword">in</span> article_container.find_all([<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;h2&#x27;</span>, <span class="string">&#x27;h3&#x27;</span>, <span class="string">&#x27;h4&#x27;</span>, <span class="string">&#x27;h5&#x27;</span>, <span class="string">&#x27;h6&#x27;</span>, <span class="string">&#x27;div&#x27;</span>, <span class="string">&#x27;img&#x27;</span>, <span class="string">&#x27;video&#x27;</span>]):</span><br><span class="line">                <span class="keyword">if</span> element.name <span class="keyword">in</span> [<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;h2&#x27;</span>, <span class="string">&#x27;h3&#x27;</span>, <span class="string">&#x27;h4&#x27;</span>, <span class="string">&#x27;h5&#x27;</span>, <span class="string">&#x27;h6&#x27;</span>, <span class="string">&#x27;div&#x27;</span>]:</span><br><span class="line">                    text = element.get_text().strip()</span><br><span class="line">                    <span class="keyword">if</span> text <span class="keyword">and</span> <span class="built_in">len</span>(text) &gt; <span class="number">10</span>:</span><br><span class="line">                        result_data.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;value&quot;</span>: text&#125;)</span><br><span class="line">                <span class="keyword">elif</span> element.name == <span class="string">&#x27;img&#x27;</span>:</span><br><span class="line">                    img_src = element.get(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> img_src:</span><br><span class="line">                        img_url = urljoin(<span class="variable language_">self</span>.base_url, img_src)</span><br><span class="line">                        result_data.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>, <span class="string">&quot;value&quot;</span>: img_url&#125;)</span><br><span class="line">                <span class="keyword">elif</span> element.name == <span class="string">&#x27;video&#x27;</span>:</span><br><span class="line">                    video_src = element.get(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> video_src:</span><br><span class="line">                        video_url = urljoin(<span class="variable language_">self</span>.base_url, video_src)</span><br><span class="line">                        result_data.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;video&quot;</span>, <span class="string">&quot;value&quot;</span>: video_url&#125;)</span><br><span class="line">                    <span class="keyword">for</span> source <span class="keyword">in</span> element.find_all(<span class="string">&#x27;source&#x27;</span>):</span><br><span class="line">                        video_src = source.get(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">                        <span class="keyword">if</span> video_src:</span><br><span class="line">                            video_url = urljoin(<span class="variable language_">self</span>.base_url, video_src)</span><br><span class="line">                            result_data.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;video&quot;</span>, <span class="string">&quot;value&quot;</span>: video_url&#125;)</span><br><span class="line">        <span class="keyword">return</span> result_data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">crawl_openharmony_news</span>(<span class="params">self</span>):</span><br><span class="line">        api_url = <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/backend/knowledge/secondaryPage/queryBatch?type=3&amp;pageNum=1&amp;pageSize=6&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;请求API: <span class="subst">&#123;api_url&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = <span class="variable language_">self</span>.session.get(api_url, timeout=<span class="number">10</span>)</span><br><span class="line">            resp.raise_for_status()</span><br><span class="line">            data = resp.json().get(<span class="string">&quot;data&quot;</span>, [])</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;API请求失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        all_articles_data = []</span><br><span class="line">        <span class="keyword">for</span> i, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">            title = item.get(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            date = item.get(<span class="string">&quot;startTime&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            article_url = item.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> article_url:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;第<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>条新闻没有url字段，跳过&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n正在爬取第 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span> 篇文章: <span class="subst">&#123;title&#125;</span> | <span class="subst">&#123;article_url&#125;</span>&quot;</span>)</span><br><span class="line">            article_data = <span class="variable language_">self</span>.parse_article_content(article_url)</span><br><span class="line">            <span class="keyword">if</span> article_data:</span><br><span class="line">                article_info = &#123;</span><br><span class="line">                    <span class="string">&quot;title&quot;</span>: title,</span><br><span class="line">                    <span class="string">&quot;date&quot;</span>: date,</span><br><span class="line">                    <span class="string">&quot;url&quot;</span>: article_url,</span><br><span class="line">                    <span class="string">&quot;content&quot;</span>: article_data</span><br><span class="line">                &#125;</span><br><span class="line">                all_articles_data.append(article_info)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;成功解析文章，共 <span class="subst">&#123;<span class="built_in">len</span>(article_data)&#125;</span> 个内容块&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;文章内容解析失败&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;爬取结果JSON:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">        json_output = json.dumps(all_articles_data, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(json_output)</span><br><span class="line">        <span class="keyword">return</span> all_articles_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;OpenHarmony官网新闻爬虫启动...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;注意：此脚本需要安装以下依赖:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  pip install requests beautifulsoup4&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    crawler = OpenHarmonyCrawler()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        results = crawler.crawl_openharmony_news()</span><br><span class="line">        <span class="keyword">if</span> results:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n爬取完成，共处理 <span class="subst">&#123;<span class="built_in">len</span>(results)&#125;</span> 篇文章&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n爬取完成，但未找到任何文章&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;爬取过程中出现错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">import</span> traceback</span><br><span class="line">        traceback.print_exc()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line">OpenHarmony官网新闻爬虫启动...</span><br><span class="line">注意：此脚本需要安装以下依赖<span class="punctuation">:</span></span><br><span class="line">  pip install requests beautifulsoup4</span><br><span class="line">--------------------------------------------------</span><br><span class="line">请求API<span class="punctuation">:</span> https<span class="punctuation">:</span><span class="comment">//www.openharmony.cn/backend/knowledge/secondaryPage/queryBatch?type=3&amp;pageNum=1&amp;pageSize=6</span></span><br><span class="line"></span><br><span class="line">正在爬取第 <span class="number">1</span> 篇文章<span class="punctuation">:</span> 对话OpenHarmony开源先锋：如何用代码革新终端生态 | https<span class="punctuation">:</span><span class="comment">//mp.weixin.qq.com/s/cHsMzPTmoYec-_VL6VllBQ</span></span><br><span class="line">成功解析文章，共 <span class="number">21</span> 个内容块</span><br><span class="line"></span><br><span class="line">正在爬取第 <span class="number">2</span> 篇文章<span class="punctuation">:</span> <span class="number">12</span>强终极PK！第二届OpenHarmony创新应用挑战赛引爆开源热潮 | https<span class="punctuation">:</span><span class="comment">//mp.weixin.qq.com/s/2EeeruCTcZEq1qbydrgsKw</span></span><br><span class="line">文章内容解析失败</span><br><span class="line"></span><br><span class="line">正在爬取第 <span class="number">3</span> 篇文章<span class="punctuation">:</span> 第二届OpenHarmony创新应用挑战赛决赛路演队伍揭晓 | https<span class="punctuation">:</span><span class="comment">//mp.weixin.qq.com/s/scsUs8XKUMWp_kelThSetA</span></span><br><span class="line">文章内容解析失败</span><br><span class="line"></span><br><span class="line">正在爬取第 <span class="number">4</span> 篇文章<span class="punctuation">:</span> OpenHarmony社区<span class="number">2024</span>年度运营报告发布，致谢每一位生态共建者！ | https<span class="punctuation">:</span><span class="comment">//mp.weixin.qq.com/s/njNirZfZFhwztz9zNnuc-A</span></span><br><span class="line">文章内容解析失败</span><br><span class="line"></span><br><span class="line">正在爬取第 <span class="number">5</span> 篇文章<span class="punctuation">:</span> 开源鸿蒙社区恭祝全体开发者<span class="number">2025</span>新年快乐，新春大吉！ | https<span class="punctuation">:</span><span class="comment">//mp.weixin.qq.com/s/fVn6brUk2EnPbUcc3pLeCA</span></span><br><span class="line">文章内容解析失败</span><br><span class="line"></span><br><span class="line">正在爬取第 <span class="number">6</span> 篇文章<span class="punctuation">:</span> 共绘<span class="number">2025</span>年开源新蓝图，OpenHarmony社区项目管理委员会年度工作会议在深圳成功举办 | https<span class="punctuation">:</span><span class="comment">//mp.weixin.qq.com/s/0q1ThRgDGocGMWp1ufHHrA</span></span><br><span class="line">成功解析文章，共 <span class="number">27</span> 个内容块</span><br><span class="line"></span><br><span class="line">==================================================</span><br><span class="line">爬取结果JSON<span class="punctuation">:</span></span><br><span class="line">==================================================</span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;对话OpenHarmony开源先锋：如何用代码革新终端生态&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025.02.28&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mp.weixin.qq.com/s/cHsMzPTmoYec-_VL6VllBQ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025年2月23日，由开放原子开源基金会主办的第二届OpenHarmony创新应用挑战赛决赛路演在北京圆满结束，作为第二届开放原子大赛的重要赛项之一，本届赛事汇聚全球418支团队，产出超过110个创新作品，集中展示了OpenHarmony在应用与游戏开发领域的前沿成果。这些凝聚智慧与协作的参赛作品，不仅在技术层面实现了多项突破，更在商业化应用层面验证了开源生态的无限潜力。赛事不仅彰显了开发者群体的创新活力，也凸显了OpenHarmony作为技术底座的重要价值，为开源技术生态发展注入革新的力量。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;当代码与创意在OpenHarmony的数字沃土中生根发芽，我们不禁期待，这些开发者如何用实践诠释开源精神？他们的探索历程又蕴藏着怎样的创新思维？让我们跟随优秀团队，解开技术突破与生态协同的共生密码。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenHarmony创新应用赛题：让书柜学会“思考”&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;由“新大陆自动识别”团队开发的《智能书导》项目，是基于开源操作系统 OpenHarmony打造的图书馆管理应用，通过融合RFID 技术，实现图书馆管理流程的高效优化。团队开发该方案的初衷是帮助图书馆高效地完成图书借阅、查询等工作，减轻管理员负担，同时希望将技术推广至物流、商超、工厂等更多场景，拓展应用范围。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;《智能书导》项目通过技术融合创新，深度整合OpenHarmony系统的分布式能力与RFID自动识别技术，利用前者实现图书信息的高效共享，借助后者完成图书的自动识别与数据交互。功能上，该项目集成了快速借还书、精准定位等核心功能，以及今日推荐等辅助功能，全面满足图书馆管理与读者服务需求。应用程序适配OpenHarmony 4.1 Release和5.0.2.50系统，可在多种设备上流畅运行，项目所用硬件也已通过兼容性测评，确保软硬件的无缝集成与高效协同。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;《智能书导》的开发者徐金生表示：“未来团队将把项目核心代码贡献至OpenHarmony主干代码库，推动各模块与性能的提升。同时，计划进一步优化技术瓶颈，拓展项目对更多设备的适配能力。”&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenHarmony创新应用赛题：用技术魔法规划繁琐旅行&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;由“领先风暴队”开发的《出行妈妈》项目，主要是为了解决旅行者在行程规划繁琐、信息整合困难以及个性化需求难以满足三大方面的痛点，提供省时省力的完美行程定制解决方案。该项目填补了OpenHarmony在旅游规划领域的空白，深度融合OpenHarmony 5.0.0 Release特性与旅游出行需求，提供 “规划+路线+玩法” 的一站式服务，支持出行规划记录与最佳路线推荐，为用户打造智能化旅行体验。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;通过bindSheet绑定半模态组件，利用emitter实现跨组件通信，支持拖拽排序、原生时间组件及API12服务卡片的实时同步，并结合Flex+Scroll弹性布局适配动态界面，《出行妈妈》以技术魔法将复杂的旅行“任务”化繁为简。未来，团队将持续优化作品，计划引入分布式数据管理、AI驱动的个性化规划定制以及社区交互等功能，进一步提升用户体验。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;在开发过程中，团队撰写了20余篇技术博客并发布至开源社区，其中多篇登上社区头条。后续，团队计划将项目中的自定义组件，如城市选择、时间选择和日历等，贡献至OpenHarmony主干代码库。作为一支年轻团队，参赛过程不仅显著提升了协作能力，也为团队积累了宝贵的实践经验。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Cocos游戏创新应用赛题：从孩童幻想到次世代飞行器&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;“gamemcu”团队打造的《星际穿越》项目，是一款高画质次世代模拟飞行游戏。玩家通过电视屏幕，即可见证掌心玩具蜕变为可操控的星际战舰，在动态的星云间完成飞行模拟。提到游戏背景，开发者陈炫烨说道：“灵感源于我的儿子，因为我经常能看到我儿子拿着玩具进行飞行模拟，于是我就把他的想象变成了一款游戏。”&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;《星际穿越》的核心优势在于其卓越的游戏渲染与镜头模拟技术。团队通过自定义高清渲染管线、重构PBR材质系统、高品质后期处理以及多边形GPU粒子系统等多项技术方案，精准还原环境光照，真实模拟人手抓取物体的触感，最终呈现出令人惊艳的飞船驾驶模拟体验。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;此前，基于Cocos开发的游戏多以风格化为主，而团队勇于突破，首次尝试了次世代效果。未来，团队将通过教程、技术指引等开源方式，帮助更多开发者了解项目，降低开发门槛。希望这个源于父子温情的太空幻想，能够激发更多开发者对次世代游戏的创作热情。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Cocos游戏创新应用赛题：因为热爱，所以存在&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;由“路妖姬”团队开发的《引力线流星》项目，是一款宇宙题材的沙盒生存游戏。玩家将操控流浪地球，在复杂的宇宙引力环境中探索生存，建造飞船单位，并与外星文明展开资源争夺。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;项目的核心优势在于对引力模拟的前沿探索，填补了OpenHarmony在游戏领域的空白。游戏采用2D物理系统精准模拟星球间的引力相互作用与轨道运动，为玩家打造高度拟真的宇宙物理环境与沉浸式体验。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;作为携《引力线流星》项目首次参赛的开发者，刘瑞表示，赛事让他深入了解了如何参与社区开源，并与社区成员共同探讨技术，结识了众多志同道合的伙伴，为未来高效合作奠定了基础。同时，他呼吁更多开发者关注OpenHarmony及游戏开发领域，助力开源生态形成更强的“引力效应”。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;融汇创新力量 共筑开源未来&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;第二届OpenHarmony创新应用挑战赛不仅是一次智慧与创新的较量，更是一场开源精神的深度实践。赛事联动产业、前沿科技与优秀人才，推动了OpenHarmony与Cocos的生态深度融合与发展，为开发者提供了施展才华的舞台，更助力开源技术加速落地。在这场融合创意与探索的盛宴中，优秀团队以实力塑造未来，终将推动创新从竞技场走向产业星辰大海。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;未来，OpenHarmony社区将持续拓展应用边界，携手全球开发者共创数字时代的新范式，助力开源生态迈向更加繁荣、智能、可持续的新时代。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;共绘2025年开源新蓝图，OpenHarmony社区项目管理委员会年度工作会议在深圳成功举办&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025.01.27&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mp.weixin.qq.com/s/0q1ThRgDGocGMWp1ufHHrA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025年1月12日上午，OpenHarmony社区项目管理委员会（PMC）（以下简称“PMC”）年度工作会议在深圳召开。本次会议全面总结了2024年PMC的工作及成果，以及明确了2025年PMC工作方向和重点工作，为OpenHarmony社区在2025年持续快速发展及繁荣打下厚实基础。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;会议伊始，PMC主席任革林为本次会议致辞。他表示，PMC在过去一年里工作成果不断，尤其是社区发布了具有里程碑意义的OpenHarmony 5.0 Release版本，该版本在系统能力完备度和稳定性方面取得显著提升，全面实现对伙伴产品的规模化海量商用的支撑。同时，任革林也指出社区明年工作方向：强化版本规划，积极推动社区走出海外。当前社区版本不仅要完善技术底座对更多品类设备的支撑能力，还要勇于探索国际社区建设路径。此外，PMC主席任革林鼓励PMC成员及各SIG领导成员积极参与国际交流，发展海外开发人员，提升社区的国际影响力。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenHarmony社区项目管理委员会主席任革林&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;随后，PMC代表董金光对2024年PMC工作进行总结。他表示，过去一年社区共建成果丰硕，底座开发者人数达8100+，开发者结构日趋多元，社区健康度和活跃度持续提升。OpenHarmony社区5.0 Release版本有效赋能成员单位产品商用，同时SIG组在内容产出和活动组织方面仍需发力。2025年PMC工作重点为版本与产品规划、社区共建、技术攻关和出海等关键战略领域。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenHarmony社区项目管理委员会代表董金光&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;在SIG新建申请环节，卫星通信技术专家胡光明提出了北斗SIG的建设构想。他指出，北斗SIG将围绕北斗导航系统的核心能力，推动北斗导航系统与OpenHarmony的融合，打造高精度定位、短报文通信等特色应用。北斗SIG的工作重点是通过技术标准的制定和开发板的集成，以此填补OpenHarmony在导航定位授时方面的空白，推动应急救援、交通物流、大众服务等垂直行业的应用开发。在未来，北斗SIG将致力于建立开源鸿蒙的北斗开发平台，通过与高校、科研机构合作，培养更多基于OpenHarmony的北斗导航领域的专业人才，为社区拓展行业伙伴提供有力支持。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;卫星通信技术专家胡光明&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中移（杭州）信息技术有限公司家庭IoT产品部副总经理施超介绍了家庭网关（Gateway）SIG的规划。他指出，家庭网关SIG将聚焦家庭网关和路由器设备，弥补设备能力方面的不足，推动互联互通标准的建立，并通过开源合作加速行业标准化进程。施超提到，中国移动每年新增1.6亿台智能家庭硬件设备，然而这些设备普遍存在底座、芯片、应用以及服务缺乏统一性的问题。家庭网关SIG将致力于解决这些问题，通过OpenHarmony技术框架，实现家庭网络设备的统一管理。会上，PMC主席任革林补充表示，家庭网关（Gateway）SIG的成立将推动基于OpenHarmony的路由器安全能力进一步提升。在未来，家庭网关（Gateway）SIG将与芯片厂商合作，通过优化设备的内核架构，降低内存和CPU占用，提升设备性能。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国移动（杭州）信息技术有限公司家庭IoT产品部副总经理施超&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深圳鸿信智联数字科技有限公司CEO张兆生提出了Watch SIG的建设方案。他指出，随着智能手表市场的快速发展，Watch SIG 将致力于构建手表领域的技术标准体系，研发配套开发工具，推动手表应用生态走向繁荣。张兆生提到，手表产业的复杂性要求SIG在芯片、OS和应用之间建立紧密的协同关系。Watch SIG将围绕表盘设计、应用开发工具和北向应用接口标准化展开工作，推动手表设备的快速开发和商用。他表示，Watch SIG计划在2025年达成500万支手表的出货目标，并通过与方案商和品牌商的深度合作，加速手表生态的成熟。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深圳鸿信智联数字科技有限公司CEO张兆生&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华为终端有限公司应用场景化解决方案专家张泰介绍了应用开发场景套件SIG的规划。他指出，应用开发场景套件SIG将围绕应用开发中的关键场景，提供开源库、Sample代码及开发指南，降低开发难度，并计划在2025年推出高性能组件库和多设备适配解决方案。张泰提到，当前开发者在应用开发中面临诸多挑战，如不同设备适配难度高、性能调优复杂等问题。应用开发场景套件SIG将通过提供标准化的开发组件和工具，帮助开发者快速上手并提升开发效率。他还表示，应用开发场景套件SIG将与众多头部生态伙伴合作，推动场景化开发套件的广泛应用。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华为终端有限公司应用场景化解决方案专家张泰&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;图形SIG、PMC图形领域代表黄然在工作报告中指出，图形SIG持续在图形架构、性能工具研发等方面投入，Smartperf已经成为OpenHarmony性能调试的关键工具。接下来，图形SIG将聚焦统一渲染、SceneBoard等核心技术深化应用与推广，积极推进与国际标准接轨，全力打造开源图形课程，携手社区伙伴提升图形技术竞争力，赋能带UI设备创新发展。游戏SIG着重强化三方库建设、优化工具与引擎协同、深化与团结引擎合作，为游戏开发者营造优质环境。开源图形驱动SIG全力支持OpenGL API、突破多GPU环境使能技术，助力图形处理能力跃升，满足多样化设备需求。针对统一渲染与分离渲染技术路线选择，经会上充分讨论，社区达成并行推进共识，兼顾不同设备性能，确保技术平稳演进。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;图形SIG、PMC图形领域代表黄然&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;智能建筑SIG组长，西安建筑科技大学信控学院院党委书记、教授、博士生导师于军琪在工作报告中汇报了智能建筑SIG的工作进展。他指出，将紧密围绕智能建筑行业需求，全力打造施工现场安全监控与能源负荷管理两大价值场景，成功研发系列核心算法模块。后续计划加速应用移植与创新合作，有力推动OpenHarmony在智能建筑领域落地生根，助力建筑行业智能化转型，提升建筑安全与能源效率，践行绿色节能发展理念。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;智能建筑SIG组长、西安建筑科技大学信控学院院党委书记、教授、博士生导师于军琪&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;开发板SIG组长，江苏润和软件股份有限公司副总裁刘洋在工作报告中对开发板SIG的工作进行了总结。他指出，尽管开发板SIG取得了一定的商用成果，但在开源工作中仍存在不足。为此，开发板SIG制定了2025年工作规划，将明确聚焦于L2标杆平台建设，引入新平台以优化选型；同时，大力加强南向开源工作，提升开源质量和规模；积极拓展海外合作，吸引国际企业参与。此外，开发板SIG还将发起招募行动，诚邀各界携手解决开发板从具备可用性向具备易用性迈进的关键难题，筑牢OpenHarmony硬件基础。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;开发板SIG组长、江苏润和软件股份有限公司副总裁刘洋&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;QT SIG组长、成都中科合迅科技有限公司技术总监蔡万苍在工作报告中分享了QT SIG的工作进展。他全面总结了2024年适配成果与问题，在多项模块适配取得进展的同时，部分关键版本适配仍在攻坚。2025年规划稳步推进版本升级与持续演进，积极应对QT与OpenHarmony框架融合挑战，如渲染线程优化等问题。加强与应用厂家合作，推动QT框架在社区商用与开源协同发展，提升应用开发框架稳定性与兼容性。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;QT SIG组长、成都中科合迅科技有限公司技术总监蔡万苍&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;会议期间，与会者积极互动，各抒己见，为社区发展建言献策。开放原子开源基金会技术监督委员会（TOC）主席谭中意、华为终端软件OpenHarmony使能部部长章晓峰、OpenHarmony项目群工作委员会执行总监陶铭、OpenHarmony PMC主席任革林等充分肯定PMC 2024年各项工作成果，并强调SIG运作对社区成功的关键作用，建议进一步加强SIG考核与协同合作，鼓励技术创新与国际交流，全力提升OpenHarmony社区影响力与竞争力，携手共创开源鸿蒙美好未来。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;开放原子开源基金会技术监督委员会（TOC）主席谭中意&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华为终端软件OpenHarmony使能部部长章晓峰&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenHarmony项目群工作委员会执行总监陶铭&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;会议还表决通过了黄然、李锋和赵鹏分别担任PMC图形领域、规划领域和版本管理领域委员。同时，会议还通过了Crossplatformui SIG成员调整的建议，同意潘锦玲担任该SIG组长。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本次OpenHarmony社区PMC年度工作会议在热烈氛围中圆满落幕，通过全面总结经验、深入剖析问题、精心规划未来，为PMC发展明确方向。PMC将汇聚各方力量，推动OpenHarmony在全球开源生态中稳健前行，持续拓展应用边界，实现技术与生态协同创新发展，开启开源操作系统发展新征程。&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>这套方案对于爬取的成功率以及内容的解析，成功率都大幅提升，但仍然存在两个问题。</p>
<p>首先一点就是在爬取目标网站的链接时仍然有无效URL导致无法访问的问题，还有就是爬取的URL数量不足，导致爬取的内容不够丰富，这一点是因为当前代码并没有包含模仿用户点击所有的文章卡片导致的获取数量不足。另外一点就是在于其生成的json格式文件中仅有<code>text</code>的type类型并没有将图片以及视频的type类型包含进去，这一点在后续的代码中会进行修改。</p>
<p>所以首先要去模仿用户点击全部的ul中的li才能获取全部的，链接，在点击完全部卡片之后再去将链接去重，将去重之后的结果进行逐一访问。</p>
<p><img src="https://bu.dusays.com/2025/07/09/686e265929f85.png" alt="1752049237718.png"></p>
<p>在获取内容时也要注意要将img的src字段在其懒加载结束之后也读取到json中将type字段的值写成image，同时value字段填写爬取到的src值。</p>
<p>首先对于分页遍历，去重以及有效性验证的代码片段如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_all_article_urls</span>(<span class="params">self</span>):</span><br><span class="line">    all_urls = <span class="built_in">set</span>()</span><br><span class="line">    page_num = <span class="number">1</span></span><br><span class="line">    page_size = <span class="number">20</span>  <span class="comment"># 可适当加大</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        api_url = <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/backend/knowledge/secondaryPage/queryBatch?type=3&amp;pageNum=<span class="subst">&#123;page_num&#125;</span>&amp;pageSize=<span class="subst">&#123;page_size&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;请求API: <span class="subst">&#123;api_url&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = <span class="variable language_">self</span>.session.get(api_url, timeout=<span class="number">10</span>)</span><br><span class="line">            resp.raise_for_status()</span><br><span class="line">            data = resp.json().get(<span class="string">&quot;data&quot;</span>, [])</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;API请求失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">            url = item.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> url:</span><br><span class="line">                all_urls.add(url)</span><br><span class="line">        page_num += <span class="number">1</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)  <span class="comment"># 防止请求过快</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;共获取到<span class="subst">&#123;<span class="built_in">len</span>(all_urls)&#125;</span>条原始url，开始去重和有效性校验...&quot;</span>)</span><br><span class="line">    valid_urls = []</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> all_urls:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = <span class="variable language_">self</span>.session.head(url, timeout=<span class="number">5</span>)</span><br><span class="line">            <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">                valid_urls.append(url)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;有效url数量: <span class="subst">&#123;<span class="built_in">len</span>(valid_urls)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> valid_urls</span><br></pre></td></tr></table></figure>
<p>所谓的验证有效性就是通过访问url的head请求，如果返回的状态码是200则说明该url是有效的，否则就是无效的。</p>
<p>对于获取内容以及将内容写入json文件的代码片段如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">parse_article_content</span>(<span class="params">self, article_url</span>):</span><br><span class="line">    content = <span class="variable language_">self</span>.get_page_content(article_url)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> content:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    soup = BeautifulSoup(content, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">    result_data = []</span><br><span class="line">    article_container = (</span><br><span class="line">        soup.find(<span class="built_in">id</span>=<span class="string">&#x27;js_content&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">        soup.find(class_=<span class="string">&#x27;rich_media_content&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">        soup.find(<span class="built_in">id</span>=<span class="string">&#x27;page-content&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">        soup.find(class_=<span class="string">&#x27;rich_media_area_primary&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">        soup.find(class_=re.<span class="built_in">compile</span>(<span class="string">r&#x27;article|content|detail&#x27;</span>, re.I)) <span class="keyword">or</span></span><br><span class="line">        soup.find(<span class="string">&#x27;article&#x27;</span>) <span class="keyword">or</span></span><br><span class="line">        soup.find(<span class="built_in">id</span>=re.<span class="built_in">compile</span>(<span class="string">r&#x27;article|content|detail&#x27;</span>, re.I))</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> article_container:</span><br><span class="line">        article_container = soup.find(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> article_container:</span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> article_container.find_all([<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;h2&#x27;</span>, <span class="string">&#x27;h3&#x27;</span>, <span class="string">&#x27;h4&#x27;</span>, <span class="string">&#x27;h5&#x27;</span>, <span class="string">&#x27;h6&#x27;</span>, <span class="string">&#x27;div&#x27;</span>, <span class="string">&#x27;img&#x27;</span>, <span class="string">&#x27;video&#x27;</span>]):</span><br><span class="line">            <span class="keyword">if</span> element.name <span class="keyword">in</span> [<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;h2&#x27;</span>, <span class="string">&#x27;h3&#x27;</span>, <span class="string">&#x27;h4&#x27;</span>, <span class="string">&#x27;h5&#x27;</span>, <span class="string">&#x27;h6&#x27;</span>, <span class="string">&#x27;div&#x27;</span>]:</span><br><span class="line">                text = element.get_text().strip()</span><br><span class="line">                <span class="keyword">if</span> text <span class="keyword">and</span> <span class="built_in">len</span>(text) &gt; <span class="number">10</span>:</span><br><span class="line">                    result_data.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;value&quot;</span>: text&#125;)</span><br><span class="line">            <span class="keyword">elif</span> element.name == <span class="string">&#x27;img&#x27;</span>:</span><br><span class="line">                img_src = element.get(<span class="string">&#x27;data-src&#x27;</span>) <span class="keyword">or</span> element.get(<span class="string">&#x27;data-original&#x27;</span>) <span class="keyword">or</span> element.get(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> img_src:</span><br><span class="line">                    img_url = urljoin(<span class="variable language_">self</span>.base_url, img_src)</span><br><span class="line">                    result_data.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>, <span class="string">&quot;value&quot;</span>: img_url&#125;)</span><br><span class="line">            <span class="keyword">elif</span> element.name == <span class="string">&#x27;video&#x27;</span>:</span><br><span class="line">                video_src = element.get(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> video_src:</span><br><span class="line">                    video_url = urljoin(<span class="variable language_">self</span>.base_url, video_src)</span><br><span class="line">                    result_data.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;video&quot;</span>, <span class="string">&quot;value&quot;</span>: video_url&#125;)</span><br><span class="line">                <span class="keyword">for</span> source <span class="keyword">in</span> element.find_all(<span class="string">&#x27;source&#x27;</span>):</span><br><span class="line">                    video_src = source.get(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> video_src:</span><br><span class="line">                        video_url = urljoin(<span class="variable language_">self</span>.base_url, video_src)</span><br><span class="line">                        result_data.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;video&quot;</span>, <span class="string">&quot;value&quot;</span>: video_url&#125;)</span><br><span class="line">    <span class="keyword">return</span> result_data</span><br></pre></td></tr></table></figure>
<p>在上述代码中，我们首先通过<code>get_page_content</code>方法获取文章内容，然后使用BeautifulSoup解析HTML。接着，我们查找文章的主要内容容器，如果找不到，则使用整个页面作为容器。然后，我们遍历容器中的所有元素，根据元素的类型（如<code>p</code>、<code>h1</code>、<code>h2</code>、<code>h3</code>、<code>h4</code>、<code>h5</code>、<code>h6</code>、<code>div</code>、<code>img</code>、<code>video</code>）提取相应的文本或URL，并将其添加到结果列表中。最后，我们返回结果列表。</p>
<p>在修改了代码并将上述算法函数进行参数微调以及适配合并进主函数的流程中后再次执行代码，进行测试。</p>
<p><img src="https://bu.dusays.com/2025/07/09/686e2c9736003.png" alt="1752050837041.png"></p>
<p><img src="https://bu.dusays.com/2025/07/09/686e2bfe7bb88.png" alt="1752050683416.png"></p>
<p>可以看到这次正确的爬取了全部的链接并且成功解析了绝大部分的链接，并且将图片以及视频的链接也成功爬取到了json文件中。</p>
<h4 id="后端项目框架构建"><a href="#后端项目框架构建" class="headerlink" title="后端项目框架构建"></a>后端项目框架构建</h4><p>在完成了最基础的爬虫功能可行性测试之后我们就先构架一个完整的web服务框架来进行后续的web服务功能可行性验证。</p>
<p>我们选择采用FastAPI框架来构建我们的web服务框架，FastAPI是一个现代、快速（高性能）的Web框架，用于构建APIs，基于标准Python类型提示。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Server/</span><br><span class="line">├── api/                           # API接口模块</span><br><span class="line">│   ├── __init__.py               # 包初始化文件</span><br><span class="line">│   └── news.py                   # 新闻相关API接口</span><br><span class="line">├── core/                          # 核心功能模块</span><br><span class="line">│   ├── __init__.py               # 包初始化文件</span><br><span class="line">│   ├── config.py                 # 配置管理</span><br><span class="line">│   ├── database.py               # 数据库操作</span><br><span class="line">│   ├── logging_config.py         # 日志配置</span><br><span class="line">│   └── scheduler.py              # 定时任务调度</span><br><span class="line">├── models/                        # 数据模型</span><br><span class="line">│   ├── __init__.py               # 包初始化文件</span><br><span class="line">│   └── news.py                   # 新闻数据模型</span><br><span class="line">├── services/                      # 服务层</span><br><span class="line">│   ├── __init__.py               # 包初始化文件</span><br><span class="line">│   └── openharmony_crawler.py    # OpenHarmony爬虫服务</span><br><span class="line">├── logs/                          # 日志文件目录</span><br><span class="line">│   ├── openharmony_api_20250709.log  # 应用日志</span><br><span class="line">│   └── error_20250709.log        # 错误日志</span><br><span class="line">├── __pycache__/                   # Python缓存文件</span><br><span class="line">├── .gitignore                     # Git忽略文件</span><br><span class="line">├── Dockerfile                     # Docker镜像配置</span><br><span class="line">├── docker-compose.yml             # Docker Compose配置</span><br><span class="line">├── main.py                        # 主应用入口</span><br><span class="line">├── openharmony_news.db            # SQLite数据库文件</span><br><span class="line">├── README.md                      # 项目说明文档</span><br><span class="line">├── requirements.txt               # Python依赖包</span><br><span class="line">└── run.py                         # 应用启动脚本</span><br></pre></td></tr></table></figure>
<ul>
<li>核心文件</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>文件</th>
<th>主要作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>main.py</code></td>
<td><strong>主应用入口</strong>，FastAPI应用配置，中间件设置，路由注册</td>
</tr>
<tr>
<td><code>run.py</code></td>
<td><strong>启动脚本</strong>，配置服务启动参数，提供便捷启动方式</td>
</tr>
<tr>
<td><code>requirements.txt</code></td>
<td><strong>依赖管理</strong>，列出所有Python包及其版本</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>API接口层</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>文件</th>
<th>主要作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>api/news.py</code></td>
<td><strong>新闻API接口</strong>，提供新闻列表、详情、爬取等接口</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>核心功能层</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>文件</th>
<th>主要作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>core/config.py</code></td>
<td><strong>配置管理</strong>，应用配置、环境变量处理</td>
</tr>
<tr>
<td><code>core/database.py</code></td>
<td><strong>数据库操作</strong>，SQLite连接、表结构、CRUD操作</td>
</tr>
<tr>
<td><code>core/logging_config.py</code></td>
<td><strong>日志配置</strong>，日志格式、文件轮转、级别设置</td>
</tr>
<tr>
<td><code>core/scheduler.py</code></td>
<td><strong>定时任务</strong>，APScheduler配置、爬虫任务调度</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>数据模型层</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>文件</th>
<th>主要作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>models/news.py</code></td>
<td><strong>数据模型</strong>，Pydantic模型定义，API响应格式</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>服务层</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>文件</th>
<th>主要作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>services/openharmony_crawler.py</code></td>
<td><strong>爬虫服务</strong>，OpenHarmony官网数据采集</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>部署配置</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>文件</th>
<th>主要作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Dockerfile</code></td>
<td><strong>Docker镜像</strong>，容器化部署配置</td>
</tr>
<tr>
<td><code>docker-compose.yml</code></td>
<td><strong>容器编排</strong>，多服务部署配置</td>
</tr>
<tr>
<td><code>.gitignore</code></td>
<td><strong>版本控制</strong>，Git忽略文件配置</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>文档和日志</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>文件</th>
<th>主要作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>README.md</code></td>
<td><strong>项目文档</strong>，使用说明、API文档</td>
</tr>
<tr>
<td><code>logs/</code></td>
<td><strong>日志文件</strong>，应用运行日志和错误日志</td>
</tr>
<tr>
<td><code>openharmony_news.db</code></td>
<td><strong>数据库文件</strong>，SQLite数据存储</td>
</tr>
</tbody>
</table>
</div>
<hr>
<p>接下来我们使用cmd进行接口测试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;   curl http://localhost:8001/health</span><br><span class="line">&#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;healthy&quot;</span>,<span class="string">&quot;timestamp&quot;</span>:1752076452.5490837,<span class="string">&quot;version&quot;</span>:<span class="string">&quot;1.0.0&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>首先测试的是提前预留的健康检查接口，可以看到返回了健康检查状态。是正常的。随后我们再去检测一下爬虫数据获取接口。</p>
<p><img src="https://bu.dusays.com/2025/07/10/686e931fce2d1.png" alt="1752077085669.png"></p>
<p>请求之后没有任何反应，所以我打开后台进行日志的查看，发现日志是正常工作的，所以说明请求正常发送了，仅仅是因为我为了不过高频率的请求而被封禁IP而设置了少量间隔，整体的爬取速度很慢，所以才短时间内没有响应，在五分钟左后后我获得了数据。</p>
<p><img src="https://bu.dusays.com/2025/07/10/686e96990526d.png" alt="1752077973683.png"></p>
<p>不过这也提醒我了，需要设置一个缓存机制，每一小时或是其他时长的间隔进行爬取，每次请求直接返回缓存好的数据，这样就不用再额外等待现场爬取数据了，当然也有可能有人就是想要刷新获取最新的数据，所以我们可以在前端的UI界面加一行提示符来提示用户我们的资讯更新间隔，并设计一个按钮专门用来获取现爬取的最新数据。</p>
<p>ok今天先测试到这里了。</p>
<h4 id="数据缓存与更新机制"><a href="#数据缓存与更新机制" class="headerlink" title="数据缓存与更新机制"></a>数据缓存与更新机制</h4><p>现在我们需要添加一个缓存机制，就是当服务程序开始运行的时候先执行一遍爬取数据，在开机第一次爬取时将服务状态设置成准备中，然后将爬取的数据暂存，每隔半个小时再次进行一次数据爬取，爬取时接收到请求仍使用上一次储存的数据，在爬取完成后替换新的数据。替换数据的过程也要将服务状态设置为准备中。这样在编写前端逻辑时我们就可以先通过服务状态接口来进行判断是否可以获取新数据如果可以就获取当前缓存数据，否则则提示用户稍后再试。</p>
<p>虽然我的预期如此，但是在首次进行调试的时候还是发现了问题。</p>
<p><img src="https://bu.dusays.com/2025/07/10/686f6f67d2020.png" alt="1752133476018.png"></p>
<p>在服务器启动后优先执行了数据的爬取并没有直接启动服务，导致长达六七分钟的时间我们的任何API都没办法被请求，这是因为当前代码的执行顺序FastAPI框架必须等待数据爬取结束后才完成服务的启动。不过先不急着停止本次服务，先等待下一次自动数据更新是否成功。</p>
<p><img src="https://bu.dusays.com/2025/07/10/686f74e27280f.png" alt="1752134878048.png"></p>
<p>可以看到在时间到了半小时的间隔之后数据的重新爬取确实是正常的触发了，但问题在于我再次请求服务端状态接口时是迟迟没有响应</p>
<p><img src="https://bu.dusays.com/2025/07/10/686f7522714eb.png" alt="1752134942432.png"></p>
<p>我的推测是整个后端服务为单线程，在爬取数据时就会阻塞当前线程，虽然请求成功发送了，服务端也正常接收了，但只是进入了等待队列，需要等待新的数据获取完成后才会真正的返回响应，所以既没有超时也没有响应，所以我们需要将爬取数据的过程放到一个单独的线程中去执行，这样就可以避免阻塞主线程，从而保证服务端可以正常响应请求。</p>
<p>经过了五分钟的等待，服务端终于返回了响应。</p>
<p><img src="https://bu.dusays.com/2025/07/10/686f76fcac501.png" alt="1752135416102.png"></p>
<p>这也证实了我的猜想，当前的服务端逻辑存在严重问题，急需修正。</p>
<h4 id="多线程解决主线程阻塞问题"><a href="#多线程解决主线程阻塞问题" class="headerlink" title="多线程解决主线程阻塞问题"></a>多线程解决主线程阻塞问题</h4><p>本次修改主要解决了<strong>多线程阻塞问题</strong>和<strong>精细状态管理</strong>两个核心问题，实现了服务启动后立即响应请求，爬虫任务在后台执行，且只有在写入数据库时才短暂设为”准备中”的优化。</p>
<hr>
<p><strong>关键代码解释</strong></p>
<ul>
<li><p><strong>多线程调度器改进</strong> (<code>core/scheduler.py</code>)</p>
<p><strong>问题</strong>: 原始实现中爬虫任务在主线程同步执行，导致服务启动时被阻塞6-7分钟。</p>
<p><strong>解决方案</strong>: 使用 <code>ThreadPoolExecutor</code> 将爬虫任务放到独立线程中执行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TaskScheduler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.scheduler = AsyncIOScheduler()</span><br><span class="line">        <span class="comment"># 新增：线程池管理爬虫任务</span></span><br><span class="line">        <span class="variable language_">self</span>.thread_pool = ThreadPoolExecutor(max_workers=<span class="number">2</span>, thread_name_prefix=<span class="string">&quot;CrawlerWorker&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>._setup_jobs()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_run_crawler_in_thread</span>(<span class="params">self, task_name: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;在线程中执行爬虫任务&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 执行爬取（此时状态仍为ready，可以正常响应请求）</span></span><br><span class="line">            crawler = OpenHarmonyCrawler()</span><br><span class="line">            articles = crawler.crawl_openharmony_news()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 只有在写入数据库时才设置状态为准备中</span></span><br><span class="line">            cache.update_cache(articles)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            cache.set_status(ServiceStatus.ERROR, <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">initial_cache_load</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始缓存加载（服务启动时执行）&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 在线程池中执行爬虫任务</span></span><br><span class="line">        future = <span class="variable language_">self</span>.thread_pool.submit(<span class="variable language_">self</span>._run_crawler_in_thread, <span class="string">&quot;初始缓存加载&quot;</span>)</span><br><span class="line">        <span class="comment"># 不等待完成，让任务在后台执行，服务可以立即启动</span></span><br><span class="line">        logger.info(<span class="string">&quot;初始缓存加载任务已提交到后台线程，服务可以立即响应请求&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>关键改进</strong>:</p>
<ul>
<li>使用 <code>ThreadPoolExecutor</code> 管理爬虫任务</li>
<li>爬虫任务在独立线程执行，不阻塞主服务线程</li>
<li>服务启动后立即可以响应请求</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><p><strong>精细状态管理</strong> (<code>core/cache.py</code>)</p>
<p><strong>问题</strong>: 原始实现中爬虫开始就设为”准备中”，整个爬虫过程都无法响应请求。</p>
<p><strong>解决方案</strong>: 只有在写入数据库时才设为”准备中”，其他时候使用数据库内容响应。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NewsCache</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._cache: <span class="type">List</span>[NewsArticle] = []</span><br><span class="line">        <span class="variable language_">self</span>._cache_lock = threading.RLock()</span><br><span class="line">        <span class="variable language_">self</span>._status = ServiceStatus.READY  <span class="comment"># 初始状态为就绪（改进前是PREPARING）</span></span><br><span class="line">        <span class="variable language_">self</span>._is_updating = <span class="literal">False</span>  <span class="comment"># 新增：标记是否正在更新</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_updating</span>(<span class="params">self, is_updating: <span class="built_in">bool</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;设置更新状态&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>._cache_lock:</span><br><span class="line">            <span class="variable language_">self</span>._is_updating = is_updating</span><br><span class="line">            <span class="keyword">if</span> is_updating:</span><br><span class="line">                logger.info(<span class="string">&quot;开始数据更新，状态设为准备中&quot;</span>)</span><br><span class="line">                <span class="variable language_">self</span>.set_status(ServiceStatus.PREPARING)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                logger.info(<span class="string">&quot;数据更新完成，状态设为就绪&quot;</span>)</span><br><span class="line">                <span class="variable language_">self</span>.set_status(ServiceStatus.READY)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_cache</span>(<span class="params">self, news_data: <span class="type">List</span>[NewsArticle]</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;更新缓存数据&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>._cache_lock:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 设置更新状态为True，状态变为准备中</span></span><br><span class="line">                <span class="variable language_">self</span>.set_updating(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 更新缓存</span></span><br><span class="line">                <span class="variable language_">self</span>._cache = news_data.copy()</span><br><span class="line">                <span class="variable language_">self</span>._last_update = datetime.now().isoformat()</span><br><span class="line">                <span class="variable language_">self</span>._update_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 设置更新状态为False，状态变为就绪</span></span><br><span class="line">                <span class="variable language_">self</span>.set_updating(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="variable language_">self</span>.set_status(ServiceStatus.ERROR, error_msg)</span><br><span class="line">                <span class="variable language_">self</span>._is_updating = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<p><strong>关键改进</strong>:</p>
<ul>
<li>初始状态改为 <code>READY</code>（改进前是 <code>PREPARING</code>）</li>
<li>添加 <code>_is_updating</code> 标记精确控制状态</li>
<li>通过 <code>set_updating()</code> 方法精确控制状态变化</li>
<li>只有在写入数据库时才设为”准备中”</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><p><strong>状态信息增强</strong> (<code>core/cache.py</code>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_status</span>(<span class="params">self</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;获取服务状态&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="variable language_">self</span>._cache_lock:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;status&quot;</span>: <span class="variable language_">self</span>._status.value,</span><br><span class="line">            <span class="string">&quot;last_update&quot;</span>: <span class="variable language_">self</span>._last_update,</span><br><span class="line">            <span class="string">&quot;cache_count&quot;</span>: <span class="built_in">len</span>(<span class="variable language_">self</span>._cache),</span><br><span class="line">            <span class="string">&quot;update_count&quot;</span>: <span class="variable language_">self</span>._update_count,</span><br><span class="line">            <span class="string">&quot;error_message&quot;</span>: <span class="variable language_">self</span>._error_message,</span><br><span class="line">            <span class="string">&quot;is_updating&quot;</span>: <span class="variable language_">self</span>._is_updating  <span class="comment"># 新增：是否正在更新</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p><strong>关键改进</strong>:</p>
<ul>
<li>状态信息中增加 <code>is_updating</code> 字段</li>
<li>客户端可以精确了解当前是否正在更新数据</li>
</ul>
<hr>
</li>
<li><p><strong>测试脚本</strong> (<code>test_fine_grained_status.py</code>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_fine_grained_status</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;测试精细状态管理&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 监控状态变化</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        response = requests.get(<span class="string">f&quot;<span class="subst">&#123;base_url&#125;</span>/api/news/status&quot;</span>, timeout=<span class="number">5</span>)</span><br><span class="line">        status_data = response.json()</span><br><span class="line">        status = status_data[<span class="string">&#x27;status&#x27;</span>]</span><br><span class="line">        is_updating = status_data.get(<span class="string">&#x27;is_updating&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">        cache_count = status_data[<span class="string">&#x27;cache_count&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;timestamp&#125;</span>] 状态: <span class="subst">&#123;status&#125;</span> | 更新中: <span class="subst">&#123;is_updating&#125;</span> | 缓存: <span class="subst">&#123;cache_count&#125;</span> 条&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果状态变为ready且有数据，说明爬虫完成</span></span><br><span class="line">        <span class="keyword">if</span> status == <span class="string">&#x27;ready&#x27;</span> <span class="keyword">and</span> cache_count &gt; <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> is_updating:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;🎉 爬虫任务完成！&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p><strong>关键功能</strong>:</p>
<ul>
<li>实时监控状态变化</li>
<li>验证爬虫期间仍可获取数据</li>
<li>测试并发请求响应</li>
</ul>
</li>
</ul>
<hr>
<p><strong>改进效果对比</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>方面</th>
<th>改进前</th>
<th>改进后</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>服务启动</strong></td>
<td>需要等待爬虫完成（6-7分钟）</td>
<td>立即启动并响应请求</td>
</tr>
<tr>
<td><strong>爬虫执行</strong></td>
<td>阻塞主线程，无法响应请求</td>
<td>后台线程执行，正常响应</td>
</tr>
<tr>
<td><strong>状态管理</strong></td>
<td>爬虫开始就设为准备中</td>
<td>只有写入数据库时才设为准备中</td>
</tr>
<tr>
<td><strong>用户体验</strong></td>
<td>等待时间长，体验差</td>
<td>即时响应，体验佳</td>
</tr>
<tr>
<td><strong>并发支持</strong></td>
<td>单线程阻塞</td>
<td>多线程并发处理</td>
</tr>
</tbody>
</table>
</div>
<hr>
<p><strong>改进后的服务端架构</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">主服务线程 (FastAPI)</span><br><span class="line">    ├── 立即响应API请求</span><br><span class="line">    ├── 使用现有缓存数据</span><br><span class="line">    └── 状态管理</span><br><span class="line">    </span><br><span class="line">后台线程池 (ThreadPoolExecutor)</span><br><span class="line">    ├── 爬虫任务执行</span><br><span class="line">    ├── 数据采集和处理</span><br><span class="line">    └── 数据库写入（短暂设为准备中）</span><br></pre></td></tr></table></figure>
<p>这次改进彻底解决了单线程阻塞问题，实现了真正的非阻塞服务架构，同时通过精细状态管理最大化服务可用性。</p>
<p><img src="https://bu.dusays.com/2025/07/10/686f7f320d774.png" alt="1752137517924.png"></p>
<p>此时可以看到在初次启动服务后</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INFO:     Application startup complete.</span><br><span class="line">INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)</span><br></pre></td></tr></table></figure>
<p>先于爬虫的任务日志显示，在此期间我再次请求了 <code>/api/news/status</code>，可以看到返回的状态是 <code>ready</code>，并且缓存数量为0，说明爬虫任务还未结束，当前的数据库中并没有数据。但也可以看到我再此期间进行的请求与都正常的返回了响应，但是响应内容是空的，不可利用的，所以我们还需要进行优化。</p>
<p>对于这个问题，首先它在实际生产环境中并不常见，因为它仅会发生在服务器初次启动时，实际的生产环境中肯定<strong>不会经常性的开关服务器</strong>，同时Nginx的<mark class="hl-label orange">**反向代理**</mark>以及<mark class="hl-label orange">**均衡负载**</mark>也会保证在服务端升级维护时是多台服务器循环重启而非全部断联，也就是所谓的<mark class="hl-label purple">**滚动升级**</mark>，来保障其<mark class="hl-label purple">**高可用性原则**</mark>，基本不会发生以上现象。所以我们需要再次测试一下再后续的稳定运行阶段是否能在爬虫运行时保证主线程能正常的处理请求。同时我们也需要在客户端利用数据库来存储上一次加载的数据，以防止在启动时获取的数据为空或者是获取失败，这样可以极大的提高运行的稳定性。</p>
<p><img src="https://bu.dusays.com/2025/07/10/686f885d1b05c.png" alt="1752139864861.png"></p>
<p>在写上面这段分析时刚好也等到了下一次更新，我在此期间再次请求了新闻列表接口，发现正常获取了数据，说明主子线程已经成功分离。（我才发现之前请求时少了个正斜杠……汗流浃背了）</p>
<p>到这里的话整体的架构就已经搭建出来了，我就可以继续收集更多的数据源了。</p>
<h4 id="CSDN平台资讯"><a href="#CSDN平台资讯" class="headerlink" title="CSDN平台资讯"></a>CSDN平台资讯</h4><p>首先还是先去观察CSDN目标网页的网页结构，去观察其是如何进行页面跳转的，这将决定我们用什么手段去获取目标资讯页面的跳转URL。先是确认一下基地址。和OpenHarmony官网不同的点在于OpenHarmony官网是直接就有资讯页面的，而且是按照时间顺序排列的，我们直接自上而下的遍历就可以很自然的按照顺序去获取到我们所需要的资讯链接。但CSDN是一个全技术栈的程序员技术网站，我们只能输入关键词进行搜索，所以我要先将<code>OpenHarmony</code>输入搜索框并勾选好最新选项，我们才能按照时间顺序获取到按时间顺序排布的全部的资讯链接。</p>
<p><img src="https://bu.dusays.com/2025/07/10/686fbc1e064af.png" alt="1752153112189.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://so.csdn.net/so/search?spm=1000.2115.3001.4498&amp;q=openHarmony&amp;t=all&amp;u=&amp;s=new</span><br></pre></td></tr></table></figure>
<p>此前我也在多篇博文中解析过URL中的一些常见参数，这里就在简单说一下吧。第一个参数<code>spm</code>虽然没有官方的解释不过我们还是能通过字段命名和值来猜个大概，它的含义应该是用于统计和追踪页面的来源、流量等信息，其数值是 CSDN 系统内部定义的编码，具体的分段数值（1000.2115.3001.4498）对应着网站内部的不同页面层级、模块或推广渠道等，对于普通用户来说，这个参数更多是网站后台用于数据分析和管理的标识，没有直接的实际使用意义。第二个参数<code>q</code>是 “query” 的缩写，代表搜索的关键词，这里表示用户搜索的内容是 “openHarmony”。第三个参数<code>t</code>代表搜索的内容类型，“all” 表示搜索全部类型的内容，在 CSDN 中，内容类型可能包括博客、问答、下载、资讯等，选择 “all” 即不限制内容类型进行搜索。第四个参数<code>u</code>可能与用户（user）相关，这里参数值为空，可能表示当前搜索没有限定特定用户发布的内容，即搜索范围是整个 CSDN 平台内符合关键词的内容，而非某个用户名下的内容。第五个参数<code>s</code>代表排序方式，“new” 表示按照内容的发布时间从新到旧进行排序，即搜索结果中，最新发布的与 “openHarmony” 相关的内容会排在较前面的位置，这也是在我勾选了最新之后出现的参数值所以还是比较确定的。</p>
<p>确认了基地址后就来分析我们的目标资源地址藏在了哪里。</p>
<p><img src="https://bu.dusays.com/2025/07/10/686fbf6a96048.png" alt="1752153958404.png"></p>
<p>哇这个页面结构是真规整啊，我先展开每一个目标list-item查看其是否包含有我们的目标链接。</p>
<p><img src="https://bu.dusays.com/2025/07/10/686fc8d8cd004.png" alt="1752156369968.png"></p>
<p>明文a标签，这可太美好了，我们直接取用其中的herf字段就可以作为资讯链接了，真是太美妙了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">crawl</span>(<span class="params">self</span>):</span><br><span class="line">    articles = []</span><br><span class="line">    url = <span class="variable language_">self</span>.BASE_URL</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;请求: <span class="subst">&#123;url&#125;</span> ...&quot;</span>)</span><br><span class="line">    resp = requests.get(url, headers=<span class="variable language_">self</span>.HEADERS, timeout=<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> resp.status_code != <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;请求失败: <span class="subst">&#123;resp.status_code&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> articles</span><br><span class="line">    soup = BeautifulSoup(resp.text, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> soup.select(<span class="string">&quot;div.list-item&quot;</span>):</span><br><span class="line">        a_tag = item.select_one(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">        title_tag = item.select_one(<span class="string">&quot;a.block-title&quot;</span>)</span><br><span class="line">        summary_tag = item.select_one(<span class="string">&quot;.search-detail&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> a_tag <span class="keyword">and</span> title_tag:</span><br><span class="line">            articles.append(&#123;</span><br><span class="line">                <span class="string">&quot;title&quot;</span>: title_tag.get_text(strip=<span class="literal">True</span>),</span><br><span class="line">                <span class="string">&quot;url&quot;</span>: a_tag.get(<span class="string">&quot;href&quot;</span>),</span><br><span class="line">                <span class="string">&quot;summary&quot;</span>: summary_tag.get_text(strip=<span class="literal">True</span>) <span class="keyword">if</span> summary_tag <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;共获取到<span class="subst">&#123;<span class="built_in">len</span>(articles)&#125;</span>篇文章&quot;</span>)</span><br><span class="line">    time.sleep(<span class="variable language_">self</span>.delay + random.random())</span><br><span class="line">    <span class="keyword">return</span> articles</span><br></pre></td></tr></table></figure>
<p>将当前爬虫代码仅作为一个单独的文件进行测试，设置独立的main函数而不是直接接入主服务流程，在测试无误后再接入主服务流程，这样能保证在调试过程中不会影响到主服务流程的运行。接下来进行测试。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">请求: https://so.csdn.net/so/search?spm=1000.2115.3001.4501&amp;q=openHarmony&amp;t=&amp;u=&amp;s=new ...</span><br><span class="line">共获取到0篇文章</span><br><span class="line">共获取到0篇文章：</span><br><span class="line"></span><br><span class="line">进程已结束，退出代码为 0</span><br></pre></td></tr></table></figure>
<p>果然失败了，每多少第一次就成功的。先冷静的分析一下原因。</p>
<p>首先我考虑到的就是URL错误或失效，毕竟其中还包含了一些我们并不能确定的参数，于是我决定进行跳转进行测试。</p>
<p><img src="https://bu.dusays.com/2025/07/11/686fed1711bdd.png" alt="1752165651408.png"></p>
<p>跳转之后显示成功，但还不能掉以轻心，我决定用CMD进行请求测试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;curl https://so.csdn.net/so/search?spm=1000.2115.3001.4501&amp;q=openHarmony&amp;t=&amp;u=&amp;s=new</span><br><span class="line">&lt;!DOCTYPE html&gt;&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;&lt;<span class="built_in">head</span>&gt;&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;&lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;&lt;meta name=<span class="string">&quot;referrer&quot;</span> content=<span class="string">&quot;always&quot;</span>&gt;&lt;meta name=<span class="string">&quot;report&quot;</span> content=<span class="string">&#x27;&#123;&quot;spm&quot;:&quot;1018.2226&quot;,&quot;disabled&quot;:&quot;true&quot;&#125;&#x27;</span>&gt;&lt;meta name=<span class="string">&quot;csdn-baidu-search&quot;</span> content=<span class="string">&#x27;&#123;&quot;keyword&quot;:&quot;&quot;&#125;&#x27;</span>&gt;&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0;&quot;</span>&gt;&lt;<span class="built_in">link</span> rel=<span class="string">&quot;icon&quot;</span> href=<span class="string">&quot;https://csdnimg.cn/public/favicon.ico&quot;</span>&gt;&lt;title&gt;&lt;/title&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/lib/jquery/3.7.1/jquery.min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/common/csdn-report/report.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/baidu-search/1.0.12/baidu-search.js&quot;</span>&gt;&lt;/script&gt;&lt;script&gt;var CFG = &#123;</span><br><span class="line">        API_URL: <span class="string">&#x27;//so.csdn.net/so/&#x27;</span>,</span><br><span class="line">        js_insert_first: <span class="literal">true</span>,</span><br><span class="line">        js_insert_count: 0</span><br><span class="line">      &#125;&lt;/script&gt;&lt;style&gt;.hiddenToolbar &#123;</span><br><span class="line">        display: none !important;</span><br><span class="line">      &#125;&lt;/style&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/chunk-507d1eda.d0e4a7f0.css&quot;</span> rel=<span class="string">&quot;prefetch&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/chunk-ef13ade6.b7f2a69e.css&quot;</span> rel=<span class="string">&quot;prefetch&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/chunk-507d1eda.f1d6c6e7.js&quot;</span> rel=<span class="string">&quot;prefetch&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/chunk-ef13ade6.fb45640e.js&quot;</span> rel=<span class="string">&quot;prefetch&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/element-ui.6b92dc4c.css&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;style&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/highlight.9276efd2.css&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;style&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/index.183186f5.css&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;style&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/element-ui.25bb7d6a.js&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;script&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/highlight.6f38c3f5.js&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;script&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/index.b1794c4a.js&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;script&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/element-ui.6b92dc4c.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/highlight.9276efd2.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/index.183186f5.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;    &lt;script src=<span class="string">&quot;/cdn_cgi_bs_captcha/static/js/waf_captcha_embedded_bs.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;&lt;body style=<span class="string">&quot;position: relative;&quot;</span>&gt;&lt;noscript&gt;&lt;strong&gt;We<span class="string">&#x27;re sorry but search-fe-v2 doesn&#x27;</span>t work properly without JavaScript enabled. Please <span class="built_in">enable</span> it to <span class="built_in">continue</span>.&lt;/strong&gt;&lt;/noscript&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;app&quot;</span>&gt;&lt;/div&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/common/csdn-login-box/csdn-login-box.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/user-ordercart/3.0.1/user-ordercart.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/lib/qrcode/1.0.0/qrcode.min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/user-ordertip/5.0.5_so_v2/user-ordertip.js&quot;</span>&gt;&lt;/script&gt;&lt;script&gt;const header = document.createElement(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">      header.type = <span class="string">&#x27;text/javascript&#x27;</span></span><br><span class="line">      header.prod = <span class="string">&#x27;so&#x27;</span></span><br><span class="line">      header.skin = <span class="string">&#x27;black&#x27;</span></span><br><span class="line">      header.domain = <span class="string">&#x27;//so.csdn.net/so/&#x27;</span></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        location.pathname.includes(<span class="string">&#x27;/chat&#x27;</span>) ||</span><br><span class="line">        location.pathname.includes(<span class="string">&#x27;/so/ai&#x27;</span>) ||</span><br><span class="line">        location.pathname.includes(<span class="string">&#x27;/so/ask&#x27;</span>)</span><br><span class="line">      ) &#123;</span><br><span class="line">        // PC端显示C知道自己的toolbar</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          navigator.userAgent.match(/(iPhone|iPod|Android|ios|iOS|iPad|Backerry|WebOS|Symbian|Windows Phone|Phone)/i)</span><br><span class="line">        ) &#123;</span><br><span class="line">          header.src = <span class="string">&#x27;//csdnimg.cn/public/common/toolbar/js/m_toolbar-2.1.2.js&#x27;</span></span><br><span class="line">          const <span class="built_in">link</span> = document.createElement(<span class="string">&#x27;link&#x27;</span>)</span><br><span class="line">          link.rel = <span class="string">&#x27;stylesheet&#x27;</span></span><br><span class="line">          link.href = <span class="string">&#x27;//csdnimg.cn/public/common/toolbar/content_toolbar_css/m_toolbar-1.1.1.css&#x27;</span></span><br><span class="line">          document.head.appendChild(<span class="built_in">link</span>)</span><br><span class="line">          // 兼容app</span><br><span class="line">          <span class="keyword">if</span> (document.cookie.includes(<span class="string">&#x27;CSDN-APP&#x27;</span>) || /csdn/i.test(window.navigator.userAgent)) &#123;</span><br><span class="line">            document.body.className = <span class="string">&#x27;csdn-app&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        header.src = <span class="string">&#x27;https://g.csdnimg.cn/common/csdn-toolbar/csdn-toolbar.js&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      document.body.appendChild(header)&lt;/script&gt;&lt;script&gt;;(<span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">        const isTest = location.host.indexOf(<span class="string">&#x27;loc&#x27;</span>) &gt; -1 || location.href.indexOf(<span class="string">&#x27;cknow-lib-env=test&#x27;</span>) &gt; -1</span><br><span class="line">        const SCRIPTS_PRELOAD = &#123;</span><br><span class="line">          AI_SEARCH_CARD: &#123;</span><br><span class="line">            LOADED: <span class="literal">false</span>,</span><br><span class="line">            SRC: isTest</span><br><span class="line">              ? <span class="string">&#x27;https://g.csdnimg.cn/aisearch/web-card/ai-search-card.js&#x27;</span></span><br><span class="line">              : <span class="string">&#x27;https://csdnimg.cn/release/aisearch/web-card/ai-search-card.js&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        const loadScript = <span class="keyword">function</span>(name) &#123;</span><br><span class="line">          <span class="keyword">if</span> (SCRIPTS_PRELOAD[name]) &#123;</span><br><span class="line">            const aiCardContentScript = document.createElement(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">            aiCardContentScript.<span class="built_in">type</span> = <span class="string">&#x27;text/javascript&#x27;</span></span><br><span class="line">            aiCardContentScript.onload = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">              SCRIPTS_PRELOAD[name].LOADED = <span class="literal">true</span></span><br><span class="line">              window.dispatchEvent(new CustomEvent(name + <span class="string">&#x27;.LOADED&#x27;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            aiCardContentScript.src = SCRIPTS_PRELOAD[name].SRC</span><br><span class="line">            document.body.appendChild(aiCardContentScript)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        window.SCRIPTS_ONLOAD = <span class="keyword">function</span>(name, callback) &#123;</span><br><span class="line">          <span class="keyword">if</span> (SCRIPTS_PRELOAD[name].LOADED) &#123;</span><br><span class="line">            callback()</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            window.addEventListener(name + <span class="string">&#x27;.LOADED&#x27;</span>, callback)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        loadScript(<span class="string">&#x27;AI_SEARCH_CARD&#x27;</span>)</span><br><span class="line">      &#125;)()&lt;/script&gt;&lt;script&gt;<span class="keyword">if</span> (!!window.ActiveXObject || <span class="string">&#x27;ActiveXObject&#x27;</span> <span class="keyword">in</span> window) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!/msie [6|7|8|9]/i.test(navigator.userAgent)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!window.upgrade) &#123;</span><br><span class="line">            window.upgrade = <span class="literal">true</span></span><br><span class="line">            <span class="built_in">let</span> s = document.createElement(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">            s.src = <span class="string">&#x27;https://g.csdnimg.cn/browser_upgrade/1.0.2/browser_upgrade.js&#x27;</span></span><br><span class="line">            <span class="built_in">let</span> x = document.getElementsByTagName(<span class="string">&#x27;script&#x27;</span>)[0]</span><br><span class="line">            x.parentNode.insertBefore(s, x)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;&lt;/script&gt;&lt;script&gt;window.onload = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (window.csdn &amp;&amp; typeof window.csdn.configuration_tool_parameterv === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">          window.csdn.configuration_tool_parameterv(&#123;</span><br><span class="line">            need_change_function: <span class="keyword">function</span>(flag) &#123;</span><br><span class="line">              <span class="built_in">let</span> c_toolbar = $(<span class="string">&#x27;#csdn-toolbar&#x27;</span>)</span><br><span class="line">              <span class="built_in">let</span> s_toolbar = $(<span class="string">&#x27;.so-toolbar&#x27;</span>)</span><br><span class="line">              <span class="built_in">let</span> advert = $(<span class="string">&#x27;#csdn-toolbar .toolbar-advert&#x27;</span>)</span><br><span class="line">              <span class="keyword">if</span> (flag === <span class="string">&#x27;fixed&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (advert.length) advert.hide()</span><br><span class="line">                s_toolbar.addClass(<span class="string">&#x27;fixed&#x27;</span>).css(<span class="string">&#x27;top&#x27;</span>, <span class="string">&#x27;0px&#x27;</span>)</span><br><span class="line">                c_toolbar.addClass(<span class="string">&#x27;hiddenToolbar&#x27;</span>)</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flag === <span class="string">&#x27;noFixed&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (advert.length) advert.show()</span><br><span class="line">                s_toolbar.removeClass(<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">                c_toolbar.removeClass(<span class="string">&#x27;hiddenToolbar&#x27;</span>)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;&lt;/script&gt;&lt;script src=<span class="string">&quot;//g.csdnimg.cn/fixed-sidebar/1.1.6/fixed-sidebar.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;//g.csdnimg.cn/user-tooltip/2.4/user-tooltip.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/element-ui.25bb7d6a.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/highlight.6f38c3f5.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/index.b1794c4a.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/chunk-vendors.b533e482.js&quot;</span>&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;<span class="string">&#x27;q&#x27;</span> 不是内部或外部命令，也不是可运行的程序</span><br><span class="line">或批处理文件。</span><br><span class="line"><span class="string">&#x27;t&#x27;</span> 不是内部或外部命令，也不是可运行的程序</span><br><span class="line">或批处理文件。</span><br><span class="line"><span class="string">&#x27;u&#x27;</span> 不是内部或外部命令，也不是可运行的程序</span><br><span class="line">或批处理文件。</span><br><span class="line"><span class="string">&#x27;s&#x27;</span> 不是内部或外部命令，也不是可运行的程序</span><br><span class="line">或批处理文件。</span><br></pre></td></tr></table></figure>
<p>enm,测试的时候后续的参数都被判定为一个cmd命令中的参数了，而不是URL的一部分。为了防止被系统误判，我们用双引号包裹再试一次。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;curl <span class="string">&quot;https://so.csdn.net/so/search?spm=1000.2115.3001.4501&amp;q=openHarmony&amp;t=&amp;u=&amp;s=new&quot;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;&lt;<span class="built_in">head</span>&gt;&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;&lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;&lt;meta name=<span class="string">&quot;referrer&quot;</span> content=<span class="string">&quot;always&quot;</span>&gt;&lt;meta name=<span class="string">&quot;report&quot;</span> content=<span class="string">&#x27;&#123;&quot;spm&quot;:&quot;1018.2226&quot;,&quot;disabled&quot;:&quot;true&quot;&#125;&#x27;</span>&gt;&lt;meta name=<span class="string">&quot;csdn-baidu-search&quot;</span> content=<span class="string">&#x27;&#123;&quot;keyword&quot;:&quot;&quot;&#125;&#x27;</span>&gt;&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0;&quot;</span>&gt;&lt;<span class="built_in">link</span> rel=<span class="string">&quot;icon&quot;</span> href=<span class="string">&quot;https://csdnimg.cn/public/favicon.ico&quot;</span>&gt;&lt;title&gt;&lt;/title&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/lib/jquery/3.7.1/jquery.min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/common/csdn-report/report.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/baidu-search/1.0.12/baidu-search.js&quot;</span>&gt;&lt;/script&gt;&lt;script&gt;var CFG = &#123;</span><br><span class="line">        API_URL: <span class="string">&#x27;//so.csdn.net/so/&#x27;</span>,</span><br><span class="line">        js_insert_first: <span class="literal">true</span>,</span><br><span class="line">        js_insert_count: 0</span><br><span class="line">      &#125;&lt;/script&gt;&lt;style&gt;.hiddenToolbar &#123;</span><br><span class="line">        display: none !important;</span><br><span class="line">      &#125;&lt;/style&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/chunk-507d1eda.d0e4a7f0.css&quot;</span> rel=<span class="string">&quot;prefetch&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/chunk-ef13ade6.b7f2a69e.css&quot;</span> rel=<span class="string">&quot;prefetch&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/chunk-507d1eda.f1d6c6e7.js&quot;</span> rel=<span class="string">&quot;prefetch&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/chunk-ef13ade6.fb45640e.js&quot;</span> rel=<span class="string">&quot;prefetch&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/element-ui.6b92dc4c.css&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;style&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/highlight.9276efd2.css&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;style&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/index.183186f5.css&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;style&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/element-ui.25bb7d6a.js&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;script&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/highlight.6f38c3f5.js&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;script&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/index.b1794c4a.js&quot;</span> rel=<span class="string">&quot;preload&quot;</span> as=<span class="string">&quot;script&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/element-ui.6b92dc4c.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/highlight.9276efd2.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/css/index.183186f5.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;    &lt;script src=<span class="string">&quot;/cdn_cgi_bs_captcha/static/js/waf_captcha_embedded_bs.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;&lt;body style=<span class="string">&quot;position: relative;&quot;</span>&gt;&lt;noscript&gt;&lt;strong&gt;We<span class="string">&#x27;re sorry but search-fe-v2 doesn&#x27;</span>t work properly without JavaScript enabled. Please <span class="built_in">enable</span> it to <span class="built_in">continue</span>.&lt;/strong&gt;&lt;/noscript&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;app&quot;</span>&gt;&lt;/div&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/common/csdn-login-box/csdn-login-box.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/user-ordercart/3.0.1/user-ordercart.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/lib/qrcode/1.0.0/qrcode.min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://g.csdnimg.cn/user-ordertip/5.0.5_so_v2/user-ordertip.js&quot;</span>&gt;&lt;/script&gt;&lt;script&gt;const header = document.createElement(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">      header.type = <span class="string">&#x27;text/javascript&#x27;</span></span><br><span class="line">      header.prod = <span class="string">&#x27;so&#x27;</span></span><br><span class="line">      header.skin = <span class="string">&#x27;black&#x27;</span></span><br><span class="line">      header.domain = <span class="string">&#x27;//so.csdn.net/so/&#x27;</span></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        location.pathname.includes(<span class="string">&#x27;/chat&#x27;</span>) ||</span><br><span class="line">        location.pathname.includes(<span class="string">&#x27;/so/ai&#x27;</span>) ||</span><br><span class="line">        location.pathname.includes(<span class="string">&#x27;/so/ask&#x27;</span>)</span><br><span class="line">      ) &#123;</span><br><span class="line">        // PC端显示C知道自己的toolbar</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          navigator.userAgent.match(/(iPhone|iPod|Android|ios|iOS|iPad|Backerry|WebOS|Symbian|Windows Phone|Phone)/i)</span><br><span class="line">        ) &#123;</span><br><span class="line">          header.src = <span class="string">&#x27;//csdnimg.cn/public/common/toolbar/js/m_toolbar-2.1.2.js&#x27;</span></span><br><span class="line">          const <span class="built_in">link</span> = document.createElement(<span class="string">&#x27;link&#x27;</span>)</span><br><span class="line">          link.rel = <span class="string">&#x27;stylesheet&#x27;</span></span><br><span class="line">          link.href = <span class="string">&#x27;//csdnimg.cn/public/common/toolbar/content_toolbar_css/m_toolbar-1.1.1.css&#x27;</span></span><br><span class="line">          document.head.appendChild(<span class="built_in">link</span>)</span><br><span class="line">          // 兼容app</span><br><span class="line">          <span class="keyword">if</span> (document.cookie.includes(<span class="string">&#x27;CSDN-APP&#x27;</span>) || /csdn/i.test(window.navigator.userAgent)) &#123;</span><br><span class="line">            document.body.className = <span class="string">&#x27;csdn-app&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        header.src = <span class="string">&#x27;https://g.csdnimg.cn/common/csdn-toolbar/csdn-toolbar.js&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      document.body.appendChild(header)&lt;/script&gt;&lt;script&gt;;(<span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">        const isTest = location.host.indexOf(<span class="string">&#x27;loc&#x27;</span>) &gt; -1 || location.href.indexOf(<span class="string">&#x27;cknow-lib-env=test&#x27;</span>) &gt; -1</span><br><span class="line">        const SCRIPTS_PRELOAD = &#123;</span><br><span class="line">          AI_SEARCH_CARD: &#123;</span><br><span class="line">            LOADED: <span class="literal">false</span>,</span><br><span class="line">            SRC: isTest</span><br><span class="line">              ? <span class="string">&#x27;https://g.csdnimg.cn/aisearch/web-card/ai-search-card.js&#x27;</span></span><br><span class="line">              : <span class="string">&#x27;https://csdnimg.cn/release/aisearch/web-card/ai-search-card.js&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        const loadScript = <span class="keyword">function</span>(name) &#123;</span><br><span class="line">          <span class="keyword">if</span> (SCRIPTS_PRELOAD[name]) &#123;</span><br><span class="line">            const aiCardContentScript = document.createElement(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">            aiCardContentScript.<span class="built_in">type</span> = <span class="string">&#x27;text/javascript&#x27;</span></span><br><span class="line">            aiCardContentScript.onload = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">              SCRIPTS_PRELOAD[name].LOADED = <span class="literal">true</span></span><br><span class="line">              window.dispatchEvent(new CustomEvent(name + <span class="string">&#x27;.LOADED&#x27;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            aiCardContentScript.src = SCRIPTS_PRELOAD[name].SRC</span><br><span class="line">            document.body.appendChild(aiCardContentScript)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        window.SCRIPTS_ONLOAD = <span class="keyword">function</span>(name, callback) &#123;</span><br><span class="line">          <span class="keyword">if</span> (SCRIPTS_PRELOAD[name].LOADED) &#123;</span><br><span class="line">            callback()</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            window.addEventListener(name + <span class="string">&#x27;.LOADED&#x27;</span>, callback)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        loadScript(<span class="string">&#x27;AI_SEARCH_CARD&#x27;</span>)</span><br><span class="line">      &#125;)()&lt;/script&gt;&lt;script&gt;<span class="keyword">if</span> (!!window.ActiveXObject || <span class="string">&#x27;ActiveXObject&#x27;</span> <span class="keyword">in</span> window) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!/msie [6|7|8|9]/i.test(navigator.userAgent)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!window.upgrade) &#123;</span><br><span class="line">            window.upgrade = <span class="literal">true</span></span><br><span class="line">            <span class="built_in">let</span> s = document.createElement(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">            s.src = <span class="string">&#x27;https://g.csdnimg.cn/browser_upgrade/1.0.2/browser_upgrade.js&#x27;</span></span><br><span class="line">            <span class="built_in">let</span> x = document.getElementsByTagName(<span class="string">&#x27;script&#x27;</span>)[0]</span><br><span class="line">            x.parentNode.insertBefore(s, x)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;&lt;/script&gt;&lt;script&gt;window.onload = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (window.csdn &amp;&amp; typeof window.csdn.configuration_tool_parameterv === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">          window.csdn.configuration_tool_parameterv(&#123;</span><br><span class="line">            need_change_function: <span class="keyword">function</span>(flag) &#123;</span><br><span class="line">              <span class="built_in">let</span> c_toolbar = $(<span class="string">&#x27;#csdn-toolbar&#x27;</span>)</span><br><span class="line">              <span class="built_in">let</span> s_toolbar = $(<span class="string">&#x27;.so-toolbar&#x27;</span>)</span><br><span class="line">              <span class="built_in">let</span> advert = $(<span class="string">&#x27;#csdn-toolbar .toolbar-advert&#x27;</span>)</span><br><span class="line">              <span class="keyword">if</span> (flag === <span class="string">&#x27;fixed&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (advert.length) advert.hide()</span><br><span class="line">                s_toolbar.addClass(<span class="string">&#x27;fixed&#x27;</span>).css(<span class="string">&#x27;top&#x27;</span>, <span class="string">&#x27;0px&#x27;</span>)</span><br><span class="line">                c_toolbar.addClass(<span class="string">&#x27;hiddenToolbar&#x27;</span>)</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flag === <span class="string">&#x27;noFixed&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (advert.length) advert.show()</span><br><span class="line">                s_toolbar.removeClass(<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">                c_toolbar.removeClass(<span class="string">&#x27;hiddenToolbar&#x27;</span>)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;&lt;/script&gt;&lt;script src=<span class="string">&quot;//g.csdnimg.cn/fixed-sidebar/1.1.6/fixed-sidebar.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;//g.csdnimg.cn/user-tooltip/2.4/user-tooltip.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/element-ui.25bb7d6a.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/highlight.6f38c3f5.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/index.b1794c4a.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;https://csdnimg.cn/release/searchv2-fe/js/chunk-vendors.b533e482.js&quot;</span>&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>可以看到，成功了。但仔细一看，获取到的页面内容很少，而且和我们使用浏览器开发者工具所看到的页面结构并不一样，没看到此前所看到的list以及其包含的list-item。这说明其页面内容是在加载后依据于设备类型进行动态生成的，属于是动态网页类型，而非静态网页。之前的OpenHarmony官网的资讯在更新了之后并不需要依赖搜索这种API来间接进行页面信息获取，所以属于是静态网页，可以直接分析结构进行信息的获取。</p>
<p>为了应对这种情况我们就需要使用所谓的“有头爬虫”。</p>
<hr>
<ol>
<li><p>什么是“有头爬虫”？</p>
<p>在爬取网页数据时，网页大致分为两类：<strong>静态网页</strong>和<strong>动态网页</strong>。  </p>
<ul>
<li><strong>静态网页</strong>：页面内容直接写在 HTML 里，用 requests、curl 等工具请求后就能直接看到完整内容，解析 HTML 即可提取数据。</li>
<li><strong>动态网页</strong>：页面初始 HTML 只有骨架，真正的内容是通过 JavaScript 动态渲染出来的。只有浏览器加载并执行 JS 后，内容才会显示在页面上。</li>
</ul>
<p>对于动态网页，传统的 requests、curl 等“无头爬虫”无法获取到渲染后的内容。这时就需要用到<strong>“有头爬虫”</strong>（也叫“浏览器爬虫”）。</p>
</li>
<li><p>有头爬虫的原理</p>
<p>“有头爬虫”本质上是<strong>自动化驱动真实浏览器</strong>（如 Chrome、Edge、Firefox），模拟人类用户的操作流程。它会：</p>
<ul>
<li>打开浏览器窗口</li>
<li>访问目标网页</li>
<li>等待页面和 JS 脚本加载、执行</li>
<li>获取渲染后的完整页面内容（包括 JS 动态生成的内容）</li>
<li>解析并提取所需数据</li>
</ul>
</li>
</ol>
<p>常用的有头爬虫工具有 Selenium、Playwright、Puppeteer 等。</p>
<ol>
<li>“有头爬虫”与“无头爬虫”的区别</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>类型</th>
<th>能力</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>无头爬虫</td>
<td>只请求静态HTML</td>
<td>静态网页</td>
</tr>
<tr>
<td>有头爬虫</td>
<td>执行JS、渲染动态内容</td>
<td>动态网页、反爬较强</td>
</tr>
</tbody>
</table>
</div>
<hr>
<p>在本项目中，我们使用了 <strong>Selenium + Chrome</strong> 作为有头爬虫的实现方案。<br>核心流程如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CSDNOpenHarmonyCrawler</span>:</span><br><span class="line">    BASE_URL = <span class="string">&quot;https://so.csdn.net/so/search?spm=1000.2115.3001.4501&amp;q=openHarmony&amp;t=&amp;u=&amp;s=new&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, delay=<span class="number">1.5</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.delay = delay</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">crawl</span>(<span class="params">self</span>):</span><br><span class="line">        articles = []</span><br><span class="line">        options = Options()</span><br><span class="line">        options.add_argument(<span class="string">&#x27;--headless&#x27;</span>)  <span class="comment"># 无界面模式，后台运行</span></span><br><span class="line">        options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>)</span><br><span class="line">        options.add_argument(<span class="string">&#x27;--no-sandbox&#x27;</span>)</span><br><span class="line">        options.add_argument(<span class="string">&#x27;--window-size=1920,1080&#x27;</span>)</span><br><span class="line">        driver = webdriver.Chrome(options=options)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            driver.get(<span class="variable language_">self</span>.BASE_URL)</span><br><span class="line">            time.sleep(<span class="variable language_">self</span>.delay)  <span class="comment"># 等待JS渲染</span></span><br><span class="line">            soup = BeautifulSoup(driver.page_source, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> soup.select(<span class="string">&quot;div.list-item&quot;</span>):</span><br><span class="line">                a_tag = item.select_one(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">                title_tag = item.select_one(<span class="string">&quot;a.block-title&quot;</span>)</span><br><span class="line">                summary_tag = item.select_one(<span class="string">&quot;.search-detail&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> a_tag <span class="keyword">and</span> title_tag:</span><br><span class="line">                    articles.append(&#123;</span><br><span class="line">                        <span class="string">&quot;title&quot;</span>: title_tag.get_text(strip=<span class="literal">True</span>),</span><br><span class="line">                        <span class="string">&quot;url&quot;</span>: a_tag.get(<span class="string">&quot;href&quot;</span>),</span><br><span class="line">                        <span class="string">&quot;summary&quot;</span>: summary_tag.get_text(strip=<span class="literal">True</span>) <span class="keyword">if</span> summary_tag <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line">                    &#125;)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            driver.quit()</span><br><span class="line">        <span class="keyword">return</span> articles</span><br></pre></td></tr></table></figure>
<p><strong>解释：</strong></p>
<ul>
<li>通过 Selenium 启动一个无头 Chrome 浏览器，访问 CSDN 搜索页面。</li>
<li>浏览器会自动执行页面中的所有 JavaScript，渲染出完整的资讯列表。</li>
<li>用 BeautifulSoup 解析渲染后的 HTML，提取 <code>div.list-item</code> 下的资讯标题、链接和摘要。</li>
<li>最终获取到的内容与浏览器 F12 看到的内容一致，<strong>解决了动态网页无法直接爬取的问题</strong>。</li>
</ul>
<p>明天继续解决详细文章内容爬取的问题。</p>
<hr>
<p>接下来我们来解决一下具体文章内容爬取的问题。</p>
<p>首先任一点开两篇文章的链接，对比其结构，统一网站的同一类型子页面内容的格式应该是一致的模板。</p>
<p><img src="https://bu.dusays.com/2025/07/11/6870b1a461fc5.png" alt="1752215970486.png"></p>
<p>首先通过第一篇文章直接选择文章正文内容的容器就可以定位到正文然后再逐级向上找到包裹全部文章正文的极小容器，这样我们就可以通过该容器来获取到全部文章内容了。</p>
<p>id是<code>content_views</code>，类名可以不唯一，但是id肯定是唯一的，我们再找一篇文章进行一下验证。</p>
<p><img src="https://bu.dusays.com/2025/07/11/6870b308a30a4.png" alt="1752216326708.png"></p>
<p>ok现在我们就可以确定我们的目标文章内容就是这个容器了。开始编写爬起代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">crawl</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用Selenium获取渲染后的资讯内容，并爬取每篇文章详情页&quot;&quot;&quot;</span></span><br><span class="line">    articles = []</span><br><span class="line">    options = Options()</span><br><span class="line">    options.add_argument(<span class="string">&#x27;--headless&#x27;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&#x27;--no-sandbox&#x27;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&#x27;--window-size=1920,1080&#x27;</span>)</span><br><span class="line">    driver = webdriver.Chrome(options=options)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = <span class="variable language_">self</span>.BASE_URL</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;请求: <span class="subst">&#123;url&#125;</span> ...&quot;</span>)</span><br><span class="line">        driver.get(url)</span><br><span class="line">        time.sleep(<span class="variable language_">self</span>.delay + random.random())  <span class="comment"># 等待JS渲染</span></span><br><span class="line">        soup = BeautifulSoup(driver.page_source, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> soup.select(<span class="string">&quot;div.list-item&quot;</span>):</span><br><span class="line">            a_tag = item.select_one(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">            title_tag = item.select_one(<span class="string">&quot;a.block-title&quot;</span>)</span><br><span class="line">            <span class="comment"># 修改简介提取方式</span></span><br><span class="line">            summary_tag = item.select_one(<span class="string">&quot;p.row2&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> a_tag <span class="keyword">and</span> title_tag:</span><br><span class="line">                article_url = a_tag.get(<span class="string">&quot;href&quot;</span>)</span><br><span class="line">                article = &#123;</span><br><span class="line">                    <span class="string">&quot;title&quot;</span>: title_tag.get_text(strip=<span class="literal">True</span>),</span><br><span class="line">                    <span class="string">&quot;url&quot;</span>: article_url,</span><br><span class="line">                    <span class="string">&quot;summary&quot;</span>: summary_tag.get_text(strip=<span class="literal">True</span>) <span class="keyword">if</span> summary_tag <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment"># 进入详情页爬取正文、作者、时间</span></span><br><span class="line">                detail = <span class="variable language_">self</span>.crawl_article_detail(driver, article_url)</span><br><span class="line">                article.update(detail)</span><br><span class="line">                articles.append(article)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;已获取: <span class="subst">&#123;article[<span class="string">&#x27;title&#x27;</span>]&#125;</span> [<span class="subst">&#123;article_url&#125;</span>]&quot;</span>)</span><br><span class="line">                time.sleep(<span class="variable language_">self</span>.delay + random.random())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;共获取到<span class="subst">&#123;<span class="built_in">len</span>(articles)&#125;</span>篇文章&quot;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        driver.quit()</span><br><span class="line">    <span class="keyword">return</span> articles</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crawl_article_detail</span>(<span class="params">self, driver, url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;爬取CSDN博文详情页，提取正文内容、作者、时间等&quot;&quot;&quot;</span></span><br><span class="line">    result = &#123;</span><br><span class="line">        <span class="string">&quot;date&quot;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        driver.get(url)</span><br><span class="line">        time.sleep(<span class="variable language_">self</span>.delay + random.random())</span><br><span class="line">        soup = BeautifulSoup(driver.page_source, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">        <span class="comment"># 正文内容</span></span><br><span class="line">        content_blocks = []</span><br><span class="line">        content_container = soup.find(<span class="built_in">id</span>=<span class="string">&quot;content_views&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> content_container:</span><br><span class="line">            <span class="keyword">for</span> elem <span class="keyword">in</span> content_container.find_all([<span class="string">&quot;p&quot;</span>, <span class="string">&quot;h1&quot;</span>, <span class="string">&quot;h2&quot;</span>, <span class="string">&quot;h3&quot;</span>, <span class="string">&quot;h4&quot;</span>, <span class="string">&quot;h5&quot;</span>, <span class="string">&quot;h6&quot;</span>, <span class="string">&quot;div&quot;</span>, <span class="string">&quot;img&quot;</span>, <span class="string">&quot;pre&quot;</span>, <span class="string">&quot;code&quot;</span>, <span class="string">&quot;ul&quot;</span>, <span class="string">&quot;ol&quot;</span>, <span class="string">&quot;li&quot;</span>]):</span><br><span class="line">                <span class="keyword">if</span> elem.name <span class="keyword">in</span> [<span class="string">&quot;p&quot;</span>, <span class="string">&quot;h1&quot;</span>, <span class="string">&quot;h2&quot;</span>, <span class="string">&quot;h3&quot;</span>, <span class="string">&quot;h4&quot;</span>, <span class="string">&quot;h5&quot;</span>, <span class="string">&quot;h6&quot;</span>, <span class="string">&quot;div&quot;</span>, <span class="string">&quot;li&quot;</span>]:</span><br><span class="line">                    text = elem.get_text(strip=<span class="literal">True</span>)</span><br><span class="line">                    <span class="keyword">if</span> text <span class="keyword">and</span> <span class="built_in">len</span>(text) &gt; <span class="number">0</span>:</span><br><span class="line">                        content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;value&quot;</span>: text&#125;)</span><br><span class="line">                <span class="keyword">elif</span> elem.name == <span class="string">&quot;img&quot;</span>:</span><br><span class="line">                    img_src = elem.get(<span class="string">&quot;src&quot;</span>)</span><br><span class="line">                    <span class="keyword">if</span> img_src:</span><br><span class="line">                        content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>, <span class="string">&quot;value&quot;</span>: img_src&#125;)</span><br><span class="line">                <span class="keyword">elif</span> elem.name <span class="keyword">in</span> [<span class="string">&quot;pre&quot;</span>, <span class="string">&quot;code&quot;</span>]:</span><br><span class="line">                    code_text = elem.get_text(<span class="string">&quot;\n&quot;</span>, strip=<span class="literal">True</span>)</span><br><span class="line">                    <span class="keyword">if</span> code_text:</span><br><span class="line">                        content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>, <span class="string">&quot;value&quot;</span>: code_text&#125;)</span><br><span class="line">        result[<span class="string">&quot;content&quot;</span>] = content_blocks</span><br><span class="line">        <span class="comment"># 作者信息</span></span><br><span class="line">        author_box = soup.select_one(<span class="string">&quot;a.profile-href&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> author_box:</span><br><span class="line">            author_name = author_box.select_one(<span class="string">&quot;span.profile-name&quot;</span>)</span><br><span class="line">            author_img = author_box.select_one(<span class="string">&quot;img.profile-img&quot;</span>)</span><br><span class="line">            result[<span class="string">&quot;author&quot;</span>] = &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: author_name.get_text(strip=<span class="literal">True</span>) <span class="keyword">if</span> author_name <span class="keyword">else</span> <span class="literal">None</span>,</span><br><span class="line">                <span class="string">&quot;avatar&quot;</span>: author_img.get(<span class="string">&quot;src&quot;</span>) <span class="keyword">if</span> author_img <span class="keyword">else</span> <span class="literal">None</span>,</span><br><span class="line">                <span class="string">&quot;homepage&quot;</span>: author_box.get(<span class="string">&quot;href&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment"># 发布时间</span></span><br><span class="line">        <span class="comment"># 常见位置：meta、时间标签、正文上方</span></span><br><span class="line">        date_str = <span class="literal">None</span></span><br><span class="line">        meta_time = soup.find(<span class="string">&quot;meta&quot;</span>, &#123;<span class="string">&quot;itemprop&quot;</span>: <span class="string">&quot;datePublished&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">if</span> meta_time <span class="keyword">and</span> meta_time.get(<span class="string">&quot;content&quot;</span>):</span><br><span class="line">            date_str = meta_time[<span class="string">&quot;content&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> date_str:</span><br><span class="line">            <span class="comment"># 备选方案：查找常见时间标签</span></span><br><span class="line">            time_tag = soup.find(<span class="string">&quot;span&quot;</span>, class_=<span class="string">&quot;time&quot;</span>) <span class="keyword">or</span> soup.find(<span class="string">&quot;span&quot;</span>, class_=<span class="string">&quot;publish-time&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> time_tag:</span><br><span class="line">                date_str = time_tag.get_text(strip=<span class="literal">True</span>)</span><br><span class="line">        result[<span class="string">&quot;date&quot;</span>] = date_str</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;详情页解析失败: <span class="subst">&#123;url&#125;</span>, 错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>我对原有的资讯列表获取功能函数进行了升级，添加了简介的获取以及对文章内容函数的调用功能。</p>
<p>开始运行测试。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/1.png" alt="1"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;​​Unity版本​​：2021.3 LTS（支持OpenHarmony 3.2+，官方推荐）；&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;​​OpenHarmony SDK​​：安装DevEco Studio（OpenHarmony开发工具）并配置LiteOS SDK（路径：File &gt; Settings &gt; SDK Manager）；&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;File &gt; Settings &gt; SDK Manager&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;​​交叉编译工具​​：OpenHarmony提供的ohos-gcc（版本r12p）与cmake（3.18+）；&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;ohos-gcc&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;cmake&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;​​调试工具​​：hdc（鸿蒙设备连接工具）、PerfTool（性能分析工具）。&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>我们可以看到在爬取的时候还成功获取了代码块中的内容，这也是之前在爬取OpenHarmony官网资讯时所没有考虑到的，因为官网的资讯大多类似于新闻报道类型的文章并不会过多的提及技术细节，只会从整体的视角介绍讲解，而CSDN与其是完全不同的性质，所以在客户端进行渲染时我也要考虑到这一点。</p>
<p>不过从结果来看还能发现两个问题，一个就是单一关键词的OpenHarmony资讯获取的数量还是太少了只有30篇，所以我应该想办法用多关键词进行爬取，另一个就是爬取的资讯中的代码部分处理的并不好。有一些代码块在获取后会有很奇怪的重复需要针对代码块进行特别的调优处理。这里我考虑可以将代码标签中的值用markdown格式来进行传递，在客户端解析时利用第三方markdown解析库进行解析。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;// EntryAbility.ets（OpenHarmony轻量系统）\nimport\nUIAbility\nfrom\n&#x27;@ohos.app.ability.UIAbility&#x27;\n;\nimport\nWindow\nfrom\n&#x27;@ohos.window&#x27;\n;\nexport\ndefault\nclass\nEntryAbility\nextends\nUIAbility\n&#123;\nonCreate\n(\nwant, launchParam\n) &#123;\nconsole\n.\nlog\n(\n&#x27;EntryAbility onCreate: 启动Unity游戏&#x27;\n);\n// 加载Unity渲染的View\nthis\n.\ncontext\n.\nsetUIContent\n(\nthis\n,\n&#x27;pages/UnityScene&#x27;\n,\nnull\n);\n&#125;\nonDestroy\n(\n) &#123;\nconsole\n.\nlog\n(\n&#x27;EntryAbility onDestroy: 关闭Unity&#x27;\n);\n&#125;\nonWindowStageCreate\n(\nwindowStage: Window.WindowStage\n) &#123;\n// 加载Unity生成的HAP包（或动态库）\nwindowStage.\nloadAbility\n(\nnew\nIntent\n.\nOperationBuilder\n()\n.\nwithAction\n(\nIntent\n.\nACTION_MAIN\n)\n.\nwithCategory\n(\nIntent\n.\nCATEGORY_LAUNCHER\n)\n.\nbuild\n()).\nthen\n(\n() =&gt;\n&#123;\nconsole\n.\nlog\n(\n&#x27;Unity场景加载完成&#x27;\n);\n&#125;).\ncatch\n(\n(\nerr\n) =&gt;\n&#123;\nconsole\n.\nerror\n(\n&#x27;加载失败：&#x27;\n+\nJSON\n.\nstringify\n(err));\n&#125;);\n&#125;\n&#125;\nAI生成项目&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;// EntryAbility.ets（OpenHarmony轻量系统）\nimport\nUIAbility\nfrom\n&#x27;@ohos.app.ability.UIAbility&#x27;\n;\nimport\nWindow\nfrom\n&#x27;@ohos.window&#x27;\n;\nexport\ndefault\nclass\nEntryAbility\nextends\nUIAbility\n&#123;\nonCreate\n(\nwant, launchParam\n) &#123;\nconsole\n.\nlog\n(\n&#x27;EntryAbility onCreate: 启动Unity游戏&#x27;\n);\n// 加载Unity渲染的View\nthis\n.\ncontext\n.\nsetUIContent\n(\nthis\n,\n&#x27;pages/UnityScene&#x27;\n,\nnull\n);\n&#125;\nonDestroy\n(\n) &#123;\nconsole\n.\nlog\n(\n&#x27;EntryAbility onDestroy: 关闭Unity&#x27;\n);\n&#125;\nonWindowStageCreate\n(\nwindowStage: Window.WindowStage\n) &#123;\n// 加载Unity生成的HAP包（或动态库）\nwindowStage.\nloadAbility\n(\nnew\nIntent\n.\nOperationBuilder\n()\n.\nwithAction\n(\nIntent\n.\nACTION_MAIN\n)\n.\nwithCategory\n(\nIntent\n.\nCATEGORY_LAUNCHER\n)\n.\nbuild\n()).\nthen\n(\n() =&gt;\n&#123;\nconsole\n.\nlog\n(\n&#x27;Unity场景加载完成&#x27;\n);\n&#125;).\ncatch\n(\n(\nerr\n) =&gt;\n&#123;\nconsole\n.\nerror\n(\n&#x27;加载失败：&#x27;\n+\nJSON\n.\nstringify\n(err));\n&#125;);\n&#125;\n&#125;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;// EntryAbility.ets（OpenHarmony轻量系统）&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;// EntryAbility.ets（OpenHarmony轻量系统）&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;// EntryAbility.ets（OpenHarmony轻量系统）&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>问题的具体表现就像是上面这样，所以我们需要针对代码块的结构进行优化处理</p>
<h4 id="CSDN资讯源的代码块结构专项优化"><a href="#CSDN资讯源的代码块结构专项优化" class="headerlink" title="CSDN资讯源的代码块结构专项优化"></a>CSDN资讯源的代码块结构专项优化</h4><p><img src="/2025/06/29/OpenSourceSummer2025/2.png" alt="2"></p>
<p><img src="/2025/06/29/OpenSourceSummer2025/3.png" alt="3"></p>
<p>我确实没怎么注意过这个代码块的渲染细节，这仔细一看才看明白，关键字，变量名，注释等都是不同的类名来进行的渲染。究竟怎么依据各个语言的语法来进行区分与渲染，或者说我们常用的这套Markdown渲染成HTML的逻辑又是怎么实现的？确实很有趣，后面没准会单开一篇文章来研究一下，哈哈。</p>
<hr>
<p>来让我们回归正题。在观察了代码块的页面结构后我对代码进行了升级改造。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elif</span> elem.name == <span class="string">&quot;pre&quot;</span>:</span><br><span class="line">    <span class="comment"># 优化：合并整个pre下的代码行，按markdown代码块格式输出</span></span><br><span class="line">    code_lines = []</span><br><span class="line">    <span class="comment"># 兼容CSDN高亮结构</span></span><br><span class="line">    <span class="keyword">for</span> code_div <span class="keyword">in</span> elem.select(<span class="string">&quot;div.hljs-ln-code, code&quot;</span>):</span><br><span class="line">        code_line = code_div.get_text(<span class="string">&quot;\n&quot;</span>, strip=<span class="literal">False</span>)</span><br><span class="line">        code_lines.append(code_line)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> code_lines:</span><br><span class="line">        <span class="comment"># 兜底：直接取pre的全部文本</span></span><br><span class="line">        code_lines = [elem.get_text(<span class="string">&quot;\n&quot;</span>, strip=<span class="literal">False</span>)]</span><br><span class="line">    code_text = <span class="string">&quot;&quot;</span>.join(code_lines)</span><br><span class="line">    <span class="comment"># 检测语言类型</span></span><br><span class="line">    lang = <span class="string">&quot;&quot;</span></span><br><span class="line">    code_tag = elem.find(<span class="string">&quot;code&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> code_tag <span class="keyword">and</span> code_tag.has_attr(<span class="string">&quot;class&quot;</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> code_tag[<span class="string">&quot;class&quot;</span>]:</span><br><span class="line">            <span class="keyword">if</span> c.startswith(<span class="string">&quot;language-&quot;</span>):</span><br><span class="line">                lang = c.replace(<span class="string">&quot;language-&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    md_code = <span class="string">f&quot;```<span class="subst">&#123;lang&#125;</span>\n<span class="subst">&#123;code_text&#125;</span>\n```&quot;</span></span><br><span class="line">    content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>, <span class="string">&quot;value&quot;</span>: md_code&#125;)</span><br><span class="line"><span class="keyword">elif</span> elem.name == <span class="string">&quot;code&quot;</span>:</span><br><span class="line">    <span class="comment"># 跳过已被pre处理的code，避免重复</span></span><br><span class="line">    <span class="keyword">if</span> elem.parent <span class="keyword">and</span> elem.parent.name == <span class="string">&quot;pre&quot;</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    code_text = elem.get_text(<span class="string">&quot;\n&quot;</span>, strip=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> code_text:</span><br><span class="line">        md_code = <span class="string">f&quot;```<span class="subst">&#123;code_text&#125;</span>```&quot;</span></span><br><span class="line">        content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>, <span class="string">&quot;value&quot;</span>: md_code&#125;)</span><br></pre></td></tr></table></figure>
<p>核心的爬取逻辑修改就在这里了，让我们再来测试一下。</p>
<p>在我看到我想看到的代码块之前我就发现了另一个问题，理论上讲我的代码已经去除了被pre标签包裹的code标签，但是实际上我的代码却将行内代码块也一并设置为了用<code>``` ``` </code>代码块来进行包裹，这很显然是错误的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;```File &gt; Settings &gt; SDK Manager```&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;​​交叉编译工具​​：OpenHarmony提供的ohos-gcc（版本r12p）与cmake（3.18+）；&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;```ohos-gcc```&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;```cmake```&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>我们先继续检索我们所想看到的代码块对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;```typescript\n// EntryAbility.ets（OpenHarmony轻量系统）\nimport\n \nUIAbility\n \nfrom\n \n&#x27;@ohos.app.ability.UIAbility&#x27;\n;\nimport\n \nWindow\n \nfrom\n \n&#x27;@ohos.window&#x27;\n;\n \nexport\n \ndefault\n \nclass\n \nEntryAbility\n \nextends\n \nUIAbility\n &#123;\n  \nonCreate\n(\nwant, launchParam\n) &#123;\n    \nconsole\n.\nlog\n(\n&#x27;EntryAbility onCreate: 启动Unity游戏&#x27;\n);\n    \n// 加载Unity渲染的View\n    \nthis\n.\ncontext\n.\nsetUIContent\n(\nthis\n, \n&#x27;pages/UnityScene&#x27;\n, \nnull\n);\n  &#125;\n \n  \nonDestroy\n(\n) &#123;\n    \nconsole\n.\nlog\n(\n&#x27;EntryAbility onDestroy: 关闭Unity&#x27;\n);\n  &#125;\n \n  \nonWindowStageCreate\n(\nwindowStage: Window.WindowStage\n) &#123;\n    \n// 加载Unity生成的HAP包（或动态库）\n    windowStage.\nloadAbility\n(\nnew\n \nIntent\n.\nOperationBuilder\n()\n      .\nwithAction\n(\nIntent\n.\nACTION_MAIN\n)\n      .\nwithCategory\n(\nIntent\n.\nCATEGORY_LAUNCHER\n)\n      .\nbuild\n()).\nthen\n(\n() =&gt;\n &#123;\n      \nconsole\n.\nlog\n(\n&#x27;Unity场景加载完成&#x27;\n);\n    &#125;).\ncatch\n(\n(\nerr\n) =&gt;\n &#123;\n      \nconsole\n.\nerror\n(\n&#x27;加载失败：&#x27;\n + \nJSON\n.\nstringify\n(err));\n    &#125;);\n  &#125;\n&#125;// EntryAbility.ets（OpenHarmony轻量系统）import\n \nUIAbility\n \nfrom\n \n&#x27;@ohos.app.ability.UIAbility&#x27;\n;import\n \nWindow\n \nfrom\n \n&#x27;@ohos.window&#x27;\n; export\n \ndefault\n \nclass\n \nEntryAbility\n \nextends\n \nUIAbility\n &#123;  \nonCreate\n(\nwant, launchParam\n) &#123;    \nconsole\n.\nlog\n(\n&#x27;EntryAbility onCreate: 启动Unity游戏&#x27;\n);    \n// 加载Unity渲染的View    \nthis\n.\ncontext\n.\nsetUIContent\n(\nthis\n, \n&#x27;pages/UnityScene&#x27;\n, \nnull\n);  &#125;   \nonDestroy\n(\n) &#123;    \nconsole\n.\nlog\n(\n&#x27;EntryAbility onDestroy: 关闭Unity&#x27;\n);  &#125;   \nonWindowStageCreate\n(\nwindowStage: Window.WindowStage\n) &#123;    \n// 加载Unity生成的HAP包（或动态库）    windowStage.\nloadAbility\n(\nnew\n \nIntent\n.\nOperationBuilder\n()      .\nwithAction\n(\nIntent\n.\nACTION_MAIN\n)      .\nwithCategory\n(\nIntent\n.\nCATEGORY_LAUNCHER\n)      .\nbuild\n()).\nthen\n(\n() =&gt;\n &#123;      \nconsole\n.\nlog\n(\n&#x27;Unity场景加载完成&#x27;\n);    &#125;).\ncatch\n(\n(\nerr\n) =&gt;\n &#123;      \nconsole\n.\nerror\n(\n&#x27;加载失败：&#x27;\n + \nJSON\n.\nstringify\n(err));    &#125;);  &#125;&#125;\n```&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>这一大段这么看咱们也不知道格式对不对我就直接利用三方插件进行一下渲染测试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ohpm i @lidary/markdown</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/29/OpenSourceSummer2025/4.png" alt="4"></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MarkdownV2</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@lidary/markdown&#x27;</span>;</span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&quot;```typescript\n// EntryAbility.ets（OpenHarmony轻量系统）\nimport\n \nUIAbility\n \nfrom\n \n&#x27;@ohos.app.ability.UIAbility&#x27;\n;\nimport\n \nWindow\n \nfrom\n \n&#x27;@ohos.window&#x27;\n;\n \nexport\n \ndefault\n \nclass\n \nEntryAbility\n \nextends\n \nUIAbility\n &#123;\n  \nonCreate\n(\nwant, launchParam\n) &#123;\n    \nconsole\n.\nlog\n(\n&#x27;EntryAbility onCreate: 启动Unity游戏&#x27;\n);\n    \n// 加载Unity渲染的View\n    \nthis\n.\ncontext\n.\nsetUIContent\n(\nthis\n, \n&#x27;pages/UnityScene&#x27;\n, \nnull\n);\n  &#125;\n \n  \nonDestroy\n(\n) &#123;\n    \nconsole\n.\nlog\n(\n&#x27;EntryAbility onDestroy: 关闭Unity&#x27;\n);\n  &#125;\n \n  \nonWindowStageCreate\n(\nwindowStage: Window.WindowStage\n) &#123;\n    \n// 加载Unity生成的HAP包（或动态库）\n    windowStage.\nloadAbility\n(\nnew\n \nIntent\n.\nOperationBuilder\n()\n      .\nwithAction\n(\nIntent\n.\nACTION_MAIN\n)\n      .\nwithCategory\n(\nIntent\n.\nCATEGORY_LAUNCHER\n)\n      .\nbuild\n()).\nthen\n(\n() =&gt;\n &#123;\n      \nconsole\n.\nlog\n(\n&#x27;Unity场景加载完成&#x27;\n);\n    &#125;).\ncatch\n(\n(\nerr\n) =&gt;\n &#123;\n      \nconsole\n.\nerror\n(\n&#x27;加载失败：&#x27;\n + \nJSON\n.\nstringify\n(err));\n    &#125;);\n  &#125;\n&#125;// EntryAbility.ets（OpenHarmony轻量系统）import\n \nUIAbility\n \nfrom\n \n&#x27;@ohos.app.ability.UIAbility&#x27;\n;import\n \nWindow\n \nfrom\n \n&#x27;@ohos.window&#x27;\n; export\n \ndefault\n \nclass\n \nEntryAbility\n \nextends\n \nUIAbility\n &#123;  \nonCreate\n(\nwant, launchParam\n) &#123;    \nconsole\n.\nlog\n(\n&#x27;EntryAbility onCreate: 启动Unity游戏&#x27;\n);    \n// 加载Unity渲染的View    \nthis\n.\ncontext\n.\nsetUIContent\n(\nthis\n, \n&#x27;pages/UnityScene&#x27;\n, \nnull\n);  &#125;   \nonDestroy\n(\n) &#123;    \nconsole\n.\nlog\n(\n&#x27;EntryAbility onDestroy: 关闭Unity&#x27;\n);  &#125;   \nonWindowStageCreate\n(\nwindowStage: Window.WindowStage\n) &#123;    \n// 加载Unity生成的HAP包（或动态库）    windowStage.\nloadAbility\n(\nnew\n \nIntent\n.\nOperationBuilder\n()      .\nwithAction\n(\nIntent\n.\nACTION_MAIN\n)      .\nwithCategory\n(\nIntent\n.\nCATEGORY_LAUNCHER\n)      .\nbuild\n()).\nthen\n(\n() =&gt;\n &#123;      \nconsole\n.\nlog\n(\n&#x27;Unity场景加载完成&#x27;\n);    &#125;).\ncatch\n(\n(\nerr\n) =&gt;\n &#123;      \nconsole\n.\nerror\n(\n&#x27;加载失败：&#x27;\n + \nJSON\n.\nstringify\n(err));    &#125;);  &#125;&#125;\n```&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Scroll</span>()&#123;</span><br><span class="line">      <span class="title class_">MarkdownV2</span>(&#123;</span><br><span class="line">        <span class="attr">content</span>:<span class="variable language_">this</span>.<span class="property">message</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>让我们来进行一下渲染测试。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/5.png" alt="5"></p>
<p>果然，这些换行符都是异常的换行符，我们还是得重新进行代码逻辑的编写。</p>
<p>当前对于换行的处理我的想法是直接按照对象进行分段就可以，这样是当前代码的逻辑，但行内代码块注定是要单独开一个对象进行存储的这样一来我们的换行逻辑就不成立了，虽然我们可以将一行的内容全部存储到一个对象数组，将文字和行内代码，之要是同一行的就都存进一个对象数组中，这样就可以保证换行的准确性了。</p>
<p>当然这个方案固然可以解决问题，但我们还应当考虑数据的复杂度，过于复杂的数据结构是否有存在的必要，<mark class="hl-label red">“如无必要，勿增实体”</mark>，这个彩色是外挂标签，但这也可以看做是换了个颜色的行内代码块，这本质上没什么区别，二者外观以及功能性都是相同的，这就够了。我们要明白我们的目标是什么，是让用户能看清楚，能看懂。所以我们其实可以先去找到原文章的效果去看一看行内代码的效果是不是那么重要。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/6.png" alt="6"></p>
<p>这一段，有一说一，其实我在仔细看代码之前从来没有意识到过这是一个经过渲染的行内代码块，仅仅是将其当做了字体不一致的文本而已。虽然仔细看是有一圈淡淡的灰色，但对于浏览文本内容来讲并无任何区别。所以我们暂时不考虑行内代码的渲染，而是先考虑如何渲染文本。</p>
<p>我选择先忽略掉<code>&lt;code&gt;</code>标签，直接通过上下级关系来去将<code>&lt;code&gt;</code>标签的文字内容与前后文串联起来即可。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">crawl_article_detail</span>(<span class="params">self, driver, url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;爬取CSDN博文详情页，提取正文内容、作者、时间等&quot;&quot;&quot;</span></span><br><span class="line">    result = &#123;</span><br><span class="line">        <span class="string">&quot;date&quot;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        driver.get(url)</span><br><span class="line">        time.sleep(<span class="variable language_">self</span>.delay + random.random())</span><br><span class="line">        soup = BeautifulSoup(driver.page_source, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">        <span class="comment"># 正文内容</span></span><br><span class="line">        content_blocks = []</span><br><span class="line">        content_container = soup.find(<span class="built_in">id</span>=<span class="string">&quot;content_views&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> content_container:</span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">append_text</span>(<span class="params">text</span>):</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> text:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">if</span> content_blocks <span class="keyword">and</span> content_blocks[-<span class="number">1</span>][<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;text&quot;</span>:</span><br><span class="line">                    content_blocks[-<span class="number">1</span>][<span class="string">&quot;value&quot;</span>] += text</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;value&quot;</span>: text&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 块级元素，每个生成一行</span></span><br><span class="line">            <span class="keyword">for</span> elem <span class="keyword">in</span> content_container.find_all([<span class="string">&quot;p&quot;</span>, <span class="string">&quot;li&quot;</span>, <span class="string">&quot;h1&quot;</span>, <span class="string">&quot;h2&quot;</span>, <span class="string">&quot;h3&quot;</span>, <span class="string">&quot;h4&quot;</span>, <span class="string">&quot;h5&quot;</span>, <span class="string">&quot;h6&quot;</span>, <span class="string">&quot;div&quot;</span>], recursive=<span class="literal">True</span>):</span><br><span class="line">                <span class="comment"># 跳过空div</span></span><br><span class="line">                <span class="keyword">if</span> elem.name == <span class="string">&quot;div&quot;</span> <span class="keyword">and</span> <span class="keyword">not</span> elem.get_text(strip=<span class="literal">True</span>):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># 处理图片</span></span><br><span class="line">                imgs = elem.find_all(<span class="string">&quot;img&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> img <span class="keyword">in</span> imgs:</span><br><span class="line">                    img_src = img.get(<span class="string">&quot;src&quot;</span>)</span><br><span class="line">                    <span class="keyword">if</span> img_src:</span><br><span class="line">                        content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>, <span class="string">&quot;value&quot;</span>: img_src&#125;)</span><br><span class="line">                <span class="comment"># 处理文本（包括code/strong等标签内容）</span></span><br><span class="line">                text = elem.get_text(separator=<span class="string">&quot;&quot;</span>, strip=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">if</span> text:</span><br><span class="line">                    content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;value&quot;</span>: text&#125;)</span><br><span class="line">            <span class="comment"># 处理pre代码块</span></span><br><span class="line">            <span class="keyword">for</span> pre <span class="keyword">in</span> content_container.find_all(<span class="string">&quot;pre&quot;</span>, recursive=<span class="literal">True</span>):</span><br><span class="line">                code_lines = []</span><br><span class="line">                <span class="keyword">for</span> code_div <span class="keyword">in</span> pre.select(<span class="string">&quot;div.hljs-ln-code, code&quot;</span>):</span><br><span class="line">                    code_line = code_div.get_text(<span class="string">&quot;\n&quot;</span>, strip=<span class="literal">False</span>)</span><br><span class="line">                    code_lines.append(code_line)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> code_lines:</span><br><span class="line">                    code_lines = [pre.get_text(<span class="string">&quot;\n&quot;</span>, strip=<span class="literal">False</span>)]</span><br><span class="line">                code_text = <span class="string">&quot;&quot;</span>.join(code_lines)</span><br><span class="line">                lang = <span class="string">&quot;&quot;</span></span><br><span class="line">                code_tag = pre.find(<span class="string">&quot;code&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> code_tag <span class="keyword">and</span> code_tag.has_attr(<span class="string">&quot;class&quot;</span>):</span><br><span class="line">                    <span class="keyword">for</span> c <span class="keyword">in</span> code_tag[<span class="string">&quot;class&quot;</span>]:</span><br><span class="line">                        <span class="keyword">if</span> c.startswith(<span class="string">&quot;language-&quot;</span>):</span><br><span class="line">                            lang = c.replace(<span class="string">&quot;language-&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                md_code = <span class="string">f&quot;```<span class="subst">&#123;lang&#125;</span>\n<span class="subst">&#123;code_text&#125;</span>\n```&quot;</span></span><br><span class="line">                content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>, <span class="string">&quot;value&quot;</span>: md_code&#125;)</span><br><span class="line">        result[<span class="string">&quot;content&quot;</span>] = content_blocks</span><br><span class="line">        <span class="comment"># 作者信息</span></span><br><span class="line">        author_box = soup.select_one(<span class="string">&quot;a.profile-href&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> author_box:</span><br><span class="line">            author_name = author_box.select_one(<span class="string">&quot;span.profile-name&quot;</span>)</span><br><span class="line">            author_img = author_box.select_one(<span class="string">&quot;img.profile-img&quot;</span>)</span><br><span class="line">            result[<span class="string">&quot;author&quot;</span>] = &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: author_name.get_text(strip=<span class="literal">True</span>) <span class="keyword">if</span> author_name <span class="keyword">else</span> <span class="literal">None</span>,</span><br><span class="line">                <span class="string">&quot;avatar&quot;</span>: author_img.get(<span class="string">&quot;src&quot;</span>) <span class="keyword">if</span> author_img <span class="keyword">else</span> <span class="literal">None</span>,</span><br><span class="line">                <span class="string">&quot;homepage&quot;</span>: author_box.get(<span class="string">&quot;href&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment"># 发布时间</span></span><br><span class="line">        <span class="comment"># 常见位置：meta、时间标签、正文上方</span></span><br><span class="line">        date_str = <span class="literal">None</span></span><br><span class="line">        meta_time = soup.find(<span class="string">&quot;meta&quot;</span>, &#123;<span class="string">&quot;itemprop&quot;</span>: <span class="string">&quot;datePublished&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">if</span> meta_time <span class="keyword">and</span> meta_time.get(<span class="string">&quot;content&quot;</span>):</span><br><span class="line">            date_str = meta_time[<span class="string">&quot;content&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> date_str:</span><br><span class="line">            <span class="comment"># 备选方案：查找常见时间标签</span></span><br><span class="line">            time_tag = soup.find(<span class="string">&quot;span&quot;</span>, class_=<span class="string">&quot;time&quot;</span>) <span class="keyword">or</span> soup.find(<span class="string">&quot;span&quot;</span>, class_=<span class="string">&quot;publish-time&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> time_tag:</span><br><span class="line">                date_str = time_tag.get_text(strip=<span class="literal">True</span>)</span><br><span class="line">        result[<span class="string">&quot;date&quot;</span>] = date_str</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;详情页解析失败: <span class="subst">&#123;url&#125;</span>, 错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>再次进行测试。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/7.png" alt="7"></p>
<p>可以看到，我们的行内代码被成功的忽视并拼接到了前后的文本中，而不是被单独提取出来。</p>
<p>但与此同时新的问题又浮现了出来。我们获取的数据中有重复的内容，这很可能是扫描了父级组件之后，又扫描了子组件，导致重复。我们需要在扫描子组件之前，先检查是否已经扫描过该组件，如果是，则跳过。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">processed_elements = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_child_of_processed</span>(<span class="params">elem</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查元素是否是已处理元素的子元素&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> parent <span class="keyword">in</span> elem.parents:</span><br><span class="line">        <span class="keyword">if</span> parent <span class="keyword">in</span> processed_elements:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>我们新增一个集合用于存储已经存储过得元素，在获取组件文本内容之前我们要先去验证是否为已经处理过的元素的子组件，这样一来我们就可以避免重复扫描导致的重复内容。</p>
<p>在代码全部修改完成后我们从新测试。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">crawl_article_detail</span>(<span class="params">self, driver, url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;爬取CSDN博文详情页，提取正文内容、作者、时间等&quot;&quot;&quot;</span></span><br><span class="line">    result = &#123;</span><br><span class="line">        <span class="string">&quot;date&quot;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        driver.get(url)</span><br><span class="line">        time.sleep(<span class="variable language_">self</span>.delay + random.random())</span><br><span class="line">        soup = BeautifulSoup(driver.page_source, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">        <span class="comment"># 正文内容</span></span><br><span class="line">        content_blocks = []</span><br><span class="line">        content_container = soup.find(<span class="built_in">id</span>=<span class="string">&quot;content_views&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> content_container:</span><br><span class="line">            processed_elements = <span class="built_in">set</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">is_child_of_processed</span>(<span class="params">elem</span>):</span><br><span class="line">                <span class="string">&quot;&quot;&quot;检查元素是否是已处理元素的子元素&quot;&quot;&quot;</span></span><br><span class="line">                <span class="keyword">for</span> parent <span class="keyword">in</span> elem.parents:</span><br><span class="line">                    <span class="keyword">if</span> parent <span class="keyword">in</span> processed_elements:</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">                <span class="keyword">return</span> Fals</span><br><span class="line">            <span class="comment"># 块级元素，每个生成一行，避免重复处理父子元素</span></span><br><span class="line">            <span class="keyword">for</span> elem <span class="keyword">in</span> content_container.find_all([<span class="string">&quot;p&quot;</span>, <span class="string">&quot;li&quot;</span>, <span class="string">&quot;h1&quot;</span>, <span class="string">&quot;h2&quot;</span>, <span class="string">&quot;h3&quot;</span>, <span class="string">&quot;h4&quot;</span>, <span class="string">&quot;h5&quot;</span>, <span class="string">&quot;h6&quot;</span>, <span class="string">&quot;div&quot;</span>], recursive=<span class="literal">True</span>):</span><br><span class="line">                <span class="comment"># 跳过空div</span></span><br><span class="line">                <span class="keyword">if</span> elem.name == <span class="string">&quot;div&quot;</span> <span class="keyword">and</span> <span class="keyword">not</span> elem.get_text(strip=<span class="literal">True</span>):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># 跳过已处理元素的子元素</span></span><br><span class="line">                <span class="keyword">if</span> is_child_of_processed(elem):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># 处理图片</span></span><br><span class="line">                imgs = elem.find_all(<span class="string">&quot;img&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> img <span class="keyword">in</span> imgs:</span><br><span class="line">                    img_src = img.get(<span class="string">&quot;src&quot;</span>)</span><br><span class="line">                    <span class="keyword">if</span> img_src:</span><br><span class="line">                        content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>, <span class="string">&quot;value&quot;</span>: img_src&#125;)</span><br><span class="line">                <span class="comment"># 处理文本（包括code/strong等标签内容）</span></span><br><span class="line">                text = elem.get_text(separator=<span class="string">&quot;&quot;</span>, strip=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">if</span> text:</span><br><span class="line">                    content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;value&quot;</span>: text&#125;)</span><br><span class="line">                    processed_elements.add(elem)</span><br><span class="line">            <span class="comment"># 处理pre代码块</span></span><br><span class="line">            <span class="keyword">for</span> pre <span class="keyword">in</span> content_container.find_all(<span class="string">&quot;pre&quot;</span>, recursive=<span class="literal">True</span>):</span><br><span class="line">                <span class="comment"># 跳过已被文本处理过的pre</span></span><br><span class="line">                <span class="keyword">if</span> pre <span class="keyword">in</span> processed_elements:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                code_lines = []</span><br><span class="line">                <span class="keyword">for</span> code_div <span class="keyword">in</span> pre.select(<span class="string">&quot;div.hljs-ln-code, code&quot;</span>):</span><br><span class="line">                    code_line = code_div.get_text(<span class="string">&quot;\n&quot;</span>, strip=<span class="literal">False</span>)</span><br><span class="line">                    code_lines.append(code_line)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> code_lines:</span><br><span class="line">                    code_lines = [pre.get_text(<span class="string">&quot;\n&quot;</span>, strip=<span class="literal">False</span>)]</span><br><span class="line">                code_text = <span class="string">&quot;&quot;</span>.join(code_lines)</span><br><span class="line">                lang = <span class="string">&quot;&quot;</span></span><br><span class="line">                code_tag = pre.find(<span class="string">&quot;code&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> code_tag <span class="keyword">and</span> code_tag.has_attr(<span class="string">&quot;class&quot;</span>):</span><br><span class="line">                    <span class="keyword">for</span> c <span class="keyword">in</span> code_tag[<span class="string">&quot;class&quot;</span>]:</span><br><span class="line">                        <span class="keyword">if</span> c.startswith(<span class="string">&quot;language-&quot;</span>):</span><br><span class="line">                            lang = c.replace(<span class="string">&quot;language-&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                md_code = <span class="string">f&quot;```<span class="subst">&#123;lang&#125;</span>\n<span class="subst">&#123;code_text&#125;</span>\n```&quot;</span></span><br><span class="line">                content_blocks.append(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>, <span class="string">&quot;value&quot;</span>: md_code&#125;)</span><br><span class="line">        result[<span class="string">&quot;content&quot;</span>] = content_blocks</span><br><span class="line">        <span class="comment"># 作者信息</span></span><br><span class="line">        author_box = soup.select_one(<span class="string">&quot;a.profile-href&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> author_box:</span><br><span class="line">            author_name = author_box.select_one(<span class="string">&quot;span.profile-name&quot;</span>)</span><br><span class="line">            author_img = author_box.select_one(<span class="string">&quot;img.profile-img&quot;</span>)</span><br><span class="line">            result[<span class="string">&quot;author&quot;</span>] = &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: author_name.get_text(strip=<span class="literal">True</span>) <span class="keyword">if</span> author_name <span class="keyword">else</span> <span class="literal">None</span>,</span><br><span class="line">                <span class="string">&quot;avatar&quot;</span>: author_img.get(<span class="string">&quot;src&quot;</span>) <span class="keyword">if</span> author_img <span class="keyword">else</span> <span class="literal">None</span>,</span><br><span class="line">                <span class="string">&quot;homepage&quot;</span>: author_box.get(<span class="string">&quot;href&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment"># 发布时间</span></span><br><span class="line">        <span class="comment"># 常见位置：meta、时间标签、正文上方</span></span><br><span class="line">        date_str = <span class="literal">None</span></span><br><span class="line">        meta_time = soup.find(<span class="string">&quot;meta&quot;</span>, &#123;<span class="string">&quot;itemprop&quot;</span>: <span class="string">&quot;datePublished&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">if</span> meta_time <span class="keyword">and</span> meta_time.get(<span class="string">&quot;content&quot;</span>):</span><br><span class="line">            date_str = meta_time[<span class="string">&quot;content&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> date_str:</span><br><span class="line">            <span class="comment"># 备选方案：查找常见时间标签</span></span><br><span class="line">            time_tag = soup.find(<span class="string">&quot;span&quot;</span>, class_=<span class="string">&quot;time&quot;</span>) <span class="keyword">or</span> soup.find(<span class="string">&quot;span&quot;</span>, class_=<span class="string">&quot;publish-time&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> time_tag:</span><br><span class="line">                date_str = time_tag.get_text(strip=<span class="literal">True</span>)</span><br><span class="line">        result[<span class="string">&quot;date&quot;</span>] = date_str</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;详情页解析失败: <span class="subst">&#123;url&#125;</span>, 错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/29/OpenSourceSummer2025/8.png" alt="8"></p>
<p>顺利的去除的重复，那么对于CSDN内容的爬取就算成功了，接下来就该去解决搜索关键词有限导致爬取目标内容不足的问题了。</p>
<h4 id="CSDN资源数量问题"><a href="#CSDN资源数量问题" class="headerlink" title="CSDN资源数量问题"></a>CSDN资源数量问题</h4><p>由于当前整体的爬虫进度就很慢了，所以我决定使用一个新的线程去获取数据，随后再将两个线程的数据按时间顺讯进行合并。</p>
<hr>
<p><strong>多线程执行逻辑分析</strong></p>
<p>现在让我详细分析我们的多线程爬虫实现：</p>
<ol>
<li><p>线程配置与URL设计</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">urls_and_keywords = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://so.csdn.net/so/search?spm=1000.2115.3001.4501&amp;q=openHarmony&amp;t=&amp;u=&amp;s=new&quot;</span>,</span><br><span class="line">        <span class="string">&quot;keyword&quot;</span>: <span class="string">&quot;openHarmony&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://so.csdn.net/so/search?spm=1000.2115.3001.4501&amp;q=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&amp;t=all&amp;u=&amp;s=new&amp;urw=&quot;</span>,</span><br><span class="line">        <span class="string">&quot;keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>我们设计了两个搜索关键词：</p>
<ul>
<li><strong>openHarmony</strong>：英文关键词，覆盖技术文档和开发相关内容</li>
<li><strong>开源鸿蒙</strong>：中文关键词，覆盖更多中文社区讨论和应用案例</li>
</ul>
<p>这样的设计可以最大化内容覆盖范围，避免单一关键词导致的内容不足问题。</p>
</li>
<li><p>线程工作函数设计</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">crawl_worker</span>(<span class="params">search_config, result_list</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;线程工作函数&quot;&quot;&quot;</span></span><br><span class="line">    crawler = CSDNOpenHarmonyCrawler()</span><br><span class="line">    articles = crawler.crawl(search_config[<span class="string">&quot;url&quot;</span>], search_config[<span class="string">&quot;keyword&quot;</span>])</span><br><span class="line">    result_list.append(articles)</span><br></pre></td></tr></table></figure>
<p>每个线程独立创建爬虫实例，避免共享状态冲突。通过 <code>result_list</code> 收集各线程结果。</p>
</li>
<li><p>时间排序与合并逻辑</p>
<p>关键在于我们的日期解析函数，使用正则表达式处理多种日期格式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge_and_sort_articles</span>(<span class="params">articles_list</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;合并多个文章列表并按日期排序&quot;&quot;&quot;</span></span><br><span class="line">    merged_articles = []</span><br><span class="line">    <span class="keyword">for</span> articles <span class="keyword">in</span> articles_list:</span><br><span class="line">        merged_articles.extend(articles)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 为每篇文章添加排序用的日期对象</span></span><br><span class="line">    <span class="keyword">for</span> article <span class="keyword">in</span> merged_articles:</span><br><span class="line">        article[<span class="string">&#x27;_sort_date&#x27;</span>] = CSDNOpenHarmonyCrawler.extract_date_from_string(article.get(<span class="string">&#x27;date&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 按日期排序（最新的在前）</span></span><br><span class="line">    merged_articles.sort(key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;_sort_date&#x27;</span>] <span class="keyword">or</span> datetime.<span class="built_in">min</span>, reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 移除临时排序字段</span></span><br><span class="line">    <span class="keyword">for</span> article <span class="keyword">in</span> merged_articles:</span><br><span class="line">        article.pop(<span class="string">&#x27;_sort_date&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> merged_articles</span><br></pre></td></tr></table></figure>
<p>这个函数能够处理CSDN可能出现的各种日期格式，确保排序的准确性。</p>
</li>
<li><p>完整的多线程执行流程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">crawl_with_threading</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用多线程爬取两个不同关键词的内容&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 定义两个搜索URL</span></span><br><span class="line">    urls_and_keywords = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://so.csdn.net/so/search?spm=1000.2115.3001.4501&amp;q=openHarmony&amp;t=&amp;u=&amp;s=new&quot;</span>,</span><br><span class="line">            <span class="string">&quot;keyword&quot;</span>: <span class="string">&quot;openHarmony&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://so.csdn.net/so/search?spm=1000.2115.3001.4501&amp;q=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&amp;t=all&amp;u=&amp;s=new&amp;urw=&quot;</span>,</span><br><span class="line">            <span class="string">&quot;keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 存储每个线程的结果</span></span><br><span class="line">    results = []</span><br><span class="line">    threads = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">crawl_worker</span>(<span class="params">search_config, result_list</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;线程工作函数&quot;&quot;&quot;</span></span><br><span class="line">        crawler = CSDNOpenHarmonyCrawler()</span><br><span class="line">        articles = crawler.crawl(search_config[<span class="string">&quot;url&quot;</span>], search_config[<span class="string">&quot;keyword&quot;</span>])</span><br><span class="line">        result_list.append(articles)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建并启动线程</span></span><br><span class="line">    <span class="keyword">for</span> config <span class="keyword">in</span> urls_and_keywords:</span><br><span class="line">        thread_result = []</span><br><span class="line">        thread = threading.Thread(target=crawl_worker, args=(config, thread_result))</span><br><span class="line">        threads.append(thread)</span><br><span class="line">        results.append(thread_result)</span><br><span class="line">        thread.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 等待所有线程完成</span></span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 收集所有结果</span></span><br><span class="line">    all_articles = []</span><br><span class="line">    <span class="keyword">for</span> thread_result <span class="keyword">in</span> results:</span><br><span class="line">        <span class="keyword">if</span> thread_result:  <span class="comment"># thread_result是列表，包含一个articles列表</span></span><br><span class="line">            all_articles.extend(thread_result[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n=== 所有线程完成，开始合并结果 ===&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;总共获取到 <span class="subst">&#123;<span class="built_in">len</span>(all_articles)&#125;</span> 篇文章&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 合并并按时间排序</span></span><br><span class="line">    sorted_articles = CSDNOpenHarmonyCrawler.merge_and_sort_articles([all_articles])</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;按时间排序完成，共 <span class="subst">&#123;<span class="built_in">len</span>(sorted_articles)&#125;</span> 篇文章&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sorted_articles</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>ok，开始测试。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/9.png" alt="9"></p>
<p>可以看到，我们的两个线程在同时获取最新的数据。不过Python的多线程其实属于是”假多线程”。</p>
<ul>
<li>全局解释器锁（GIL）的限制</li>
</ul>
<p>Python中存在一个叫做<strong>全局解释器锁（Global Interpreter Lock，GIL）</strong>的机制，这是CPython解释器的一个特性。GIL确保在任何时刻只有一个线程在执行Python字节码，这意味着：</p>
<ol>
<li><strong>CPU密集型任务</strong>：多线程并不能真正并行执行，反而可能因为线程切换的开销而变得更慢</li>
<li><strong>真正的并发</strong>：只有在遇到I/O操作（如网络请求、文件读写）时，GIL才会被释放，允许其他线程执行</li>
</ol>
<ul>
<li>为什么我们的爬虫仍然有效？</li>
</ul>
<p>虽然Python有GIL限制，但我们的CSDN爬虫仍然能从多线程中受益，原因如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在我们的爬虫中，大部分时间都花在I/O操作上：</span></span><br><span class="line">driver.get(search_url)              <span class="comment"># 网络请求 - 释放GIL</span></span><br><span class="line">time.sleep(<span class="variable language_">self</span>.delay + random.random())  <span class="comment"># 睡眠等待 - 释放GIL</span></span><br><span class="line">soup = BeautifulSoup(driver.page_source, <span class="string">&quot;html.parser&quot;</span>)  <span class="comment"># CPU操作 - 持有GIL</span></span><br><span class="line">driver.get(article_url)             <span class="comment"># 网络请求 - 释放GIL</span></span><br></pre></td></tr></table></figure>
<p><strong>关键点</strong>：当线程A在等待网页加载时（I/O阻塞），GIL被释放，线程B可以开始执行自己的网络请求。这样两个爬虫线程实际上是在<strong>交替执行</strong>，而不是真正的<strong>并行执行</strong>。</p>
<ul>
<li>GIL的工作机制</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 伪代码展示GIL的工作方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">thread_execution_with_gil</span>():</span><br><span class="line">    <span class="comment"># 线程A获得GIL</span></span><br><span class="line">    thread_a_acquires_gil()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 线程A执行CPU操作</span></span><br><span class="line">    parse_html()  <span class="comment"># 持有GIL</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 线程A遇到I/O操作</span></span><br><span class="line">    make_network_request()  <span class="comment"># 释放GIL，进入等待状态</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 此时线程B可以获得GIL</span></span><br><span class="line">    thread_b_acquires_gil()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 线程B执行自己的操作</span></span><br><span class="line">    thread_b_parse_html()  <span class="comment"># 持有GIL</span></span><br><span class="line">    thread_b_make_request()  <span class="comment"># 释放GIL</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 当线程A的网络请求完成时，重新竞争GIL</span></span><br><span class="line">    thread_a_network_response_received()</span><br><span class="line">    <span class="comment"># ... 循环往复</span></span><br></pre></td></tr></table></figure>
<ul>
<li>真正的并行替代方案</li>
</ul>
<p>如果需要真正的并行处理，Python提供了几种替代方案：</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">多进程（multiprocessing）</button><button type="button" class="tab">异步编程（asyncio）</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crawl_with_multiprocessing</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用多进程实现真正的并行爬取&quot;&quot;&quot;</span></span><br><span class="line">    queue = Queue()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">crawl_process</span>(<span class="params">search_config, result_queue</span>):</span><br><span class="line">        crawler = CSDNOpenHarmonyCrawler()</span><br><span class="line">        articles = crawler.crawl(search_config[<span class="string">&quot;url&quot;</span>], search_config[<span class="string">&quot;keyword&quot;</span>])</span><br><span class="line">        result_queue.put(articles)</span><br><span class="line">    </span><br><span class="line">    processes = []</span><br><span class="line">    <span class="keyword">for</span> config <span class="keyword">in</span> urls_and_keywords:</span><br><span class="line">        p = Process(target=crawl_process, args=(config, queue))</span><br><span class="line">        processes.append(p)</span><br><span class="line">        p.start()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 等待所有进程完成</span></span><br><span class="line">    results = []</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> processes:</span><br><span class="line">        results.append(queue.get())</span><br><span class="line">        p.join()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_crawl</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用异步编程实现高并发爬取&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        tasks = []</span><br><span class="line">        <span class="keyword">for</span> config <span class="keyword">in</span> urls_and_keywords:</span><br><span class="line">            task = crawl_async(session, config)</span><br><span class="line">            tasks.append(task)</span><br><span class="line">        </span><br><span class="line">        results = <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line">        <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>
<ul>
<li>为什么我们选择多线程？</li>
</ul>
<p>尽管存在GIL限制，我们仍然选择多线程的原因：</p>
<ol>
<li><strong>简单性</strong>：实现简单，无需额外的进程间通信</li>
<li><strong>资源效率</strong>：比多进程消耗更少的系统资源</li>
<li><strong>I/O密集特性</strong>：我们的爬虫主要受网络I/O限制，多线程已经足够</li>
<li><strong>Selenium兼容性</strong>：Selenium WebDriver在多线程环境下工作良好</li>
</ol>
<p>Python的多线程确实受到GIL的限制，无法实现真正的CPU并行。但对于我们这种I/O密集型的网络爬虫任务，多线程仍然能够带来显著的性能提升。GIL在遇到I/O操作时会释放，允许其他线程执行，这正是我们的爬虫能够受益的原因。</p>
<p>如果未来需要处理更加CPU密集的任务（如大量的数据处理、图像处理等），那么考虑使用多进程或异步编程会是更好的选择。但对于当前的需求，多线程已经是一个既简单又有效的解决方案。</p>
<p>okay，回归正题，写这段的时候我们的爬虫也完成了工作让我们来看看结果。</p>
<p>额上面的看起来都没什么问题，但是下面的几条看起来就有点怪了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;沸腾了！华为开源鸿蒙OS2.0！安卓会被淘汰吗？&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://blog.csdn.net/weixin_39016100/article/details/108525946?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522cb9ab9f418f13100393baa0c8eb1aaa0%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=cb9ab9f418f13100393baa0c8eb1aaa0&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-29-108525946-null-null.142^v102^pc_search_result_base4&amp;utm_term=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&quot;</span>,</span><br><span class="line">  <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;点击上方“Github中文社区”，关注看遍Github好玩的项目大家好，我是hub哥今天鸿蒙OS开源代码公开了！！！没错！今天在华为开发者大会上，也是从9月10日起，HarmonyOS开...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span>,</span><br><span class="line">  <span class="string">&quot;date&quot;</span>: <span class="string">&quot;于 2020-09-10 20:15:41 发布&quot;</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Github中文社区&quot;</span>,</span><br><span class="line">    <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;https://profile-avatar.csdnimg.cn/5af19c4ff58e436d83205022d2ad1234_weixin_39016100.jpg!1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;homepage&quot;</span>: <span class="string">&quot;https://blog.csdn.net/weixin_39016100&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://i-blog.csdnimg.cn/blog_migrate/370744e1190c99c8de088f5b7a706e3c.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://i-blog.csdnimg.cn/blog_migrate/fe866ad2d04f269afd112092719e594f.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://i-blog.csdnimg.cn/blog_migrate/609f5a565db9efa9d929c79438025217.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://i-blog.csdnimg.cn/blog_migrate/fb9beec5cebedf3597eacb9b1a5d0a08.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://i-blog.csdnimg.cn/blog_migrate/bc34bc591bd1668a15424f268781cca7.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://i-blog.csdnimg.cn/blog_migrate/6b2793d9781a11e15943eb9bb303119b.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://i-blog.csdnimg.cn/blog_migrate/6e72c3f532a58018ff9163342840315f.gif&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;点击上方“Github中文社区”，关注看遍Github好玩的项目大家好，我是hub哥今天鸿蒙OS开源代码公开了！！！没错！今天在华为开发者大会上，也是从9月10日起，HarmonyOS开源代码公开了！项目仓库已经可以看了, 目前关注2.5k。鸿蒙OSOpenHarmony是开放原子开源基金会（OpenAtom Foundation）旗下开源项目，定位是一款面向全场景的开源分布式操作系统。其实在2019年 8月9日，华为鸿蒙1.0 ，OS揭开了面纱。2019年的在华为开发者大会上, 华为首款搭载鸿蒙OS终端正式亮相！荣耀智慧屏-首款搭载华为鸿蒙系统的荣耀智慧屏 系列8月10日震撼发布今天的大会上，余承东宣布，华为鸿蒙系统已经升级至2.0版本，即HarmonyOS 2.0。此次HarmonyOS的升级，不仅仅带来了分布式能力的全面提升，还为开发者提供了完整的分布式设备与应用开发生态，全面赋能全场景智慧生态。HarmonyOS主要包含如下系统:余承东讲话得到几点信息：从今天起将面向程序员提供大屏、手表、车机的鸿蒙OS2.0的beta版本今年12月份将提供鸿蒙2.0的beta版本2021年4月将面向内存128MB-4GB终端设备开源2021年10月以后将面向4GB以上所有设备开源明年起，华为智能手机将升级支持鸿蒙2.0一些总结在鸿蒙 OS 上，他们可以用一套代码开发出兼容多终端的软件，鸿蒙 OS 能做到自动适配。对开发者来说，所有设备都同一个系统，交互更好、学习成本更低，体验更加统一。如果明年4月 搭载鸿蒙OS的手机发布，并推动手机应用开发者加入，那么配合新的开发语言，又将提供一大批岗位，其实利好开发者！大厂需要华为生态渠道，客户端岗位需求会激增。和安卓系统形成竞对的局面，从而促使android提高体验和优化性能，避免以后收费。传送门鸿蒙官网：https://www.harmonyos.com开源项目官网：https://www.openatom.org/openharmony开源代码仓库：https://openharmony.gitee.com华为开发者联盟论坛：https://developer.huawei.com/consumer投票环节最后大家来投个票吧OK！到这就是这期分享如果觉得文章有意思，请点赞在看，分享。历史原创★ 程序员大佬女装登顶GitHub 热榜，太变态了！还以为逛 PornHub呢！★18禁警告！这个工具教你涂鸦画丁丁，数据还开源了★ 强！这个GitHub官方终端命令行工具！星标10K！真是让人相见恨晚啊★ 模糊妹子图变超清！这个神器能让模糊图秒变4K高清，瞬间觉得PS也没那么香了文稿征集令来啦！点个在看呗！AI生成项目php运行&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;code&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;```php\nOK！到这就是这期分享\n \n \n如果觉得文章有意思，请点赞在看，分享。\n \n \n \n历史原创\n \n★ 程序员大佬女装登顶GitHub 热榜，太变态了！还以为逛 PornHub呢！★ \n18\n 禁警告！这个工具教你涂鸦画丁丁，数据还开源了★ 强！这个GitHub官方终端命令行工具！星标\n10\nK！真是让人相见恨晚啊★ 模糊妹子图变超清！这个神器能让模糊图秒变\n4\nK高清，瞬间觉得PS也没那么香了\n \n \n \n文稿征集令来啦！ \n \n \n点个在看呗！OK！到这就是这期分享  如果觉得文章有意思，请点赞在看，分享。   历史原创 ★ 程序员大佬女装登顶GitHub 热榜，太变态了！还以为逛 PornHub呢！★ \n18\n 禁警告！这个工具教你涂鸦画丁丁，数据还开源了★ 强！这个GitHub官方终端命令行工具！星标\n10\nK！真是让人相见恨晚啊★ 模糊妹子图变超清！这个神器能让模糊图秒变\n4\nK高清，瞬间觉得PS也没那么香了   文稿征集令来啦！   点个在看呗！\n```&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;1.OpenHarmony&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://ask.csdn.net/new?word=openHarmony&quot;</span>,</span><br><span class="line">  <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;OpenHarmonyOpenHarmony是开放原子开源基金会（OpenAtom Foundation）旗下开源项目，定位是一款面向全场景的开源分布式操作系统，第一个版本支持128K-128M设备上运行。 https://openharmony.gitee.comOpenHarmony...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;openHarmony&quot;</span>,</span><br><span class="line">  <span class="string">&quot;date&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;智启未来 | 拓维信息携旗下开鸿智谷受邀参加开源鸿蒙开发者大会2025&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://blog.csdn.net/u011945431/article/details/148261304?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522cb9ab9f418f13100393baa0c8eb1aaa0%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=cb9ab9f418f13100393baa0c8eb1aaa0&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-5-148261304-null-null.142^v102^pc_search_result_base4&amp;utm_term=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&quot;</span>,</span><br><span class="line">  <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;大会期间，拓维信息旗下开鸿智谷基于开源鸿蒙研发的在鸿OS、在鸿控制器、在鸿实验箱、在鸿行业PC、在鸿平板和在鸿智慧园区场景等软硬件创新产品及数智化解决方案悉数亮相，吸引了大量开发者和生态客户关注。...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span>,</span><br><span class="line">  <span class="string">&quot;date&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;开源鸿蒙开发者大会2025交流区亮点纷呈，社区与生态伙伴共绘智能图景&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://blog.csdn.net/u011945431/article/details/148260001?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522cb9ab9f418f13100393baa0c8eb1aaa0%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=cb9ab9f418f13100393baa0c8eb1aaa0&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-6-148260001-null-null.142^v102^pc_search_result_base4&amp;utm_term=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&quot;</span>,</span><br><span class="line">  <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;值得一提的是，本次大会的专题交流区首次展出了有关开源鸿蒙SIG 地图、开源鸿蒙Web SIG及W3C标准、统一互联PMC（筹）地图等丰富的信息，以及第二届中国研究生操作系统开源创新大赛开源鸿蒙赛道、开源鸿蒙人才生态...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span>,</span><br><span class="line">  <span class="string">&quot;date&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;深开鸿联合中软国际、粤科金融集团发布国内首个开源鸿蒙创业投资基金&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://blog.csdn.net/luluningmeng1/article/details/142638398?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522cb9ab9f418f13100393baa0c8eb1aaa0%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=cb9ab9f418f13100393baa0c8eb1aaa0&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-12-142638398-null-null.142^v102^pc_search_result_base4&amp;utm_term=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&quot;</span>,</span><br><span class="line">  <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;该基金不仅将为开源鸿蒙初创企业提供早期资本支持，还将通过与地方政府、企业、高校的合作，推动更多地区的创新创业项目落地，助力区域人才和产业生态的繁荣。韦家燊表示，未来深开鸿将在全国范围内推广“服务+资本...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span>,</span><br><span class="line">  <span class="string">&quot;date&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;深开鸿联合深天使发布国内首个开源鸿蒙产业加速营&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://blog.csdn.net/luluningmeng1/article/details/142638371?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522cb9ab9f418f13100393baa0c8eb1aaa0%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=cb9ab9f418f13100393baa0c8eb1aaa0&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-13-142638371-null-null.142^v102^pc_search_result_base4&amp;utm_term=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&quot;</span>,</span><br><span class="line">  <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;深天使开源鸿蒙产业加速营携手深开鸿及其生态合作伙伴，以“K计划”为抓手，在开源鸿蒙初创项目和企业中挖掘重点培育对象，进行深度孵化与激发潜能，助力这些团队和企业的快速成长。国内首个开源鸿蒙产业加速营发布...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span>,</span><br><span class="line">  <span class="string">&quot;date&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;深开鸿与深信息联合成立开源鸿蒙高等工程师学院&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://blog.csdn.net/u011945431/article/details/130057959?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522cb9ab9f418f13100393baa0c8eb1aaa0%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=cb9ab9f418f13100393baa0c8eb1aaa0&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-25-130057959-null-null.142^v102^pc_search_result_base4&amp;utm_term=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&quot;</span>,</span><br><span class="line">  <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;4月8日，在深圳信息职业技术学院（简称：深信息）与华为联合举办的“培养复合型数字人才，释放数字生产力”数字人才培养高峰论坛上，深开鸿与深信息联合成立“开源鸿蒙高等工程师学院”，旨在建设开源鸿蒙人才培养...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span>,</span><br><span class="line">  <span class="string">&quot;date&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;华为开源操作系统鸿蒙开源地址链接&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://ask.csdn.net/new?word=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&quot;</span>,</span><br><span class="line">  <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;华为开源操作系统鸿蒙开源地址链接:  华为开发资源:https://developer.huaweicloud.com/  华为终端开发者论坛:https://developer.huawei.com/consumer/cn/forumupgrading  华为系统liteOS老地址：...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span>,</span><br><span class="line">  <span class="string">&quot;date&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先是”沸腾了！华为开源鸿蒙OS2.0！安卓会被淘汰吗？”这篇文章的文章内容顺序乱了，原文中的文本是穿插在图中间的而且比较靠前，爬取后就到后面了，暂时不清楚是什么原因。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/10.png" alt="10"></p>
<p>还有就是后面这几篇都404了，可能是原作者删除了文章吧，明天得再加个404的检测机制。今天先这样了，累了累了。</p>
<hr>
<h3 id="可行性验证阶段汇报"><a href="#可行性验证阶段汇报" class="headerlink" title="可行性验证阶段汇报"></a>可行性验证阶段汇报</h3><p>在经过了一周的开发后也算是有了点眉目，本来在选择项目时我就十分担心，因为爬虫这东西之前也做过几次，各个网站的网站结构还有加载、渲染方式都不尽相同，在官网的项目简介上也并没有标明该用什么手段去获取资讯信息，只说了让我们去聚合。我是真的没有头绪，毕竟我也是没有系统行的学习过爬虫或者说是后端技术来着。更何况开源协会的大家都将开源之夏视作是一个很牛逼的开源项目经历，现在看来确实是有些魅化了，只有在实际上手后才能祛魅。行动是缓解焦虑做好的办法。我在和老师汇报的前一晚也是紧张的直冒汗，不过在实际汇报时也是冷静的将我自己所做的尝试以及当前的进度和解决方案都助理列举了出来。虽然我将老师所所说的线上交流误解成了微信聊天，所以直接就给老师发消息了，下次还是汇总成一个文件来进行汇报吧，（尴尬死了）。不过整体的方案还是得到了认可，我也就可以继续进行开发调试了。</p>
<div class="note success flat"><p>在实际开发中发现问题，思考对策，解决问题，在发现新问题，才能真正的提升能力，一味地读文档，看教程永远是学不会的，计划书写得再好也看不到真正隐藏的问题。</p>
</div>
<h2 id="后端正式开发阶段"><a href="#后端正式开发阶段" class="headerlink" title="后端正式开发阶段"></a>后端正式开发阶段</h2><p>虽说到这个章节我们才开始正式的后端开发，但实际上在可行性验证阶段，我们就已经完成了很多后端开发阶段的事了，我们只需要继续按照我们的思路进行开发即可。</p>
<h3 id="信息源爬虫完善"><a href="#信息源爬虫完善" class="headerlink" title="信息源爬虫完善"></a>信息源爬虫完善</h3><h4 id="CSDN爬虫的404防御机制"><a href="#CSDN爬虫的404防御机制" class="headerlink" title="CSDN爬虫的404防御机制"></a>CSDN爬虫的404防御机制</h4><p>上面在可行性验证阶段，我们最后截止到了发现爬取的内容中包含了404的页面，接下来我们就来进行一下404页面的检测与防御机制。</p>
<p>首先还是观察一下404页面。</p>
<p>！<a href="OpenSourceSummer2025/11.png">11</a></p>
<p>可以看到404页面都会存在一个new_404的侧边栏，我们只需要检测在跳转后的目标页面是否存在这个侧边栏就可以判断是否是404页面了。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    driver.get(url)</span><br><span class="line">    time.sleep(<span class="variable language_">self</span>.delay + random.random())</span><br><span class="line">    soup = BeautifulSoup(driver.page_source, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">    <span class="comment"># 404检测</span></span><br><span class="line">    <span class="keyword">if</span> soup.find(<span class="string">&quot;div&quot;</span>, class_=<span class="string">&quot;new_404&quot;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;页面404或已被删除: <span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="comment"># 正文内容</span></span><br></pre></td></tr></table></figure>
<p>我们直接处理正文内容之前去进行404侧边栏的检测即可，如果没有就返回一个空值就可以了。</p>
<p>再次进行测试。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">=== 所有线程完成，开始合并结果 ===</span><br><span class="line">总共获取到 <span class="number">60</span> 篇文章</span><br><span class="line">按时间排序完成，共 <span class="number">60</span> 篇文章</span><br><span class="line"></span><br><span class="line">=== 最终结果统计 ===</span><br><span class="line"><span class="title class_">OpenHarmony</span> 文章数: <span class="number">30</span></span><br><span class="line">开源鸿蒙 文章数: <span class="number">30</span></span><br><span class="line">总文章数: <span class="number">60</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;title&quot;</span>: <span class="string">&quot;开源鸿蒙4.0 RK3566开发板配置&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://download.csdn.net/download/caimouse/88979392?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522ff96528c115517d0ea0d052aaf5e7e96%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=ff96528c115517d0ea0d052aaf5e7e96&amp;biz_id=1&amp;utm_medium=distribute.pc_search_result.none-task-download-2~all~time_text~default-16-88979392-null-null.142^v102^pc_search_result_base9&amp;utm_term=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&quot;</span>,</span><br><span class="line">    <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span>,</span><br><span class="line">    <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2024-09-15&quot;</span>,</span><br><span class="line">    <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">    <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;title&quot;</span>: <span class="string">&quot;OpenHarmony移植：Unity游戏适配开源鸿蒙小型设备&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://blog.csdn.net/m0_59315734/article/details/148615480?ops_request_misc=%257B%2522request%255Fid%2522%253A%25225776fbf6d1ad8ca886ab0e4a760bdb64%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=5776fbf6d1ad8ca886ab0e4a760bdb64&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-1-148615480-null-null.142^v102^pc_search_result_base2&amp;utm_term=openHarmony&quot;</span>,</span><br><span class="line">    <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;将Unity游戏适配到OpenHarmony小型设备，核心在于​​资源优化、系统API对接与性能调优​​。通过本文的实践，开发者可掌握从环境配置到最终发布的完整流程，应对小型设备的资源限制与系统差异。未来，随着...&quot;</span>,</span><br><span class="line">    <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;openHarmony&quot;</span>,</span><br><span class="line">    <span class="string">&quot;date&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">    <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;title&quot;</span>: <span class="string">&quot;第三章 iTop3588平台移植OpenHarmony-4.0-Release&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://blog.csdn.net/jixufan/article/details/147256785?ops_request_misc=%257B%2522request%255Fid%2522%253A%25225776fbf6d1ad8ca886ab0e4a760bdb64%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=5776fbf6d1ad8ca886ab0e4a760bdb64&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-2-147256785-null-null.142^v102^pc_search_result_base2&amp;utm_term=openHarmony&quot;</span>,</span><br><span class="line">    <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;本文档旨在为小伙伴们快速在iTop3588开发平台上移植OpenHarmony4.0 Release版本标准系统提供技术指导，为小伙伴们在不同平台中移植OpenHarmony系统提供思路。采用从dayu210平台复制替换的方式，快速在 iTOP-3588...&quot;</span>,</span><br><span class="line">    <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;openHarmony&quot;</span>,</span><br><span class="line">    <span class="string">&quot;date&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">&quot;author&quot;</span>: &#123;&#125;,</span><br><span class="line">    <span class="string">&quot;content&quot;</span>: []</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>又出现了新的问题，的确是没有404页面了但是还是内容却都异常为空。enm，让我们来分析一下，首先我是没有改动之前的爬虫代码的同样的文章却爬不出来（？）</p>
<p>遇事不决先加日志！！！</p>
<p>加入更多debug信息，加入更多的判断，看看是哪一步出了问题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[openHarmony] 已获取: 如何编译OpenHarmonySDK API [https://blog.csdn.net/maniuT/article/details/139843235?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522eeee35897e2f50b78de4166161201e81%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=eeee35897e2f50b78de4166161201e81&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-9-139843235-null-null.142^v102^pc_search_result_base1&amp;utm_term=openHarmony]</span><br><span class="line">[openHarmony] 内容块数量: 0</span><br><span class="line">DEBUG: content_views容器存在: False</span><br><span class="line">DEBUG: content_views为空，尝试备用方法</span><br><span class="line">DEBUG: 未找到任何备用容器</span><br><span class="line">[openHarmony] 已获取: Baumer工业相机堡盟工业相机如何联合OpenHarmony框架开发连接USB相机（OpenHarmony） [https://blog.csdn.net/xianzuzhicai/article/details/138343924?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522eeee35897e2f50b78de4166161201e81%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=eeee35897e2f50b78de4166161201e81&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-10-138343924-null-null.142^v102^pc_search_result_base1&amp;utm_term=openHarmony]</span><br><span class="line">[openHarmony] 内容块数量: 0</span><br><span class="line">DEBUG: content_views容器存在: False</span><br><span class="line">DEBUG: content_views为空，尝试备用方法</span><br><span class="line">DEBUG: 未找到任何备用容器</span><br><span class="line">[开源鸿蒙] 已获取: 软通动力子公司鸿湖万联重磅发布SwanLinkOS 5，擘画开源鸿蒙AI PC新篇章 [https://blog.csdn.net/isoftstone_HOS/article/details/141856542?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522db64b9f6682e28a5ac17597c2687bced%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=db64b9f6682e28a5ac17597c2687bced&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-11-141856542-null-null.142^v102^pc_search_result_base3&amp;utm_term=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99]</span><br><span class="line">[开源鸿蒙] 内容块数量: 0</span><br><span class="line">DEBUG: content_views容器存在: True</span><br><span class="line">DEBUG: 找到元素数量: 52</span><br><span class="line">[openHarmony] 已获取: OpenHarmony实战：配置OpenHarmony下载、编译代码环境 [https://blog.csdn.net/m0_64420071/article/details/137159551?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522eeee35897e2f50b78de4166161201e81%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=eeee35897e2f50b78de4166161201e81&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-11-137159551-null-null.142^v102^pc_search_result_base1&amp;utm_term=openHarmony]</span><br><span class="line">[openHarmony] 内容块数量: 42</span><br><span class="line">DEBUG: content_views容器存在: True</span><br><span class="line">DEBUG: 找到元素数量: 14</span><br></pre></td></tr></table></figure>
<p>嘶？有很多文章的目标容器是找不到的？？？难道是我们最初在寻找目标文章容器时就出现了问题？？</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/12.png" alt="12"></p>
<p>原来是因为有的文章结构不一样啊，那没事了，我们只需要从新修改一下爬取逻辑就好了</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果content_views不存在，尝试其他方法</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> content_blocks:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;DEBUG: content_views为空，尝试备用方法&quot;</span>)</span><br><span class="line">    <span class="comment"># 支持多class的CSS选择器</span></span><br><span class="line">    possible_selectors = [</span><br><span class="line">        <span class="string">&quot;div#content_views&quot;</span>,</span><br><span class="line">        <span class="string">&quot;div.article_content.article-content.clearfix&quot;</span>,</span><br><span class="line">        <span class="string">&quot;div.article_content&quot;</span>,</span><br><span class="line">        <span class="string">&quot;div.article-content&quot;</span>,</span><br><span class="line">        <span class="string">&quot;div.blog-content-box&quot;</span>,</span><br><span class="line">        <span class="string">&quot;div.article-content-box&quot;</span>,</span><br><span class="line">        <span class="string">&quot;div.content&quot;</span>,</span><br><span class="line">        <span class="string">&quot;article&quot;</span>,</span><br><span class="line">        <span class="string">&quot;div[data-article-content]&quot;</span>,</span><br><span class="line">        <span class="string">&quot;div.markdown_views&quot;</span>,</span><br><span class="line">        <span class="string">&quot;div.htmledit_views&quot;</span></span><br><span class="line">    ]</span><br><span class="line">    article_content = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> selector <span class="keyword">in</span> possible_selectors:</span><br><span class="line">        container = soup.select_one(selector)</span><br><span class="line">        <span class="keyword">if</span> container:</span><br><span class="line">            article_content = container</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;DEBUG: 找到备用容器: <span class="subst">&#123;selector&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> article_content:</span><br><span class="line">        all_text = article_content.get_text(separator=<span class="string">&quot;\n&quot;</span>, strip=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">if</span> all_text:</span><br><span class="line">            result[<span class="string">&quot;content&quot;</span>] = [&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;value&quot;</span>: all_text&#125;]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;DEBUG: 备用方法提取到文本长度: <span class="subst">&#123;<span class="built_in">len</span>(all_text)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;DEBUG: 备用容器存在但文本为空&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;DEBUG: 未找到任何备用容器&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>从这里我们也可以看出，同一个网站也可能因为代际更迭的原因导致原来的文章渲染逻辑发生改变，所以爬虫也需要不断更新以适应新的环境，这也就是所谓运维需要做的工作之一。</p>
<p>在仔细的看了看CSDN的文章内容结构发现还是有太多奇怪的情况了，我决定先暂时加一个过滤器，将空内容过滤将，先完成再优化。</p>
<hr>
<p>7.15嗓子疼加小低烧休息了一天，让我们回来继续吧。</p>
<hr>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge_and_sort_articles</span>(<span class="params">articles_list</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;合并多个文章列表并按日期排序，过滤掉不完整的文章&quot;&quot;&quot;</span></span><br><span class="line">    merged_articles = []</span><br><span class="line">    <span class="keyword">for</span> articles <span class="keyword">in</span> articles_list:</span><br><span class="line">        merged_articles.extend(articles)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;DEBUG: 合并前文章总数: <span class="subst">&#123;<span class="built_in">len</span>(merged_articles)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 过滤掉不完整的文章（date、author、content 任何一个为空）</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_article_complete</span>(<span class="params">article</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;检查文章是否完整&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 检查 date 是否为空</span></span><br><span class="line">        date_empty = <span class="keyword">not</span> article.get(<span class="string">&#x27;date&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查 author 是否为空</span></span><br><span class="line">        author = article.get(<span class="string">&#x27;author&#x27;</span>, &#123;&#125;)</span><br><span class="line">        author_empty = <span class="keyword">not</span> author <span class="keyword">or</span> <span class="keyword">not</span> author.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查 content 是否为空</span></span><br><span class="line">        content = article.get(<span class="string">&#x27;content&#x27;</span>, [])</span><br><span class="line">        content_empty = <span class="keyword">not</span> content <span class="keyword">or</span> <span class="built_in">len</span>(content) == <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> (date_empty <span class="keyword">or</span> author_empty <span class="keyword">or</span> content_empty)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 分别统计过滤原因</span></span><br><span class="line">    total_before = <span class="built_in">len</span>(merged_articles)</span><br><span class="line">    date_empty_count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> a <span class="keyword">in</span> merged_articles <span class="keyword">if</span> <span class="keyword">not</span> a.get(<span class="string">&#x27;date&#x27;</span>))</span><br><span class="line">    author_empty_count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> a <span class="keyword">in</span> merged_articles <span class="keyword">if</span> <span class="keyword">not</span> a.get(<span class="string">&#x27;author&#x27;</span>) <span class="keyword">or</span> <span class="keyword">not</span> a.get(<span class="string">&#x27;author&#x27;</span>, &#123;&#125;).get(<span class="string">&#x27;name&#x27;</span>))</span><br><span class="line">    content_empty_count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> a <span class="keyword">in</span> merged_articles <span class="keyword">if</span> <span class="keyword">not</span> a.get(<span class="string">&#x27;content&#x27;</span>) <span class="keyword">or</span> <span class="built_in">len</span>(a.get(<span class="string">&#x27;content&#x27;</span>, [])) == <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;DEBUG: 过滤统计 - 日期为空: <span class="subst">&#123;date_empty_count&#125;</span>, 作者为空: <span class="subst">&#123;author_empty_count&#125;</span>, 内容为空: <span class="subst">&#123;content_empty_count&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 应用过滤器</span></span><br><span class="line">    filtered_articles = [article <span class="keyword">for</span> article <span class="keyword">in</span> merged_articles <span class="keyword">if</span> is_article_complete(article)]</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;DEBUG: 过滤后文章数量: <span class="subst">&#123;<span class="built_in">len</span>(filtered_articles)&#125;</span> (移除了 <span class="subst">&#123;total_before - <span class="built_in">len</span>(filtered_articles)&#125;</span> 篇不完整文章)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 为每篇文章添加排序用的日期对象</span></span><br><span class="line">    <span class="keyword">for</span> article <span class="keyword">in</span> filtered_articles:</span><br><span class="line">        article[<span class="string">&#x27;_sort_date&#x27;</span>] = CSDNOpenHarmonyCrawler.extract_date_from_string(article.get(<span class="string">&#x27;date&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 按日期排序（最新的在前）</span></span><br><span class="line">    filtered_articles.sort(key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;_sort_date&#x27;</span>] <span class="keyword">or</span> datetime.<span class="built_in">min</span>, reverse=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 移除临时排序字段</span></span><br><span class="line">    <span class="keyword">for</span> article <span class="keyword">in</span> filtered_articles:</span><br><span class="line">        article.pop(<span class="string">&#x27;_sort_date&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> filtered_articles</span><br></pre></td></tr></table></figure>
<p>修改完代码之后我们再次进行测试，测试运行期间给老师编写一下可行性验证总结还有方案设计文档。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">=== 所有线程完成，开始合并结果 ===</span><br><span class="line">总共获取到 <span class="number">58</span> 篇文章</span><br><span class="line"><span class="attr">DEBUG</span>: 合并前文章总数: <span class="number">58</span></span><br><span class="line"><span class="attr">DEBUG</span>: 过滤统计 - 日期为空: <span class="number">8</span>, 作者为空: <span class="number">8</span>, 内容为空: <span class="number">1</span></span><br><span class="line"><span class="attr">DEBUG</span>: 过滤后文章数量: <span class="number">50</span> (移除了 <span class="number">8</span> 篇不完整文章)</span><br><span class="line">按时间排序完成，共 <span class="number">50</span> 篇文章</span><br><span class="line"></span><br><span class="line">=== 最终结果统计 ===</span><br><span class="line"><span class="title class_">OpenHarmony</span> 文章数: <span class="number">29</span></span><br><span class="line">开源鸿蒙 文章数: <span class="number">21</span></span><br><span class="line">总文章数: <span class="number">50</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;title&quot;</span>: <span class="string">&quot;开源鸿蒙北向开发: 截屏&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://blog.csdn.net/qq_37059136/article/details/149205961?ops_request_misc=%257B%2522request%255Fid%2522%253A%25221c1bfd376230bf5fb1ee4e9ac236951d%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=1c1bfd376230bf5fb1ee4e9ac236951d&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-1-149205961-null-null.142^v102^pc_search_result_base2&amp;utm_term=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&quot;</span>,</span><br><span class="line">    <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;开源鸿蒙系统使用snapshot_display命令实现截屏功能，执行后生成1920x1200分辨率的JPEG格式图片，默认保存在/data/local/tmp/目录下，文件名包含时间戳。通过hdc file recv命令可将截图传输到指定目录（如Windows的F...&quot;</span>,</span><br><span class="line">    <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span>,</span><br><span class="line">    <span class="string">&quot;date&quot;</span>: <span class="string">&quot;已于 2025-07-08 20:44:17 修改&quot;</span>,</span><br><span class="line">    <span class="string">&quot;author&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;痕忆丶&quot;</span>,</span><br><span class="line">      <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;https://profile-avatar.csdnimg.cn/3e1dd1269622485eadacb58f950127a7_qq_37059136.jpg!1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;homepage&quot;</span>: <span class="string">&quot;https://blog.csdn.net/qq_37059136&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;截屏&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;开源鸿蒙系统的截屏功能为snapshot_display&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;使用snapshot_display命令即可截屏&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://i-blog.csdnimg.cn/direct/7987a6a2093843cbafd4d047c6cc970c.png&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;# snapshot_displayprocess: set filename to /data/local/tmp/snapshot_2025-07-08_20-23-17.jpegprocess: display 0: width 1920, height 1200snapshot: pixel format is: 3snapshot: convert rgba8888 to rgb888 successfully.&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;success: snapshot display 0 , write to /data/local/tmp/snapshot_2025-07-08_20-23-17.jpeg as jpeg, width 1920, height 1200&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;上述表示截屏成功,且默认保存在/data/local/tmp/目录下&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;取出屏幕截图&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;hdcfile recv /data/local/tmp/snapshot_2025-07-08_20-21-20.jpeg F:\\fvmshare\\out&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://i-blog.csdnimg.cn/direct/e9adf3feb18c4fdbb4220b11f435d1ef.png&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;将截图取出,放到F:\\fvmshare\\out目录&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://i-blog.csdnimg.cn/direct/fd03ae46236c4fcf8cdec6855ccca4df.png&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;title&quot;</span>: <span class="string">&quot;开源鸿蒙地图导航功能的集成业务过程&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://blog.csdn.net/ZHUOJIANLONG/article/details/149167807?ops_request_misc=%257B%2522request%255Fid%2522%253A%25221c1bfd376230bf5fb1ee4e9ac236951d%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=1c1bfd376230bf5fb1ee4e9ac236951d&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~time_text~default-2-149167807-null-null.142^v102^pc_search_result_base2&amp;utm_term=%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99&quot;</span>,</span><br><span class="line">    <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;在开源鸿蒙系统集成地图导航功能时遇到多重阻碍：尝试高德SDK因开发板兼容问题闪退；开源鸿蒙无自带地图应用包；WebView桥接方案虽可行但效果不佳。三种方案均未能完美解决导航功能落地问题，凸显开源生态配套工具的...&quot;</span>,</span><br><span class="line">    <span class="string">&quot;search_keyword&quot;</span>: <span class="string">&quot;开源鸿蒙&quot;</span>,</span><br><span class="line">    <span class="string">&quot;date&quot;</span>: <span class="string">&quot;已于 2025-07-08 11:46:14 修改&quot;</span>,</span><br><span class="line">    <span class="string">&quot;author&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小卓想喂猫&quot;</span>,</span><br><span class="line">      <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;https://profile-avatar.csdnimg.cn/1e099f3d58fe41ab879e3bf3013d11eb_zhuojianlong.jpg!1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;homepage&quot;</span>: <span class="string">&quot;https://blog.csdn.net/ZHUOJIANLONG&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;开源鸿蒙集成地图导航的思路碰壁&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;第一种是想当然的使用高德的SDK，在华为的鸿蒙系统里面非常好用，但是业务需要迁移到开发板子上，下载了官方的实例和询问了官方的客服后，发现兼容不了，一直会闪退&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;第二种是调用调用系统应用做地图导航，但是开源鸿蒙内没有自带的地图应用包&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;第三种是直接使用webview桥接，感觉这个应该是可以实现，但是用网页的效果肯定没多好只能做到目的查询的程度，网页版不支持直接进行车载导航&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>ok效果也是非常的好，前面近两年的资讯都是十分顺利的爬取，文字内容以及图片内容的排布也是正确的顺序，我们的分段也是正常的，由此我们也是可以推断出CSDN的文章结构是随着网站的升级换代而更新的，不过我们的目标是推送最新的资讯所以我们也不用太过担心。</p>
<p>随后我们将CSDN爬虫并入主线。</p>
<h3 id="CSDN爬虫的主线合并"><a href="#CSDN爬虫的主线合并" class="headerlink" title="CSDN爬虫的主线合并"></a>CSDN爬虫的主线合并</h3><p>此前的主线中我们只包含了OpenHarmony官网的爬虫，所以我们现在的主要工作就是将两个爬虫获取的数据结构进行统一的规范化让两者的字段保持一致。</p>
<p>然后我将提供最主要的四个接口：</p>
<ul>
<li>首页轮播图接口（待开发）</li>
<li>OpenHarmony官网资讯列表接口</li>
<li>CSDN资讯列表接口</li>
<li>服务状态接口</li>
</ul>
<p>由于当前还没有开发首页轮播图的接口所以我本身打算加一个<code>promptAction</code>弹窗，结果意外发现在此前我用的<code>showToast</code>函数被弃用了，从API version 18开始废弃，且直接使用showToast可能导致UI上下文不明确的问题，建议使用UIContext中的getPromptAction获取PromptAction实例，再通过此实例调用替代方法showToast。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/17.png" alt="17"></p>
<p>刚好也让我们来试一下这个新方法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Swiper</span>()&#123;</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">swiperList</span>,<span class="function">(<span class="params"><span class="attr">item</span>:<span class="title class_">NewsSwiperModule</span></span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title class_">Image</span>(item.<span class="property">img</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> promptAction = <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getPromptAction</span>()</span><br><span class="line">        promptAction.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:<span class="string">&#x27;跳转原页面功能待开发&#x27;</span>&#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">curve</span>(<span class="title class_">Curve</span>.<span class="property">EaseInOut</span>)</span><br><span class="line">.<span class="title function_">loop</span>(<span class="literal">true</span>)</span><br><span class="line">.<span class="title function_">autoPlay</span>(<span class="literal">true</span>)</span><br><span class="line">.<span class="title function_">interval</span>(<span class="number">2000</span>)</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="18.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<h3 id="后端测试"><a href="#后端测试" class="headerlink" title="后端测试"></a>后端测试</h3><p>在测试室发现了问题。首先在请求<code>http://localhost:8001/api/health</code>时获得了了以下信息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;status&quot;</span>: <span class="string">&quot;healthy&quot;</span>,</span><br><span class="line">  <span class="string">&quot;timestamp&quot;</span>: <span class="number">1753952766.34884</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;services&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;cache&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;status&quot;</span>: <span class="string">&quot;ready&quot;</span>,</span><br><span class="line">      <span class="string">&quot;cache_count&quot;</span>: <span class="number">385</span>,</span><br><span class="line">      <span class="string">&quot;last_update&quot;</span>: <span class="string">&quot;2025-07-31T15:25:53.290022&quot;</span>,</span><br><span class="line">      <span class="string">&quot;error_message&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;news_sources&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;source&quot;</span>: <span class="string">&quot;openharmony&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;OpenHarmony官网&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;OpenHarmony官方网站最新动态和新闻&quot;</span>,</span><br><span class="line">        <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;https://www.openharmony.cn&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;source&quot;</span>: <span class="string">&quot;csdn&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;CSDN&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;CSDN平台上关于OpenHarmony的技术文章和资讯&quot;</span>,</span><br><span class="line">        <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;https://blog.csdn.net&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;endpoints&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;openharmony_news&quot;</span>: <span class="string">&quot;/api/news/openharmony&quot;</span>,</span><br><span class="line">    <span class="string">&quot;csdn_news&quot;</span>: <span class="string">&quot;/api/news/csdn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;all_news&quot;</span>: <span class="string">&quot;/api/news/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;manual_crawl&quot;</span>: <span class="string">&quot;/api/news/crawl&quot;</span>,</span><br><span class="line">    <span class="string">&quot;service_status&quot;</span>: <span class="string">&quot;/api/news/status/info&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后在访问<code>http://localhost:8001/api/news/openharmony</code>时却显示获取新闻失败。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;detail&quot;</span>: <span class="string">&quot;获取OpenHarmony官网新闻失败&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后访问<code>http://localhost:8001/api/news/csdn</code>时又没有任何的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;articles&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;total&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">&quot;page&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;page_size&quot;</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="string">&quot;has_next&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;has_prev&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后我又尝试了获取全部新闻的接口。<code>http://localhost:8001/api/news/</code>，这倒是成功了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;articles&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;id&quot;</span>: <span class="string">&quot;00d1196eb553e2e0&quot;</span>,</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: <span class="string">&quot;对话OpenHarmony开源先锋：如何用代码革新终端生态&quot;</span>,</span><br><span class="line">      <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2025.02.28&quot;</span>,</span><br><span class="line">      <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/cHsMzPTmoYec-_VL6VllBQ&quot;</span>,</span><br><span class="line">      <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_gif/15QnXdLP7ibT0RCulIUzFZ2cGSMTZ3VHFWEttSQKAePB61zNuqdYPP41JIA6b7hph5Z02wKZ61Ch5rjl5FxLzWw/640?wx_fmt=gif&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;2025年2月23日，由开放原子开源基金会主办的第二届OpenHarmony创新应用挑战赛决赛路演在北京圆满结束，作为第二届开放原子大赛的重要赛项之一，本届赛事汇聚全球418支团队，产出超过110个创新作品，集中展示了OpenHarmony在应用与游戏开发领域的前沿成果。这些凝聚智慧与协作的参赛作品，不仅在技术层面实现了多项突破，更在商业化应用层面验证了开源生态的无限潜力。赛事不仅彰显了开发者群体的创新活力，也凸显了OpenHarmony作为技术底座的重要价值，为开源技术生态发展注入革新的力量。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibRnShrEU2uTRKJQbyziasm8ib3wXuDS7TicltuOnUzHt396f649ICg1WZr7mRSEMRDVX8iawxjdPZVItA/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;当代码与创意在OpenHarmony的数字沃土中生根发芽，我们不禁期待，这些开发者如何用实践诠释开源精神？他们的探索历程又蕴藏着怎样的创新思维？让我们跟随优秀团队，解开技术突破与生态协同的共生密码。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;OpenHarmony创新应用赛题：让书柜学会“思考”&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;由“新大陆自动识别”团队开发的《智能书导》项目，是基于开源操作系统 OpenHarmony打造的图书馆管理应用，通过融合RFID 技术，实现图书馆管理流程的高效优化。团队开发该方案的初衷是帮助图书馆高效地完成图书借阅、查询等工作，减轻管理员负担，同时希望将技术推广至物流、商超、工厂等更多场景，拓展应用范围。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;《智能书导》项目通过技术融合创新，深度整合OpenHarmony系统的分布式能力与RFID自动识别技术，利用前者实现图书信息的高效共享，借助后者完成图书的自动识别与数据交互。功能上，该项目集成了快速借还书、精准定位等核心功能，以及今日推荐等辅助功能，全面满足图书馆管理与读者服务需求。应用程序适配OpenHarmony 4.1 Release和5.0.2.50系统，可在多种设备上流畅运行，项目所用硬件也已通过兼容性测评，确保软硬件的无缝集成与高效协同。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibRnShrEU2uTRKJQbyziasm8ibOP4I1IZBc61z68ukktnxx6yDW3bALR5RnB3b4BFicTKY4ebec6tlQWw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;《智能书导》的开发者徐金生表示：“未来团队将把项目核心代码贡献至OpenHarmony主干代码库，推动各模块与性能的提升。同时，计划进一步优化技术瓶颈，拓展项目对更多设备的适配能力。”&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;OpenHarmony创新应用赛题：用技术魔法规划繁琐旅行&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;由“领先风暴队”开发的《出行妈妈》项目，主要是为了解决旅行者在行程规划繁琐、信息整合困难以及个性化需求难以满足三大方面的痛点，提供省时省力的完美行程定制解决方案。该项目填补了OpenHarmony在旅游规划领域的空白，深度融合OpenHarmony 5.0.0 Release特性与旅游出行需求，提供 “规划+路线+玩法” 的一站式服务，支持出行规划记录与最佳路线推荐，为用户打造智能化旅行体验。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;通过bindSheet绑定半模态组件，利用emitter实现跨组件通信，支持拖拽排序、原生时间组件及API12服务卡片的实时同步，并结合Flex+Scroll弹性布局适配动态界面，《出行妈妈》以技术魔法将复杂的旅行“任务”化繁为简。未来，团队将持续优化作品，计划引入分布式数据管理、AI驱动的个性化规划定制以及社区交互等功能，进一步提升用户体验。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibRnShrEU2uTRKJQbyziasm8ibIbuQ5PpGAGuiaUZIiaeCh4Lf1CdKm4LaPdPoWepZGVPffyYagtMDyUPg/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;在开发过程中，团队撰写了20余篇技术博客并发布至开源社区，其中多篇登上社区头条。后续，团队计划将项目中的自定义组件，如城市选择、时间选择和日历等，贡献至OpenHarmony主干代码库。作为一支年轻团队，参赛过程不仅显著提升了协作能力，也为团队积累了宝贵的实践经验。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;Cocos游戏创新应用赛题：从孩童幻想到次世代飞行器&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;“gamemcu”团队打造的《星际穿越》项目，是一款高画质次世代模拟飞行游戏。玩家通过电视屏幕，即可见证掌心玩具蜕变为可操控的星际战舰，在动态的星云间完成飞行模拟。提到游戏背景，开发者陈炫烨说道：“灵感源于我的儿子，因为我经常能看到我儿子拿着玩具进行飞行模拟，于是我就把他的想象变成了一款游戏。”&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibRnShrEU2uTRKJQbyziasm8ibJLdpS8G5Rxj071oyrLJZ8WIgoHMAEZSyll4l0APjrtibIlydTVXMsjw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;《星际穿越》的核心优势在于其卓越的游戏渲染与镜头模拟技术。团队通过自定义高清渲染管线、重构PBR材质系统、高品质后期处理以及多边形GPU粒子系统等多项技术方案，精准还原环境光照，真实模拟人手抓取物体的触感，最终呈现出令人惊艳的飞船驾驶模拟体验。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;此前，基于Cocos开发的游戏多以风格化为主，而团队勇于突破，首次尝试了次世代效果。未来，团队将通过教程、技术指引等开源方式，帮助更多开发者了解项目，降低开发门槛。希望这个源于父子温情的太空幻想，能够激发更多开发者对次世代游戏的创作热情。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;Cocos游戏创新应用赛题：因为热爱，所以存在&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;由“路妖姬”团队开发的《引力线流星》项目，是一款宇宙题材的沙盒生存游戏。玩家将操控流浪地球，在复杂的宇宙引力环境中探索生存，建造飞船单位，并与外星文明展开资源争夺。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;项目的核心优势在于对引力模拟的前沿探索，填补了OpenHarmony在游戏领域的空白。游戏采用2D物理系统精准模拟星球间的引力相互作用与轨道运动，为玩家打造高度拟真的宇宙物理环境与沉浸式体验。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibRnShrEU2uTRKJQbyziasm8ibbsIK6gNaBjpaI48OdJIhFh7GATGQtflgFvB38IYZp7aYLNsY6iaZoKw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;作为携《引力线流星》项目首次参赛的开发者，刘瑞表示，赛事让他深入了解了如何参与社区开源，并与社区成员共同探讨技术，结识了众多志同道合的伙伴，为未来高效合作奠定了基础。同时，他呼吁更多开发者关注OpenHarmony及游戏开发领域，助力开源生态形成更强的“引力效应”。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;融汇创新力量 共筑开源未来&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;第二届OpenHarmony创新应用挑战赛不仅是一次智慧与创新的较量，更是一场开源精神的深度实践。赛事联动产业、前沿科技与优秀人才，推动了OpenHarmony与Cocos的生态深度融合与发展，为开发者提供了施展才华的舞台，更助力开源技术加速落地。在这场融合创意与探索的盛宴中，优秀团队以实力塑造未来，终将推动创新从竞技场走向产业星辰大海。&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;未来，OpenHarmony社区将持续拓展应用边界，携手全球开发者共创数字时代的新范式，助力开源生态迈向更加繁荣、智能、可持续的新时代。&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;category&quot;</span>: <span class="string">&quot;官方动态&quot;</span>,</span><br><span class="line">      <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;source&quot;</span>: <span class="string">&quot;OpenHarmony&quot;</span>,</span><br><span class="line">      <span class="string">&quot;created_at&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="string">&quot;updated_at&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;id&quot;</span>: <span class="string">&quot;5e06c277ebc52833&quot;</span>,</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: <span class="string">&quot;12强终极PK！第二届OpenHarmony创新应用挑战赛引爆开源热潮&quot;</span>,</span><br><span class="line">      <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2025.02.24&quot;</span>,</span><br><span class="line">      <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/2EeeruCTcZEq1qbydrgsKw&quot;</span>,</span><br><span class="line">      <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_gif/15QnXdLP7ibT0RCulIUzFZ2cGSMTZ3VHFWEttSQKAePB61zNuqdYPP41JIA6b7hph5Z02wKZ61Ch5rjl5FxLzWw/640?wx_fmt=gif&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQEl1nS9dNOaQCOzJmfasMKiaoVVxxkYdzicib6Zaq5TrNL4QTausgosiaZ73DLiawkqiawcG2QYljGH8SQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQEl1nS9dNOaQCOzJmfasMKmHJKGmcdSl5tmeIG4j4mZ7L3nu0n5hu3UVvcibGYib23ouMWYGpVBzlQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQEl1nS9dNOaQCOzJmfasMK6TeDicn203fPkTTqQKBTp8NdQJTgXks14Nic2WKeiboR9Np2b5sEa8xwQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQEl1nS9dNOaQCOzJmfasMKrVYxoGtdzllKYXjG1DibNLVHia6atSoDKzUHqWwRnTqOMJt0WnvV1tcw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQEl1nS9dNOaQCOzJmfasMKIyI0odwRy4Xr2j3iaYL7UUrSPdQUEgd8S0gANWqQXRHWcjic6dHiaGicYw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQEl1nS9dNOaQCOzJmfasMK66LJ96zBOn4l3KAjxPibnOWXhdMoGUWnFfdRQNB1jj4ic8VnMdPGcQ1g/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQEl1nS9dNOaQCOzJmfasMKjIr9qTMzZgm2icNic9DANICsAFvToGVfIUicXpxIgPM1ia4AVx7qd7OU6w/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQEl1nS9dNOaQCOzJmfasMKkhHgOGV1JrNgVYeRB5R9BCOafvic9cWsgwMibiaLibe4icu6UqZfZc9eicDw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQEl1nS9dNOaQCOzJmfasMK2MTia9Y47GbZ7XpAl4O9XJxMTZEFGShCSe8KtllXKvLdXaIpP0iczyww/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQEl1nS9dNOaQCOzJmfasMK4cbuXzzXd4aDYs3NRbNydcWa3ogSxRx25PmtOB0VBHyLXRomaJ3dRA/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;category&quot;</span>: <span class="string">&quot;官方动态&quot;</span>,</span><br><span class="line">      <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;source&quot;</span>: <span class="string">&quot;OpenHarmony&quot;</span>,</span><br><span class="line">      <span class="string">&quot;created_at&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="string">&quot;updated_at&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;id&quot;</span>: <span class="string">&quot;a2042a2858a50164&quot;</span>,</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: <span class="string">&quot;第二届OpenHarmony创新应用挑战赛决赛路演队伍揭晓&quot;</span>,</span><br><span class="line">      <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2025.02.20&quot;</span>,</span><br><span class="line">      <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/scsUs8XKUMWp_kelThSetA&quot;</span>,</span><br><span class="line">      <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_gif/15QnXdLP7ibT0RCulIUzFZ2cGSMTZ3VHFWEttSQKAePB61zNuqdYPP41JIA6b7hph5Z02wKZ61Ch5rjl5FxLzWw/640?wx_fmt=gif&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibTWPUlSlQlrgYv16cD7MdLyGVbH7vwicqqjQebo99Q9HGG9ribtnAvLcqKTK9JckcvrOLwuytlNs6ibw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;category&quot;</span>: <span class="string">&quot;官方动态&quot;</span>,</span><br><span class="line">      <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;source&quot;</span>: <span class="string">&quot;OpenHarmony&quot;</span>,</span><br><span class="line">      <span class="string">&quot;created_at&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="string">&quot;updated_at&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;id&quot;</span>: <span class="string">&quot;5114e5ff16d11bd8&quot;</span>,</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: <span class="string">&quot;OpenHarmony社区2024年度运营报告发布，致谢每一位生态共建者！&quot;</span>,</span><br><span class="line">      <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2025.02.11&quot;</span>,</span><br><span class="line">      <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/njNirZfZFhwztz9zNnuc-A&quot;</span>,</span><br><span class="line">      <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_gif/15QnXdLP7ibT0RCulIUzFZ2cGSMTZ3VHFWEttSQKAePB61zNuqdYPP41JIA6b7hph5Z02wKZ61Ch5rjl5FxLzWw/640?wx_fmt=gif&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEnbwtoZypOib8UjEhcpZWEjGMkFlPAL5icMm9MibtzskiaicCNrpytC8GcqQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEqicGZvtcZ3xqClk9Idm90o1KQuqqajJS4s84wbibZ0OSYNiahYQ9Uiam8g/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEUfAzhY6hGc3409floe2AsD1xRy9ZLgTSkibxzGtecxbPAUDAfWtB3qA/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEHdosZ5bXHP3LPwrfeNRfYkJRxNTLiaG4OpEA1fjc6Ud0FjACW3NRb6Q/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lE5SrR24VGd4681lCdHwEk7etQa7cxasUPBnIWy536SwBiaC05ZeCB0Bw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEvrmibn4fEjtgot1GdNzQQ6yBwvMDTVV67xJKS0ibAy6WNvXbA61ohygg/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEibyYuqgj0G0el5NAnVMZDVr9JqaC9WfmibY2NwoVgcqqzR3cQ86T7Oxw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEIuWvGaVW1AsVbccv91BxJddta5cuNBjicLymbYhn1k8K3xYia8neBIPA/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEYuvkRia1Ns1icGmLjFUbnmeiauD54te6aWDgnicXfq05qEDVNkomabBGZg/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEyBgz13QMqZtfDquTyMjeiazXHZGqmr2VVAgVAKMCmvEtIeur87vh6og/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEXBHNV1fU1W7hP8lHwonVWGWicC7SQIvVIibFsaAkhbj6oHdSQybbSvEg/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEbc704wvtChnw93E30syHCUlb03p6bl3Lh2lBQoGfxrvK1PKmtN3rYg/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEsF4Wugny506jkz59DJF9vqzaBHC4JksK0vorwcia7KrBv9pm01s8t6A/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEnxbV9983xoMKSdicZjahgA4iclekibh2qg758rLRvibK2ABicr1ZIvDs1ew/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEBpLU0LQ8Oge2YwF05Xg1p3kHckC98UyT5s1KxiapibqVibozW0JX3tictQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lE19837Louetkvia0NIMCRR0q7ODQbeIzXFh95vfn4FJDgD6f4jtmo4wQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEKDcHPjshicrricqGJFtLSBibQlKmCBnRvAJnSUjaGE2KGDTspBuZad1TQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lETpll3OKOKXib75zc9T5YUdSf6xXYLyHicB22AmUjceoa2VcNsU76PUsg/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEP7BHKHSUcz9ABK8N3bCOl03YEFZeRsfrcwtDhWtmvA3XS4AedzyvcQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEdbagNibvmQXh1IGwIS78ORtMx6tyWxrYD3jH8SibyR4TvEDJG8ia6Tlicg/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEJAe6DAO8GiaYfQueePYNTefrKAksfAjfWiaJicV3cGW3lpSyx0ic6hHAqg/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lETNP43Ae6zokA8p3iaur406j5hnsx1JINHq7kuT6wQF699hW4cxnKiagg/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lE6ic596IMRNVRia3uyLhXLS4ibCpqUXCvFNH2B7TUw7ZT9bnFicmHuWog1w/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lER3sgogF4V3S7y9fk6lMfD6NQYrMR2aYYXSxngZ1PYbW7nKPqyJ2iazA/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEeCGnSx0kbMbxuXJz3Ib74vUmmKWGJHo0UaROeTSxkbVM4f5WLhFLCA/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEmPicNYGZdJfA8nqNI9b9kLQGE8wqxpX7Ju62reVhsLlia5JbhpibIh9RQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lErwNG1iaIzaWLxIptCfQXzH4k9LssoKJibpQZ3WSAQB9Rfn25LrHAodQQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEa3jwI4tQBwtGN4rhMnDavM39De1zezdCTuuWkbl2sEzzcWqtVRflPw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEiaG63ia3YHt10DFR65RbLicGQIcSvVmDTzSyJP4Dbva7Sbn0mvfMItVfw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lE1nUDfYAfq3AmQSOabYD8HbhChc8nJlxMyvcI32c5tpnqtyR3va5Fgg/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEQs6jV1siamc8jaH7z63f00Bfj6yNibc7Rm5G07U9CNibkIqmtHIafBTkw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lEsQNHfDptkC0CCht9Ik6l3lyD6La1bkLVh7DEPRx9jhN1uXhstGTKAg/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQ8ldk4OHyMf3GPLCdTb4lE70eiaOPB7CY9QQeetZWdibPzaTvuLrYto80rJ2LfTibMC5duyA3zQCSvQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;category&quot;</span>: <span class="string">&quot;官方动态&quot;</span>,</span><br><span class="line">      <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;source&quot;</span>: <span class="string">&quot;OpenHarmony&quot;</span>,</span><br><span class="line">      <span class="string">&quot;created_at&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="string">&quot;updated_at&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;id&quot;</span>: <span class="string">&quot;946a1bb32c960dfd&quot;</span>,</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: <span class="string">&quot;开源鸿蒙社区恭祝全体开发者2025新年快乐，新春大吉！&quot;</span>,</span><br><span class="line">      <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2025.01.29&quot;</span>,</span><br><span class="line">      <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/fVn6brUk2EnPbUcc3pLeCA&quot;</span>,</span><br><span class="line">      <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_gif/15QnXdLP7ibT0RCulIUzFZ2cGSMTZ3VHFWEttSQKAePB61zNuqdYPP41JIA6b7hph5Z02wKZ61Ch5rjl5FxLzWw/640?wx_fmt=gif&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibQiarLkqywuj2ibkbZLBn4Wd21VTTD4cDyuibMTY1N0QBYGuKPWdFoAzcgzlAfufQW8H2YEdZ7FXrG1Q/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;category&quot;</span>: <span class="string">&quot;官方动态&quot;</span>,</span><br><span class="line">      <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;source&quot;</span>: <span class="string">&quot;OpenHarmony&quot;</span>,</span><br><span class="line">      <span class="string">&quot;created_at&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="string">&quot;updated_at&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;id&quot;</span>: <span class="string">&quot;2aefad8ffbbc8970&quot;</span>,</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: <span class="string">&quot;精彩预告 | 2024开放原子开发者大会OpenHarmony技术分论坛等您来！&quot;</span>,</span><br><span class="line">      <span class="string">&quot;date&quot;</span>: <span class="string">&quot; 2024.12.17&quot;</span>,</span><br><span class="line">      <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://mp.weixin.qq.com/s/Bsx93rP5cj-vMgFjwIIeXg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_gif/15QnXdLP7ibT0RCulIUzFZ2cGSMTZ3VHFWEttSQKAePB61zNuqdYPP41JIA6b7hph5Z02wKZ61Ch5rjl5FxLzWw/640?wx_fmt=gif&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_png/15QnXdLP7ibRTC12x0PiaKpzepz3HIA99ibl1HlPbm1xSqXNaGYAib76xOCh6GOTRVp1tmFem1cSWLkcHc3FNUHpEw/640?wx_fmt=png&amp;from=appmsg&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;category&quot;</span>: <span class="string">&quot;官方动态&quot;</span>,</span><br><span class="line">      <span class="string">&quot;summary&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;source&quot;</span>: <span class="string">&quot;OpenHarmony&quot;</span>,</span><br><span class="line">      <span class="string">&quot;created_at&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="string">&quot;updated_at&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;total&quot;</span>: <span class="number">385</span>,</span><br><span class="line">  <span class="string">&quot;page&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;page_size&quot;</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="string">&quot;has_next&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;has_prev&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>中间数据太长了我删除了一大部分。</p>
<p>看来我的两个资讯源的获取逻辑有问题。应该将两个数据源获取的数据能够分开获取才对。</p>
<p>但是看了一圈并没有发现问题在哪就很奇怪了。</p>
<h3 id="不分页数据获取参数"><a href="#不分页数据获取参数" class="headerlink" title="不分页数据获取参数"></a>不分页数据获取参数</h3><p>我准备设置一个全部数据一次性获取的接口来简化一下后端的接口设计。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">router = APIRouter(prefix=<span class="string">&quot;/api/news&quot;</span>, tags=[<span class="string">&quot;news&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">@router.get(<span class="params"><span class="string">&quot;/&quot;</span>, response_model=NewsResponse</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_news</span>(<span class="params"></span></span><br><span class="line"><span class="params">    page: <span class="built_in">int</span> = Query(<span class="params"><span class="number">1</span>, ge=<span class="number">1</span>, description=<span class="string">&quot;页码&quot;</span></span>),</span></span><br><span class="line"><span class="params">    page_size: <span class="built_in">int</span> = Query(<span class="params"><span class="number">20</span>, ge=<span class="number">1</span>, le=<span class="number">100</span>, description=<span class="string">&quot;每页数量&quot;</span></span>),</span></span><br><span class="line"><span class="params">    category: <span class="type">Optional</span>[<span class="built_in">str</span>] = Query(<span class="params"><span class="literal">None</span>, description=<span class="string">&quot;新闻分类&quot;</span></span>),</span></span><br><span class="line"><span class="params">    search: <span class="type">Optional</span>[<span class="built_in">str</span>] = Query(<span class="params"><span class="literal">None</span>, description=<span class="string">&quot;搜索关键词&quot;</span></span>),</span></span><br><span class="line"><span class="params">    <span class="built_in">all</span>: <span class="built_in">bool</span> = Query(<span class="params"><span class="literal">False</span>, description=<span class="string">&quot;是否返回全部新闻不分页&quot;</span></span>)</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    获取新闻列表，支持分页、分类和搜索</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    参数说明：</span></span><br><span class="line"><span class="string">    - page: 页码（当all=True时忽略）</span></span><br><span class="line"><span class="string">    - page_size: 每页数量（当all=True时忽略）</span></span><br><span class="line"><span class="string">    - category: 新闻分类过滤</span></span><br><span class="line"><span class="string">    - search: 搜索关键词</span></span><br><span class="line"><span class="string">    - all: 是否返回全部新闻不分页，为true时返回所有匹配的新闻</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 从缓存获取数据</span></span><br><span class="line">        cache = get_news_cache()</span><br><span class="line">        cache_status = cache.get_status()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查服务状态</span></span><br><span class="line">        <span class="keyword">if</span> cache_status[<span class="string">&quot;status&quot;</span>] == ServiceStatus.ERROR.value:</span><br><span class="line">            <span class="keyword">raise</span> HTTPException(</span><br><span class="line">                status_code=<span class="number">503</span>, </span><br><span class="line">                detail=<span class="string">f&quot;服务暂时不可用: <span class="subst">&#123;cache_status.get(<span class="string">&#x27;error_message&#x27;</span>, <span class="string">&#x27;未知错误&#x27;</span>)&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果服务正在准备中，返回提示信息</span></span><br><span class="line">        <span class="keyword">if</span> cache_status[<span class="string">&quot;status&quot;</span>] == ServiceStatus.PREPARING.value:</span><br><span class="line">            <span class="keyword">return</span> NewsResponse(</span><br><span class="line">                articles=[],</span><br><span class="line">                total=<span class="number">0</span>,</span><br><span class="line">                page=page,</span><br><span class="line">                page_size=page_size,</span><br><span class="line">                has_next=<span class="literal">False</span>,</span><br><span class="line">                has_prev=<span class="literal">False</span></span><br><span class="line">            )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 从缓存获取数据</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>:</span><br><span class="line">            <span class="comment"># 如果要返回全部数据，设置一个很大的page_size来获取所有数据</span></span><br><span class="line">            result = cache.get_news(page=<span class="number">1</span>, page_size=<span class="number">10000</span>, </span><br><span class="line">                                  category=category, search=search)</span><br><span class="line">            <span class="comment"># 重新设置分页信息，表示这是全部数据</span></span><br><span class="line">            result.page = <span class="number">1</span></span><br><span class="line">            result.page_size = result.total</span><br><span class="line">            result.has_next = <span class="literal">False</span></span><br><span class="line">            result.has_prev = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 正常分页逻辑</span></span><br><span class="line">            result = cache.get_news(page=page, page_size=page_size, </span><br><span class="line">                                  category=category, search=search)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> HTTPException:</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;获取新闻列表失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">500</span>, detail=<span class="string">&quot;获取新闻列表失败&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>保留原有的功能函数，然后新增一个全部数据获取的参数，这样就可以实现功能的拓展。</p>
<h3 id="核心接口测试"><a href="#核心接口测试" class="headerlink" title="核心接口测试"></a>核心接口测试</h3><p>理论上讲我现在的接口是支持以下几种URL的请求的我都先列在这里。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8001/api/news/?all=<span class="literal">true</span></span><br><span class="line">http://localhost:8001/api/news/?all=<span class="literal">true</span>&amp;category=官方动态</span><br><span class="line">http://localhost:8001/api/news/?all=<span class="literal">true</span>&amp;search=OpenHarmony</span><br><span class="line">http://localhost:8001/api/news/?all=<span class="literal">true</span>&amp;search=创新应用</span><br></pre></td></tr></table></figure>
<p>随后等待后端服务重新启动完成我们来访问一下这些接口来进行测试验证。</p>
<p>首先是<code>?all=true</code></p>
<video width="100%" controls>
  <source src="22.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>数据量太大了我就不全放在我的文章里了，观感不好。我直接放一个视频来证明数据时成功获取的。</p>
<p>随后再来测试一下<code>?all=true&amp;search=OpenHarmony</code>这个搜索接口。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;detail&quot;</span>: <span class="string">&quot;获取新闻列表失败&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>果然这个细分来源的接口还是有问题存在，虽然暂时没有查出问题所在，但但使用一个全部资讯接口也是可以进行渲染的，所以我决定先去继续推进度。</p>
<h2 id="客户端开发"><a href="#客户端开发" class="headerlink" title="客户端开发"></a>客户端开发</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>首先我们先去搭建一下标准化的三层架构层级，创建两个动态共享包，<code>common</code>和<code>feature</code>。</p>
<p>然后将日志工具迁移过来。再设置一下动态资源包依赖。最后再安装一下我们所需要的md三方库。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ohpm i @lidary/markdown</span><br></pre></td></tr></table></figure>
<p>然后再修改一下我们的应用名称以及图标。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/13.png" alt="13"></p>
<p>ok，至此准备工作准备就绪。奥对，我们还需在再下载一个骨架屏的三方库，虽然之前在面试通项目时我们也自制过骨架屏，但还是太简陋了，有现成好用的三方库就直接用吧，何乐而不为呢。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ohpm i @hw-agconnect/ui-skeleton</span><br></pre></td></tr></table></figure>
<h3 id="整体应用构想"><a href="#整体应用构想" class="headerlink" title="整体应用构想"></a>整体应用构想</h3><p>首先整体应用的核心界面就三个，一个是文章列表，一个是文章详情页，还有一个设置页面。</p>
<p>三个页面的基本结构其实市面上有很多参考，也并不难设计。</p>
<p>首先文章列表页面就是上面一个轮播图播放最热门的几个资讯，这个我考虑是从OpenHarmony官网爬取带封面图的文章来当轮播提的内容，随后下面做的是在手机上成一列在折叠屏上成两列，在平板上成三列的一多列表用GridRow和GridColumn来进行实现，配个Scroll组件来实现滑动效果。然后信息列表的话我在采用一个tab标签页来分栏展示我们资讯来源。想到这里我突然想到之前的面试通项目，上面的轮播图部分我们并没有将它囊括进滚动区域的范围，最后导致我们的应用页面只有下半部分能进行滚动，这很不合理也不美观，所以这次我们一定要将轮播图也囊括进滚动区域，这样我们的应用页面才能真正的实现全屏滚动。但我们也不能直接将整个页面全部囊括进一个Scroll组件，这样会导致我们的tab工具栏随着滚动一并向上滚动，最后滚动到屏幕外面，这并不合理，所以我决定将主页面的内容都放在List组件中，然后利用<code>ListItemGroup</code>组件来实现吸顶效果，，这样就可以做到吸顶了。</p>
<p>还有个问题就是在于跳转，从文章列表跳转到文章这不用说，直接点击对应文章就跳转到对应页面即可这没什么好说的，但问题在于设置页怎么做。因为我并没有打算做用户个人界面，那就意味着我没法单独开一个小按钮在个人信息页中去进行设置页的跳转。目前我的想法灵感是来自于我的博客，手机版页面的右下角会有个工具栏页表，显示回到顶部以及阅读模式开启等功能。我也准备将设置页的按钮入口直接设置在滚动列表的右下角，同时还可以设置一个深浅色模式的快捷开关，因为这应该是最常用的功能，所以我可以将它放在和设置列表并列的位置，这样一来我们就可以快捷的更改颜色模式了，不过这个按钮我们应该需要制作一个防抖器，不能因为过快的点击而频繁切换颜色模式可能会导致应用崩溃。</p>
<p>然后设置项目前我想到的只有一个字体大小设置，用滑动条去进行设置，深浅色模式也在这里单独列出，因为我们可以再单独设置一个按钮开关控制页面，用来调整回到顶部以及深浅色模式是否开启的按钮设置项。然后深浅色模式还可以在设置页面中进行更改，增加一个跟随系统选项。</p>
<h3 id="启动页面构建"><a href="#启动页面构建" class="headerlink" title="启动页面构建"></a>启动页面构建</h3><p>首先将<code>Navigation</code>组件的页面栈以及相关的常量枚举量都创建完成随后进行签名以及真机测试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; hvigor ERROR: Failed :common:default@CompileArkTS... </span><br><span class="line">&gt; hvigor ERROR:  ERROR: page <span class="string">&#x27;D:/HarmonyAppS/NowInOpenHarmony/ostest_integration_test/scenario/NowInOpenHarmony/APP/NowInOpenHarmony/commons/common/src/main/ets/pages/Index.ets&#x27;</span> does not exist. </span><br><span class="line">&gt; hvigor ERROR: BUILD FAILED <span class="keyword">in</span> 708 ms</span><br></pre></td></tr></table></figure>
<p>一开始我还以为是因为我将entry模块的<code>Index.ets</code>文件改成了<code>Main.ets</code>导致的文件缺失，但是我明明在<code>EntryAbility.ets</code>中的<code>windowStage.loadContent</code>函数中修改了目标页面的路径但依旧报错，而且报的错是Index文件缺失，并不是修改后的Main文件缺失，所以我只好先将主页面的Main先改回去。但改回去之后还报错，我仔细的捋了一下缺失的文件路径这才发现是common包里面的Index页面缺失。我才想起来之前我好像给删了，先去补回来吧。</p>
<p>特性层没删就没报这个错，于是我直接去将<code>main_pages.json</code>文件中的Index页面字段删了，然后就得到了新的报错说数组长度小于1，那我就只好去创建Index页面。</p>
<p>创建时又发现报错显示已经存在Index页面？？？</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/14.png" alt="14"></p>
<p>所以我尝试创建了Main页面发现不报错了，重新编译也没问题了。嘶，搞不太懂，后面再研究研究吧。</p>
<h4 id="Navigation启动页问题"><a href="#Navigation启动页问题" class="headerlink" title="Navigation启动页问题"></a>Navigation启动页问题</h4><p>这个问题其实在鸿小易期间就存在，当时我在设置启动页时使用的就是<code>NavDestination</code>组件让其作为一个<code>Navigation</code>组件的一个跳转页面，但存在一个问题就是如果直接将其放在<code>Navigation</code>组件中，那么在跳转至主界面后触发系统的返回键会跳转回启动页，这很显然不合理。在鸿小易项目中我的解决方案是使用router来去进行替换跳转。但其实我现在仔细一想，好像不需要那么麻烦，我直接将主界面放在<code>Navigation</code>之中当做根页面就好了。</p>
<p>先做一个简单的轮播图组件放在首页来去进行一下首页和默认页面的区分。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/15.png" alt="15"></p>
<p>复制一个官网轮播图的链接过来进行一下显示测试。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NewsSwiperModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;common&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页上方轮播图组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">NewsSwiper</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">swiperList</span>: <span class="title class_">NewsSwiperModule</span> [] = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">NewsSwiperModule</span>(<span class="string">&#x27;https://images.openharmony.cn/%E9%A6%96%E9%A1%B5/banner/20240411/4.1releas%E6%89%8B%E6%9C%BA.jpg&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;开源生态大会&#x27;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">NewsSwiperModule</span>(<span class="string">&#x27;https://images.openharmony.cn/%E9%A6%96%E9%A1%B5/banner/20240411/4.1releas%E6%89%8B%E6%9C%BA.jpg&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;开源生态大会&#x27;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">NewsSwiperModule</span>(<span class="string">&#x27;https://images.openharmony.cn/%E9%A6%96%E9%A1%B5/banner/20240411/4.1releas%E6%89%8B%E6%9C%BA.jpg&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;开源生态大会&#x27;</span>)</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Swiper</span>()&#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">swiperList</span>,<span class="function">(<span class="params"><span class="attr">item</span>:<span class="title class_">NewsSwiperModule</span></span>)=&gt;</span>&#123;</span><br><span class="line">          <span class="title class_">Image</span>(item.<span class="property">img</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">curve</span>(<span class="title class_">Curve</span>.<span class="property">EaseInOut</span>)</span><br><span class="line">      .<span class="title function_">loop</span>(<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">autoPlay</span>(<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">interval</span>(<span class="number">2000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后将主页面直接设为Navigation的子组件，这样应该就不会出现跳转至空白页面的问题了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NavDests</span>, <span class="variable constant_">NAV_PATH_STUCK</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;common&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MainPage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./nav_pages/mainPage&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">StarPage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./nav_pages/startPage&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Main</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">navPathStuck</span>: <span class="title class_">NavPathStack</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NavPathStack</span>, <span class="variable constant_">NAV_PATH_STUCK</span>,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">NavPathStack</span>())!</span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title class_">NavDestMap</span>(<span class="attr">name</span>: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="title class_">NavDests</span>.<span class="property">MAIN</span>) &#123;</span><br><span class="line">      <span class="title class_">Main</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (name === <span class="title class_">NavDests</span>.<span class="property">START_PAGE</span>)&#123;</span><br><span class="line">      <span class="title class_">StarPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">navPathStuck</span>.<span class="title function_">replacePath</span>(&#123;<span class="attr">name</span>:<span class="title class_">NavDests</span>.<span class="property">START_PAGE</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Navigation</span>(<span class="variable language_">this</span>.<span class="property">navPathStuck</span>)&#123;</span><br><span class="line">      <span class="title class_">MainPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">navDestination</span>(<span class="variable language_">this</span>.<span class="property">NavDestMap</span>)</span><br><span class="line">    .<span class="title function_">hideTitleBar</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">hideToolBar</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">hideBackButton</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">titleMode</span>(<span class="title class_">NavigationTitleMode</span>.<span class="property">Mini</span>)</span><br><span class="line">    .<span class="title function_">mode</span>(<span class="title class_">NavigationMode</span>.<span class="property">Stack</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后在启动页的<code>aboutToAppear</code>函数中设置设置一个延时器来模拟才能够服务器获取数据的流程。加载完成之后直接将启动页从页面栈删除就可以。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NavDests</span>, <span class="variable constant_">NAV_PATH_STUCK</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;common&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MainPage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./nav_pages/mainPage&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">StarPage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./nav_pages/startPage&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Main</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">navPathStuck</span>: <span class="title class_">NavPathStack</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NavPathStack</span>, <span class="variable constant_">NAV_PATH_STUCK</span>,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">NavPathStack</span>())!</span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title class_">NavDestMap</span>(<span class="attr">name</span>: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="title class_">NavDests</span>.<span class="property">MAIN</span>) &#123;</span><br><span class="line">      <span class="title class_">Main</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (name === <span class="title class_">NavDests</span>.<span class="property">START_PAGE</span>)&#123;</span><br><span class="line">      <span class="title class_">StarPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">navPathStuck</span>.<span class="title function_">replacePath</span>(&#123;<span class="attr">name</span>:<span class="title class_">NavDests</span>.<span class="property">START_PAGE</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Navigation</span>(<span class="variable language_">this</span>.<span class="property">navPathStuck</span>)&#123;</span><br><span class="line">      <span class="title class_">MainPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">navDestination</span>(<span class="variable language_">this</span>.<span class="property">NavDestMap</span>)</span><br><span class="line">    .<span class="title function_">hideTitleBar</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">hideToolBar</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">hideBackButton</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">titleMode</span>(<span class="title class_">NavigationTitleMode</span>.<span class="property">Mini</span>)</span><br><span class="line">    .<span class="title function_">mode</span>(<span class="title class_">NavigationMode</span>.<span class="property">Stack</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="16.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>嗯，测试结果还是很满意的。原来是我之前的思路错了。</p>
<h3 id="API基础功能模块构建"><a href="#API基础功能模块构建" class="headerlink" title="API基础功能模块构建"></a>API基础功能模块构建</h3><h4 id="网络请求工具封装"><a href="#网络请求工具封装" class="headerlink" title="网络请求工具封装"></a>网络请求工具封装</h4><p>首先设置一下基地址的常量。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">SERVE_BASE_ADDRESS</span> = <span class="string">&#x27;http://localhost:8001&#x27;</span></span><br></pre></td></tr></table></figure>
<p>同时安装一下axios的三方库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ohpm install @ohos/axios</span><br></pre></td></tr></table></figure>
<p>随后在common层的<code>api</code>文件夹下封装一个axios请求实例对象。</p>
<p>在我从原来的项目迁移封装好的请求工具类时我突然意识到一个问题就是说从UIContext中获取到的<code>promptAction</code>对象我好像得提出来作为一个全局变量否则我一直调用的都是那个被废弃的接口。</p>
<p>通过之前鸿小易的开发经验我可以得知，直接向AppStorageV2中存入上下文对象是不可行的，我需要将其包装为一个实例对象的属性来进行存储，所以我们设置一个包装类。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取上下文对象包装类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GetUIContext</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">_context</span>: <span class="title class_">UIContext</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">set</span> <span class="title function_">context</span>(<span class="params"><span class="attr">value</span>: <span class="title class_">UIContext</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_context</span> = value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">get</span> <span class="title function_">context</span>(): <span class="title class_">UIContext</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_context</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">context</span>: <span class="title class_">UIContext</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_context</span> = context</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后在页面的<code>onWindowStageCreate</code>函数中去获取UI上下文对象并存储到全局变量中。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onWindowStageCreate</span>(<span class="attr">windowStage</span>: <span class="variable language_">window</span>.<span class="property">WindowStage</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Main window is created, set main page for this ability</span></span><br><span class="line">  hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onWindowStageCreate&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  windowStage.<span class="title function_">loadContent</span>(<span class="string">&#x27;pages/Index&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err.<span class="property">code</span>) &#123;</span><br><span class="line">      hilog.<span class="title function_">error</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Failed to load the content. Cause: %&#123;public&#125;s&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Succeeded in loading the content.&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> uiPromptAction = windowStage.<span class="title function_">getMainWindowSync</span>().<span class="title function_">getUIContext</span>()</span><br><span class="line">    <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">GetUIContext</span>,<span class="variable constant_">GET_UICONTEXT</span>,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">GetUIContext</span>(uiPromptAction));</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">GetUIContext</span>, <span class="variable constant_">GET_UICONTEXT</span>)!==<span class="literal">undefined</span>) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">&#x27;Get UIContext succeed&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后封装axios的基础配置以及拦截器的数据判断</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123; <span class="title class_">AxiosError</span>, <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@ohos/axios&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&quot;../../utils&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">GET_UICONTEXT</span>, <span class="variable constant_">SERVE_BASE_ADDRESS</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../constants&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GetUIContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../modules/context/GetUIContext&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">AXIOS_HTTP_LOG_TAG</span> = <span class="string">&#x27;AxiosHttp:  &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * axios请求实例</span></span><br><span class="line"><span class="comment"> * 配置基地址和请求超时时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> axiosInstance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="variable constant_">SERVE_BASE_ADDRESS</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">10000</span></span><br><span class="line">&#125;)</span><br><span class="line">logger.<span class="title function_">debug</span>(<span class="string">&#x27;请求获取UIContext&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> uiPromptAction = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">GetUIContext</span>,<span class="variable constant_">GET_UICONTEXT</span>)!.<span class="property">context</span>.<span class="title function_">getPromptAction</span>()</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置响应拦截器拦截器</span></span><br><span class="line"><span class="comment"> * interceptors:    拦截器</span></span><br><span class="line"><span class="comment"> * response:        响应</span></span><br><span class="line"><span class="comment"> * 由这个axiosInstance实例发送到请求的响应都会经过它再返回</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">axiosInstance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">    logger.<span class="title function_">warn</span>(<span class="variable constant_">AXIOS_HTTP_LOG_TAG</span> + <span class="string">&#x27;Req Success&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>))</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">data</span></span><br><span class="line">  &#125;</span><br><span class="line">  logger.<span class="title function_">error</span>(<span class="variable constant_">AXIOS_HTTP_LOG_TAG</span> + <span class="string">&#x27;ReqCode Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>))</span><br><span class="line">  uiPromptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;ReqCode Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>) &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(res.<span class="property">data</span>)</span><br><span class="line">&#125;, <span class="function">(<span class="params"><span class="attr">err</span>: <span class="title class_">AxiosError</span></span>) =&gt;</span> &#123;</span><br><span class="line">  logger.<span class="title function_">error</span>(<span class="variable constant_">AXIOS_HTTP_LOG_TAG</span> + <span class="string">&#x27;Req Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err))</span><br><span class="line">  uiPromptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;Req Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err) &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AxiosHttp</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Axios包装过的请求函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> config 网络请求配置项</span></span><br><span class="line"><span class="comment">   * &lt;res:响应数据类型</span></span><br><span class="line"><span class="comment">   * req:请求体参数类型 - get不需要传&gt;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  request&lt;res, req = <span class="title class_">Object</span>&gt;(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>&lt;req&gt;) &#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="variable constant_">AXIOS_HTTP_LOG_TAG</span> + <span class="string">&#x27;进入AxiosHttp.request&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> axiosInstance&lt;<span class="literal">null</span>, res, req&gt;(config)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 包装后的axios请求，添加了拦截器直接选取res.data中的字段</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> axiosHttp = <span class="keyword">new</span> <span class="title class_">AxiosHttp</span>()</span><br></pre></td></tr></table></figure>
<p>进行测试，果然和我预想的一样出了问题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Reason:Error</span><br><span class="line">Error name:Error</span><br><span class="line">Error message:The default creator should be <span class="keyword">function</span> when first connect</span><br><span class="line">Stacktrace:</span><br><span class="line">SourceMap is not initialized yet </span><br><span class="line">    at connect (/usr1/hmos_for_system/src/increment/sourcecode/foundation/arkui/ace_engine/frameworks/bridge/declarative_frontend/engine/stateMgmt.js:10862:1)</span><br><span class="line">    at connect (../../../foundation/arkui/ace_engine/frameworks/bridge/declarative_frontend/engine/jsStateManagement.js:45:1)</span><br><span class="line">    at func_main_0 (common|common|1.0.0|src/main/ets/api/http/AxiosHttp.ts:16:24)</span><br></pre></td></tr></table></figure>
<p>动态资源共享包的编译过程很显然是在UI界面渲染之前发生的，也就代表我们获取UI上下文的代码执行发生在了我们使用弹窗之前。我们先将从全局变量中获取对象的代码注释掉试试，如果仅注释掉网络请求工具封装文件中的代码问题就消失，而且点击轮播图的弹窗依旧正常显示的话说明我的想法是正确的，问题就发生在了我们代码的执行顺序上。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">logger.<span class="title function_">debug</span>(<span class="string">&#x27;请求获取UIContext&#x27;</span>)</span><br><span class="line"><span class="comment">// const uiPromptAction = AppStorageV2.connect(GetUIContext,GET_UICONTEXT)!.context.getPromptAction()</span></span><br></pre></td></tr></table></figure>
<p>经测试bug消失，同时点击轮播图的弹窗依旧正常显示，说明我们的想法是正确的，问题就发生在了我们代码的执行顺序上。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置响应拦截器拦截器</span></span><br><span class="line"><span class="comment"> * interceptors:    拦截器</span></span><br><span class="line"><span class="comment"> * response:        响应</span></span><br><span class="line"><span class="comment"> * 由这个axiosInstance实例发送到请求的响应都会经过它再返回</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">axiosInstance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> uiPromptAction = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">GetUIContext</span>,<span class="variable constant_">GET_UICONTEXT</span>)!.<span class="property">context</span>.<span class="title function_">getPromptAction</span>()</span><br><span class="line">  <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">    logger.<span class="title function_">warn</span>(<span class="variable constant_">AXIOS_HTTP_LOG_TAG</span> + <span class="string">&#x27;Req Success&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>))</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">data</span></span><br><span class="line">  &#125;</span><br><span class="line">  logger.<span class="title function_">error</span>(<span class="variable constant_">AXIOS_HTTP_LOG_TAG</span> + <span class="string">&#x27;ReqCode Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>))</span><br><span class="line">  uiPromptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;ReqCode Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>) &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(res.<span class="property">data</span>)</span><br><span class="line">&#125;, <span class="function">(<span class="params"><span class="attr">err</span>: <span class="title class_">AxiosError</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> uiPromptAction = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">GetUIContext</span>,<span class="variable constant_">GET_UICONTEXT</span>)!.<span class="property">context</span>.<span class="title function_">getPromptAction</span>()</span><br><span class="line">  logger.<span class="title function_">error</span>(<span class="variable constant_">AXIOS_HTTP_LOG_TAG</span> + <span class="string">&#x27;Req Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err))</span><br><span class="line">  uiPromptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;Req Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err) &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>我尝试将获取放入响应拦截器中看是否能解决这个问题。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/19.jpg" alt="19"></p>
<p>问题成功解决。</p>
<div class="note success flat"><p>小结一下，我将从全局变量获取UIContext的代码移动进了axios的响应拦截器中，这样就不会在编译动态资源包时就直接执行这段代码，而是在UI界面构建之后由界面逻辑触发请求时才会调佣这段代码，避免了代码顺序问题。</p>
</div>
<h4 id="API测试"><a href="#API测试" class="headerlink" title="API测试"></a>API测试</h4><p>我现在启动了后端服务，我们先来编写一段代码来测试一下我们的网络请求工具是否正常工作。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新闻源信息接口</span></span><br><span class="line"><span class="comment"> * 描述不同来源的新闻平台信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">NewsSource</span> &#123;</span><br><span class="line">  <span class="comment">/** 新闻源标识（如：openharmony、csdn） */</span></span><br><span class="line">  <span class="attr">source</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 新闻源名称（如：OpenHarmony官网、CSDN） */</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 新闻源描述信息 */</span></span><br><span class="line">  <span class="attr">description</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 新闻源基础URL */</span></span><br><span class="line">  <span class="attr">base_url</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 缓存服务状态接口</span></span><br><span class="line"><span class="comment"> * 描述缓存服务的当前状态信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CacheService</span> &#123;</span><br><span class="line">  <span class="comment">/** 缓存服务状态（如：preparing、ready、error） */</span></span><br><span class="line">  <span class="attr">status</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 缓存数量 */</span></span><br><span class="line">  <span class="attr">cache_count</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/** 最后更新时间（null表示未更新过） */</span></span><br><span class="line">  <span class="attr">last_update</span>: <span class="built_in">number</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">/** 错误信息（无错误时可能为null或空字符串） */</span></span><br><span class="line">  <span class="attr">error_message</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务集合接口</span></span><br><span class="line"><span class="comment"> * 包含系统中所有可用的服务信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Services</span> &#123;</span><br><span class="line">  <span class="comment">/** 缓存服务信息 */</span></span><br><span class="line">  <span class="attr">cache</span>: <span class="title class_">CacheService</span>;</span><br><span class="line">  <span class="comment">/** 新闻源列表 */</span></span><br><span class="line">  <span class="attr">news_sources</span>: <span class="title class_">NewsSource</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接口端点集合接口</span></span><br><span class="line"><span class="comment"> * 描述系统提供的所有API接口端点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Endpoints</span> &#123;</span><br><span class="line">  <span class="comment">/** OpenHarmony新闻接口 */</span></span><br><span class="line">  <span class="attr">openharmony_news</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** CSDN新闻接口 */</span></span><br><span class="line">  <span class="attr">csdn_news</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 所有新闻聚合接口 */</span></span><br><span class="line">  <span class="attr">all_news</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 手动爬取接口 */</span></span><br><span class="line">  <span class="attr">manual_crawl</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 服务状态查询接口 */</span></span><br><span class="line">  <span class="attr">service_status</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 系统状态根接口</span></span><br><span class="line"><span class="comment"> * 包含整个系统的状态信息和可用接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SystemStatus</span> &#123;</span><br><span class="line">  <span class="comment">/** 系统整体状态（如：preparing、ready） */</span></span><br><span class="line">  <span class="attr">status</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 时间戳（状态生成的时间） */</span></span><br><span class="line">  <span class="attr">timestamp</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/** 系统版本号 */</span></span><br><span class="line">  <span class="attr">version</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 系统包含的服务集合 */</span></span><br><span class="line">  <span class="attr">services</span>: <span class="title class_">Services</span>;</span><br><span class="line">  <span class="comment">/** 系统提供的API接口端点集合 */</span></span><br><span class="line">  <span class="attr">endpoints</span>: <span class="title class_">Endpoints</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先定义一系列的数据接口用于承接并解析数据。随后在利用封装好的网络请求工具测试一下我们的后端服务是否正常工作以及是否能直接请求，是否会存在一些跨域问题。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; axiosHttp &#125; <span class="keyword">from</span> <span class="string">&#x27;../http/AxiosHttp&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SystemStatus</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../../modules/server/ServerHelth&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&#x27;../../utils/logger/logger&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ServerHealthAPI</span>_TAG = <span class="string">&#x27;ServerHealthAPI:&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServerHealthAPI</span> &#123;</span><br><span class="line">  <span class="title function_">isServerReady</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = axiosHttp.<span class="property">request</span>&lt;<span class="title class_">SystemStatus</span>&gt;(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/api/health&#x27;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="title class_">ServerHealthAPI</span>_TAG + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res))</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="title class_">ServerHealthAPI</span>_TAG + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> serverHealthApi = <span class="keyword">new</span> <span class="title class_">ServerHealthAPI</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最后再将这个函数在主页面的生命周期中去进行调用。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  serverHealthApi.<span class="title function_">isServerReady</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动调试并观察日志输出。</p>
<p>诶？奇怪的现象出现了。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/20.png" alt="20"></p>
<p>请求触发了但是API中并没有成功解析到数据，但是封装的请求工具中设置的拦截器是成功捕获了响应。</p>
<p>同时含有一个现象就是拦截器触发的时机是在API的日志打印之后，这个代码的执行顺序有问题。奥，原来是因为网络请求是异步操作，但我用的是同步变成，res是Promise对象，而不是请求后的响应数据。</p>
<p>改一下代码。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; axiosHttp &#125; <span class="keyword">from</span> <span class="string">&#x27;../http/AxiosHttp&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SystemStatus</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../../modules/server/ServerHelth&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&#x27;../../utils/logger/logger&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ServerHealthAPI</span>_TAG = <span class="string">&#x27;ServerHealthAPI: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServerHealthAPI</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">isServerReady</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> axiosHttp.<span class="property">request</span>&lt;<span class="title class_">SystemStatus</span>&gt;(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/api/health&#x27;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="title class_">ServerHealthAPI</span>_TAG + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res))</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="title class_">ServerHealthAPI</span>_TAG + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> serverHealthApi = <span class="keyword">new</span> <span class="title class_">ServerHealthAPI</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  serverHealthApi.<span class="title function_">isServerReady</span>().<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">res</span>:<span class="built_in">boolean</span></span>)=&gt;</span>&#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="title class_">MainPage</span>_TAG+res.<span class="title function_">valueOf</span>())</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次测试</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/21.png" alt="21"></p>
<p>成功了成功了，吓死我了。还是不熟练，还得多练。</p>
<p>随后就开始依据其他的重要API开始逐一编写数据模型以及接口类型。</p>
<h4 id="新闻API"><a href="#新闻API" class="headerlink" title="新闻API"></a>新闻API</h4><p>首先是数据模型的定义，核心的就是这四个，这四个足以支撑我们的页面构建需求。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 内容类型枚举</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">ContentType</span> &#123;</span><br><span class="line">  <span class="variable constant_">TEXT</span> = <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="variable constant_">IMAGE</span> = <span class="string">&quot;image&quot;</span>,</span><br><span class="line">  <span class="variable constant_">VIDEO</span> = <span class="string">&quot;video&quot;</span>,</span><br><span class="line">  <span class="variable constant_">CODE</span> = <span class="string">&quot;code&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新闻内容块接口</span></span><br><span class="line"><span class="comment"> * 定义新闻文章中单个内容块的结构</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">NewsContentBlock</span> &#123;</span><br><span class="line">  <span class="comment">/** 内容类型 */</span></span><br><span class="line">  <span class="attr">type</span>: <span class="title class_">ContentType</span>;</span><br><span class="line">  <span class="comment">/** 内容值 */</span></span><br><span class="line">  <span class="attr">value</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新闻文章接口</span></span><br><span class="line"><span class="comment"> * 定义完整新闻文章的数据结构</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">NewsArticle</span> &#123;</span><br><span class="line">  <span class="comment">/** 文章唯一标识符（可选） */</span></span><br><span class="line">  <span class="attr">id</span>?: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">/** 文章标题 */</span></span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 发布日期 */</span></span><br><span class="line">  <span class="attr">date</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 文章原链接 */</span></span><br><span class="line">  <span class="attr">url</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** 文章内容块数组 */</span></span><br><span class="line">  <span class="attr">content</span>: <span class="title class_">NewsContentBlock</span>[];</span><br><span class="line">  <span class="comment">/** 文章分类（可选） */</span></span><br><span class="line">  <span class="attr">category</span>?: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">/** 文章摘要（可选） */</span></span><br><span class="line">  <span class="attr">summary</span>?: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">/** 新闻来源（可选） */</span></span><br><span class="line">  <span class="attr">source</span>?: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">/** 创建时间（可选，ISO 8601 格式） */</span></span><br><span class="line">  <span class="attr">created_at</span>?: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">/** 更新时间（可选，ISO 8601 格式） */</span></span><br><span class="line">  <span class="attr">updated_at</span>?: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新闻响应接口</span></span><br><span class="line"><span class="comment"> * 定义分页新闻数据的响应结构</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">NewsResponse</span> &#123;</span><br><span class="line">  <span class="comment">/** 新闻文章数组 */</span></span><br><span class="line">  <span class="attr">articles</span>: <span class="title class_">NewsArticle</span>[];</span><br><span class="line">  <span class="comment">/** 总文章数量 */</span></span><br><span class="line">  <span class="attr">total</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/** 当前页码 */</span></span><br><span class="line">  <span class="attr">page</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/** 每页文章数量 */</span></span><br><span class="line">  <span class="attr">page_size</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/** 是否有下一页 */</span></span><br><span class="line">  <span class="attr">has_next</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="comment">/** 是否有上一页 */</span></span><br><span class="line">  <span class="attr">has_prev</span>: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ok，随后就可以开始对获取全部数据接口进行封装了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NewsArticle</span>, <span class="title class_">NewsResponse</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../modules/news/NewsListModules&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&quot;../../utils/logger/logger&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; axiosHttp &#125; <span class="keyword">from</span> <span class="string">&quot;../http/AxiosHttp&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewsListAPI</span>_TAG = <span class="string">&#x27;NewsListAPI: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">NewsListAPI</span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取全部新闻列表接口，在调用前请先调用isServerReady接口</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 若是出现异常则为空正常则为全部新闻列表NewsArticle[]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getAllNews</span>(): <span class="title class_">Promise</span>&lt;<span class="title class_">NewsArticle</span>[] | <span class="literal">null</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="title class_">NewsListAPI</span>_TAG+<span class="string">&#x27;进入getAllNews&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> axiosHttp.<span class="property">request</span>&lt;<span class="title class_">NewsResponse</span>&gt;(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&#x27;/api/news/?all=true&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="title class_">NewsListAPI</span>_TAG+<span class="string">&#x27;res = &#x27;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res))</span><br><span class="line">      <span class="keyword">return</span> res.<span class="property">articles</span></span><br><span class="line">    &#125;<span class="keyword">catch</span> (err)&#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err))</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> newsListApi = <span class="keyword">new</span> <span class="title class_">NewsListAPI</span>()</span><br></pre></td></tr></table></figure>
<p>随后我们用相同的方式进行一下真机测试。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">isServerReady</span>:<span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="variable constant_">START_PAGE_TAGE</span>+<span class="string">&#x27;延时跳转&#x27;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">navPathStuck</span>.<span class="title function_">clear</span>()</span><br><span class="line">  &#125;,<span class="number">2000</span>)</span><br><span class="line">  serverHealthApi.<span class="title function_">isServerReady</span>().<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">res</span>:<span class="built_in">boolean</span></span>)=&gt;</span> &#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="variable constant_">START_PAGE_TAGE</span> + res.<span class="title function_">valueOf</span>())</span><br><span class="line">    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">      isServerReady = <span class="literal">true</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">START_PAGE_TAGE</span>+<span class="string">&#x27;服务端准备就绪isServerReady=&#x27;</span>+isServerReady)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      isServerReady = <span class="literal">false</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">START_PAGE_TAGE</span>+<span class="string">&#x27;服务端准备中isServerReady=&#x27;</span>+isServerReady)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (isServerReady)&#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="variable constant_">START_PAGE_TAGE</span>+<span class="string">&#x27;尝试获取全部新闻列表&#x27;</span>)</span><br><span class="line">    newsListApi.<span class="title function_">getAllNews</span>().<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">res</span>:<span class="title class_">NewsArticle</span>[] | <span class="literal">null</span></span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (res === <span class="literal">null</span>) &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="variable constant_">START_PAGE_TAGE</span>+<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一段异步编程我感觉可能会有执行顺序问题，我们先测试一下看看。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/22.png" alt="22"></p>
<p>后端请求超时？？？后端日志也确实没显示有请求访问。</p>
<p>我立刻检查了电脑的科学上网工具，会不会是VPN导致的IP变动。但事实证明不是，我已经关闭了VPN。随后又检查了手机，也未发现异常。</p>
<p>我思考了一段时间，又一次检查了IP地址常量，并没有问题。<code>198.168....</code>诶？等会我这是私有IP地址段并不是公网IP地址，我手机连接的是流量，并不是家里的WiFi，应该是这个问题。</p>
<p>我切换了一下网络，测试，果然成功了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">08-01 17:47:58.207   32053-32053   A01234/com.xbx...ony/XBXLogger  pid-32053             D     AxiosHttp:  进入AxiosHttp.request</span><br><span class="line">08-01 17:47:58.239   32053-32053   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  W     AxiosHttp:  Req Success&#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;healthy&quot;</span>,<span class="string">&quot;timestamp&quot;</span>:1754041678.1939504,<span class="string">&quot;version&quot;</span>:<span class="string">&quot;1.0.0&quot;</span>,<span class="string">&quot;services&quot;</span>:&#123;<span class="string">&quot;cache&quot;</span>:&#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;ready&quot;</span>,<span class="string">&quot;cache_count&quot;</span>:386,<span class="string">&quot;last_update&quot;</span>:<span class="string">&quot;2025-08-01T14:40:11.540102&quot;</span>,<span class="string">&quot;error_message&quot;</span>:null&#125;,<span class="string">&quot;news_sources&quot;</span>:[&#123;<span class="string">&quot;source&quot;</span>:<span class="string">&quot;openharmony&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;OpenHarmony官网&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;OpenHarmony官方网站最新动态和新闻&quot;</span>,<span class="string">&quot;base_url&quot;</span>:<span class="string">&quot;https://www.openharmony.cn&quot;</span>&#125;,&#123;<span class="string">&quot;source&quot;</span>:<span class="string">&quot;csdn&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;CSDN&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;CSDN平台上关于OpenHarmony的技术文章和资讯&quot;</span>,<span class="string">&quot;base_url&quot;</span>:<span class="string">&quot;https://blog.csdn.net&quot;</span>&#125;]&#125;,<span class="string">&quot;endpoints&quot;</span>:&#123;<span class="string">&quot;openharmony_news&quot;</span>:<span class="string">&quot;/api/news/openharmony&quot;</span>,<span class="string">&quot;csdn_news&quot;</span>:<span class="string">&quot;/api/news/csdn&quot;</span>,<span class="string">&quot;all_news&quot;</span>:<span class="string">&quot;/api/news/&quot;</span>,<span class="string">&quot;manual_crawl&quot;</span>:<span class="string">&quot;/api/news/crawl&quot;</span>,<span class="string">&quot;service_status&quot;</span>:<span class="string">&quot;/api/news/status/info&quot;</span>&#125;&#125;</span><br><span class="line">08-01 17:47:58.239   32053-32053   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  I     ServerHealthAPI: &#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;healthy&quot;</span>,<span class="string">&quot;timestamp&quot;</span>:1754041678.1939504,<span class="string">&quot;version&quot;</span>:<span class="string">&quot;1.0.0&quot;</span>,<span class="string">&quot;services&quot;</span>:&#123;<span class="string">&quot;cache&quot;</span>:&#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;ready&quot;</span>,<span class="string">&quot;cache_count&quot;</span>:386,<span class="string">&quot;last_update&quot;</span>:<span class="string">&quot;2025-08-01T14:40:11.540102&quot;</span>,<span class="string">&quot;error_message&quot;</span>:null&#125;,<span class="string">&quot;news_sources&quot;</span>:[&#123;<span class="string">&quot;source&quot;</span>:<span class="string">&quot;openharmony&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;OpenHarmony官网&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;OpenHarmony官方网站最新动态和新闻&quot;</span>,<span class="string">&quot;base_url&quot;</span>:<span class="string">&quot;https://www.openharmony.cn&quot;</span>&#125;,&#123;<span class="string">&quot;source&quot;</span>:<span class="string">&quot;csdn&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;CSDN&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;CSDN平台上关于OpenHarmony的技术文章和资讯&quot;</span>,<span class="string">&quot;base_url&quot;</span>:<span class="string">&quot;https://blog.csdn.net&quot;</span>&#125;]&#125;,<span class="string">&quot;endpoints&quot;</span>:&#123;<span class="string">&quot;openharmony_news&quot;</span>:<span class="string">&quot;/api/news/openharmony&quot;</span>,<span class="string">&quot;csdn_news&quot;</span>:<span class="string">&quot;/api/news/csdn&quot;</span>,<span class="string">&quot;all_news&quot;</span>:<span class="string">&quot;/api/news/&quot;</span>,<span class="string">&quot;manual_crawl&quot;</span>:<span class="string">&quot;/api/news/crawl&quot;</span>,<span class="string">&quot;service_status&quot;</span>:<span class="string">&quot;/api/news/status/info&quot;</span>&#125;&#125;</span><br><span class="line">08-01 17:47:58.239   32053-32053   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  D     StartPage:  <span class="literal">true</span></span><br><span class="line">08-01 17:47:58.239   32053-32053   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  I     StartPage:  服务端准备就绪isServerReady=<span class="literal">true</span></span><br><span class="line">08-01 17:48:00.207   32053-32053   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  D     StartPage:  延时跳转</span><br></pre></td></tr></table></figure>
<p>虽然请求成功了，但我们可以看到的确是存在顺序问题，我们的<code>isServerReady()</code>调用之后被放置到了任务队列中直接向下执行了导致判定标志变量没有正确的赋值。</p>
<p>有两种改法，一种是直接将<code>getAllNews()</code>的调用塞到<code>isServerReady()</code>的<code>then</code>回调函数中，另一种是使用<code>async</code>和<code>await</code>来等待<code>isServerReady()</code>的返回值。</p>
<p>很显然我们要选择后者，否则就是回调地狱的苗头了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">uiPromptAction</span>:<span class="title class_">PromptAction</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">GetUIContext</span>, <span class="variable constant_">GET_UICONTEXT</span>)!.<span class="property">context</span>.<span class="title function_">getPromptAction</span>()</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">aboutToAppear</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">isServerReady</span>:<span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="variable constant_">START_PAGE_TAGE</span>+<span class="string">&#x27;延时跳转&#x27;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">navPathStuck</span>.<span class="title function_">clear</span>()</span><br><span class="line">  &#125;,<span class="number">2000</span>)</span><br><span class="line">  <span class="keyword">await</span> serverHealthApi.<span class="title function_">isServerReady</span>().<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">res</span>:<span class="built_in">boolean</span></span>)=&gt;</span> &#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="variable constant_">START_PAGE_TAGE</span> + res.<span class="title function_">valueOf</span>())</span><br><span class="line">    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">      isServerReady = <span class="literal">true</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">START_PAGE_TAGE</span>+<span class="string">&#x27;服务端准备就绪isServerReady=&#x27;</span>+isServerReady)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      isServerReady = <span class="literal">false</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">START_PAGE_TAGE</span>+<span class="string">&#x27;服务端准备中isServerReady=&#x27;</span>+isServerReady)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (isServerReady)&#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="variable constant_">START_PAGE_TAGE</span>+<span class="string">&#x27;尝试获取全部新闻列表&#x27;</span>)</span><br><span class="line">    newsListApi.<span class="title function_">getAllNews</span>().<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">res</span>:<span class="title class_">NewsArticle</span>[] | <span class="literal">null</span></span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (res === <span class="literal">null</span>) &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="variable constant_">START_PAGE_TAGE</span>+<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">uiPromptAction</span>.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:<span class="string">&#x27;获取新闻列表成功&#x27;</span>,<span class="attr">duration</span>:<span class="number">2000</span>&#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ok，我们只需要等待服务状态检测的API顺利返回值就行，只要服务状态正常，我们就没必要再去继续堵塞线程了，让页面正常跳转就好，哪怕在开屏的两秒里没有顺利获取全部信息，毕竟实际场景可能会有信号波动，我们可以设置一个<strong>是否加载完成的全局状态变量标志符</strong>，来控制骨架屏的显隐。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">08-01 18:01:10.463   39335-39335   A01234/com.xbx...ony/XBXLogger  pid-39335             D     AxiosHttp:  进入AxiosHttp.request</span><br><span class="line">08-01 18:01:10.522   39335-39335   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  W     AxiosHttp:  Req Success&#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;healthy&quot;</span>,<span class="string">&quot;timestamp&quot;</span>:1754042470.472609,<span class="string">&quot;version&quot;</span>:<span class="string">&quot;1.0.0&quot;</span>,<span class="string">&quot;services&quot;</span>:&#123;<span class="string">&quot;cache&quot;</span>:&#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;ready&quot;</span>,<span class="string">&quot;cache_count&quot;</span>:386,<span class="string">&quot;last_update&quot;</span>:<span class="string">&quot;2025-08-01T14:40:11.540102&quot;</span>,<span class="string">&quot;error_message&quot;</span>:null&#125;,<span class="string">&quot;news_sources&quot;</span>:[&#123;<span class="string">&quot;source&quot;</span>:<span class="string">&quot;openharmony&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;OpenHarmony官网&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;OpenHarmony官方网站最新动态和新闻&quot;</span>,<span class="string">&quot;base_url&quot;</span>:<span class="string">&quot;https://www.openharmony.cn&quot;</span>&#125;,&#123;<span class="string">&quot;source&quot;</span>:<span class="string">&quot;csdn&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;CSDN&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;CSDN平台上关于OpenHarmony的技术文章和资讯&quot;</span>,<span class="string">&quot;base_url&quot;</span>:<span class="string">&quot;https://blog.csdn.net&quot;</span>&#125;]&#125;,<span class="string">&quot;endpoints&quot;</span>:&#123;<span class="string">&quot;openharmony_news&quot;</span>:<span class="string">&quot;/api/news/openharmony&quot;</span>,<span class="string">&quot;csdn_news&quot;</span>:<span class="string">&quot;/api/news/csdn&quot;</span>,<span class="string">&quot;all_news&quot;</span>:<span class="string">&quot;/api/news/&quot;</span>,<span class="string">&quot;manual_crawl&quot;</span>:<span class="string">&quot;/api/news/crawl&quot;</span>,<span class="string">&quot;service_status&quot;</span>:<span class="string">&quot;/api/news/status/info&quot;</span>&#125;&#125;</span><br><span class="line">08-01 18:01:10.522   39335-39335   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  I     ServerHealthAPI: &#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;healthy&quot;</span>,<span class="string">&quot;timestamp&quot;</span>:1754042470.472609,<span class="string">&quot;version&quot;</span>:<span class="string">&quot;1.0.0&quot;</span>,<span class="string">&quot;services&quot;</span>:&#123;<span class="string">&quot;cache&quot;</span>:&#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;ready&quot;</span>,<span class="string">&quot;cache_count&quot;</span>:386,<span class="string">&quot;last_update&quot;</span>:<span class="string">&quot;2025-08-01T14:40:11.540102&quot;</span>,<span class="string">&quot;error_message&quot;</span>:null&#125;,<span class="string">&quot;news_sources&quot;</span>:[&#123;<span class="string">&quot;source&quot;</span>:<span class="string">&quot;openharmony&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;OpenHarmony官网&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;OpenHarmony官方网站最新动态和新闻&quot;</span>,<span class="string">&quot;base_url&quot;</span>:<span class="string">&quot;https://www.openharmony.cn&quot;</span>&#125;,&#123;<span class="string">&quot;source&quot;</span>:<span class="string">&quot;csdn&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;CSDN&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;CSDN平台上关于OpenHarmony的技术文章和资讯&quot;</span>,<span class="string">&quot;base_url&quot;</span>:<span class="string">&quot;https://blog.csdn.net&quot;</span>&#125;]&#125;,<span class="string">&quot;endpoints&quot;</span>:&#123;<span class="string">&quot;openharmony_news&quot;</span>:<span class="string">&quot;/api/news/openharmony&quot;</span>,<span class="string">&quot;csdn_news&quot;</span>:<span class="string">&quot;/api/news/csdn&quot;</span>,<span class="string">&quot;all_news&quot;</span>:<span class="string">&quot;/api/news/&quot;</span>,<span class="string">&quot;manual_crawl&quot;</span>:<span class="string">&quot;/api/news/crawl&quot;</span>,<span class="string">&quot;service_status&quot;</span>:<span class="string">&quot;/api/news/status/info&quot;</span>&#125;&#125;</span><br><span class="line">08-01 18:01:10.522   39335-39335   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  D     StartPage:  <span class="literal">true</span></span><br><span class="line">08-01 18:01:10.522   39335-39335   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  I     StartPage:  服务端准备就绪isServerReady=<span class="literal">true</span></span><br><span class="line">08-01 18:01:10.522   39335-39335   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  D     StartPage:  尝试获取全部新闻列表</span><br><span class="line">08-01 18:01:10.522   39335-39335   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  D     NewsListAPI: 进入getAllNews</span><br><span class="line">08-01 18:01:10.522   39335-39335   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  D     AxiosHttp:  进入AxiosHttp.request</span><br><span class="line">08-01 18:01:10.919   39335-39335   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  W     AxiosHttp:  Req Success&#123;<span class="string">&quot;articles&quot;</span>:[&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;00d1196eb553e2e0&quot;</span>,<span class="string">&quot;title&quot;</span>:<span class="string">&quot;对话OpenHarmony开源先锋：如何用代码革新终端生态&quot;</span>,<span class="string">&quot;date&quot;</span>:<span class="string">&quot;2025.02.28&quot;</span>,<span class="string">&quot;url&quot;</span>:<span class="string">&quot;https://mp.weixin.qq.com/s/cHsMzPTmoYec-_VL6VllBQ&quot;</span>,<span class="string">&quot;content&quot;</span>:[&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;image&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_gif/15QnXdLP7ibT0RCulIUzFZ2cGSMTZ3VHFWEttSQKAePB61zNuqdYPP41JIA6b7hph5Z02wKZ61Ch5rjl5FxLzWw/640?wx_fmt=gif&amp;from=appmsg&quot;</span>&#125;,&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;2025年2月23日，由开放原子开源基金会主办的第二届OpenHarmony创新应用挑战赛决赛路演在北京圆满结束，作为第二届开放原子大赛的重要赛项之一，本届赛事汇聚全球418支团队，产出超过110个创新作品，集中展示了OpenHarmony在应用与游戏开发领域的前沿成果。这些凝聚智慧与协作的参赛作品，不仅在技术层面实现了多项突破，更在商业化应用层面验证了开源生态的无限潜力。赛事不仅彰显了开发者群体的创新活力，也凸显了OpenHarmony作为技术底座的重要价值，为开源技术生态发展注入革新的力量。&quot;</span>&#125;,&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;image&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibRnShrEU2uTRKJQbyziasm8ib3wXuDS7TicltuOnUzHt396f649ICg1WZr7mRSEMRDVX8iawxjdPZVItA/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span>&#125;,&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;当代码与创意在OpenHarmony的数字沃土中生根发芽，我们不禁期待，这些开发者如何用实践诠释开源精神？他们的探索历程又蕴藏着怎样的创新思维？让我们跟随优秀团队，解开技术突破与生态协同的共生密码。&quot;</span>&#125;,&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;OpenHarmony创新应用赛题：让书柜学会“思考”&quot;</span>&#125;,&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;由“新大陆自动识别”团队开发的《智能书导》项目，是基于开源操作系统 OpenHarmony打造的图书馆管理应用，通过融合RFID 技术，实现图书馆管理流程的高效优化。团队开发该方案的初衷是帮助图书馆高效地完成图书借阅、查询等工作，减轻管理员负担，同时希望将技术推广至物流、商超、工厂等更多场景，拓展应用范围。&quot;</span>&#125;,&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;《智能书导》项目通过技术融合创新，深度整合OpenHarmony系统的分布式能力与RFID自动识别技术，利用前者实现图书信息的高效共享，借助后者完成图书的自动识别与数据交互。功能上，该项目集成了快速借还书、精准定位等核心功能，以及今日推荐等辅助功能，全面满足图书馆管理与读者服务需求。应用程序适配OpenHarmony 4.1 Release和5.0.2.50系统，可在多种设备上流畅运行，项目所用硬件也已通过兼容性测评，确保软硬件的无缝集成与高效协同。&quot;</span>&#125;,&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;image&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibRnShrEU2uTRKJQbyziasm8ibOP4I1IZBc61z68ukktnxx6yDW3bALR5RnB3b4BFicTKY4ebec6tlQWw/640?wx_fmt=jpeg&amp;from=appmsg&quot;</span>&#125;,&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;《智能书导》的开发者徐金生表示：“未来团队将把项目核心代码贡献至OpenHarmony主干代码库，推动各模块与性能的提升。同时，计划进一步优化技术瓶颈，拓展项目对更多设备的适配能力。”&quot;</span>&#125;,&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;OpenHarmony创新应用赛题：用技术魔法规划繁琐旅行&quot;</span>&#125;,&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;由“领先风暴队”开发的《出行妈妈》项目，主要是为了解决旅行者在行程规划繁琐、信息整合困难以及个性化需求难以满足三大方面的痛点，提供省时省力的完美行程定制解决方案。该项目填补了OpenHarmony在旅游规�</span></span><br><span class="line"><span class="string">08-01 18:01:10.936   39335-39335   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  I     NewsListAPI: res = &#123;&quot;</span>articles<span class="string">&quot;:[&#123;&quot;</span><span class="built_in">id</span><span class="string">&quot;:&quot;</span>00d1196eb553e2e0<span class="string">&quot;,&quot;</span>title<span class="string">&quot;:&quot;</span>对话OpenHarmony开源先锋：如何用代码革新终端生态<span class="string">&quot;,&quot;</span><span class="built_in">date</span><span class="string">&quot;:&quot;</span>2025.02.28<span class="string">&quot;,&quot;</span>url<span class="string">&quot;:&quot;</span>https://mp.weixin.qq.com/s/cHsMzPTmoYec-_VL6VllBQ<span class="string">&quot;,&quot;</span>content<span class="string">&quot;:[&#123;&quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>image<span class="string">&quot;,&quot;</span>value<span class="string">&quot;:&quot;</span>https://mmbiz.qpic.cn/mmbiz_gif/15QnXdLP7ibT0RCulIUzFZ2cGSMTZ3VHFWEttSQKAePB61zNuqdYPP41JIA6b7hph5Z02wKZ61Ch5rjl5FxLzWw/640?wx_fmt=gif&amp;from=appmsg<span class="string">&quot;&#125;,&#123;&quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>text<span class="string">&quot;,&quot;</span>value<span class="string">&quot;:&quot;</span>2025年2月23日，由开放原子开源基金会主办的第二届OpenHarmony创新应用挑战赛决赛路演在北京圆满结束，作为第二届开放原子大赛的重要赛项之一，本届赛事汇聚全球418支团队，产出超过110个创新作品，集中展示了OpenHarmony在应用与游戏开发领域的前沿成果。这些凝聚智慧与协作的参赛作品，不仅在技术层面实现了多项突破，更在商业化应用层面验证了开源生态的无限潜力。赛事不仅彰显了开发者群体的创新活力，也凸显了OpenHarmony作为技术底座的重要价值，为开源技术生态发展注入革新的力量。<span class="string">&quot;&#125;,&#123;&quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>image<span class="string">&quot;,&quot;</span>value<span class="string">&quot;:&quot;</span>https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibRnShrEU2uTRKJQbyziasm8ib3wXuDS7TicltuOnUzHt396f649ICg1WZr7mRSEMRDVX8iawxjdPZVItA/640?wx_fmt=jpeg&amp;from=appmsg<span class="string">&quot;&#125;,&#123;&quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>text<span class="string">&quot;,&quot;</span>value<span class="string">&quot;:&quot;</span>当代码与创意在OpenHarmony的数字沃土中生根发芽，我们不禁期待，这些开发者如何用实践诠释开源精神？他们的探索历程又蕴藏着怎样的创新思维？让我们跟随优秀团队，解开技术突破与生态协同的共生密码。<span class="string">&quot;&#125;,&#123;&quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>text<span class="string">&quot;,&quot;</span>value<span class="string">&quot;:&quot;</span>OpenHarmony创新应用赛题：让书柜学会“思考”<span class="string">&quot;&#125;,&#123;&quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>text<span class="string">&quot;,&quot;</span>value<span class="string">&quot;:&quot;</span>由“新大陆自动识别”团队开发的《智能书导》项目，是基于开源操作系统 OpenHarmony打造的图书馆管理应用，通过融合RFID 技术，实现图书馆管理流程的高效优化。团队开发该方案的初衷是帮助图书馆高效地完成图书借阅、查询等工作，减轻管理员负担，同时希望将技术推广至物流、商超、工厂等更多场景，拓展应用范围。<span class="string">&quot;&#125;,&#123;&quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>text<span class="string">&quot;,&quot;</span>value<span class="string">&quot;:&quot;</span>《智能书导》项目通过技术融合创新，深度整合OpenHarmony系统的分布式能力与RFID自动识别技术，利用前者实现图书信息的高效共享，借助后者完成图书的自动识别与数据交互。功能上，该项目集成了快速借还书、精准定位等核心功能，以及今日推荐等辅助功能，全面满足图书馆管理与读者服务需求。应用程序适配OpenHarmony 4.1 Release和5.0.2.50系统，可在多种设备上流畅运行，项目所用硬件也已通过兼容性测评，确保软硬件的无缝集成与高效协同。<span class="string">&quot;&#125;,&#123;&quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>image<span class="string">&quot;,&quot;</span>value<span class="string">&quot;:&quot;</span>https://mmbiz.qpic.cn/mmbiz_jpg/15QnXdLP7ibRnShrEU2uTRKJQbyziasm8ibOP4I1IZBc61z68ukktnxx6yDW3bALR5RnB3b4BFicTKY4ebec6tlQWw/640?wx_fmt=jpeg&amp;from=appmsg<span class="string">&quot;&#125;,&#123;&quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>text<span class="string">&quot;,&quot;</span>value<span class="string">&quot;:&quot;</span>《智能书导》的开发者徐金生表示：“未来团队将把项目核心代码贡献至OpenHarmony主干代码库，推动各模块与性能的提升。同时，计划进一步优化技术瓶颈，拓展项目对更多设备的适配能力。”<span class="string">&quot;&#125;,&#123;&quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>text<span class="string">&quot;,&quot;</span>value<span class="string">&quot;:&quot;</span>OpenHarmony创新应用赛题：用技术魔法规划繁琐旅行<span class="string">&quot;&#125;,&#123;&quot;</span><span class="built_in">type</span><span class="string">&quot;:&quot;</span>text<span class="string">&quot;,&quot;</span>value<span class="string">&quot;:&quot;</span>由“领先风暴队”开发的《出行妈妈》项目，主要是为了解决旅行者在行程规划繁琐、信息整合困难以及个性化需求难以满足三大方面的痛点，提供省时省力的完美行程定制解决方案。该项目填补了OpenHarmony在旅游规划�</span><br><span class="line">08-01 18:01:12.464   39335-39335   A01234/com.xbx...ony/XBXLogger  com.xbxyf...nHarmony  D     StartPage:  延时跳转</span><br></pre></td></tr></table></figure>
<p>ok，十分顺利，这次代码的执行顺序就与我们的预期完全一致了。不过我还想到了一种解决加载速度的方式，就是将跳转操作绑定到我们加载完成的<code>then</code>回调函数中，不过这样就会导致每次进入应用的开屏时间都不一致，同时也会出现一旦加载失败应用就会卡死在开屏页面的状态。enm，还是算了吧，仔细想想市面上的APP中也没有说像我这样设计的。</p>
<h3 id="数据库接口"><a href="#数据库接口" class="headerlink" title="数据库接口"></a>数据库接口</h3><p>对于数据库的选取我想的是直接使用键值型数据库即可，因为我的新闻列表整体是属于一个JSON字符串，并不需要进行后续的查询等操作。这也是我第一次使用数据库来进行开发，我先去仿照着官网的代码去进行接口的开发试试。</p>
<p>但很快我就迎来了第一个问题。又是上下文对象的类型问题。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/27.png" alt="27"></p>
<p>这个东西和他搏斗太久了，鸿小易时期就在和这个东西纠缠。我本来想直接使用上面已经存入全局变量中的UIContext就行了结果仔细读了一下文档发现两者并不是同一类型。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/28.png" alt="28"></p>
<p>这个<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-basecontext">BaseContext</a>是一个用来判断当前应用模型的上下文对象。</p>
<p>我只好再去看一看子安学长的代码了。</p>
<p>于是我发现了这一行。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">init</span>(<span class="attr">context</span>: common.<span class="property">BaseContext</span>): <span class="built_in">void</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>于是就有了如下的尝试。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; distributedKVStore &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkData&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/logger/logger&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">KVDatabase</span>_LOG_TAG = <span class="string">&#x27;KVDatabase: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 键值型数据库管理接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">KVDatabase</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 数据库管理对象，应用启动后需要先行创建并进行数据库的创建。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">kvManager</span>: distributedKVStore.<span class="property">KVManager</span> | <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="attr">appId</span>: <span class="built_in">string</span> = <span class="string">&#x27;com.xbxyftx.NowInOpenHarmony&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 创建数据库管理对象KVManager</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> context 当前应用上下文</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 是否成功创建</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">createKVManager</span>(<span class="attr">context</span>: common.<span class="property">BaseContext</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">kvManagerConfig</span>: distributedKVStore.<span class="property">KVManagerConfig</span> = &#123;</span><br><span class="line">      <span class="attr">context</span>: context,</span><br><span class="line">      <span class="attr">bundleName</span>: <span class="variable language_">this</span>.<span class="property">appId</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 创建KVManager实例</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">kvManager</span> = distributedKVStore.<span class="title function_">createKVManager</span>(kvManagerConfig);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="title class_">KVDatabase</span>_LOG_TAG + <span class="string">&#x27;Succeeded in creating KVManager.&#x27;</span>);</span><br><span class="line">      <span class="comment">// 继续创建获取数据库</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">kvManager</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="title class_">KVDatabase</span>_LOG_TAG+<span class="string">&#x27;数据库管理对象创建成功。&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="title class_">KVDatabase</span>_LOG_TAG + <span class="string">&#x27;数据库管理对象创建失败&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">let</span> error = e <span class="keyword">as</span> <span class="title class_">BusinessError</span>;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="title class_">KVDatabase</span>_LOG_TAG + <span class="string">`Failed to create KVManager. Code:<span class="subst">$&#123;error.code&#125;</span>,message:<span class="subst">$&#123;error.message&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">kvDatabase</span>: <span class="title class_">KVDatabase</span> = <span class="keyword">new</span> <span class="title class_">KVDatabase</span>()</span><br></pre></td></tr></table></figure>
<p>先真机测试一下这个创建过程，以及反复启动应用是否会出现问题。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/29.png" alt="29"></p>
<p>创建成功。不过这也是有个新问题。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/30.png" alt="30"></p>
<p>我们可以看到我们所需要的参数类型是<code>BaseContext</code>但是我们所传入的却是<code>UIAbilityContext</code>类型。我又将函数定义的类型进行了一下修改进行尝试。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改前</span></span><br><span class="line"><span class="title function_">createKVManager</span>(<span class="attr">context</span>: common.<span class="property">BaseContext</span>)</span><br><span class="line"><span class="comment">//修改后</span></span><br><span class="line"><span class="title function_">createKVManager</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>)</span><br></pre></td></tr></table></figure>
<p>经测试运行依旧正常，数据库管理对象依旧是正常的去创建了，对此我第一个想到的就是多态，这几个类型之间是存在集成的子父代关系的，与此同时<code>BaseContext</code>、<code>Context</code>、<code>UIAbilityContext</code>这几个命名也是基于<code>context</code>这个单次去进行修饰词的添加的。让我们来读一下源码证实我的想法。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/31.png" alt="31"></p>
<p><img src="/2025/06/29/OpenSourceSummer2025/32.png" alt="32"></p>
<p>ok，源码完美的验证了我的想法<code>BaseContext</code>的的确确是另外两个的上下文对象的父类，而且其仅仅包含了应用模型类型这一个信息。我们传递的参数是<code>BaseContext</code>类型说明其仅需要应用框架类型这一个信息，而<code>UIAbilityContext</code>是<code>BaseContext</code>的子类，同样包含了这个信息，所以我们可以直接将<code>UIAbilityContext</code>类型的参数传递给<code>createKVManager</code>函数，这就实现了多态。</p>
<div class="note success flat"><p>关于这一块我后面又去寻找了一下相关的文档说明，也是找到了专门解释这一块的文档。<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8Bcontext%E7%9A%84%E7%BB%A7%E6%89%BF%E5%92%8C%E6%8C%81%E6%9C%89%E5%85%B3%E7%B3%BB">传送门</a></p>
<p><img src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20250822155516.57232657365788405215170185352656:50001231000000:2800:BF79EFDD4AAA5620DCD6B96CC760D9FECC2247D36B77809280AE796390B43673.png" alt="alt text"><br><img src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20250822155516.41713918890506122165673003330164:50001231000000:2800:607839D596540E0B7FFBC58D6794F403B8FBDAB34632F1390F1C13E04316195D.png" alt="alt text"></p>
</div>
<h3 id="用户首选项接口"><a href="#用户首选项接口" class="headerlink" title="用户首选项接口"></a>用户首选项接口</h3><p>我们需要将用户的配置和新闻数据进行分开的存储，由于用户的配置设置属于是很小的数据量，所以我们就依照官方的推荐去进行存储。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; preferences &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkData&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&#x27;../../utils&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PreferenceDB</span>_LOG_TAG = <span class="string">&#x27;PreferenceDB: &#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户首选项数据持久化接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PreferenceDB</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">dataPreference</span>: preferences.<span class="property">Preferences</span> | <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="attr">context</span>: common.<span class="property">BaseContext</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">option</span>: preferences.<span class="property">Options</span> = &#123; <span class="attr">name</span>: <span class="string">&#x27;jyt&#x27;</span> &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataPreference</span> = preferences.<span class="title function_">getPreferencesSync</span>(context, option);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataPreference</span>.<span class="title function_">on</span>(<span class="string">&quot;change&quot;</span>, <span class="function">(<span class="params"><span class="attr">key</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;PreferenceDB_LOG_TAG&#125;</span>The key <span class="subst">$&#123;key&#125;</span> changed`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">release</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dataPreference</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dataPreference</span>.<span class="title function_">off</span>(<span class="string">&quot;change&quot;</span>, <span class="function">(<span class="params"><span class="attr">key</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;PreferenceDB_LOG_TAG&#125;</span>UnSubscribe the key <span class="subst">$&#123;key&#125;</span>`</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">hasData</span>(<span class="attr">key</span>: <span class="built_in">string</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dataPreference</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">dataExist</span>: <span class="built_in">boolean</span> = <span class="variable language_">this</span>.<span class="property">dataPreference</span>.<span class="title function_">hasSync</span>(key);</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;PreferenceDB_LOG_TAG&#125;</span>Has <span class="subst">$&#123;key&#125;</span> data: <span class="subst">$&#123;dataExist&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span> dataExist;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">pushData</span>(<span class="attr">key</span>: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="title class_">Object</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dataPreference</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dataPreference</span>.<span class="title function_">putSync</span>(key, value);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dataPreference</span>.<span class="title function_">flush</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">deleteData</span>(<span class="attr">key</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dataPreference</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dataPreference</span>.<span class="title function_">deleteSync</span>(key);</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;PreferenceDB_LOG_TAG&#125;</span>Delete data <span class="subst">$&#123;key&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getData</span>(<span class="attr">key</span>: <span class="built_in">string</span>): <span class="built_in">object</span> | <span class="literal">null</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dataPreference</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">obj</span>: preferences.<span class="property">ValueType</span> = <span class="variable language_">this</span>.<span class="property">dataPreference</span>.<span class="title function_">getSync</span>(key, <span class="string">&#x27;default&#x27;</span>);</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;PreferenceDB_LOG_TAG&#125;</span>Get data <span class="subst">$&#123;key&#125;</span> <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(obj)&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span> obj <span class="keyword">as</span> <span class="built_in">object</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">preferenceDB</span>: <span class="title class_">PreferenceDB</span> = <span class="keyword">new</span> <span class="title class_">PreferenceDB</span>();</span><br></pre></td></tr></table></figure>
<p>直接将数据的增删改查封装成一个类，同时对基础的系统接口进行包装，直接将数据的持久化过程利用防御性编程进行封装，以符合业务需求。</p>
<p>随后的话，在应用运行期间的状态始终是要用全局变量的一个包装包装着，但是在进行数据持久化的过程中时我们还是需要去分字段的去进行存储的，这样才方便与管理。为此我的方案是设置一个枚举类型来管理持久化键值字段，与此同时设置一个数据模型并进行数据变化的追踪，用于设置全局变量，并在跟页面设置监听器，一旦出现变化就及时去进行数据的持久化。同时为了方式应用被直接杀死进程的退出，所以我们还需要在生命周期的<code>onDestroy</code>方法中去进行数据的持久化。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">Preference</span> &#123;</span><br><span class="line">  <span class="variable constant_">COLOR_MODE</span> = <span class="string">&#x27;ColorMode&#x27;</span>,</span><br><span class="line">  <span class="variable constant_">FONT_SIZE</span> = <span class="string">&#x27;FontSize&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户设置项</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ObservedV2</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UserConfigViewModel</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 深浅色模式</span></span><br><span class="line"><span class="comment">   * 0 浅色模式</span></span><br><span class="line"><span class="comment">   * 1 深色模式</span></span><br><span class="line"><span class="comment">   * 2 跟随系统</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">colorModel</span>: <span class="number">0</span> | <span class="number">1</span> | <span class="number">2</span> = <span class="number">2</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 文章字体大小</span></span><br><span class="line"><span class="comment">   * 合理取值区间12-24</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">fontSize</span>: <span class="built_in">number</span> = <span class="number">16</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用这套模式在开发时我也是又遇到了新的类型问题，也就是显示数据模型和我所提供的首选项数据接口的类型不一致问题。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/33.png" alt="27"></p>
<p>于是我考虑的是直接将接口的返回值类型给修改为泛型接口，并用trycatch包裹来去处理可能发生的异常。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">getData&lt;T&gt;(<span class="attr">key</span>: <span class="built_in">string</span>): T | <span class="literal">null</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dataPreference</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">obj</span>: preferences.<span class="property">ValueType</span> = <span class="variable language_">this</span>.<span class="property">dataPreference</span>.<span class="title function_">getSync</span>(key, <span class="string">&#x27;default&#x27;</span>);</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;PreferenceDB_LOG_TAG&#125;</span>Get data <span class="subst">$&#123;key&#125;</span> <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(obj)&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span> obj <span class="keyword">as</span> T;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;<span class="keyword">catch</span> (e)&#123;</span><br><span class="line">    promptAction.<span class="title function_">openToast</span>(&#123;<span class="attr">message</span>:<span class="string">`<span class="subst">$&#123;PreferenceDB_LOG_TAG&#125;</span>获取数据异常，异常信息为<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(e)&#125;</span>`</span>&#125;)</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;PreferenceDB_LOG_TAG&#125;</span>获取数据异常，异常信息为<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(e)&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="应用初始化接口"><a href="#应用初始化接口" class="headerlink" title="应用初始化接口"></a>应用初始化接口</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">DEFAULT_COLOR_MODE</span>,</span><br><span class="line">  <span class="variable constant_">DEFAULT_FONT_SIZE</span>,</span><br><span class="line">  <span class="variable constant_">GET_USER_CONFIG</span>,</span><br><span class="line">  logger,</span><br><span class="line">  preferenceDB,</span><br><span class="line">  <span class="title class_">PreferenceEnum</span>,</span><br><span class="line">  <span class="title class_">UserConfigViewModel</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.AbilityKit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span>, promptAction &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AppInit</span>_LOG_TAG = <span class="string">&#x27;AppInit: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 应用初始化接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppInit</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用户配置项初始化</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">configInit</span>(<span class="params"><span class="attr">context</span>: common.<span class="title class_">UIAbilityContext</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">isPreferenceDBInitSuccess</span>: <span class="built_in">boolean</span> = preferenceDB.<span class="title function_">init</span>(context)</span><br><span class="line">    <span class="keyword">if</span> (isPreferenceDBInitSuccess) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>用户首选项初始化成功`</span>)</span><br><span class="line">      <span class="keyword">if</span> (preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>)) &#123;</span><br><span class="line">        <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> =</span><br><span class="line">          preferenceDB.<span class="property">getData</span>&lt;<span class="number">0</span> | <span class="number">1</span> | <span class="number">2</span>&gt;(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>)!</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>)) &#123;</span><br><span class="line">        <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">fontSize</span> =</span><br><span class="line">          preferenceDB.<span class="property">getData</span>&lt;<span class="built_in">number</span>&gt;(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>)!</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>) || !preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setConfigToDefault</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      promptAction.<span class="title function_">openToast</span>(&#123; <span class="attr">message</span>: <span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>用户首选项初始化错误`</span> &#125;)</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>用户首选项初始化错误`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setConfigToDefault</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>)) &#123;</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> =</span><br><span class="line">        <span class="variable constant_">DEFAULT_COLOR_MODE</span></span><br><span class="line">      preferenceDB.<span class="title function_">pushData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>, <span class="variable constant_">DEFAULT_COLOR_MODE</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>)) &#123;</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> =</span><br><span class="line">        <span class="variable constant_">DEFAULT_COLOR_MODE</span></span><br><span class="line">      preferenceDB.<span class="title function_">pushData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>, <span class="variable constant_">DEFAULT_FONT_SIZE</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> appInit = <span class="keyword">new</span> <span class="title class_">AppInit</span>()</span><br></pre></td></tr></table></figure>
<p>在应用的启动阶段调用这个初始化接口去进行持久化数据的读取或是默认数据的设置。</p>
<p>但我认为这个代码其实应该将功能再次拆解，将持久化数据以及应用状态的交互拆分出来放在特性层中进行封装，因为我们还需要数据同步接口。</p>
<h4 id="数据管理器封装"><a href="#数据管理器封装" class="headerlink" title="数据管理器封装"></a>数据管理器封装</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">DEFAULT_COLOR_MODE</span>,</span><br><span class="line">  <span class="variable constant_">DEFAULT_FONT_SIZE</span>,</span><br><span class="line">  <span class="variable constant_">GET_USER_CONFIG</span>,</span><br><span class="line">  logger,</span><br><span class="line">  preferenceDB,</span><br><span class="line">  <span class="title class_">PreferenceEnum</span>,</span><br><span class="line">  <span class="title class_">UserConfigViewModel</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span>, promptAction &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UserConfigManager</span>_LOG_TAG = <span class="string">&#x27;UserConfigManager: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户配置项管理器，提供全局变量和持久化数据之间的交互接口。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UserConfigManager</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 持久化当前应用配置数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 是否成功</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">syncDataToPreference</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">UserConfig</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!</span><br><span class="line">    <span class="keyword">const</span> colorMode = <span class="title class_">UserConfig</span>.<span class="property">colorModel</span></span><br><span class="line">    preferenceDB.<span class="title function_">pushData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>, colorMode)</span><br><span class="line">    <span class="keyword">const</span> fontSize = <span class="title class_">UserConfig</span>.<span class="property">fontSize</span></span><br><span class="line">    preferenceDB.<span class="title function_">pushData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>, fontSize)</span><br><span class="line">    <span class="keyword">if</span> (preferenceDB.<span class="property">getData</span>&lt;<span class="number">0</span> | <span class="number">1</span> | <span class="number">2</span>&gt;(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>) === colorMode &amp;&amp;</span><br><span class="line">      preferenceDB.<span class="property">getData</span>&lt;<span class="built_in">number</span>&gt;(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>) === fontSize) &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>数据持久化成功,colorMode=<span class="subst">$&#123;preferenceDB.getData&lt;<span class="number">0</span> | <span class="number">1</span> | <span class="number">2</span>&gt;(PreferenceEnum.COLOR_MODE)&#125;</span>,fontSize=<span class="subst">$&#123;preferenceDB.getData&lt;<span class="built_in">number</span>&gt;(PreferenceEnum.FONT_SIZE)&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取应用配置持久化数据,若无持久化数据则设置默认数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 是否成功</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">syncDataToAppStorage</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">UserConfig</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!</span><br><span class="line">    <span class="keyword">if</span> (preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>)) &#123;</span><br><span class="line">      <span class="title class_">UserConfig</span>.<span class="property">colorModel</span> = preferenceDB.<span class="property">getData</span>&lt;<span class="number">0</span> | <span class="number">1</span> | <span class="number">2</span>&gt;(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>)!</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>)) &#123;</span><br><span class="line">      <span class="title class_">UserConfig</span>.<span class="property">fontSize</span> = preferenceDB.<span class="property">getData</span>&lt;<span class="built_in">number</span>&gt;(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>)!</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>) || !preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>)) &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>无用户配置持久化数据，执行默认配置设置`</span>)</span><br><span class="line">      promptAction.<span class="title function_">openToast</span>(&#123;<span class="attr">message</span>:<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>无用户配置持久化数据，执行默认配置设置`</span>&#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setConfigToDefault</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> fontSize = <span class="title class_">UserConfig</span>.<span class="property">fontSize</span></span><br><span class="line">    <span class="keyword">const</span> colorMode = <span class="title class_">UserConfig</span>.<span class="property">colorModel</span></span><br><span class="line">    <span class="keyword">if</span> (preferenceDB.<span class="property">getData</span>&lt;<span class="number">0</span> | <span class="number">1</span> | <span class="number">2</span>&gt;(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>) === colorMode &amp;&amp;</span><br><span class="line">      preferenceDB.<span class="property">getData</span>&lt;<span class="built_in">number</span>&gt;(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>) === fontSize) &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>用户首选项持久化数据读取成功,colorMode=<span class="subst">$&#123;colorMode&#125;</span>,fontSize=<span class="subst">$&#123;fontSize&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>用户首选项持久化数据获取发生异常`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 将全局状态变量以及持久化数据更改为默认状态</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">setConfigToDefault</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>)) &#123;</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> =</span><br><span class="line">        <span class="variable constant_">DEFAULT_COLOR_MODE</span></span><br><span class="line">      preferenceDB.<span class="title function_">pushData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>, <span class="variable constant_">DEFAULT_COLOR_MODE</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>)) &#123;</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> =</span><br><span class="line">        <span class="variable constant_">DEFAULT_COLOR_MODE</span></span><br><span class="line">      preferenceDB.<span class="title function_">pushData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>, <span class="variable constant_">DEFAULT_FONT_SIZE</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userConfigManager = <span class="keyword">new</span> <span class="title class_">UserConfigManager</span>()</span><br></pre></td></tr></table></figure>
<h4 id="配置初始化接口更新"><a href="#配置初始化接口更新" class="headerlink" title="配置初始化接口更新"></a>配置初始化接口更新</h4><p>在封装完了数据管理器之后我们就可以对应用初始化包中的应用配置初识化进行简化。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">DEFAULT_COLOR_MODE</span>,</span><br><span class="line">  <span class="variable constant_">DEFAULT_FONT_SIZE</span>,</span><br><span class="line">  <span class="variable constant_">GET_USER_CONFIG</span>,</span><br><span class="line">  logger,</span><br><span class="line">  preferenceDB,</span><br><span class="line">  <span class="title class_">PreferenceEnum</span>,</span><br><span class="line">  <span class="title class_">UserConfigViewModel</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.AbilityKit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span>, promptAction &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; userConfigManager &#125; <span class="keyword">from</span> <span class="string">&quot;feature&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AppInit</span>_LOG_TAG = <span class="string">&#x27;AppInit: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 应用初始化接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppInit</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用户配置项初始化</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">configInit</span>(<span class="params"><span class="attr">context</span>: common.<span class="title class_">UIAbilityContext</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">isPreferenceDBInitSuccess</span>: <span class="built_in">boolean</span> = preferenceDB.<span class="title function_">init</span>(context)</span><br><span class="line">    <span class="keyword">if</span> (isPreferenceDBInitSuccess) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>首选项数据对象初始化成功`</span>)</span><br><span class="line">      <span class="keyword">if</span>(userConfigManager.<span class="title function_">syncDataToAppStorage</span>())&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      promptAction.<span class="title function_">openToast</span>(&#123; <span class="attr">message</span>: <span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>首选项数据对象初始化错误`</span> &#125;)</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>首选项数据对象初始化错误`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> appInit = <span class="keyword">new</span> <span class="title class_">AppInit</span>()</span><br></pre></td></tr></table></figure>
<p>随后在应用构建的生命周期函数中调用。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onCreate</span>(<span class="attr">want</span>: <span class="title class_">Want</span>, <span class="attr">launchParam</span>: <span class="title class_">AbilityConstant</span>.<span class="property">LaunchParam</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">getApplicationContext</span>().<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_NOT_SET</span>);</span><br><span class="line">  hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onCreate&#x27;</span>);</span><br><span class="line">  kvDatabase.<span class="title function_">init</span>(<span class="variable language_">this</span>.<span class="property">context</span>)</span><br><span class="line">  appInit.<span class="title function_">configInit</span>(<span class="variable language_">this</span>.<span class="property">context</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到这里面的数据库初识化还是直接调用的，我们后面也要将他封装进<code>appInit</code>对象中。现在先用真机运行一下进行测试。如果能正常打印出用户首选项相关的日志信息就说明我们上面封装的首选项接口都没有问题。</p>
<h4 id="资源未初始化问题的解决"><a href="#资源未初始化问题的解决" class="headerlink" title="资源未初始化问题的解决"></a>资源未初始化问题的解决</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Module name:com.xbxyftx.NowInOpenHarmony</span><br><span class="line">Version:1.0.0</span><br><span class="line">VersionCode:1000000</span><br><span class="line">PreInstalled:No</span><br><span class="line">Foreground:Yes</span><br><span class="line">Pid:14414</span><br><span class="line">Uid:20020052</span><br><span class="line">Reason:TypeError</span><br><span class="line">Error name:TypeError</span><br><span class="line">Error message:is not callable</span><br><span class="line">Stacktrace:</span><br><span class="line">SourceMap is not initialized yet </span><br><span class="line">    at syncDataToAppStorage (feature|feature|1.0.0|src/main/ets/api/UserConfig.ts:40:13)</span><br><span class="line">    at configInit (default|default|1.0.0|src/main/ets/init/AppInit.ts:17:17)</span><br><span class="line">    at onCreate (default|default|1.0.0|src/main/ets/entryability/EntryAbility.ts:15:9)</span><br></pre></td></tr></table></figure>
<p>enm，报错了，包的是未初始化的错。我们再来看一下日志断在了什么位置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Callee constructor is OK string</span><br><span class="line">Ability::constructor callee is object [object Object]</span><br><span class="line">Ability onCreate</span><br><span class="line">KVDatabase: Succeeded <span class="keyword">in</span> creating KVManager.</span><br><span class="line">KVDatabase: 数据库管理对象创建成功。</span><br><span class="line">AppInit: 首选项数据对象初始化成功</span><br><span class="line">PreferenceDB: Has ColorMode data: <span class="literal">false</span></span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">false</span></span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">false</span></span><br><span class="line">UserConfigManager: 无用户配置持久化数据，执行默认配置设置</span><br></pre></td></tr></table></figure>
<p>成功检测了第一次安装并没有持久化数据，然后开始去检查是否存在无配置的数据，发现字体没有就开始去设置默认值。我们的默认值设置函数并没有设置日志，让我们添加一些日志来进行进一步排查。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将全局状态变量以及持久化数据更改为默认状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">setConfigToDefault</span>(<span class="params"></span>) &#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>开始尝试默认设置写入`</span>)</span><br><span class="line">  <span class="keyword">if</span> (preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>)) &#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>preferenceDB.hasData(PreferenceEnum.COLOR_MODE)=<span class="subst">$&#123;preferenceDB.hasData(PreferenceEnum.COLOR_MODE)&#125;</span>`</span>)</span><br><span class="line">    <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> =</span><br><span class="line">      <span class="variable constant_">DEFAULT_COLOR_MODE</span></span><br><span class="line">    preferenceDB.<span class="title function_">pushData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>, <span class="variable constant_">DEFAULT_COLOR_MODE</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>)) &#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>preferenceDB.hasData(PreferenceEnum.FONT_SIZE)=<span class="subst">$&#123;preferenceDB.hasData(PreferenceEnum.FONT_SIZE)&#125;</span>`</span>)</span><br><span class="line">    <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> =</span><br><span class="line">      <span class="variable constant_">DEFAULT_COLOR_MODE</span></span><br><span class="line">    preferenceDB.<span class="title function_">pushData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>, <span class="variable constant_">DEFAULT_FONT_SIZE</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/29/OpenSourceSummer2025/34.png" alt="34"></p>
<p>添加日志后发现了我最没想到的问题，整个函数压根就没有进入？？？这可怎么办呢，我们再仔细排查一下。</p>
<p>我尝试了将可疑的耗时点都加上了异步await，但是发现程序确实是会跳过问题点继续运行了，但是问题没有解决，依旧没有后续日志。这时我想起来之前写数据持久化文章时看到的同步和异步flush，所以我决定先去改用同步接口试试。</p>
<p>现象没变化，还是没走到这一步。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">pushData</span>(<span class="attr">key</span>: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="title class_">Object</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dataPreference</span>) &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;PreferenceDB_LOG_TAG&#125;</span>key=<span class="subst">$&#123;key&#125;</span>,value=<span class="subst">$&#123;value&#125;</span>`</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataPreference</span>.<span class="title function_">putSync</span>(key, value);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataPreference</span>.<span class="title function_">flushSync</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再加上一行日志试试。</p>
<p>还是没区别，依旧没走到那行。到这基本上我已经可以确定是我寻找的方向错了。从新审视一下这个问题。</p>
<p>从最后一行日志到函数调用之前仅有两行代码，既然前面已经证明了我的首选项接口没有问题，那我就只能怀疑是这个弹窗的问题了。仔细回想一下应用的构建流程，在<code>onCreate</code>生命周期中，我们并没有进行窗口的构建，仅仅是做一些数据上的准备，也就是说这段时间我们的UIContext是还没有被初始化的，虽然我已经从由Promptaction实例对象调用改为了直接调用openToast，但这个弹窗也是要和窗口的事例对象进行绑定的，我既然还没有初始化我的窗口界面，也就没有UI上下文对象，此时我去调用弹窗接口确实就是可能会发生未初始化的情况。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>) || !preferenceDB.<span class="title function_">hasData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>)) &#123;</span><br><span class="line">  logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>无用户配置持久化数据，执行默认配置设置`</span>)</span><br><span class="line">  <span class="comment">// promptAction.openToast(&#123; message: `$&#123;UserConfigManager_LOG_TAG&#125;无用户配置持久化数据，执行默认配置设置` &#125;)</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setConfigToDefault</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先将这一行暂时注释掉。再次运行。</p>
<p>我死死盯着手机，它终于是没有闪退了，赶紧查看一下日志。后续的日志都出来了，总算是正确了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">AppInit: 首选项数据对象初始化成功</span><br><span class="line">PreferenceDB: Has ColorMode data: <span class="literal">false</span></span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">false</span></span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">false</span></span><br><span class="line">UserConfigManager: 无用户配置持久化数据，执行默认配置设置</span><br><span class="line">UserConfigManager: 开始尝试默认设置写入</span><br><span class="line">PreferenceDB: Has ColorMode data: <span class="literal">false</span></span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">false</span></span><br><span class="line">PreferenceDB: Get data ColorMode <span class="string">&quot;default&quot;</span></span><br><span class="line">UserConfigManager: 用户首选项持久化数据获取发生异常</span><br></pre></td></tr></table></figure>
<p>随后的这一抹红色也是吓了我一跳，但我很快就反应过来了，原来是我的逻辑还有问题，当前我是先去判断其存在再去写入默认值，这就说明我没有考虑第一次的问题。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将全局状态变量以及持久化数据更改为默认状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">setConfigToDefault</span>(<span class="params"></span>) &#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>开始尝试默认设置写入`</span>)</span><br><span class="line"></span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>preferenceDB.hasData(PreferenceEnum.COLOR_MODE)=<span class="subst">$&#123;preferenceDB.hasData(PreferenceEnum.COLOR_MODE)&#125;</span>`</span>)</span><br><span class="line">  <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> =</span><br><span class="line">    <span class="variable constant_">DEFAULT_COLOR_MODE</span></span><br><span class="line">  preferenceDB.<span class="title function_">pushData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">COLOR_MODE</span>, <span class="variable constant_">DEFAULT_COLOR_MODE</span>)</span><br><span class="line"></span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="string">`<span class="subst">$&#123;UserConfigManager_LOG_TAG&#125;</span>preferenceDB.hasData(PreferenceEnum.FONT_SIZE)=<span class="subst">$&#123;preferenceDB.hasData(PreferenceEnum.FONT_SIZE)&#125;</span>`</span>)</span><br><span class="line">  <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> =</span><br><span class="line">    <span class="variable constant_">DEFAULT_COLOR_MODE</span></span><br><span class="line">  preferenceDB.<span class="title function_">pushData</span>(<span class="title class_">PreferenceEnum</span>.<span class="property">FONT_SIZE</span>, <span class="variable constant_">DEFAULT_FONT_SIZE</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从新运行尝试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">AppInit: 首选项数据对象初始化成功</span><br><span class="line">PreferenceDB: Has ColorMode data: <span class="literal">false</span></span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">false</span></span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">false</span></span><br><span class="line">UserConfigManager: 无用户配置持久化数据，执行默认配置设置</span><br><span class="line">UserConfigManager: 开始尝试默认设置写入</span><br><span class="line">PreferenceDB: Has ColorMode data: <span class="literal">false</span></span><br><span class="line">UserConfigManager: preferenceDB.hasData(PreferenceEnum.COLOR_MODE)=<span class="literal">false</span></span><br><span class="line">PreferenceDB: key=ColorMode,value=2</span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">false</span></span><br><span class="line">UserConfigManager: preferenceDB.hasData(PreferenceEnum.FONT_SIZE)=<span class="literal">false</span></span><br><span class="line">PreferenceDB: key=FontSize,value=16</span><br><span class="line">PreferenceDB: Get data ColorMode: 2</span><br><span class="line">PreferenceDB: Get data FontSize: 16</span><br><span class="line">UserConfigManager: 用户首选项持久化数据读取成功,colorMode=2,fontSize=16</span><br><span class="line">Ability onWindowStageCreate</span><br><span class="line">Ability onForeground</span><br><span class="line">PreferenceDB: The key ColorMode changed</span><br><span class="line">Succeeded <span class="keyword">in</span> loading the content.</span><br><span class="line">PreferenceDB: The key FontSize changed</span><br></pre></td></tr></table></figure>
<p>nb，终于成功了。修改成功了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AppInit: 首选项数据对象初始化成功</span><br><span class="line">PreferenceDB: Has ColorMode data: <span class="literal">true</span></span><br><span class="line">PreferenceDB: Has ColorMode data: <span class="literal">true</span></span><br><span class="line">UserConfigManager: 检测到COLOR_MODE=<span class="literal">true</span></span><br><span class="line">PreferenceDB: Get data ColorMode: 2</span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">true</span></span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">true</span></span><br><span class="line">UserConfigManager: 检测到FONT_SIZE=<span class="literal">true</span></span><br><span class="line">PreferenceDB: Get data FontSize: 16</span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">true</span></span><br><span class="line">PreferenceDB: Has ColorMode data: <span class="literal">true</span></span><br><span class="line">PreferenceDB: Get data ColorMode: 2</span><br><span class="line">PreferenceDB: Get data FontSize: 16</span><br><span class="line">UserConfigManager: 用户首选项持久化数据读取成功,colorMode=2,fontSize=16</span><br></pre></td></tr></table></figure>
<p>ok！第二次启动也是成功读取到了上一次所持久化的数据！大成功啦！</p>
<h3 id="深浅色切换工具"><a href="#深浅色切换工具" class="headerlink" title="深浅色切换工具"></a>深浅色切换工具</h3><p>接下来我们趁热打铁，将用户配置数据和深浅色切换工具相结合，让深浅色切换真正的与应用状态绑定。</p>
<p>首先先去官网查看一下主动切换深浅色的<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ui-dark-light-color-adaptation#%E5%BA%94%E7%94%A8%E4%B8%BB%E5%8A%A8%E8%AE%BE%E7%BD%AE%E6%B7%B1%E6%B5%85%E8%89%B2%E6%A8%A1%E5%BC%8F">指南文档</a>。</p>
<p>在看了指南文档后我就确认了，就是现在API18应用创建后基础代码中就包含了的那个方法。所以深浅色工具的封装逻辑就很简单了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; common, <span class="title class_">ConfigurationConstant</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.AbilityKit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DEFAULT_COLOR_MODE</span>, <span class="variable constant_">GET_USER_CONFIG</span>, logger, <span class="title class_">UserConfigViewModel</span> &#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; userConfigManager &#125; <span class="keyword">from</span> <span class="string">&quot;./UserConfigManager&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ColorModManager</span>_LOG_TAG = <span class="string">&#x27;ColorModManager: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 颜色模式管理器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ColorModManager</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 应用上下文对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">applicationContext</span>: common.<span class="property">ApplicationContext</span> | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 当前应用颜色模式，需在init过程中进行初始化数据获取，以免直接调用AppStorage造成未初始化问题。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">appColorMode</span>: <span class="number">0</span> | <span class="number">1</span> | <span class="number">2</span> = <span class="variable constant_">DEFAULT_COLOR_MODE</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 管理器初始化，并应用初始化后的颜色应用状态</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> applicationContext 应用上下文对象</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 是否初始化成功</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">init</span>(<span class="attr">applicationContext</span>: common.<span class="property">ApplicationContext</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">applicationContext</span> = applicationContext</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">appColorMode</span> =</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span></span><br><span class="line">    <span class="keyword">if</span> (applicationContext) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>applicationContext初始化成功`</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initColoModSetting</span>();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 初始化颜色设置，仅做内部调用，外部请使用其余设置接口</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">initColoModSetting</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">applicationContext</span>!.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_LIGHT</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">applicationContext</span>!.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_DARK</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">applicationContext</span>!.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_NOT_SET</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setDarkMod</span>():<span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">applicationContext</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">applicationContext</span>.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_DARK</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">appColorMode</span> = <span class="number">1</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>深色模式修改成功colorModel=<span class="subst">$&#123;AppStorageV2.connect(UserConfigViewModel, GET_USER_CONFIG, () =&gt; <span class="keyword">new</span> UserConfigViewModel())!.colorModel&#125;</span>`</span>)</span><br><span class="line">      userConfigManager.<span class="title function_">syncDataToPreference</span>()</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>应用上下文对象缺失`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setLightMod</span>():<span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">applicationContext</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">applicationContext</span>.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_LIGHT</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">appColorMode</span> = <span class="number">0</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>浅色模式修改成功colorModel=<span class="subst">$&#123;AppStorageV2.connect(UserConfigViewModel, GET_USER_CONFIG, () =&gt; <span class="keyword">new</span> UserConfigViewModel())!.colorModel&#125;</span>`</span>)</span><br><span class="line">      userConfigManager.<span class="title function_">syncDataToPreference</span>()</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>应用上下文对象缺失`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setDefaultColorMode</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">applicationContext</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">applicationContext</span>.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_NOT_SET</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">appColorMode</span> = <span class="number">2</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>跟随系统模式修改成功colorModel=<span class="subst">$&#123;AppStorageV2.connect(UserConfigViewModel,</span></span></span><br><span class="line"><span class="subst"><span class="string">        GET_USER_CONFIG, () =&gt; <span class="keyword">new</span> UserConfigViewModel())!.colorModel&#125;</span>`</span>)</span><br><span class="line">      userConfigManager.<span class="title function_">syncDataToPreference</span>()</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>应用上下文对象缺失`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>整体的思路就是通过应用上下文对象设置应用的颜色模式，与此同时通过全局变量来实现应用的通讯，以及深浅色切换控件的图标切换等工作，在切换时自动将数据持久化。</p>
<p>随后将初始化过程串流到应用初始化流程中。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DEFAULT_COLOR_MODE</span>, <span class="variable constant_">GET_USER_CONFIG</span>, logger, <span class="title class_">UserConfigViewModel</span> &#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; colorModManager &#125; <span class="keyword">from</span> <span class="string">&quot;../../managers/ColorModManager&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ColorModChoseButton</span>_LOG_TAG = <span class="string">&#x27;ColorModChoseButton: &#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 颜色模式切换按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">ColorModChoseButton</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">appColorMode</span>: <span class="number">0</span> | <span class="number">1</span> | <span class="number">2</span> = <span class="variable constant_">DEFAULT_COLOR_MODE</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">appColorMode</span> =</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">changeColorMode</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span>===<span class="number">2</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">appColorMode</span> = <span class="number">0</span></span><br><span class="line">      colorModManager.<span class="title function_">setLightMod</span>()</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModChoseButton_LOG_TAG&#125;</span>点击生效，切换为浅色模式`</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span>===<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">appColorMode</span> = <span class="number">1</span></span><br><span class="line">      colorModManager.<span class="title function_">setDarkMod</span>()</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModChoseButton_LOG_TAG&#125;</span>点击生效，切换为深色模式`</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span>===<span class="number">1</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">appColorMode</span> = <span class="number">2</span></span><br><span class="line">      colorModManager.<span class="title function_">setDefaultColorMode</span>()</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModChoseButton_LOG_TAG&#125;</span>点击生效，切换为跟随系统模式`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span>===<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;系&#x27;</span>)</span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span>===<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;深&#x27;</span>)</span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span>===<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;浅&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">changeColorMode</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">    .<span class="title function_">borderRadius</span>(<span class="number">99</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="number">30</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="number">30</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后用一个<code>ColorModChoseButton</code>控件来去进行深浅色切换。</p>
<video width="100%" controls>
  <source src="35.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>在测试时又发现了新问题，就是在切换深浅色时是正常的但是在退出应用时却发现它变回了默认状态，太诡异了。</p>
<h4 id="持久化失败的问题排查与研究"><a href="#持久化失败的问题排查与研究" class="headerlink" title="持久化失败的问题排查与研究"></a>持久化失败的问题排查与研究</h4><p>我们首先再给这个按钮加一些样式来明确一下边界后再次进行测试。</p>
<p>这里也是刚好牵扯出来一个小的开发技巧，就是在动态资源共享包中想要新增一个颜色配置文件该怎么做。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/36.png" alt="36"></p>
<p>创建好深色模式资源包之后将Product模块的两个颜色JSON文件复制过来，这里其实只是为了数据格式的一致性，自己重新写也是可以的。</p>
<p>还有个小点就是主动获取系统配置变化，可以通过<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-ability#abilityonconfigurationupdate">onConfigurationUpdate</a>回调函数来获取。当然这里我们还是先解决深浅色切换为重。</p>
<p>先让我们来取一段日志来分析一下。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/37.png" alt="37"></p>
<p>可以看到，我们按钮点击触发后设置浅色的函数的的确确是成功了的，但是我们的日志显示问题发生在了<code>PreferenceDB: push data: key=ColorMode,value=2</code>这一步，写入到数据时跟随系统！！！这很致命啊，我第一时间想到的是深浅拷贝问题，之前在测试我们的持久化数据存储时已经成功了，后面我为了省事我是直接提取为了一个成员变量，我现在加上<code>@Trace</code>试一试。</p>
<p>没有变化，问题不在这里那我就把成员变量拆回去。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; common, <span class="title class_">ConfigurationConstant</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.AbilityKit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DEFAULT_COLOR_MODE</span>, <span class="variable constant_">GET_USER_CONFIG</span>, logger, <span class="title class_">UserConfigViewModel</span> &#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; userConfigManager &#125; <span class="keyword">from</span> <span class="string">&quot;./UserConfigManager&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ColorModManager</span>_LOG_TAG = <span class="string">&#x27;ColorModManager: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 颜色模式管理器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ColorModManager</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 应用上下文对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">applicationContext</span>: common.<span class="property">ApplicationContext</span> | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 管理器初始化，并应用初始化后的颜色应用状态</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> applicationContext 应用上下文对象</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 是否初始化成功</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">init</span>(<span class="attr">applicationContext</span>: common.<span class="property">ApplicationContext</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">applicationContext</span> = applicationContext</span><br><span class="line">    <span class="keyword">if</span> (applicationContext) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>applicationContext初始化成功`</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initColoModSetting</span>();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 初始化颜色设置，仅做内部调用，外部请使用其余设置接口</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">initColoModSetting</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">applicationContext</span>!.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_LIGHT</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">applicationContext</span>!.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_DARK</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">applicationContext</span>!.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_NOT_SET</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setDarkMod</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">applicationContext</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">applicationContext</span>.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_DARK</span>)</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> = <span class="number">1</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>深色模式修改成功AppStoragecolorModel=<span class="subst">$&#123;AppStorageV2.connect(UserConfigViewModel,</span></span></span><br><span class="line"><span class="subst"><span class="string">        GET_USER_CONFIG, () =&gt; <span class="keyword">new</span> UserConfigViewModel())!.colorModel&#125;</span>开始持久化数据`</span>)</span><br><span class="line">      userConfigManager.<span class="title function_">syncDataToPreference</span>()</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>应用上下文对象缺失`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setLightMod</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">applicationContext</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">applicationContext</span>.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_LIGHT</span>)</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> = <span class="number">0</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>浅色模式修改成功AppStoragecolorModel=<span class="subst">$&#123;AppStorageV2.connect(UserConfigViewModel,</span></span></span><br><span class="line"><span class="subst"><span class="string">        GET_USER_CONFIG, () =&gt; <span class="keyword">new</span> UserConfigViewModel())!.colorModel&#125;</span>开始持久化数据`</span>)</span><br><span class="line">      userConfigManager.<span class="title function_">syncDataToPreference</span>()</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>应用上下文对象缺失`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setDefaultColorMode</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">applicationContext</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">applicationContext</span>.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_NOT_SET</span>)</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span> = <span class="number">2</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>跟随系统模式修改成功AppStoragecolorModel=<span class="subst">$&#123;AppStorageV2.connect(UserConfigViewModel,</span></span></span><br><span class="line"><span class="subst"><span class="string">        GET_USER_CONFIG, () =&gt; <span class="keyword">new</span> UserConfigViewModel())!.colorModel&#125;</span>开始持久化数据`</span>)</span><br><span class="line">      userConfigManager.<span class="title function_">syncDataToPreference</span>()</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>应用上下文对象缺失`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> colorModManager = <span class="keyword">new</span> <span class="title class_">ColorModManager</span>()</span><br></pre></td></tr></table></figure>
<p>再次测试</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/38.png" alt="38"></p>
<p>这才对啊。但是真机的显示效果又出现了新的问题。在我重新启动应用后发现按钮显示的文字正确但是真正的颜色模式还是跟随系统。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/39.jpg" alt="39"></p>
<p>这个问题的定位倒是很快速的，我是在当初学习如何设置当前应用的深浅色模式的时候就看到过再创建项目后的默认代码中就有一行是设置成跟随系统，我当时忘删了。删除后再试一下。</p>
<p>诶？不对，还是不对，而且现象相同？那现在可能的原因就是初始化流程中出现了问题。</p>
<p>我需要在初始化的过程中添加更多的日志，因为当前的日志并不能准确的定位问题所在。于是我开始寻找我一楼添加日志的位置，想到往事在写初始化颜色模式的这个函数的时候我认为逻辑过于简单就没有添加日志，我现在加一下试试。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化颜色设置，仅做内部调用，外部请使用其余设置接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">initColoModSetting</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>initColoModSetting 0: AppStorageV2colorModel = <span class="subst">$&#123;AppStorageV2.connect(UserConfigViewModel,</span></span></span><br><span class="line"><span class="subst"><span class="string">        GET_USER_CONFIG, () =&gt; <span class="keyword">new</span> UserConfigViewModel())!.colorModel&#125;</span>`</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">applicationContext</span>!.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_LIGHT</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>initColoModSetting 1: AppStorageV2colorModel = <span class="subst">$&#123;AppStorageV2.connect(UserConfigViewModel,</span></span></span><br><span class="line"><span class="subst"><span class="string">        GET_USER_CONFIG, () =&gt; <span class="keyword">new</span> UserConfigViewModel())!.colorModel&#125;</span>`</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">applicationContext</span>!.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_DARK</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModManager_LOG_TAG&#125;</span>initColoModSetting 2: AppStorageV2colorModel = <span class="subst">$&#123;AppStorageV2.connect(UserConfigViewModel,</span></span></span><br><span class="line"><span class="subst"><span class="string">        GET_USER_CONFIG, () =&gt; <span class="keyword">new</span> UserConfigViewModel())!.colorModel&#125;</span>`</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">applicationContext</span>!.<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_NOT_SET</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后再次进行测试，果然发现了问题所在。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ColorModManager: applicationContext初始化成功</span><br><span class="line">ColorModManager: initColoModSetting 0: AppStorageV2colorModel = 0</span><br><span class="line">ColorModManager: initColoModSetting 1: AppStorageV2colorModel = 0</span><br><span class="line">ColorModManager: initColoModSetting 2: AppStorageV2colorModel = 0</span><br></pre></td></tr></table></figure>
<p>三个语块全部进入。很诡异真的。</p>
<p>我又仔细一想，问了下AI才想起来是忘记加break了，导致全部语块都被执行直至最后一个跟随系统设置。</p>
<p>再次测试。</p>
<video width="100%" controls>
  <source src="40.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<h3 id="KV数据库与新闻数据管理器"><a href="#KV数据库与新闻数据管理器" class="headerlink" title="KV数据库与新闻数据管理器"></a>KV数据库与新闻数据管理器</h3><h4 id="KV数据库的功能完善"><a href="#KV数据库的功能完善" class="headerlink" title="KV数据库的功能完善"></a>KV数据库的功能完善</h4><p>首先先接着之前的初始化代码后面接着封装一个获取KV数据库实例的方法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; distributedKVStore &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkData&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&quot;../../utils/logger/logger&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">KVDatabase</span>_LOG_TAG = <span class="string">&#x27;KVDatabase: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 键值型数据库管理接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">KVDatabase</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 数据库管理对象，应用启动后需要先行创建并进行数据库的创建。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">kvManager</span>: distributedKVStore.<span class="property">KVManager</span> | <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="attr">appId</span>: <span class="built_in">string</span> = <span class="string">&#x27;com.xbxyftx.NowInOpenHarmony&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 初始化方法，创建数据库管理对象KVManager，需在应用启动阶段进行调用。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> context 当前应用上下文</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 是否成功初始化</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">init</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">kvManagerConfig</span>: distributedKVStore.<span class="property">KVManagerConfig</span> = &#123;</span><br><span class="line">      <span class="attr">context</span>: context,</span><br><span class="line">      <span class="attr">bundleName</span>: <span class="variable language_">this</span>.<span class="property">appId</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 创建KVManager实例</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">kvManager</span> = distributedKVStore.<span class="title function_">createKVManager</span>(kvManagerConfig);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="title class_">KVDatabase</span>_LOG_TAG + <span class="string">&#x27;Succeeded in creating KVManager.&#x27;</span>);</span><br><span class="line">      <span class="comment">// 继续创建获取数据库</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">kvManager</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="title class_">KVDatabase</span>_LOG_TAG+<span class="string">&#x27;数据库管理对象创建成功。&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="title class_">KVDatabase</span>_LOG_TAG + <span class="string">&#x27;数据库管理对象创建失败&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">let</span> error = e <span class="keyword">as</span> <span class="title class_">BusinessError</span>;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="title class_">KVDatabase</span>_LOG_TAG + <span class="string">`Failed to create KVManager. Code:<span class="subst">$&#123;error.code&#125;</span>,message:<span class="subst">$&#123;error.message&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 通过ID获取数据库实例对象，需在init后使用。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> storeId 数据库实例对象ID</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 单版本数据库实例对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getKVStoreById</span>(<span class="attr">storeId</span>:<span class="built_in">string</span>):<span class="title class_">Promise</span>&lt;distributedKVStore.<span class="property">SingleKVStore</span>|<span class="literal">null</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">kvManager</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">options</span>:distributedKVStore.<span class="property">Options</span> = &#123;</span><br><span class="line">          <span class="attr">createIfMissing</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">securityLevel</span>: distributedKVStore.<span class="property">SecurityLevel</span>.<span class="property">S1</span>,</span><br><span class="line">          <span class="attr">kvStoreType</span>:distributedKVStore.<span class="property">KVStoreType</span>.<span class="property">SINGLE_VERSION</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">kVStore</span>:distributedKVStore.<span class="property">SingleKVStore</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">kvManager</span>.<span class="title function_">getKVStore</span>(storeId,options)</span><br><span class="line">        <span class="keyword">if</span> (kVStore) &#123;</span><br><span class="line">          logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;KVDatabase_LOG_TAG&#125;</span>成功获取storeId:<span class="subst">$&#123;storeId&#125;</span>数据库实例对象`</span>)</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">kvManager</span>.<span class="title function_">on</span>(<span class="string">&#x27;distributedDataServiceDie&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;KVDatabase_LOG_TAG&#125;</span>数据库服务订阅发生变更`</span>)</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">return</span> kVStore</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="keyword">catch</span> (e)&#123;</span><br><span class="line">        <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;KVDatabase_LOG_TAG&#125;</span>获取KV数据库实例对象异常，异常信息: <span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">kvDatabase</span>: <span class="title class_">KVDatabase</span> = <span class="keyword">new</span> <span class="title class_">KVDatabase</span>()</span><br></pre></td></tr></table></figure>
<p>这里要注意的一点就是这个获取数据库实例的操作是一个异步的耗时操作，我们在后续的处理中也要注意这一点。随后将这个初始化过程绑定到新闻列表管理器的初始化方法中。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当前应用的键值数据库实例对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">appKVDb</span>: distributedKVStore.<span class="property">SingleKVStore</span> | <span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化函数，获取当前应用的键值对数据库实例。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">context</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">init</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">  kvDatabase.<span class="title function_">init</span>(context)</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> kvDatabase.<span class="title function_">getKVStoreById</span>(<span class="variable constant_">APP_KV_DB_ID</span>)</span><br><span class="line">  <span class="keyword">if</span> (res) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">appKVDb</span> = res</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>init: 获取appKVDb成功`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进行测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">KVDatabase: 成功获取storeId:NowInOpenHarmonyKVDB数据库实例对象</span><br><span class="line">NewsManager: init: 获取appKVDb成功</span><br></pre></td></tr></table></figure>
<p>成功，随后编写一下更新数据库新闻列表数据的方法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">APP_KV_DB</span> <span class="keyword">as</span> <span class="variable constant_">APP_KV_DB_ID</span>, kvDatabase,</span><br><span class="line">  <span class="variable constant_">KV_DB_KEYS</span>,</span><br><span class="line">  logger, <span class="title class_">NewsArticle</span>, newsListApi, serverHealthApi &#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.AbilityKit&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; distributedKVStore &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkData&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewsManager</span>_LOG_TAG = <span class="string">&#x27;NewsManager: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">NewsManager</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 当前应用的键值数据库实例对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">appKVDb</span>: distributedKVStore.<span class="property">SingleKVStore</span> | <span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 初始化函数，获取当前应用的键值对数据库实例。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">context</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">init</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    kvDatabase.<span class="title function_">init</span>(context)</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> kvDatabase.<span class="title function_">getKVStoreById</span>(<span class="variable constant_">APP_KV_DB_ID</span>)</span><br><span class="line">    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">appKVDb</span> = res</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>init: 获取appKVDb成功`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>初始化失败`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">updateNewsListToDB</span>(<span class="attr">times</span>: <span class="built_in">number</span> = <span class="number">1</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (times&lt;=<span class="number">5</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">await</span> serverHealthApi.<span class="title function_">isServerReady</span>()) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">news</span>:<span class="title class_">NewsArticle</span>[]|<span class="literal">null</span> = (<span class="keyword">await</span> newsListApi.<span class="title function_">getAllNews</span>())</span><br><span class="line">        <span class="keyword">if</span> (news &amp;&amp; <span class="variable language_">this</span>.<span class="property">appKVDb</span>) &#123;</span><br><span class="line">          logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>成功获取最新新闻，总条数: <span class="subst">$&#123;news.length&#125;</span>`</span>)</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">appKVDb</span>.<span class="title function_">put</span>(<span class="variable constant_">KV_DB_KEYS</span>.<span class="property">NewsArticleList</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(news))</span><br><span class="line">            logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>数据库写入成功，无异常`</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">          &#125;<span class="keyword">catch</span> (e)&#123;</span><br><span class="line">            <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">            logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>更新数据库NewsArticle数据发生异常，异常信息: <span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>获取新闻失败`</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>第<span class="subst">$&#123;times&#125;</span>次查询服务端健康状态失败`</span>)</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">updateNewsListToDB</span>(++times)</span><br><span class="line">        &#125;, <span class="number">100</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>times = <span class="subst">$&#123;times&#125;</span>,服务端健康情况异常`</span>)</span><br><span class="line">    promptAction.<span class="title function_">openToast</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>:<span class="string">`服务端状态异常，已经尝试状态检查<span class="subst">$&#123;times&#125;</span>次`</span>,</span><br><span class="line">      <span class="attr">duration</span>:<span class="number">3000</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> newsManager = <span class="keyword">new</span> <span class="title class_">NewsManager</span>()</span><br></pre></td></tr></table></figure>
<p>随后串流至app初始化的流程中进行测试。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">initAll</span>(<span class="params"><span class="attr">uiAbilityContext</span>: common.<span class="title class_">UIAbilityContext</span>,<span class="attr">applicationContext</span>:common.<span class="title class_">ApplicationContext</span></span>)&#123;</span><br><span class="line">  <span class="keyword">await</span> newsManager.<span class="title function_">init</span>(uiAbilityContext)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">configInit</span>(uiAbilityContext)</span><br><span class="line">  colorModManager.<span class="title function_">init</span>(applicationContext)</span><br><span class="line">  newsManager.<span class="title function_">updateNewsListToDB</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/29/OpenSourceSummer2025/41.png" alt="41"></p>
<p>ok，很完美，其实我一开始害怕单个字段存储会不会出现数据量过大的情况，但看来并没有发生，那我就放心了。</p>
<p>随后用类似的结构去封装一下获取数据库中的新闻列表数据的方法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">getNewsArticleListFromDB</span>(): <span class="title class_">Promise</span>&lt;<span class="title class_">NewsArticle</span>[] | <span class="literal">null</span>&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appKVDb</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">res</span>:<span class="built_in">string</span> =(<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">appKVDb</span>.<span class="title function_">get</span>(<span class="variable constant_">KV_DB_KEYS</span>.<span class="property">NewsArticleList</span>)) <span class="keyword">as</span> <span class="built_in">string</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>读取到数据库新闻列表数据: <span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">const</span> newsArticleList = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res) <span class="keyword">as</span> <span class="title class_">NewsArticle</span>[]</span><br><span class="line">      <span class="keyword">return</span> newsArticleList</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e)&#123;</span><br><span class="line">      <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>尝试获取数据库新闻列表数据发生异常，异常信息: <span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后进行串流测试。这次测试我为了确保在应用断网或者是服务端异常的情况下，应用依然能够正常启动，并开始运作备用的数据库存储方案来去进行数据的渲染，所以特意没有开启服务端，而是进行纯客户端测试。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">initAll</span>(<span class="params"><span class="attr">uiAbilityContext</span>: common.<span class="title class_">UIAbilityContext</span>,<span class="attr">applicationContext</span>:common.<span class="title class_">ApplicationContext</span></span>)&#123;</span><br><span class="line">  <span class="keyword">await</span> newsManager.<span class="title function_">init</span>(uiAbilityContext)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">configInit</span>(uiAbilityContext)</span><br><span class="line">  colorModManager.<span class="title function_">init</span>(applicationContext)</span><br><span class="line">  newsManager.<span class="title function_">updateNewsListToDB</span>()</span><br><span class="line">  newsManager.<span class="title function_">getNewsArticleListFromDB</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/29/OpenSourceSummer2025/44.png" alt="44"></p>
<p>我草非常顺利啊，没有出现异常。那接下来我们就只需要去考虑这两套数据获取方式的切换逻辑了，这部分应该是最后在完善AppInit功能模块时的工作，下一步我需要思考的应该是文章渲染组件以及对应的样式设计，以及文章字体大小控制组件的功能封装。</p>
<h3 id="启动页UI"><a href="#启动页UI" class="headerlink" title="启动页UI"></a>启动页UI</h3><p>对于启动页的UI，首先肯定是要以简洁为主题风格，随后是要有应用的名称，然后我们还有明白启动页的核心功能是用来给应用的启动提供充足的缓冲时间，如果启动页进入之后还没有加载完成数据，那大概率是意味着网络出现了问题或是服务端出现了这状态异常，所以我们需要将从后端更新数据以及全部数据库的初始化工作都放在启动页显示期间进行。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/42.png" alt="27"></p>
<p>在豆包之后就获得了这个logo，调整几次后的这个结果还是非常让人满意的，思路来源就是OpenHarmony的绿色和蓝色的渐变，虽然不是用专业绘图软件画的没有透明的背景，但我可以直接设置成同样的背景色，这样就可以做出透明背景的效果了。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/43.jpg" alt="43"></p>
<h3 id="主页面UI"><a href="#主页面UI" class="headerlink" title="主页面UI"></a>主页面UI</h3><h4 id="页面配色"><a href="#页面配色" class="headerlink" title="页面配色"></a>页面配色</h4><p>首先我考虑的是整体页面的背景颜色，毕竟背景颜色的选定是会影响整个页面给用户的第一印象以及整体感受的。我选择采用和OpenHarmony图标一致的蓝绿渐变，给人一种生机盎然的气息，和开元鸿蒙所追求的“万物互联，共创未来”的理念不谋而合。</p>
<p>为了进行深浅色适配我们就需要在<code>color.json</code>文件中去进行同名配置，来进行深浅色的自适配。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;color&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;start_window_background&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;#FFFFFF&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;index_page_background_1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;#ff00a7c4&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;index_page_background_2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;#ff00c6c6&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;index_page_background_3&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;#b900d48c&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;index_page_background_4&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;#ff00d91c&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;color&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;start_window_background&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;#000000&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;index_page_background_1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;#FF03788C&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;index_page_background_2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;#FF048D8D&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;index_page_background_3&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;#B9028C5C&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;index_page_background_4&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;#FF069B18&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/29/OpenSourceSummer2025/24.jpg" alt="24"></p>
<p>看着还不错吧。</p>
<p>在这个过程中我也是遇到了一个小问题，就是我继续用<code>NavDestination</code>制作启动页的话这将意味着我的启动页将无法在平板上去进行全屏的覆盖，这并不合理。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/25.jpg" alt="25"></p>
<p>所以我还是决定使用router来去解决这个问题。</p>
<p>在使用router局部重构页面逻辑时又发现了一个新的问题，就是router的<code>pushUrl</code>方法已经被废弃了。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/26.png" alt="26"></p>
<p>我立即去查看了<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-router#routerpushurldeprecated">官方文档</a>。</p>
<p>原来是和之前遇到的PromptAction相同的指代不明的问题。由于之前解决的时候已经获取过UIContext了所以我就直接使用此前获取的就可以了。</p>
<p>随后我又去学习了一下页面间转场动画的制作，修改完得到如下代码。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span>, curves, <span class="title class_">PromptAction</span>, <span class="title class_">Router</span>, router &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">GetUIContext</span>,</span><br><span class="line">  <span class="variable constant_">GET_UICONTEXT</span>,</span><br><span class="line">  logger,</span><br><span class="line">  <span class="title class_">NavDests</span>,</span><br><span class="line">  <span class="variable constant_">NAV_PATH_STUCK</span>,</span><br><span class="line">  <span class="title class_">NewsArticle</span>,</span><br><span class="line">  newsListApi,</span><br><span class="line">  serverHealthApi</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">START_PAGE_TAGE</span> = <span class="string">&#x27;StartPage:  &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">StarPage</span> &#123;</span><br><span class="line">  <span class="attr">uiPromptAction</span>: <span class="title class_">PromptAction</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">GetUIContext</span>, <span class="variable constant_">GET_UICONTEXT</span>)!.<span class="property">context</span>.<span class="title function_">getPromptAction</span>()</span><br><span class="line">  <span class="attr">uiRouter</span>: <span class="title class_">Router</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">GetUIContext</span>, <span class="variable constant_">GET_UICONTEXT</span>)!.<span class="property">context</span>.<span class="title function_">getRouter</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">aboutToAppear</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">isServerReady</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">START_PAGE_TAGE</span> + <span class="string">&#x27;延时跳转&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">uiRouter</span>.<span class="title function_">pushUrl</span>(&#123; <span class="attr">url</span>: <span class="string">&quot;pages/Index&quot;</span>, <span class="attr">recoverable</span>: <span class="literal">false</span> &#125;)</span><br><span class="line">      <span class="comment">// 为了能触发路由动画特此使用push</span></span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">START_PAGE_TAGE</span> + <span class="string">&#x27;清理启动页&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">uiRouter</span>.<span class="title function_">clear</span>()</span><br><span class="line">    &#125;, <span class="number">2000</span>)</span><br><span class="line">    <span class="keyword">await</span> serverHealthApi.<span class="title function_">isServerReady</span>().<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">boolean</span></span>) =&gt;</span> &#123;</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">START_PAGE_TAGE</span> + res.<span class="title function_">valueOf</span>())</span><br><span class="line">      <span class="keyword">if</span> (res) &#123;</span><br><span class="line">        isServerReady = <span class="literal">true</span></span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="variable constant_">START_PAGE_TAGE</span> + <span class="string">&#x27;服务端准备就绪isServerReady=&#x27;</span> + isServerReady)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        isServerReady = <span class="literal">false</span></span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="variable constant_">START_PAGE_TAGE</span> + <span class="string">&#x27;服务端准备中isServerReady=&#x27;</span> + isServerReady)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (isServerReady) &#123;</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">START_PAGE_TAGE</span> + <span class="string">&#x27;尝试获取全部新闻列表&#x27;</span>)</span><br><span class="line">      newsListApi.<span class="title function_">getAllNews</span>().<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">res</span>: <span class="title class_">NewsArticle</span>[] | <span class="literal">null</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res === <span class="literal">null</span>) &#123;</span><br><span class="line">          logger.<span class="title function_">warn</span>(<span class="variable constant_">START_PAGE_TAGE</span> + <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">uiPromptAction</span>.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;获取新闻列表成功&#x27;</span>, <span class="attr">duration</span>: <span class="number">2000</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">pageTransition</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">PageTransitionExit</span>(&#123; <span class="attr">type</span>: <span class="title class_">RouteType</span>.<span class="property">None</span>, <span class="attr">duration</span>: <span class="number">200</span>, <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseInOut</span> &#125;)</span><br><span class="line">      .<span class="title function_">slide</span>(<span class="title class_">SlideEffect</span>.<span class="property">Left</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.logo&#x27;</span>))</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;20%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123;<span class="attr">bottom</span>:<span class="number">100</span>&#125;)</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;Welcome&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="string">&#x27;#ff00be53&#x27;</span>)</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;NowInOpenHarmony&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">50</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="string">&#x27;#ff00be53&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="number">700</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">expandSafeArea</span>()</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#062872&#x27;</span>)</span><br><span class="line">    .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NavDests</span>, <span class="variable constant_">NAV_PATH_STUCK</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;common&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MainPage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./nav_pages/mainPage&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Main</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">navPathStuck</span>: <span class="title class_">NavPathStack</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NavPathStack</span>, <span class="variable constant_">NAV_PATH_STUCK</span>,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">NavPathStack</span>())!</span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title class_">NavDestMap</span>(<span class="attr">name</span>: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="title class_">NavDests</span>.<span class="property">MAIN</span>) &#123;</span><br><span class="line">      <span class="title class_">Main</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">pageTransition</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">PageTransitionEnter</span>(&#123; <span class="attr">type</span>: <span class="title class_">RouteType</span>.<span class="property">None</span>, <span class="attr">duration</span>: <span class="number">200</span>, <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseInOut</span> &#125;)</span><br><span class="line">      .<span class="title function_">scale</span>(&#123;<span class="attr">x</span>:<span class="number">0.2</span>,<span class="attr">y</span>:<span class="number">0.2</span>&#125;)</span><br><span class="line">      .<span class="title function_">opacity</span>(<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Navigation</span>(<span class="variable language_">this</span>.<span class="property">navPathStuck</span>)&#123;</span><br><span class="line">      <span class="title class_">MainPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">linearGradient</span>(&#123;</span><br><span class="line">      <span class="attr">angle</span>:<span class="number">20</span>,</span><br><span class="line">      <span class="attr">colors</span>:[</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_1&#x27;</span>),<span class="number">0</span>],</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_2&#x27;</span>),<span class="number">0.4</span>],</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_3&#x27;</span>),<span class="number">0.7</span>],</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_4&#x27;</span>),<span class="number">1</span>]</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">navDestination</span>(<span class="variable language_">this</span>.<span class="property">NavDestMap</span>)</span><br><span class="line">    .<span class="title function_">hideTitleBar</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">hideToolBar</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">hideBackButton</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">titleMode</span>(<span class="title class_">NavigationTitleMode</span>.<span class="property">Free</span>)</span><br><span class="line">    .<span class="title function_">mode</span>(<span class="title class_">NavigationMode</span>.<span class="property">Auto</span>)</span><br><span class="line">    .<span class="title function_">navBarWidth</span>(<span class="string">&#x27;40%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Navigation标题的从新启用"><a href="#Navigation标题的从新启用" class="headerlink" title="Navigation标题的从新启用"></a>Navigation标题的从新启用</h4><p>在使用Navigation的过程中我发现了一个不算很大但确实影响观感的问题就是在于如果不设置标题的话最上方和左侧在分栏显示的状态下就会出现一条分栏。所以我决定去单独封装一个标题Builder来去进行标题的重新启用，这样可以避免那条无法去除的留白带来的感官影响。</p>
<h3 id="平板竖屏显示问题"><a href="#平板竖屏显示问题" class="headerlink" title="平板竖屏显示问题"></a>平板竖屏显示问题</h3><p>在测试平板侧的一多的时候发现一个问题就是他的竖屏模式Navigation并不会自动恢复到单栏模式，且图片的比例也会变得很奇怪，所以对于这个问题有两种解决方式，一种是通过媒体查询来去解决这个问，另一种就是通过设置横屏锁定来解决。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/45.jpg" alt="45"></p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">媒体查询</button><button type="button" class="tab">横屏锁定</button></div><div class="tab-contents"><div class="tab-item-content active"><p>对于媒体查询来说他只需要做到依据手机和平板去让我手动修改Navigation的显示模式就可以了，并不需要进行太多功能性上的修改。</p>
<p>首先先用长宽比属性锁定一下轮播图组件的长宽比，随后去设置断点的判断机制。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NewsSwiperModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;common&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页上方轮播图组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">NewsSwiper</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">swiperList</span>: <span class="title class_">NewsSwiperModule</span> [] = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">NewsSwiperModule</span>(<span class="string">&#x27;https://images.openharmony.cn/%E9%A6%96%E9%A1%B5/banner/20240411/4.1releas%E6%89%8B%E6%9C%BA.jpg&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;开源生态大会&#x27;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">NewsSwiperModule</span>(<span class="string">&#x27;https://images.openharmony.cn/%E6%B4%BB%E5%8A%A8/%E5%88%9B%E6%96%B0%E8%B5%9B2023/20230831/%E4%B8%89%E6%96%B9%E5%BA%93%E7%A7%BB%E5%8A%A8%E7%AB%AF.png&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;开源生态大会&#x27;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">NewsSwiperModule</span>(<span class="string">&#x27;https://images.openharmony.cn/%E6%B4%BB%E5%8A%A8/%E6%98%8E%E6%98%9F%E5%BC%80%E5%8F%91%E6%9D%BF20250728/%E9%A6%96%E9%A1%B5banner657-433.jpg&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;开源生态大会&#x27;</span>)</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Swiper</span>()&#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">swiperList</span>,<span class="function">(<span class="params"><span class="attr">item</span>:<span class="title class_">NewsSwiperModule</span></span>)=&gt;</span>&#123;</span><br><span class="line">          <span class="title class_">Image</span>(item.<span class="property">img</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Fill</span>)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">              promptAction.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:<span class="string">&#x27;跳转原页面功能待开发&#x27;</span>&#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">            .<span class="title function_">aspectRatio</span>(<span class="number">2.2</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">curve</span>(<span class="title class_">Curve</span>.<span class="property">EaseInOut</span>)</span><br><span class="line">      .<span class="title function_">loop</span>(<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">autoPlay</span>(<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">interval</span>(<span class="number">2000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>断点监听系统。我需要针对于</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Breakpoint</span>, <span class="title class_">BreakpointType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../modules/breakPoint/BreakPointSystem&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span>, mediaquery &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BreakpointState</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../modules/breakPoint/BreakpointState&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&quot;..&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">BREAK_POINT_SYSTEM_LOG_TAG</span> = <span class="string">&#x27;BreakpointSystem:  &#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 断点系统核心类（单例模式）</span></span><br><span class="line"><span class="comment"> * 负责管理设备断点状态及监听逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BreakpointSystem</span> &#123;</span><br><span class="line">  <span class="comment">// 单例实例引用，确保全局唯一性[1](@ref)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="attr">instance</span>: <span class="title class_">BreakpointSystem</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 预定义断点范围配置（可扩展）*/</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="attr">breakpoints</span>: <span class="title class_">Breakpoint</span>[] = [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;xs&#x27;</span>, <span class="attr">size</span>: <span class="number">0</span> &#125;,     <span class="comment">// 0vp &lt;= width &lt; 320vp</span></span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;sm&#x27;</span>, <span class="attr">size</span>: <span class="number">320</span> &#125;,   <span class="comment">// 320vp &lt;= width &lt; 600vp</span></span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;md&#x27;</span>, <span class="attr">size</span>: <span class="number">700</span> &#125;,   <span class="comment">// 700vp &lt;= width &lt; 1240vp</span></span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;lg&#x27;</span>, <span class="attr">size</span>: <span class="number">1540</span> &#125;    <span class="comment">// 1540vp &lt;= width</span></span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 使用Set存储状态观察者（自动去重）[1](<span class="doctag">@ref</span>)*/</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">_states</span>: <span class="title class_">Set</span>&lt;<span class="title class_">BreakpointState</span>&lt;<span class="title class_">Object</span>&gt;&gt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">get</span> <span class="title function_">states</span>(): <span class="title class_">Set</span>&lt;<span class="title class_">BreakpointState</span>&lt;<span class="title class_">Object</span>&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_states</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 私有构造器（单例模式）</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_states</span> = <span class="keyword">new</span> <span class="title class_">Set</span>()  <span class="comment">// 初始化观察者集合</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 获取单例实例 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">getInstance</span>(): <span class="title class_">BreakpointSystem</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">BreakpointSystem</span>.<span class="property">instance</span>) &#123;</span><br><span class="line">      <span class="title class_">BreakpointSystem</span>.<span class="property">instance</span> = <span class="keyword">new</span> <span class="title class_">BreakpointSystem</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">BreakpointSystem</span>.<span class="property">instance</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 注册状态观察者 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">attach</span>(<span class="attr">state</span>: <span class="title class_">BreakpointState</span>&lt;<span class="title class_">Object</span>&gt;): <span class="built_in">void</span> &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;BREAK_POINT_SYSTEM_LOG_TAG&#125;</span>注册状态观察者`</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_states</span>.<span class="title function_">add</span>(state)  <span class="comment">// 添加新观察者到集合</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 注销状态观察者 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">detach</span>(<span class="attr">state</span>: <span class="title class_">BreakpointState</span>&lt;<span class="title class_">Object</span>&gt;): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_states</span>.<span class="title function_">delete</span>(state)  <span class="comment">// 从集合中移除观察者</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 启动断点监听系统 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">breakpoints</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params"><span class="attr">breakpoint</span>: <span class="title class_">Breakpoint</span>, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 查询条件</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">condition</span>: <span class="built_in">string</span></span><br><span class="line">      <span class="comment">// 动态生成媒体查询条件：</span></span><br><span class="line">      <span class="keyword">if</span> (index === <span class="variable language_">this</span>.<span class="property">breakpoints</span>.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 最后一个断点使用 &gt;= 条件</span></span><br><span class="line">        condition = <span class="string">`(<span class="subst">$&#123;breakpoint.size&#125;</span>vp&lt;=width)`</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 中间断点使用区间条件</span></span><br><span class="line">        condition = <span class="string">`(<span class="subst">$&#123;breakpoint.size&#125;</span>vp&lt;=width&lt;<span class="subst">$&#123;<span class="variable language_">this</span>.breakpoints[index + <span class="number">1</span>].size&#125;</span>vp)`</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建媒体查询监听器[1](@ref)</span></span><br><span class="line">      breakpoint.<span class="property">mediaQueryListener</span> = mediaquery.<span class="title function_">matchMediaSync</span>(condition)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 初始化匹配状态检查</span></span><br><span class="line">      <span class="keyword">if</span> (breakpoint.<span class="property">mediaQueryListener</span>.<span class="property">matches</span>) &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;BREAK_POINT_SYSTEM_LOG_TAG&#125;</span>初始化匹配成功breakpoint.name=<span class="subst">$&#123;breakpoint.name&#125;</span>`</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">updateAllState</span>(breakpoint.<span class="property">name</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 注册尺寸变化监听回调</span></span><br><span class="line">      breakpoint.<span class="property">mediaQueryListener</span>.<span class="title function_">on</span>(<span class="string">&#x27;change&#x27;</span>, <span class="function">(<span class="params">mediaQueryResult</span>) =&gt;</span> &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;BREAK_POINT_SYSTEM_LOG_TAG&#125;</span>触发断点状态变化回调`</span>)</span><br><span class="line">        <span class="keyword">if</span> (mediaQueryResult.<span class="property">matches</span>) &#123;</span><br><span class="line">          logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;BREAK_POINT_SYSTEM_LOG_TAG&#125;</span>匹配成功breakpoint.name=<span class="subst">$&#123;breakpoint.name&#125;</span>`</span>)</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">updateAllState</span>(breakpoint.<span class="property">name</span>)  <span class="comment">// 触发状态更新</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">BREAK_POINT_SYSTEM_LOG_TAG</span>+<span class="string">`第<span class="subst">$&#123;index&#125;</span>个断点状态对象启动完成`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 更新所有观察者状态 */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">updateAllState</span>(<span class="attr">type</span>: <span class="title class_">BreakpointType</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_states</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">state</span> =&gt;</span> state.<span class="title function_">update</span>(<span class="keyword">type</span>))  <span class="comment">// 遍历执行更新</span></span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="variable constant_">BREAK_POINT_SYSTEM_LOG_TAG</span>+<span class="string">&#x27;全部断点状态更新完成&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 停止监听并清理资源 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">stop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">breakpoints</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">breakpoint</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (breakpoint.<span class="property">mediaQueryListener</span>) &#123;</span><br><span class="line">        breakpoint.<span class="property">mediaQueryListener</span>.<span class="title function_">off</span>(<span class="string">&#x27;change&#x27;</span>)  <span class="comment">// 注销监听器</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_states</span>.<span class="title function_">clear</span>()  <span class="comment">// 清空观察者集合</span></span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="variable constant_">BREAK_POINT_SYSTEM_LOG_TAG</span>+<span class="string">&#x27;断点状态对象全部关闭&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当前设备断点系统的包装类</span></span><br><span class="line"><span class="comment"> * 调用getBreakPointSystem获取当前断点系统</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GetBreakPointSystem</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">breakPointSystem</span>:<span class="title class_">BreakpointSystem</span>=<span class="title class_">BreakpointSystem</span>.<span class="title function_">getInstance</span>()</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取当前断点系统</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 当前断点系统</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">getBreakPointSystem</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">breakPointSystem</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> breakpointSystem = <span class="title class_">BreakpointSystem</span>.<span class="title function_">getInstance</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BreakpointEnum</span>, <span class="title class_">BreakpointState</span>, breakpointSystem, logger, <span class="variable constant_">NAV_DESTS</span>, <span class="variable constant_">NAV_PATH_STUCK</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;common&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MainPage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./nav_pages/mainPage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Main</span>_LOG_TAG=<span class="string">&#x27;Main: &#x27;</span></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Main</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">navPathStuck</span>: <span class="title class_">NavPathStack</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NavPathStack</span>, <span class="variable constant_">NAV_PATH_STUCK</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">NavPathStack</span>())!</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">breakPointState</span>: <span class="title class_">BreakpointState</span>&lt;<span class="built_in">string</span>&gt; = <span class="title class_">BreakpointState</span>.<span class="property">of</span>&lt;<span class="built_in">string</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">xs</span>: <span class="string">&#x27;xs&#x27;</span>,</span><br><span class="line">    <span class="attr">sm</span>: <span class="string">&#x27;sm&#x27;</span>,</span><br><span class="line">    <span class="attr">xl</span>: <span class="string">&#x27;xl&#x27;</span>,</span><br><span class="line">    <span class="attr">xxl</span>: <span class="string">&#x27;xxl&#x27;</span>,</span><br><span class="line">    <span class="attr">md</span>: <span class="string">&#x27;md&#x27;</span>,</span><br><span class="line">    <span class="attr">lg</span>: <span class="string">&#x27;lg&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title class_">NavDestMap</span>(<span class="attr">name</span>: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="variable constant_">NAV_DESTS</span>.<span class="property">MAIN</span>) &#123;</span><br><span class="line">      <span class="title class_">Main</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * navigation</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">navMod</span>: <span class="title class_">NavigationMode</span> = <span class="title class_">NavigationMode</span>.<span class="property">Stack</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">pageTransition</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">PageTransitionEnter</span>(&#123; <span class="attr">type</span>: <span class="title class_">RouteType</span>.<span class="property">None</span>, <span class="attr">duration</span>: <span class="number">200</span>, <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseInOut</span> &#125;)</span><br><span class="line">      .<span class="title function_">scale</span>(&#123; <span class="attr">x</span>: <span class="number">0.2</span>, <span class="attr">y</span>: <span class="number">0.2</span> &#125;)</span><br><span class="line">      .<span class="title function_">opacity</span>(<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Monitor</span>(<span class="string">&#x27;breakPointState.value&#x27;</span>)</span><br><span class="line">  <span class="title function_">getNavMode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;Main_LOG_TAG&#125;</span>this.breakPointState.getCurrentBreakPointType() = <span class="subst">$&#123;<span class="variable language_">this</span>.breakPointState.getCurrentBreakPointType()&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">breakPointState</span>.<span class="title function_">getCurrentBreakPointType</span>() === <span class="title class_">BreakpointEnum</span>.<span class="property">xs</span> ||</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">breakPointState</span>.<span class="title function_">getCurrentBreakPointType</span>() === <span class="title class_">BreakpointEnum</span>.<span class="property">sm</span> ||</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">breakPointState</span>.<span class="title function_">getCurrentBreakPointType</span>() === <span class="title class_">BreakpointEnum</span>.<span class="property">md</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">navMod</span> = <span class="title class_">NavigationMode</span>.<span class="property">Stack</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">navMod</span> = <span class="title class_">NavigationMode</span>.<span class="property">Split</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    breakpointSystem.<span class="title function_">attach</span>(<span class="variable language_">this</span>.<span class="property">breakPointState</span>)</span><br><span class="line">    breakpointSystem.<span class="title function_">start</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getNavMode</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Navigation</span>(<span class="variable language_">this</span>.<span class="property">navPathStuck</span>) &#123;</span><br><span class="line">      <span class="title class_">MainPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">linearGradient</span>(&#123;</span><br><span class="line">      <span class="attr">angle</span>: <span class="number">20</span>,</span><br><span class="line">      <span class="attr">colors</span>: [</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_1&#x27;</span>), <span class="number">0</span>],</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_2&#x27;</span>), <span class="number">0.4</span>],</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_3&#x27;</span>), <span class="number">0.7</span>],</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_4&#x27;</span>), <span class="number">1</span>]</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">title</span>(<span class="string">&#x27;NowInOpenHarmony&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">navDestination</span>(<span class="variable language_">this</span>.<span class="property">NavDestMap</span>)</span><br><span class="line">    .<span class="title function_">hideToolBar</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">hideBackButton</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">titleMode</span>(<span class="title class_">NavigationTitleMode</span>.<span class="property">Mini</span>)</span><br><span class="line">    .<span class="title function_">mode</span>(<span class="variable language_">this</span>.<span class="property">navMod</span>)</span><br><span class="line">    .<span class="title function_">navBarWidth</span>(<span class="string">&#x27;40%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后进行测试！！！</p>
<video width="100%" controls>
  <source src="47.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>啊啊啊，经过一个多小时的折磨之后终于是顺利完成了这个切换的逻辑，中间还掺杂了因为<code>@Monitor</code>装饰器的变量名写错了的这种该死的疏忽而导致的bug。还被误认为是我原来写的这套媒体监听逻辑有问题，然后用的时候才发现一个问题就是虽然我项目原本是用API18，但是因为手机是API17所以我测试也只能用API17的接口所以我又把很多新接口改回了被废弃的老接口，也是很绝望了。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/48.png" alt="48"></p></div><div class="tab-item-content"><p>对于横竖屏模式的切换，我查找了<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-landscape-and-portrait-development">官方文档的建议</a>，有两种模式进行修改：一种是直接配置module.json5的<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#abilities%E6%A0%87%E7%AD%BE">orientation字段</a>；还有另外一种在代码逻辑里进行锁定的方式。</p>
<p>但这两种的缺点也很明显，在设置了之后就肯定是无法在切换回竖屏使用了，我也遇到过那种在平板上只能竖向使用不能横向使用的应用，有时候确实很让人恼火，尤其是恰好不是你的使用习惯的场景。</p>
<p>我在尝试着修改了配置文件之后就发现它无法分开在平板和手机上使用不同的横竖屏策略。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/46.jpg" alt="46"></p>
<p>确实是很让人恼火的事，所以我决定去引入媒体查询功能模块。</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>
<h3 id="媒体查询与断点系统的针对性调优"><a href="#媒体查询与断点系统的针对性调优" class="headerlink" title="媒体查询与断点系统的针对性调优"></a>媒体查询与断点系统的针对性调优</h3><p>这一部分我们主要是为了解决在平板的<mark class="hl-label red">自由多窗和全景多窗</mark>情况下的适配问题，以及当下仍然存在的一部分API接口的兼容问题，API17和API18之间还是有挺大差异的，API18是处理了一大批接口的UI上下文指代不明确的问题。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/49.png" alt="49"></p>
<h4 id="媒体查询接口调优"><a href="#媒体查询接口调优" class="headerlink" title="媒体查询接口调优"></a>媒体查询接口调优</h4><p>针对于上面提到的UI上下文指代不明的问题，我对断点系统进行了调优，将构造函数和获取实例方法都进行了UIContext的传参改造。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Breakpoint</span>, <span class="title class_">BreakpointType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../modules/breakPoint/BreakPointSystem&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; mediaquery &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BreakpointState</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../modules/breakPoint/BreakpointState&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&quot;..&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">BREAK_POINT_SYSTEM_LOG_TAG</span> = <span class="string">&#x27;BreakpointSystem:  &#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 断点系统核心类（单例模式）</span></span><br><span class="line"><span class="comment"> * 负责管理设备断点状态及监听逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BreakpointSystem</span> &#123;</span><br><span class="line">  <span class="comment">// 单例实例引用，确保全局唯一性[1](@ref)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="attr">instance</span>: <span class="title class_">BreakpointSystem</span></span><br><span class="line">  <span class="attr">uiContext</span>:<span class="title class_">UIContext</span></span><br><span class="line">  <span class="comment">/** 预定义断点范围配置（可扩展）*/</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="attr">breakpoints</span>: <span class="title class_">Breakpoint</span>[] = [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;xs&#x27;</span>, <span class="attr">size</span>: <span class="number">0</span> &#125;,     <span class="comment">// 0vp &lt;= width &lt; 320vp</span></span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;sm&#x27;</span>, <span class="attr">size</span>: <span class="number">320</span> &#125;,   <span class="comment">// 320vp &lt;= width &lt; 600vp</span></span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;md&#x27;</span>, <span class="attr">size</span>: <span class="number">600</span> &#125;,   <span class="comment">// 700vp &lt;= width &lt; 1040vp</span></span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;lg&#x27;</span>, <span class="attr">size</span>: <span class="number">1040</span> &#125;    <span class="comment">// 1040vp &lt;= width</span></span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 使用Set存储状态观察者（自动去重）[1](<span class="doctag">@ref</span>)*/</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">_states</span>: <span class="title class_">Set</span>&lt;<span class="title class_">BreakpointState</span>&lt;<span class="title class_">Object</span>&gt;&gt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">get</span> <span class="title function_">states</span>(): <span class="title class_">Set</span>&lt;<span class="title class_">BreakpointState</span>&lt;<span class="title class_">Object</span>&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_states</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 私有构造器（单例模式）</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">constructor</span>(<span class="params"><span class="attr">uiContext</span>:<span class="title class_">UIContext</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_states</span> = <span class="keyword">new</span> <span class="title class_">Set</span>()  <span class="comment">// 初始化观察者集合</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">uiContext</span>=uiContext</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 获取单例实例 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">getInstance</span>(<span class="attr">uiContext</span>:<span class="title class_">UIContext</span>): <span class="title class_">BreakpointSystem</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">BreakpointSystem</span>.<span class="property">instance</span>) &#123;</span><br><span class="line">      <span class="title class_">BreakpointSystem</span>.<span class="property">instance</span> = <span class="keyword">new</span> <span class="title class_">BreakpointSystem</span>(uiContext)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">BreakpointSystem</span>.<span class="property">instance</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 注册状态观察者 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">attach</span>(<span class="attr">state</span>: <span class="title class_">BreakpointState</span>&lt;<span class="title class_">Object</span>&gt;): <span class="built_in">void</span> &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;BREAK_POINT_SYSTEM_LOG_TAG&#125;</span>注册状态观察者`</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_states</span>.<span class="title function_">add</span>(state)  <span class="comment">// 添加新观察者到集合</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 注销状态观察者 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">detach</span>(<span class="attr">state</span>: <span class="title class_">BreakpointState</span>&lt;<span class="title class_">Object</span>&gt;): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_states</span>.<span class="title function_">delete</span>(state)  <span class="comment">// 从集合中移除观察者</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 启动断点监听系统 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">breakpoints</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params"><span class="attr">breakpoint</span>: <span class="title class_">Breakpoint</span>, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 查询条件</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">condition</span>: <span class="built_in">string</span></span><br><span class="line">      <span class="comment">// 动态生成媒体查询条件：</span></span><br><span class="line">      <span class="keyword">if</span> (index === <span class="variable language_">this</span>.<span class="property">breakpoints</span>.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 最后一个断点使用 &gt;= 条件</span></span><br><span class="line">        condition = <span class="string">`(<span class="subst">$&#123;breakpoint.size&#125;</span>vp&lt;=width)`</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 中间断点使用区间条件</span></span><br><span class="line">        condition = <span class="string">`(<span class="subst">$&#123;breakpoint.size&#125;</span>vp&lt;=width&lt;<span class="subst">$&#123;<span class="variable language_">this</span>.breakpoints[index + <span class="number">1</span>].size&#125;</span>vp)`</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建媒体查询监听器[1](@ref)</span></span><br><span class="line">      breakpoint.<span class="property">mediaQueryListener</span> = <span class="variable language_">this</span>.<span class="property">uiContext</span>.<span class="title function_">getMediaQuery</span>().<span class="title function_">matchMediaSync</span>(condition)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 初始化匹配状态检查</span></span><br><span class="line">      <span class="keyword">if</span> (breakpoint.<span class="property">mediaQueryListener</span>.<span class="property">matches</span>) &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;BREAK_POINT_SYSTEM_LOG_TAG&#125;</span>初始化匹配成功breakpoint.name=<span class="subst">$&#123;breakpoint.name&#125;</span>`</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">updateAllState</span>(breakpoint.<span class="property">name</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 注册尺寸变化监听回调</span></span><br><span class="line">      breakpoint.<span class="property">mediaQueryListener</span>.<span class="title function_">on</span>(<span class="string">&#x27;change&#x27;</span>, <span class="function">(<span class="params">mediaQueryResult</span>) =&gt;</span> &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;BREAK_POINT_SYSTEM_LOG_TAG&#125;</span>触发断点状态变化回调`</span>)</span><br><span class="line">        <span class="keyword">if</span> (mediaQueryResult.<span class="property">matches</span>) &#123;</span><br><span class="line">          logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;BREAK_POINT_SYSTEM_LOG_TAG&#125;</span>匹配成功breakpoint.name=<span class="subst">$&#123;breakpoint.name&#125;</span>`</span>)</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">updateAllState</span>(breakpoint.<span class="property">name</span>)  <span class="comment">// 触发状态更新</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">BREAK_POINT_SYSTEM_LOG_TAG</span>+<span class="string">`第<span class="subst">$&#123;index&#125;</span>个断点状态对象启动完成`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 更新所有观察者状态 */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">updateAllState</span>(<span class="attr">type</span>: <span class="title class_">BreakpointType</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_states</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">state</span> =&gt;</span> state.<span class="title function_">update</span>(<span class="keyword">type</span>))  <span class="comment">// 遍历执行更新</span></span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="variable constant_">BREAK_POINT_SYSTEM_LOG_TAG</span>+<span class="string">&#x27;全部断点状态更新完成&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 停止监听并清理资源 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">stop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">breakpoints</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">breakpoint</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (breakpoint.<span class="property">mediaQueryListener</span>) &#123;</span><br><span class="line">        breakpoint.<span class="property">mediaQueryListener</span>.<span class="title function_">off</span>(<span class="string">&#x27;change&#x27;</span>)  <span class="comment">// 注销监听器</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_states</span>.<span class="title function_">clear</span>()  <span class="comment">// 清空观察者集合</span></span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="variable constant_">BREAK_POINT_SYSTEM_LOG_TAG</span>+<span class="string">&#x27;断点状态对象全部关闭&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时将其初始化的过程从appInit中移出，放置在了首页的生命周期函数中，因为UIContext对象是在窗口的构建之后才会被初始化的。</p>
<h4 id="窗口断点宽度调整"><a href="#窗口断点宽度调整" class="headerlink" title="窗口断点宽度调整"></a>窗口断点宽度调整</h4><p>依据官方给出的断点划分840VP以上就是lg断点了，但是840这个分界线会导致平板竖屏场景下依旧是分栏模式不会呈现出单栏模式。这并不合适。于是我尝试将lg断点情况的判定扩展到1040VP，进行测试。</p>
<video width="100%" controls>
  <source src="50.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>效果很不错，同时也是完美的适配了全景多窗的场景。但我们也要看到缺点，在自由多窗的场景下我们的显示效果并不那么尽如人意。</p>
<video width="100%" controls>
  <source src="51.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<h4 id="自由多窗模式针对调优"><a href="#自由多窗模式针对调优" class="headerlink" title="自由多窗模式针对调优"></a>自由多窗模式针对调优</h4><p>首先分析一下当前的自由多窗场景下出现显示效果不佳的主要原因。</p>
<p>当前的切换逻辑在我手动覆写之后，切换的依据完全是根据窗口的宽度去进行切换，没有考虑到高度以及长宽比的问题。在实际应用中，自由多窗很可能出现宽度较小，但高度更小的情况，就会出现内容比例过大，信息密度过小的情况出现。这里用一个视频来解释一下。</p>
<video width="100%" controls>
  <source src="52.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>随意对于这个问题我想到了两种方式，分别是升级断点判断系统，依据窗宽比来去实现断点的切换。另一种则是设置窗口最小高度，同时设置平板的方向旋转事件的监听。当旋转事件发生之后就自动切换为单栏模式，这样我们就可以去将切换为单栏模式的最小宽度给缩小，这样就不会出现宽胖窗口形态下的单栏模式问题了。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">注册最小高度与旋转事件</button><button type="button" class="tab">升级断点系统</button></div><div class="tab-contents"><div class="tab-item-content active"><p>在开始这个方法的尝试之前我是先去尝试了升级断点系统，在阅读官方的开源代码时学习到了设置窗口最小高度的方式于是就有了一下尝试。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">windowMinSizeInit</span>(<span class="params"><span class="attr">mainWindow</span>:<span class="variable language_">window</span>.<span class="title class_">Window</span></span>)&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">windowLimits</span>: <span class="variable language_">window</span>.<span class="property">WindowLimits</span> = &#123;</span><br><span class="line">      <span class="attr">minWidth</span>: <span class="number">350</span>,</span><br><span class="line">      <span class="attr">minHeight</span>:<span class="number">800</span></span><br><span class="line">    &#125;;</span><br><span class="line">    mainWindow.<span class="title function_">setWindowLimits</span>(windowLimits).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>设置窗口最小尺寸成功`</span>)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">err</span>: <span class="title class_">BusinessError</span></span>)=&gt;</span>&#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>设置窗口最小尺寸失败，错误原因：<span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;<span class="keyword">catch</span> (e)&#123;</span><br><span class="line">    <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>设置窗口最小尺寸失败，错误原因：<span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onWindowStageCreate</span>(<span class="attr">windowStage</span>: <span class="variable language_">window</span>.<span class="property">WindowStage</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Main window is created, set main page for this ability</span></span><br><span class="line">  hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onWindowStageCreate&#x27;</span>);</span><br><span class="line">  appInit.<span class="title function_">windowMinSizeInit</span>(windowStage.<span class="title function_">getMainWindowSync</span>())</span><br><span class="line">  windowStage.<span class="title function_">loadContent</span>(<span class="string">&#x27;pages/StartPage&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err.<span class="property">code</span>) &#123;</span><br><span class="line">      hilog.<span class="title function_">error</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Failed to load the content. Cause: %&#123;public&#125;s&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Succeeded in loading the content.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后进行测试。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/54.jpg" alt="54"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AppInit: 设置窗口最小尺寸失败，错误原因：Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</span><br></pre></td></tr></table></figure>
<p>额，失败了。看一下错误原因中提供的可能原因。1. 必填参数未指定；2. 参数类型不正确；3. 参数验证失败。难道说是我的设置位置出现了问题？</p>
<p>观察官方的开源代码发现它的设置位置是在加载首页之后的位置，但是我放在前面了，所以我放在后面再试试。</p>
<p>测试后还是失败了而且没有任何变化。难道说是因为我的参数设置的太大了。缩小到700试试。不行，再缩到400试试。还是不行。我有点不理解了。我将这一段拆出来直接放在生命周期函数中试试。</p>
<p>测试后还是不行。给日志做一些区分。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// Set mini window.</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">windowClass</span>: <span class="variable language_">window</span>.<span class="property">Window</span> = windowStage.<span class="title function_">getMainWindowSync</span>();</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">windowLimits</span>: <span class="variable language_">window</span>.<span class="property">WindowLimits</span> = &#123;</span><br><span class="line">    <span class="attr">minWidth</span>: <span class="number">350</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">let</span> promise = windowClass.<span class="title function_">setWindowLimits</span>(windowLimits);</span><br><span class="line">  promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">&#x27;Succeeded in changing the window limits.&#x27;</span>);</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">err</span>: <span class="title class_">BusinessError</span></span>) =&gt;</span> &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`promise设置窗口最小尺寸失败，错误原因：<span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">catch</span> (e)&#123;</span><br><span class="line">  <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">  logger.<span class="title function_">error</span>(<span class="string">`设置窗口最小尺寸失败，错误原因：<span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次测试发现问题出现在外层的trycatch中，说明异常发生在了<code>setWindowLimits</code>的传参过程中，而不是执行的过程。我决定先换一种使用配置文件修改的方式。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;abilities&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;EntryAbility&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;srcEntry&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./ets/entryability/EntryAbility.ets&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$string:EntryAbility_desc&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$media:logo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$string:EntryAbility_label&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;startWindowIcon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$media:logo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;startWindowBackground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$color:start_window_background&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;exported&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skills&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;entities&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;entity.system.home&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;action.system.home&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;supportWindowMode&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;floating&quot;</span><span class="punctuation">,</span><span class="string">&quot;fullscreen&quot;</span><span class="punctuation">,</span><span class="string">&quot;split&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;minWindowHeight&quot;</span><span class="punctuation">:</span> <span class="number">600</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>进行测试。</p>
<video width="100%" controls>
  <source src="55.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>成功了，调整的更大一些，调整到900，同时设置最小宽度为500。随后调整断点判断的极限值为780。</p>
<video width="100%" controls>
  <source src="56.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>！！！完美！！！</p>
<p>随后我们就可以开始依据于平板的旋转事件的监听去进行断点对象的改造了。</p>
<p>对于这一块我仔细的想了一下，改造现有的这套断点系统过于繁琐，不如直接在页面的生命周期函数中去进行操作的好。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Monitor</span>(<span class="string">&#x27;breakPointState.value&#x27;</span>)</span><br><span class="line"><span class="title function_">getNavMode</span>(<span class="params"></span>) &#123;</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;Main_LOG_TAG&#125;</span>this.breakPointState.getCurrentBreakPointType() = <span class="subst">$&#123;<span class="variable language_">this</span>.breakPointState.getCurrentBreakPointType()&#125;</span>`</span>)</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getMediaQuery</span>().<span class="title function_">matchMediaSync</span>(<span class="string">&#x27;(orientation: landscape)&#x27;</span>).<span class="property">matches</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">breakPointState</span>.<span class="title function_">getCurrentBreakPointType</span>() === <span class="title class_">BreakpointEnum</span>.<span class="property">xs</span> ||</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">breakPointState</span>.<span class="title function_">getCurrentBreakPointType</span>() === <span class="title class_">BreakpointEnum</span>.<span class="property">sm</span> ||</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">breakPointState</span>.<span class="title function_">getCurrentBreakPointType</span>() === <span class="title class_">BreakpointEnum</span>.<span class="property">md</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">navMod</span> = <span class="title class_">NavigationMode</span>.<span class="property">Stack</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">navMod</span> = <span class="title class_">NavigationMode</span>.<span class="property">Split</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getMediaQuery</span>().<span class="title function_">matchMediaSync</span>(<span class="string">&#x27;(orientation: portrait)&#x27;</span>).<span class="property">matches</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">navMod</span> = <span class="title class_">NavigationMode</span>.<span class="property">Stack</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进行测试。</p>
<p>并没有生效，这里我推测的原因是在我修改了触发的极限值后屏幕的旋转并没有触发断点判断，所以导致回调函数没有触发。因此我需要去独立编写一下横竖屏监听事件的触发扳机。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">orientationMatch</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">mediaQueryListener</span>:mediaquery.<span class="property">MediaQueryListener</span> = <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getMediaQuery</span>().<span class="title function_">matchMediaSync</span>(<span class="string">&#x27;(orientation: landscape)&#x27;</span>)</span><br><span class="line">  mediaQueryListener.<span class="title function_">on</span>(<span class="string">&#x27;change&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;Main_LOG_TAG&#125;</span>横竖屏发生变化`</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getNavMode</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Local</span> <span class="attr">breakpointSystem</span>:<span class="title class_">BreakpointSystem</span>=<span class="title class_">BreakpointSystem</span>.<span class="title function_">getInstance</span>(<span class="variable language_">this</span>.<span class="title function_">getUIContext</span>())</span><br><span class="line"><span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">breakpointSystem</span>.<span class="title function_">attach</span>(<span class="variable language_">this</span>.<span class="property">breakPointState</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">breakpointSystem</span>.<span class="title function_">start</span>()</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">orientationMatch</span>()</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getNavMode</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次测试。</p>
<p>完美解决！！！</p>
<video width="100%" controls>
  <source src="57.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video></div><div class="tab-item-content"><p>首先对于断点系统的升级，我想到两种方式，一种是再加一个断点去判断窗口高度的类型，然后通过排列组合长宽断点情况来去做出改变。还有一种就是直接使用宽高比来去进行断点的划分，从而取代单纯的宽度判断。不过关于这两种想法我都没有很合适的事件案例，所以我决定先去查一查官方的开源代码中的断点判断机制。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2024 Huawei Device Co., Ltd.</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AbilityConstant</span>, <span class="title class_">UIAbility</span>, <span class="title class_">Want</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; display, <span class="variable language_">window</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span>, deviceInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Logger</span> <span class="keyword">from</span> <span class="string">&#x27;../constants/utils/Logger&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">TAG</span>: <span class="built_in">string</span> = <span class="string">&#x27;EntryAbility&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">EntryAbility</span> <span class="keyword">extends</span> <span class="title class_ inherited__">UIAbility</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">windowObj</span>?: <span class="variable language_">window</span>.<span class="property">Window</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">updateBreakpoint</span>(<span class="attr">windowWidth</span>: <span class="built_in">number</span>, <span class="attr">windowHeight</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> windowWidthVp = windowWidth / display.<span class="title function_">getDefaultDisplaySync</span>().<span class="property">densityPixels</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">curBp</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (windowWidthVp &lt; <span class="number">600</span>) &#123;</span><br><span class="line">      curBp = <span class="string">&#x27;sm&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (windowWidthVp &lt; <span class="number">840</span>) &#123;</span><br><span class="line">      curBp = <span class="string">&#x27;md&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      curBp = <span class="string">&#x27;lg&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">AppStorage</span>.<span class="title function_">setOrCreate</span>(<span class="string">&#x27;breakPoint&#x27;</span>, curBp);</span><br><span class="line">    <span class="title class_">AppStorage</span>.<span class="title function_">setOrCreate</span>(<span class="string">&#x27;windowSize&#x27;</span>, windowWidth / display.<span class="title function_">getDefaultDisplaySync</span>().<span class="property">densityPixels</span>);</span><br><span class="line">    <span class="title class_">AppStorage</span>.<span class="title function_">setOrCreate</span>(<span class="string">&#x27;windowSizeHeight&#x27;</span>, windowHeight / display.<span class="title function_">getDefaultDisplaySync</span>().<span class="property">densityPixels</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onCreate</span>(<span class="attr">want</span>: <span class="title class_">Want</span>, <span class="attr">launchParam</span>: <span class="title class_">AbilityConstant</span>.<span class="property">LaunchParam</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onCreate&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onDestroy</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onDestroy&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onWindowStageCreate</span>(<span class="attr">windowStage</span>: <span class="variable language_">window</span>.<span class="property">WindowStage</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// Main window is created, set main page for this ability</span></span><br><span class="line">    <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onWindowStageCreate&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    windowStage.<span class="title function_">loadContent</span>(<span class="string">&#x27;pages/Index&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">AppStorage</span>.<span class="title function_">setOrCreate</span>(<span class="string">&#x27;uiContext&#x27;</span>, windowStage.<span class="title function_">getMainWindowSync</span>().<span class="title function_">getUIContext</span>());</span><br><span class="line">      <span class="keyword">if</span> (err.<span class="property">code</span>) &#123;</span><br><span class="line">        <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Failed to load the content. Cause: %&#123;public&#125;s&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err) ?? <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Succeeded in loading the content.&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    windowStage.<span class="title function_">getMainWindow</span>().<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">data</span>: <span class="variable language_">window</span>.<span class="title class_">Window</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// Window immersive.</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">deviceTypeInfo</span>: <span class="built_in">string</span> = deviceInfo.<span class="property">deviceType</span>;</span><br><span class="line">      <span class="keyword">if</span> (deviceTypeInfo !== <span class="string">&#x27;2in1&#x27;</span>) &#123;</span><br><span class="line">        data.<span class="title function_">setWindowLayoutFullScreen</span>(<span class="literal">true</span>)</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;Succeeded in setting the window layout to full-screen mode. Data: %&#123;public&#125;s&#x27;</span>,</span><br><span class="line">              <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data) ?? <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">err</span>: <span class="title class_">BusinessError</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;Failed to set the window layout to full-screen mode. Cause: %&#123;public&#125;s&#x27;</span>,</span><br><span class="line">              <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err) ?? <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">windowObj</span> = data;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">updateBreakpoint</span>(<span class="variable language_">this</span>.<span class="property">windowObj</span>.<span class="title function_">getWindowProperties</span>().<span class="property">windowRect</span>.<span class="property">width</span>,</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">windowObj</span>.<span class="title function_">getWindowProperties</span>().<span class="property">windowRect</span>.<span class="property">height</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">windowObj</span>.<span class="title function_">on</span>(<span class="string">&#x27;windowSizeChange&#x27;</span>, <span class="function">(<span class="params"><span class="attr">windowSize</span>: <span class="variable language_">window</span>.<span class="title class_">Size</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">updateBreakpoint</span>(windowSize.<span class="property">width</span>, windowSize.<span class="property">height</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// Set mini window.</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">windowClass</span>: <span class="variable language_">window</span>.<span class="property">Window</span> = windowStage.<span class="title function_">getMainWindowSync</span>();</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">windowLimits</span>: <span class="variable language_">window</span>.<span class="property">WindowLimits</span> = &#123;</span><br><span class="line">        <span class="attr">minWidth</span>: <span class="number">350</span></span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">let</span> promise = windowClass.<span class="title function_">setWindowLimits</span>(windowLimits);</span><br><span class="line">      promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Succeeded in changing the window limits.&#x27;</span>);</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">err</span>: <span class="title class_">BusinessError</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Failed to change the window limits. Cause: %&#123;public&#125;s&#x27;</span>,</span><br><span class="line">          <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err) ?? <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (exception) &#123;</span><br><span class="line">      <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Failed to change the window limits. Cause: %&#123;public&#125;s&#x27;</span>,</span><br><span class="line">        <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(exception) ?? <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onWindowStageDestroy</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// Main window is destroyed, release UI related resources</span></span><br><span class="line">    <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onWindowStageDestroy&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onForeground</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// Ability has brought to foreground</span></span><br><span class="line">    <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onForeground&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onBackground</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// Ability has back to background</span></span><br><span class="line">    <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onBackground&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们注意到了官方给出的断点判断与我所想的不同，并不是直接使用长宽比去进行判断，此时在仔细回想的确如此，若面积不同但都是相似图形的话，他的长宽比并不会变，我的想法的确是不合理。</p>
<p><code>display</code>这个包我确实是不熟悉，所以我要先去查询一下<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display">官方文档</a>的讲解。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/53.png" alt="53"></p>
<p>在阅读了官方文档中对于<code>densityPixels</code>的解释后，我明白了其实官方的这个划分模式依旧是纯粹的使用宽度进行断点判断罢了。也并没有在断点上去考虑高度的数据。</p>
<p>不过在仔细的阅读后我就发现，这里面还有一个设置最小窗口大小的API可以被我的另一种方式所应用。也就是下面这段代码。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// Set mini window.</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">windowClass</span>: <span class="variable language_">window</span>.<span class="property">Window</span> = windowStage.<span class="title function_">getMainWindowSync</span>();</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">windowLimits</span>: <span class="variable language_">window</span>.<span class="property">WindowLimits</span> = &#123;</span><br><span class="line">    <span class="attr">minWidth</span>: <span class="number">350</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">let</span> promise = windowClass.<span class="title function_">setWindowLimits</span>(windowLimits);</span><br><span class="line">  promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Succeeded in changing the window limits.&#x27;</span>);</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">err</span>: <span class="title class_">BusinessError</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Failed to change the window limits. Cause: %&#123;public&#125;s&#x27;</span>,</span><br><span class="line">      <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err) ?? <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (exception) &#123;</span><br><span class="line">  <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Failed to change the window limits. Cause: %&#123;public&#125;s&#x27;</span>,</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(exception) ?? <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码中使用了Window对象中的setWindowLimits方法，这个方法可以设置窗口的最小宽度，最大宽度，最小高度，最大高度。这样我们就可以通过设置最小高度来达到另一个方法的效果。</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>
<h3 id="主界面渲染布局"><a href="#主界面渲染布局" class="headerlink" title="主界面渲染布局"></a>主界面渲染布局</h3><h4 id="颜色切换按钮的位置布局"><a href="#颜色切换按钮的位置布局" class="headerlink" title="颜色切换按钮的位置布局"></a>颜色切换按钮的位置布局</h4><p>这个按钮之前为了测试方便直接放在了主界面的轮播图下面，很显然是不合理的。我考虑是直接将这个按钮放在整个屏幕的右下角，和我博客手机端的切换按钮相似的位置。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Stack</span>()&#123;</span><br><span class="line">    <span class="title class_">Navigation</span>(<span class="variable language_">this</span>.<span class="property">navPathStuck</span>) &#123;</span><br><span class="line">      <span class="title class_">MainPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">linearGradient</span>(&#123;</span><br><span class="line">      <span class="attr">angle</span>: <span class="number">20</span>,</span><br><span class="line">      <span class="attr">colors</span>: [</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_1&#x27;</span>), <span class="number">0</span>],</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_2&#x27;</span>), <span class="number">0.4</span>],</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_3&#x27;</span>), <span class="number">0.7</span>],</span><br><span class="line">        [$r(<span class="string">&#x27;app.color.index_page_background_4&#x27;</span>), <span class="number">1</span>]</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">title</span>(<span class="string">&#x27;NowInOpenHarmony&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">navDestination</span>(<span class="variable language_">this</span>.<span class="property">NavDestMap</span>)</span><br><span class="line">    .<span class="title function_">hideToolBar</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">hideBackButton</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">titleMode</span>(<span class="title class_">NavigationTitleMode</span>.<span class="property">Mini</span>)</span><br><span class="line">    .<span class="title function_">mode</span>(<span class="variable language_">this</span>.<span class="property">navMod</span>)</span><br><span class="line">    .<span class="title function_">navBarWidth</span>(<span class="string">&#x27;40%&#x27;</span>)</span><br><span class="line">    <span class="title class_">ColorModChoseButton</span>()</span><br><span class="line">      .<span class="title function_">position</span>(&#123;<span class="attr">right</span>:<span class="number">30</span>,<span class="attr">bottom</span>:<span class="number">100</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="针对平板和手机的差异化布局"><a href="#针对平板和手机的差异化布局" class="headerlink" title="针对平板和手机的差异化布局"></a>针对平板和手机的差异化布局</h4><p>在平板上显得大小合适的按钮大小，在手机上显得就会有些大，容易遮挡内容，这主要是因为我们所使用的单位为虚拟像素单位VP而并非物理像素单位PX，两者的分辨率以及VP的换算比不一样所以我们需要进行一下定制化处理，虽然平板也会有分辨率和大小差异，但总体属于同一类别的设备，相差不会太多所以我们就不做更加细化的公式计算了。</p>
<p>这里主要依赖的是之前在读官方提供的开源代码时学习到的<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-enterprise-deviceinfo#deviceinfogetdeviceinfo">deviceInfo设备信息管理</a>的系统能力。通过这个kit我们可以获取当前设备的类型，从而进行判断。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DEFAULT_COLOR_MODE</span>, deviceTypesEnum, <span class="variable constant_">GET_USER_CONFIG</span>, logger, <span class="title class_">UserConfigViewModel</span> &#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; colorModManager &#125; <span class="keyword">from</span> <span class="string">&quot;../../managers/ColorModManager&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ConfigurationConstant</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.AbilityKit&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; deviceInfo &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ColorModChoseButton</span>_LOG_TAG = <span class="string">&#x27;ColorModChoseButton: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 颜色模式切换按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">ColorModChoseButton</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">deviceType</span>: deviceTypesEnum =</span><br><span class="line">    deviceInfo.<span class="property">deviceType</span> === deviceTypesEnum.<span class="property">PHONE</span> ? deviceTypesEnum.<span class="property">PHONE</span> : deviceTypesEnum.<span class="property">TABLET</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">appColorMode</span>: <span class="number">0</span> | <span class="number">1</span> | <span class="number">2</span> = <span class="variable constant_">DEFAULT_COLOR_MODE</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">appColorMode</span> =</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">colorModel</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">changeColorMode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="string">`<span class="subst">$&#123;ColorModChoseButton_LOG_TAG&#125;</span>颜色切换触发`</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span> === <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">appColorMode</span> = <span class="number">0</span></span><br><span class="line">      colorModManager.<span class="title function_">setLightMod</span>()</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModChoseButton_LOG_TAG&#125;</span>点击生效，切换为浅色模式`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">appColorMode</span> = <span class="number">1</span></span><br><span class="line">      colorModManager.<span class="title function_">setDarkMod</span>()</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModChoseButton_LOG_TAG&#125;</span>点击生效，切换为深色模式`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span> === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">appColorMode</span> = <span class="number">2</span></span><br><span class="line">      colorModManager.<span class="title function_">setDefaultColorMode</span>()</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;ColorModChoseButton_LOG_TAG&#125;</span>点击生效，切换为跟随系统模式`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Stack</span>(&#123; <span class="attr">alignContent</span>: <span class="title class_">Alignment</span>.<span class="property">Center</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Image</span>($rawfile(<span class="string">&#x27;colorButtonBG.svg&#x27;</span>))</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;90%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;90%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fillColor</span>($r(<span class="string">&#x27;app.color.color_change_button_svg&#x27;</span>))</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span> === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;系&#x27;</span>)</span><br><span class="line">          .<span class="title function_">textStyle</span>(<span class="variable language_">this</span>.<span class="property">deviceType</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span> === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;深&#x27;</span>)</span><br><span class="line">          .<span class="title function_">textStyle</span>(<span class="variable language_">this</span>.<span class="property">deviceType</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appColorMode</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;浅&#x27;</span>)</span><br><span class="line">          .<span class="title function_">textStyle</span>(<span class="variable language_">this</span>.<span class="property">deviceType</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">deviceType</span> === deviceTypesEnum.<span class="property">PHONE</span> ? <span class="number">35</span> : <span class="number">45</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="variable language_">this</span>.<span class="property">deviceType</span> === deviceTypesEnum.<span class="property">PHONE</span> ? <span class="number">35</span> : <span class="number">45</span>)</span><br><span class="line">    .<span class="title function_">shadow</span>(&#123;</span><br><span class="line">      <span class="attr">color</span>: <span class="title class_">Color</span>.<span class="property">Black</span>,</span><br><span class="line">      <span class="attr">radius</span>: <span class="number">10</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.color_change_button_background&#x27;</span>))</span><br><span class="line">    .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">changeColorMode</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">borderRadius</span>(<span class="number">99</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Extend</span>(<span class="title class_">Text</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">textStyle</span>(<span class="params"><span class="attr">deviceType</span>: deviceTypesEnum</span>) &#123;</span><br><span class="line">  .<span class="title function_">fontSize</span>(deviceType === deviceTypesEnum.<span class="property">PHONE</span> ? <span class="number">20</span> : <span class="number">30</span>)</span><br><span class="line">  .<span class="title function_">fontWeight</span>(<span class="number">800</span>)</span><br><span class="line">  .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.color_change_button_font&#x27;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="首页吸顶"><a href="#首页吸顶" class="headerlink" title="首页吸顶"></a>首页吸顶</h4><p>首先我先设置了两个彼此独立的ListItemGroup，随后为新闻列表编写一个Builder。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="title class_">NewsListHeaderBuilder</span>() &#123;</span><br><span class="line">  <span class="title class_">Column</span>() &#123;</span><br><span class="line">    <span class="title class_">Text</span>(<span class="string">`热点新闻共<span class="subst">$&#123;<span class="variable language_">this</span>.NewsList?.length&#125;</span>条`</span>)</span><br><span class="line">      .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">      .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.news_list_header_font&#x27;</span>))</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">10</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">  .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">  .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_header_bg&#x27;</span>))</span><br><span class="line">  .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">borderRadius</span>(&#123;</span><br><span class="line">    <span class="attr">topLeft</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">topRight</span>: <span class="number">20</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写完Builder后就可以将吸顶属性给设置上了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="title class_">NewsListHeaderBuilder</span>() &#123;</span><br><span class="line">  <span class="title class_">Column</span>() &#123;</span><br><span class="line">    <span class="title class_">Text</span>(<span class="string">`热点新闻共<span class="subst">$&#123;<span class="variable language_">this</span>.NewsList?.length&#125;</span>条`</span>)</span><br><span class="line">      .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">      .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.news_list_header_font&#x27;</span>))</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">10</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">  .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">  .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_header_bg&#x27;</span>))</span><br><span class="line">  .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">borderRadius</span>(&#123;</span><br><span class="line">    <span class="attr">topLeft</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">topRight</span>: <span class="number">20</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">NavDestination</span>() &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ListItemGroup</span>() &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>() &#123;</span><br><span class="line">              <span class="title class_">NewsSwiper</span>()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">ListItemGroup</span>(&#123; <span class="attr">header</span>: <span class="variable language_">this</span>.<span class="title class_">NewsListHeaderBuilder</span>() &#125;) &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">borderRadius</span>(&#123;</span><br><span class="line">          <span class="attr">topLeft</span>: <span class="number">20</span>,</span><br><span class="line">          <span class="attr">topRight</span>: <span class="number">20</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">sticky</span>(<span class="title class_">StickyStyle</span>.<span class="property">Header</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="热点新闻列表渲染"><a href="#热点新闻列表渲染" class="headerlink" title="热点新闻列表渲染"></a>热点新闻列表渲染</h4><p>对于渲染列表是一个包含了点击跳转至详情页的功能函数，要兼具跳转逻辑以及传参跳转传参的功能，所以我们将它封装为一个功能组件，而不是纯粹的UI样式组件。</p>
<p>这里具体的编写过程就不说了太简单了，最后就直接放代码就好了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DEVICE_TYPES</span>, <span class="variable constant_">NAV_PATH_STUCK</span>, <span class="title class_">NewsArticle</span> &#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; deviceInfo &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">NewsList</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">newsList</span>: <span class="title class_">NewsArticle</span>[] = []</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">navPathStuck</span>: <span class="title class_">NavPathStack</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NavPathStack</span>, <span class="variable constant_">NAV_PATH_STUCK</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">NavPathStack</span>())!</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">deviceType</span>: <span class="variable constant_">DEVICE_TYPES</span> =</span><br><span class="line">    deviceInfo.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> : <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">TABLET</span></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title class_">NewsListHeaderBuilder</span>() &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">`热点新闻共<span class="subst">$&#123;<span class="variable language_">this</span>.newsList?.length&#125;</span>条`</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.news_list_header_font&#x27;</span>))</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">10</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_header_bg&#x27;</span>))</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">borderRadius</span>(<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">margin</span>(&#123;</span><br><span class="line">      <span class="attr">bottom</span>:<span class="number">15</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">ListItemGroup</span>(&#123; <span class="attr">header</span>: <span class="variable language_">this</span>.<span class="title class_">NewsListHeaderBuilder</span>(),<span class="attr">space</span>:<span class="number">15</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">newsList</span>, <span class="function">(<span class="params"><span class="attr">news</span>: <span class="title class_">NewsArticle</span>, <span class="attr">index</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>(&#123;<span class="attr">space</span>:<span class="number">20</span>&#125;)&#123;</span><br><span class="line">            <span class="title class_">Text</span>(news.<span class="property">title</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">deviceType</span>===<span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span>?<span class="number">20</span>:<span class="number">25</span>)</span><br><span class="line">              .<span class="title function_">fontWeight</span>(<span class="number">900</span>)</span><br><span class="line">            <span class="title class_">Text</span>(news.<span class="property">date</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">              .<span class="title function_">fontWeight</span>(<span class="number">200</span>)</span><br><span class="line">              .<span class="title function_">textOverflow</span>(&#123;</span><br><span class="line">                <span class="attr">overflow</span>: <span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span></span><br><span class="line">              &#125;)</span><br><span class="line">              .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">borderWidth</span>(<span class="number">2</span>)</span><br><span class="line">        .<span class="title function_">borderColor</span>($r(<span class="string">&#x27;app.color.news_list_item_border&#x27;</span>))</span><br><span class="line">        .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_item_bg&#x27;</span>))</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">20</span>)</span><br><span class="line">        .<span class="title function_">padding</span>(&#123;</span><br><span class="line">          <span class="attr">top</span>:<span class="number">5</span>,</span><br><span class="line">          <span class="attr">bottom</span>:<span class="number">5</span>,</span><br><span class="line">          <span class="attr">left</span>:<span class="number">10</span>,</span><br><span class="line">          <span class="attr">right</span>:<span class="number">10</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">divider</span>(&#123;</span><br><span class="line">      <span class="attr">strokeWidth</span>:<span class="number">2</span>,</span><br><span class="line">      <span class="attr">color</span>:$r(<span class="string">&#x27;app.color.news_list_divider&#x27;</span>),</span><br><span class="line">      <span class="attr">endMargin</span>:<span class="number">20</span>,</span><br><span class="line">      <span class="attr">startMargin</span>:<span class="number">20</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">borderRadius</span>(&#123;</span><br><span class="line">      <span class="attr">topLeft</span>: <span class="number">20</span>,</span><br><span class="line">      <span class="attr">topRight</span>: <span class="number">20</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里为了保障渲染不出错误所以我的类型设置上并没有设置null的可能性，但是在主界面以及我们的数据获取接口的返回值都有可能是null，所以在传参的时候我也是使用了个小巧思。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">NewsList</span>(&#123; <span class="attr">newsList</span>: <span class="variable language_">this</span>.<span class="property">newsList</span> ?? [] &#125;)</span><br></pre></td></tr></table></figure>
<p>我使用了<code>??</code>来进行参数值的判断，简化了单独封装一个函数来去获取值的繁琐情况。<code>??</code>是空值合并运算符，只有在左侧为null或者undefined的时候才会返回右侧的值，毕竟null和一个空数组是两个不一样的类型。</p>
<p>随后进行一下实机测试。</p>
<video width="100%" controls>
  <source src="58.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<video width="100%" controls>
  <source src="59.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>随后我们还需要解决一下再header吸顶之后四个圆角会漏出一部分内容的问题，这看起来并不太好。还有就是在下拉刷新的逻辑，在下拉之后更新数据库数据，并等待数据库更新完成后再次进行数据库数据的提取，在此之间还要做一下加载动画。</p>
<h4 id="吸顶事件监听"><a href="#吸顶事件监听" class="headerlink" title="吸顶事件监听"></a>吸顶事件监听</h4><p>对于header吸顶事件的监听，虽然目前的API18中没有给出直接的监听函数，但是官方的Q&amp;A中给出了一种<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/architecture-guides/health-v1_2-ts_16-0000002445421321">解决方案</a>。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">StickyHeaderExample</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">arr</span>: <span class="built_in">number</span>[] = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title class_">CustomHeader</span>() &#123;</span><br><span class="line">    <span class="title class_">Text</span>(<span class="string">&#x27;分组标题&#x27;</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">      .<span class="title function_">onAreaChange</span>(<span class="function">(<span class="params"><span class="attr">oldValue</span>: <span class="title class_">Area</span>, <span class="attr">newValue</span>: <span class="title class_">Area</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (oldValue.<span class="property">position</span>.<span class="property">y</span> == <span class="number">0</span> &amp;&amp; newValue.<span class="property">position</span>.<span class="property">y</span> == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;没吸顶&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;吸顶了&#x27;</span>, oldValue.<span class="property">position</span>.<span class="property">y</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">arr</span>, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">&#x27;&#x27;</span> + item)</span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">              .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">              .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">              .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">              .<span class="title function_">backgroundColor</span>(<span class="number">0xFFFFFF</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">string</span></span>) =&gt;</span> item)</span><br><span class="line">        <span class="title class_">ListItemGroup</span>(&#123;</span><br><span class="line">          <span class="attr">header</span>: <span class="variable language_">this</span>.<span class="property">CustomHeader</span>,</span><br><span class="line">          <span class="attr">space</span>: <span class="number">10</span></span><br><span class="line">        &#125;) &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: <span class="number">20</span> &#125;), <span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">void</span>, <span class="attr">index</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">`列表项 <span class="subst">$&#123;index&#125;</span>`</span>)</span><br><span class="line">                .<span class="title function_">height</span>(<span class="number">80</span>)</span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#FFF&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">sticky</span>(<span class="title class_">StickyStyle</span>.<span class="property">Header</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要就是依据我们的header组件在吸顶时他的y轴坐标始终为0这个特性来作为触发扳机，所以我们可以通过监听y轴坐标的变化来判断header是否吸顶。</p>
<p>首先依据官方给出的方案我们来编写一版基础的代码进行测试。</p>
<video width="100%" controls>
  <source src="60.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>可以看到这里是有一个比较严重的抖动问题，这个问题的原因其实比较好理解，就是在我们的header在第一次触发吸顶时就会开始动画的播放，但播放动画的过程可能会产生几个像素的强制位移，这就会导致监听器监听到了y轴坐标的变化，导致反复触发吸顶切换动画。</p>
<p>为了解决这个问题我们只需要引入一个防抖机制就可以，同时这个防抖机制也可以用来保障动画的完整性，保证单词动画是可以完整的播放，而不是说在动画播放过程中被强制打断。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">ANIMATE_PARAM</span>,</span><br><span class="line">  <span class="variable constant_">DEVICE_TYPES</span>,</span><br><span class="line">  <span class="variable constant_">IS_STICKY</span>,</span><br><span class="line">  logger,</span><br><span class="line">  <span class="variable constant_">NAV_PATH_STUCK</span>,</span><br><span class="line">  <span class="title class_">NewsArticle</span>,</span><br><span class="line">  <span class="title class_">NewsListHeaderIsSticky</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span>, curves &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; deviceInfo &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewsList</span>_LOG_TAG = <span class="string">&#x27;NewsList: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">NewsList</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">newsList</span>: <span class="title class_">NewsArticle</span>[] = []</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">navPathStuck</span>: <span class="title class_">NavPathStack</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NavPathStack</span>, <span class="variable constant_">NAV_PATH_STUCK</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">NavPathStack</span>())!</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">deviceType</span>: <span class="variable constant_">DEVICE_TYPES</span> =</span><br><span class="line">    deviceInfo.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> : <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">TABLET</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isNewsListSticky</span>: <span class="title class_">NewsListHeaderIsSticky</span> =</span><br><span class="line">    <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NewsListHeaderIsSticky</span>, <span class="variable constant_">IS_STICKY</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">NewsListHeaderIsSticky</span>())!</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">headerRadius</span>: <span class="built_in">number</span> = <span class="number">20</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">headerAlignItems</span>: <span class="title class_">HorizontalAlign</span> = <span class="title class_">HorizontalAlign</span>.<span class="property">Center</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">headerFontSize</span>: <span class="built_in">number</span> = <span class="number">35</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isOnAreaChange</span>:<span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title class_">NewsListHeaderBuilder</span>() &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`热点新闻共<span class="subst">$&#123;<span class="variable language_">this</span>.newsList?.length&#125;</span>条`</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">headerFontSize</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.news_list_header_font&#x27;</span>))</span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">10</span> &#125;)</span><br><span class="line">          .<span class="title function_">animation</span>(&#123;</span><br><span class="line">            <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseInOut</span>,</span><br><span class="line">            <span class="attr">duration</span>: <span class="number">500</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;95%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="variable language_">this</span>.<span class="property">headerAlignItems</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_header_bg&#x27;</span>))</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="variable language_">this</span>.<span class="property">headerRadius</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123;</span><br><span class="line">        <span class="attr">bottom</span>: <span class="number">15</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">right</span>: <span class="number">5</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">animation</span>(&#123;</span><br><span class="line">        <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseInOut</span>,</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">500</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">animation</span>(&#123;</span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseInOut</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">500</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">onAreaChange</span>(<span class="function">(<span class="params"><span class="attr">oldValue</span>: <span class="title class_">Area</span>, <span class="attr">newValue</span>: <span class="title class_">Area</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isOnAreaChange</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue.<span class="property">position</span>.<span class="property">y</span> == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span> = <span class="literal">false</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span> = <span class="literal">true</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isOnAreaChange</span>=<span class="literal">true</span></span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isOnAreaChange</span>=<span class="literal">false</span></span><br><span class="line">          &#125;,<span class="number">500</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Monitor</span>(<span class="string">&#x27;isNewsListSticky.isSticky&#x27;</span>)</span><br><span class="line">  <span class="title function_">viewChange</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerRadius</span> = <span class="number">0</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerAlignItems</span> = <span class="title class_">HorizontalAlign</span>.<span class="property">Start</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerFontSize</span> = <span class="number">20</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerRadius</span> = <span class="number">20</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerAlignItems</span> = <span class="title class_">HorizontalAlign</span>.<span class="property">Center</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerFontSize</span> = <span class="number">35</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="string">&#x27;NewsList aboutToAppear&#x27;</span>)</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">newsList</span>.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>()</span><br><span class="line">          .<span class="title function_">getPromptAction</span>()</span><br><span class="line">          .<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;后端数据正在更新请稍后下拉刷新或重启应用重试&#x27;</span>, <span class="attr">duration</span>: <span class="number">5000</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">ListItemGroup</span>(&#123; <span class="attr">header</span>: <span class="variable language_">this</span>.<span class="title class_">NewsListHeaderBuilder</span>(), <span class="attr">space</span>: <span class="number">30</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">newsList</span>, <span class="function">(<span class="params"><span class="attr">news</span>: <span class="title class_">NewsArticle</span>, <span class="attr">index</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">              <span class="title class_">Text</span>(news.<span class="property">title</span>)</span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="number">20</span> : <span class="number">25</span>)</span><br><span class="line">                .<span class="title function_">fontWeight</span>(<span class="number">900</span>)</span><br><span class="line">              <span class="title class_">Column</span>() &#123;</span><br><span class="line">                <span class="title class_">Text</span>(<span class="string">`来自于<span class="subst">$&#123;news.source&#125;</span>`</span>)</span><br><span class="line">                  .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">                  .<span class="title function_">fontWeight</span>(<span class="number">200</span>)</span><br><span class="line">                  .<span class="title function_">textOverflow</span>(&#123;</span><br><span class="line">                    <span class="attr">overflow</span>: <span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span></span><br><span class="line">                  &#125;)</span><br><span class="line">                  .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">                <span class="title class_">Text</span>(news.<span class="property">date</span>)</span><br><span class="line">                  .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">                  .<span class="title function_">fontWeight</span>(<span class="number">200</span>)</span><br><span class="line">                  .<span class="title function_">textOverflow</span>(&#123;</span><br><span class="line">                    <span class="attr">overflow</span>: <span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span></span><br><span class="line">                  &#125;)</span><br><span class="line">                  .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">              &#125;</span><br><span class="line">              .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">padding</span>(&#123;</span><br><span class="line">              <span class="attr">top</span>: <span class="number">5</span>,</span><br><span class="line">              <span class="attr">bottom</span>: <span class="number">5</span>,</span><br><span class="line">              <span class="attr">left</span>: <span class="number">10</span>,</span><br><span class="line">              <span class="attr">right</span>: <span class="number">10</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">19</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_item_bg&#x27;</span>))</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;95%&#x27;</span>)</span><br><span class="line">          .<span class="title function_">backgroundImage</span>($rawfile(<span class="string">&#x27;newsListItemBG.png&#x27;</span>))</span><br><span class="line">          .<span class="title function_">borderWidth</span>(<span class="number">2</span>)</span><br><span class="line">          .<span class="title function_">borderColor</span>($r(<span class="string">&#x27;app.color.news_list_item_border&#x27;</span>))</span><br><span class="line">          .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_item_bg&#x27;</span>))</span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">transition</span>(<span class="variable constant_">ANIMATE_PARAM</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">alignSelf</span>(<span class="title class_">ItemAlign</span>.<span class="property">Center</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">borderRadius</span>(&#123;</span><br><span class="line">      <span class="attr">topLeft</span>: <span class="number">20</span>,</span><br><span class="line">      <span class="attr">topRight</span>: <span class="number">20</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="61.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>效果很爽啊真的。</p>
<h4 id="返回顶部按钮"><a href="#返回顶部按钮" class="headerlink" title="返回顶部按钮"></a>返回顶部按钮</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">NEWS_LIST_ITEM_ANIMATE_PARAM</span>,</span><br><span class="line">  <span class="variable constant_">DEVICE_TYPES</span>,</span><br><span class="line">  <span class="variable constant_">IS_STICKY</span>,</span><br><span class="line">  logger,</span><br><span class="line">  <span class="variable constant_">NAV_PATH_STUCK</span>,</span><br><span class="line">  <span class="title class_">NewsArticle</span>,</span><br><span class="line">  <span class="title class_">NewsListHeaderIsSticky</span>,</span><br><span class="line">  <span class="variable constant_">NEWS_LIST_ANIMATION_PARAM</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span>, curves &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; deviceInfo &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewsList</span>_LOG_TAG = <span class="string">&#x27;NewsList: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">NewsList</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">listScroller</span>:<span class="title class_">Scroller</span> = <span class="keyword">new</span> <span class="title class_">Scroller</span>()</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">newsList</span>: <span class="title class_">NewsArticle</span>[] = []</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">navPathStuck</span>: <span class="title class_">NavPathStack</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NavPathStack</span>, <span class="variable constant_">NAV_PATH_STUCK</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">NavPathStack</span>())!</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">deviceType</span>: <span class="variable constant_">DEVICE_TYPES</span> =</span><br><span class="line">    deviceInfo.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> : <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">TABLET</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isNewsListSticky</span>: <span class="title class_">NewsListHeaderIsSticky</span> =</span><br><span class="line">    <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NewsListHeaderIsSticky</span>, <span class="variable constant_">IS_STICKY</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">NewsListHeaderIsSticky</span>())!</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">headerRadius</span>: <span class="built_in">number</span> = <span class="number">20</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">headerAlignItems</span>: <span class="title class_">HorizontalAlign</span> = <span class="title class_">HorizontalAlign</span>.<span class="property">Center</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">headerFontSize</span>: <span class="built_in">number</span> = <span class="number">35</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isOnAreaChange</span>:<span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title class_">NewsListHeaderBuilder</span>() &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`热点新闻共<span class="subst">$&#123;<span class="variable language_">this</span>.newsList?.length&#125;</span>条`</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">headerFontSize</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.news_list_header_font&#x27;</span>))</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">10</span> &#125;)</span><br><span class="line">            .<span class="title function_">animation</span>(<span class="variable constant_">NEWS_LIST_ANIMATION_PARAM</span>)</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span>)&#123;</span><br><span class="line">            <span class="title class_">Image</span>($rawfile(<span class="string">&#x27;backToTop.svg&#x27;</span>))</span><br><span class="line">              .<span class="title function_">fillColor</span>($r(<span class="string">&#x27;app.color.back_to_top&#x27;</span>))</span><br><span class="line">              .<span class="title function_">width</span>(<span class="number">25</span>)</span><br><span class="line">              .<span class="title function_">transition</span>(<span class="variable constant_">NEWS_LIST_ITEM_ANIMATE_PARAM</span>)</span><br><span class="line">              .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">listScroller</span>.<span class="title function_">scrollEdge</span>(<span class="title class_">Edge</span>.<span class="property">Top</span>,&#123;<span class="attr">velocity</span>:<span class="number">6000</span>&#125;)</span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">justifyContent</span>(<span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span>?<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>:<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;95%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_header_bg&#x27;</span>))</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="variable language_">this</span>.<span class="property">headerRadius</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123;</span><br><span class="line">        <span class="attr">bottom</span>: <span class="number">15</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">right</span>: <span class="number">5</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">animation</span>(<span class="variable constant_">NEWS_LIST_ANIMATION_PARAM</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">animation</span>(<span class="variable constant_">NEWS_LIST_ANIMATION_PARAM</span>)</span><br><span class="line">    .<span class="title function_">onAreaChange</span>(<span class="function">(<span class="params"><span class="attr">oldValue</span>: <span class="title class_">Area</span>, <span class="attr">newValue</span>: <span class="title class_">Area</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isOnAreaChange</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue.<span class="property">position</span>.<span class="property">y</span> == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span> = <span class="literal">false</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span> = <span class="literal">true</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isOnAreaChange</span>=<span class="literal">true</span></span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isOnAreaChange</span>=<span class="literal">false</span></span><br><span class="line">          &#125;,<span class="number">200</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Monitor</span>(<span class="string">&#x27;isNewsListSticky.isSticky&#x27;</span>)</span><br><span class="line">  <span class="title function_">viewChange</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerRadius</span> = <span class="number">0</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerAlignItems</span> = <span class="title class_">HorizontalAlign</span>.<span class="property">Start</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerFontSize</span> = <span class="number">20</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerRadius</span> = <span class="number">20</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerAlignItems</span> = <span class="title class_">HorizontalAlign</span>.<span class="property">Center</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerFontSize</span> = <span class="number">35</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="string">&#x27;NewsList aboutToAppear&#x27;</span>)</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">newsList</span>.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>()</span><br><span class="line">          .<span class="title function_">getPromptAction</span>()</span><br><span class="line">          .<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;后端数据正在更新请稍后下拉刷新或重启应用重试&#x27;</span>, <span class="attr">duration</span>: <span class="number">5000</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">ListItemGroup</span>(&#123; <span class="attr">header</span>: <span class="variable language_">this</span>.<span class="title class_">NewsListHeaderBuilder</span>(), <span class="attr">space</span>: <span class="number">30</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">newsList</span>, <span class="function">(<span class="params"><span class="attr">news</span>: <span class="title class_">NewsArticle</span>, <span class="attr">index</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">              <span class="title class_">Text</span>(news.<span class="property">title</span>)</span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="number">20</span> : <span class="number">25</span>)</span><br><span class="line">                .<span class="title function_">fontWeight</span>(<span class="number">900</span>)</span><br><span class="line">              <span class="title class_">Column</span>() &#123;</span><br><span class="line">                <span class="title class_">Text</span>(<span class="string">`来自于<span class="subst">$&#123;news.source&#125;</span>`</span>)</span><br><span class="line">                  .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">                  .<span class="title function_">fontWeight</span>(<span class="number">200</span>)</span><br><span class="line">                  .<span class="title function_">textOverflow</span>(&#123;</span><br><span class="line">                    <span class="attr">overflow</span>: <span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span></span><br><span class="line">                  &#125;)</span><br><span class="line">                  .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">                <span class="title class_">Text</span>(news.<span class="property">date</span>)</span><br><span class="line">                  .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">                  .<span class="title function_">fontWeight</span>(<span class="number">200</span>)</span><br><span class="line">                  .<span class="title function_">textOverflow</span>(&#123;</span><br><span class="line">                    <span class="attr">overflow</span>: <span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span></span><br><span class="line">                  &#125;)</span><br><span class="line">                  .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">              &#125;</span><br><span class="line">              .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">padding</span>(&#123;</span><br><span class="line">              <span class="attr">top</span>: <span class="number">5</span>,</span><br><span class="line">              <span class="attr">bottom</span>: <span class="number">5</span>,</span><br><span class="line">              <span class="attr">left</span>: <span class="number">10</span>,</span><br><span class="line">              <span class="attr">right</span>: <span class="number">10</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">19</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_item_bg&#x27;</span>))</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;95%&#x27;</span>)</span><br><span class="line">          .<span class="title function_">backgroundImage</span>($rawfile(<span class="string">&#x27;newsListItemBG.png&#x27;</span>))</span><br><span class="line">          .<span class="title function_">borderWidth</span>(<span class="number">2</span>)</span><br><span class="line">          .<span class="title function_">borderColor</span>($r(<span class="string">&#x27;app.color.news_list_item_border&#x27;</span>))</span><br><span class="line">          .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_item_bg&#x27;</span>))</span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">transition</span>(<span class="variable constant_">NEWS_LIST_ITEM_ANIMATE_PARAM</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">alignSelf</span>(<span class="title class_">ItemAlign</span>.<span class="property">Center</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">borderRadius</span>(&#123;</span><br><span class="line">      <span class="attr">topLeft</span>: <span class="number">20</span>,</span><br><span class="line">      <span class="attr">topRight</span>: <span class="number">20</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对原有的UI结构进行一些合理的调整，并将控制按钮的出现与吸顶扳机绑定，再加上一点点的出场动画，就可以开始测试了。</p>
<video width="100%" controls>
  <source src="62.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>可以看到有一点点卡顿，但不明显。改成懒加载优化一下性能。</p>
<h4 id="懒加载改造"><a href="#懒加载改造" class="headerlink" title="懒加载改造"></a>懒加载改造</h4><p><img src="/2025/06/29/OpenSourceSummer2025/63.png" alt="63"></p>
<p>这描述太对味了。让我们开始进行改造吧。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NewsArticle</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../../../../Index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BasicDataSource实现了IDataSource接口，用于管理listener监听，以及通知LazyForEach数据更新</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasicDataSource</span> <span class="keyword">implements</span> <span class="title class_">IDataSource</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">listeners</span>: <span class="title class_">DataChangeListener</span>[] = [];</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">originDataArray</span>: <span class="title class_">NewsArticle</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">totalCount</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">originDataArray</span>.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">getData</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="title class_">NewsArticle</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">originDataArray</span>[index];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 该方法为框架侧调用，为LazyForEach组件向其数据源处添加listener监听</span></span><br><span class="line">  <span class="title function_">registerDataChangeListener</span>(<span class="attr">listener</span>: <span class="title class_">DataChangeListener</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">indexOf</span>(listener) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;add listener&#x27;</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">push</span>(listener);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 该方法为框架侧调用，为对应的LazyForEach组件在数据源处去除listener监听</span></span><br><span class="line">  <span class="title function_">unregisterDataChangeListener</span>(<span class="attr">listener</span>: <span class="title class_">DataChangeListener</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> pos = <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">indexOf</span>(listener);</span><br><span class="line">    <span class="keyword">if</span> (pos &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;remove listener&#x27;</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">splice</span>(pos, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通知LazyForEach组件需要重载所有子组件</span></span><br><span class="line">  <span class="title function_">notifyDataReload</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">      listener.<span class="title function_">onDataReloaded</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通知LazyForEach组件需要在index对应索引处添加子组件</span></span><br><span class="line">  <span class="title function_">notifyDataAdd</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">      listener.<span class="title function_">onDataAdd</span>(index);</span><br><span class="line">      <span class="comment">// 写法2：listener.onDatasetChange([&#123;type: DataOperationType.ADD, index: index&#125;]);</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通知LazyForEach组件在index对应索引处数据有变化，需要重建该子组件</span></span><br><span class="line">  <span class="title function_">notifyDataChange</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">      listener.<span class="title function_">onDataChange</span>(index);</span><br><span class="line">      <span class="comment">// 写法2：listener.onDatasetChange([&#123;type: DataOperationType.CHANGE, index: index&#125;]);</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通知LazyForEach组件需要在index对应索引处删除该子组件</span></span><br><span class="line">  <span class="title function_">notifyDataDelete</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">      listener.<span class="title function_">onDataDelete</span>(index);</span><br><span class="line">      <span class="comment">// 写法2：listener.onDatasetChange([&#123;type: DataOperationType.DELETE, index: index&#125;]);</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通知LazyForEach组件将from索引和to索引处的子组件进行交换</span></span><br><span class="line">  <span class="title function_">notifyDataMove</span>(<span class="attr">from</span>: <span class="built_in">number</span>, <span class="attr">to</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">      listener.<span class="title function_">onDataMove</span>(<span class="keyword">from</span>, to);</span><br><span class="line">      <span class="comment">// 写法2：listener.onDatasetChange(</span></span><br><span class="line">      <span class="comment">//         [&#123;type: DataOperationType.EXCHANGE, index: &#123;start: from, end: to&#125;&#125;]);</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">notifyDatasetChange</span>(<span class="attr">operations</span>: <span class="title class_">DataOperation</span>[]): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">      listener.<span class="title function_">onDatasetChange</span>(operations);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">NewsListDataSource</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BasicDataSource</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">dataArray</span>: <span class="title class_">NewsArticle</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">totalCount</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">getData</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="title class_">NewsArticle</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">dataArray</span>[index];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">pushData</span>(<span class="attr">data</span>: <span class="title class_">NewsArticle</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="title function_">push</span>(data);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">notifyDataAdd</span>(<span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="property">length</span> - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先依据官方文档去封装好我们的数据源工具类，随后我们再去改写一下页面的数据源部分。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">NEWS_LIST_ITEM_ANIMATE_PARAM</span>,</span><br><span class="line">  <span class="variable constant_">DEVICE_TYPES</span>,</span><br><span class="line">  <span class="variable constant_">IS_STICKY</span>,</span><br><span class="line">  logger,</span><br><span class="line">  <span class="variable constant_">NAV_PATH_STUCK</span>,</span><br><span class="line">  <span class="title class_">NewsArticle</span>,</span><br><span class="line">  <span class="title class_">NewsListHeaderIsSticky</span>,</span><br><span class="line">  <span class="variable constant_">NEWS_LIST_ANIMATION_PARAM</span>,</span><br><span class="line">  <span class="title class_">NewsListDataSource</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span>, curves &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; deviceInfo &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewsList</span>_LOG_TAG = <span class="string">&#x27;NewsList: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">NewsList</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">listScroller</span>: <span class="title class_">Scroller</span> = <span class="keyword">new</span> <span class="title class_">Scroller</span>()</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">newsList</span>: <span class="title class_">NewsArticle</span>[] = []</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">navPathStuck</span>: <span class="title class_">NavPathStack</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NavPathStack</span>, <span class="variable constant_">NAV_PATH_STUCK</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">NavPathStack</span>())!</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">deviceType</span>: <span class="variable constant_">DEVICE_TYPES</span> =</span><br><span class="line">    deviceInfo.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> : <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">TABLET</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isNewsListSticky</span>: <span class="title class_">NewsListHeaderIsSticky</span> =</span><br><span class="line">    <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NewsListHeaderIsSticky</span>, <span class="variable constant_">IS_STICKY</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">NewsListHeaderIsSticky</span>())!</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">headerRadius</span>: <span class="built_in">number</span> = <span class="number">20</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">headerAlignItems</span>: <span class="title class_">HorizontalAlign</span> = <span class="title class_">HorizontalAlign</span>.<span class="property">Center</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">headerFontSize</span>: <span class="built_in">number</span> = <span class="number">35</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isOnAreaChange</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">newsListDataSource</span>: <span class="title class_">NewsListDataSource</span> = <span class="keyword">new</span> <span class="title class_">NewsListDataSource</span>()</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title class_">NewsListHeaderBuilder</span>() &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`热点新闻共<span class="subst">$&#123;<span class="variable language_">this</span>.newsList?.length&#125;</span>条`</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">headerFontSize</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.news_list_header_font&#x27;</span>))</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">10</span> &#125;)</span><br><span class="line">            .<span class="title function_">animation</span>(<span class="variable constant_">NEWS_LIST_ANIMATION_PARAM</span>)</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span>) &#123;</span><br><span class="line">            <span class="title class_">Image</span>($rawfile(<span class="string">&#x27;backToTop.svg&#x27;</span>))</span><br><span class="line">              .<span class="title function_">fillColor</span>($r(<span class="string">&#x27;app.color.back_to_top&#x27;</span>))</span><br><span class="line">              .<span class="title function_">width</span>(<span class="number">25</span>)</span><br><span class="line">              .<span class="title function_">transition</span>(<span class="variable constant_">NEWS_LIST_ITEM_ANIMATE_PARAM</span>)</span><br><span class="line">              .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">listScroller</span>.<span class="title function_">scrollEdge</span>(<span class="title class_">Edge</span>.<span class="property">Top</span>, &#123; <span class="attr">velocity</span>: <span class="number">6000</span> &#125;)</span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">justifyContent</span>(<span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span> ? <span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span> : <span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;95%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_header_bg&#x27;</span>))</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="variable language_">this</span>.<span class="property">headerRadius</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123;</span><br><span class="line">        <span class="attr">bottom</span>: <span class="number">15</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">right</span>: <span class="number">5</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">animation</span>(<span class="variable constant_">NEWS_LIST_ANIMATION_PARAM</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">animation</span>(<span class="variable constant_">NEWS_LIST_ANIMATION_PARAM</span>)</span><br><span class="line">    .<span class="title function_">onAreaChange</span>(<span class="function">(<span class="params"><span class="attr">oldValue</span>: <span class="title class_">Area</span>, <span class="attr">newValue</span>: <span class="title class_">Area</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isOnAreaChange</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue.<span class="property">position</span>.<span class="property">y</span> == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span> = <span class="literal">false</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span> = <span class="literal">true</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isOnAreaChange</span> = <span class="literal">true</span></span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isOnAreaChange</span> = <span class="literal">false</span></span><br><span class="line">          &#125;, <span class="number">200</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Monitor</span>(<span class="string">&#x27;isNewsListSticky.isSticky&#x27;</span>)</span><br><span class="line">  <span class="title function_">viewChange</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isNewsListSticky</span>.<span class="property">isSticky</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerRadius</span> = <span class="number">0</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerAlignItems</span> = <span class="title class_">HorizontalAlign</span>.<span class="property">Start</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerFontSize</span> = <span class="number">20</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerRadius</span> = <span class="number">20</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerAlignItems</span> = <span class="title class_">HorizontalAlign</span>.<span class="property">Center</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">headerFontSize</span> = <span class="number">35</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">pushNewsArticleDataToDataSource</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newsList</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newsListDataSource</span>.<span class="title function_">pushData</span>(item)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">newsList</span>.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>()</span><br><span class="line">          .<span class="title function_">getPromptAction</span>()</span><br><span class="line">          .<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;后端数据正在更新请稍后下拉刷新或重启应用重试&#x27;</span>, <span class="attr">duration</span>: <span class="number">5000</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">pushNewsArticleDataToDataSource</span>()</span><br><span class="line">    &#125;, <span class="number">200</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">ListItemGroup</span>(&#123; <span class="attr">header</span>: <span class="variable language_">this</span>.<span class="title class_">NewsListHeaderBuilder</span>(), <span class="attr">space</span>: <span class="number">30</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">LazyForEach</span>(<span class="variable language_">this</span>.<span class="property">newsListDataSource</span>, <span class="function">(<span class="params"><span class="attr">news</span>: <span class="title class_">NewsArticle</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">              <span class="title class_">Text</span>(news.<span class="property">title</span>)</span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="number">20</span> : <span class="number">25</span>)</span><br><span class="line">                .<span class="title function_">fontWeight</span>(<span class="number">900</span>)</span><br><span class="line">              <span class="title class_">Column</span>() &#123;</span><br><span class="line">                <span class="title class_">Text</span>(<span class="string">`来自于<span class="subst">$&#123;news.source&#125;</span>`</span>)</span><br><span class="line">                  .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">                  .<span class="title function_">fontWeight</span>(<span class="number">200</span>)</span><br><span class="line">                  .<span class="title function_">textOverflow</span>(&#123;</span><br><span class="line">                    <span class="attr">overflow</span>: <span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span></span><br><span class="line">                  &#125;)</span><br><span class="line">                  .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">                <span class="title class_">Text</span>(news.<span class="property">date</span>)</span><br><span class="line">                  .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">                  .<span class="title function_">fontWeight</span>(<span class="number">200</span>)</span><br><span class="line">                  .<span class="title function_">textOverflow</span>(&#123;</span><br><span class="line">                    <span class="attr">overflow</span>: <span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span></span><br><span class="line">                  &#125;)</span><br><span class="line">                  .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">              &#125;</span><br><span class="line">              .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">padding</span>(&#123;</span><br><span class="line">              <span class="attr">top</span>: <span class="number">5</span>,</span><br><span class="line">              <span class="attr">bottom</span>: <span class="number">5</span>,</span><br><span class="line">              <span class="attr">left</span>: <span class="number">10</span>,</span><br><span class="line">              <span class="attr">right</span>: <span class="number">10</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">19</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_item_bg&#x27;</span>))</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;95%&#x27;</span>)</span><br><span class="line">          .<span class="title function_">backgroundImage</span>($rawfile(<span class="string">&#x27;newsListItemBG.png&#x27;</span>))</span><br><span class="line">          .<span class="title function_">borderWidth</span>(<span class="number">2</span>)</span><br><span class="line">          .<span class="title function_">borderColor</span>($r(<span class="string">&#x27;app.color.news_list_item_border&#x27;</span>))</span><br><span class="line">          .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.news_list_item_bg&#x27;</span>))</span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">transition</span>(<span class="variable constant_">NEWS_LIST_ITEM_ANIMATE_PARAM</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">alignSelf</span>(<span class="title class_">ItemAlign</span>.<span class="property">Center</span>)</span><br><span class="line">      &#125;, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">NewsArticle</span>, <span class="attr">i</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;item.id&#125;</span>+<span class="subst">$&#123;i&#125;</span>`</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">borderRadius</span>(&#123;</span><br><span class="line">      <span class="attr">topLeft</span>: <span class="number">20</span>,</span><br><span class="line">      <span class="attr">topRight</span>: <span class="number">20</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用数据源进行数据渲染，这里将懒加载提前到下拉刷新逻辑编写之前也是为了方便后续数据更新的逻辑不用再次更新。对此我也进一步的为刷新逻辑进行一下接口的预留吧。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">NewsListDataSource</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BasicDataSource</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">dataArray</span>: <span class="title class_">NewsArticle</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">totalCount</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">getData</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="title class_">NewsArticle</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">dataArray</span>[index];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">pushData</span>(<span class="attr">data</span>: <span class="title class_">NewsArticle</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="title function_">push</span>(data);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">notifyDataAdd</span>(<span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="property">length</span> - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 批量添加数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> dataArr 待添加数据数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">pushDataArr</span>(<span class="attr">dataArr</span>: <span class="title class_">NewsArticle</span>[]): <span class="built_in">void</span> &#123;</span><br><span class="line">    dataArr.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span>=&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="title function_">push</span>(item)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">notifyDataAdd</span>(<span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="property">length</span> - <span class="number">1</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 重新录入全部数据，替换现有数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> newData 新的完整数据数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">resetData</span>(<span class="attr">newData</span>: <span class="title class_">NewsArticle</span>[]): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 替换现有数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataArray</span> = [...newData];</span><br><span class="line">    <span class="comment">// 通知组件重新加载所有数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">notifyDataReload</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ok，测试一下。</p>
<video width="100%" controls>
  <source src="64.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>哎呀太爽了。</p>
<h4 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h4><p>下拉刷新逻辑核心就是依赖一个Refresh组件，然后手动绑定一下下拉刷新结束的扳机，同时写一下刷新逻辑。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">IS_STICKY</span>, <span class="title class_">NewsArticle</span>, <span class="title class_">NewsListHeaderIsSticky</span> &#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NewsList</span>, newsManager, <span class="title class_">NewsSwiper</span> &#125; <span class="keyword">from</span> <span class="string">&quot;feature&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MainPage</span>_TAG = <span class="string">&#x27;MainPage: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">MainPage</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">newsList</span>: <span class="title class_">NewsArticle</span>[] | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isNewsListSticky</span>: <span class="title class_">NewsListHeaderIsSticky</span> =</span><br><span class="line">    <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">NewsListHeaderIsSticky</span>, <span class="variable constant_">IS_STICKY</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">NewsListHeaderIsSticky</span>())!</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">listScroller</span>: <span class="title class_">Scroller</span> = <span class="keyword">new</span> <span class="title class_">Scroller</span>()</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isLoading</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">aboutToAppear</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newsList</span> = <span class="keyword">await</span> newsManager.<span class="title function_">getNewsArticleListFromDB</span>()</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newsList</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getPromptAction</span>().<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">`当前数据库新闻数据为空,请连接后端服务以更新数据`</span> &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">newsList</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getPromptAction</span>().<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">`查询到<span class="subst">$&#123;<span class="variable language_">this</span>.newsList.length&#125;</span>条新闻数据`</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">reloadAllData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getPromptAction</span>().<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;刷新数据&#x27;</span> &#125;)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">await</span> newsManager.<span class="title function_">updateNewsListToDB</span>()) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newsList</span> = <span class="keyword">await</span> newsManager.<span class="title function_">getNewsArticleListFromDB</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newsList</span> = []</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getPromptAction</span>().<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;获取新数据失败请稍后再试。&#x27;</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Refresh</span>(&#123; <span class="attr">refreshing</span>: $$this.<span class="property">isLoading</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">20</span>, <span class="attr">scroller</span>: <span class="variable language_">this</span>.<span class="property">listScroller</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">ListItemGroup</span>() &#123;</span><br><span class="line">            <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">              <span class="title class_">NewsSwiper</span>()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="title class_">NewsList</span>(&#123; <span class="attr">newsList</span>: <span class="variable language_">this</span>.<span class="property">newsList</span> ?? [], <span class="attr">listScroller</span>: <span class="variable language_">this</span>.<span class="property">listScroller</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">edgeEffect</span>(<span class="title class_">EdgeEffect</span>.<span class="property">Spring</span>, &#123; <span class="attr">alwaysEnabled</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">        .<span class="title function_">chainAnimation</span>(<span class="literal">true</span>)</span><br><span class="line">        .<span class="title function_">sticky</span>(<span class="title class_">StickyStyle</span>.<span class="property">Header</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">onRefreshing</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">reloadAllData</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后再在NewsList组件补上一个监听器就可以。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Monitor</span>(<span class="string">&#x27;newsList&#x27;</span>)</span><br><span class="line"><span class="title function_">resetDataSource</span>(<span class="params"></span>)&#123;</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="string">&#x27;捕获到newsList变化&#x27;</span>+<span class="variable language_">this</span>.<span class="property">newsList</span>.<span class="property">length</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">newsListDataSource</span>.<span class="title function_">resetData</span>(<span class="variable language_">this</span>.<span class="property">newsList</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经测试很顺利。</p>
<h2 id="后端爬虫逻辑调优"><a href="#后端爬虫逻辑调优" class="headerlink" title="后端爬虫逻辑调优"></a>后端爬虫逻辑调优</h2><h3 id="CSDN爬虫数据问题"><a href="#CSDN爬虫数据问题" class="headerlink" title="CSDN爬虫数据问题"></a>CSDN爬虫数据问题</h3><p>在开发客户端时一直在编写一些逻辑函数的封装以及UI组件的封装，并没有过多在意我们所获取到的数据是否正确，因为总条数也确实很多我就没有在意，在渲染了NewsList组件后才发现获取的数据都是OpenHarmony官网的资讯，而并不是CSDN的资讯，这时我才意识到了CSDN的爬虫数据获取发生了错误。</p>
<p>首先是在渲染中发现新闻的日期都是很落后的，最细的一个是25年2月的，随后我又去CSDN搜索了一下发现最新的文章是今年8月的，那明显是错误了。</p>
<p>我的怀疑的问题有两点，一种是被反爬了，另一种是因为动态网页的页面内容导致我的爬虫没有等待内容加载完成就进行数据提取了。</p>
<p>在修改完了基础的爬虫逻辑后确实是因为没有等待内容加载完成就进行数据提取了，所以导致获取到的数据都是错误的。但是只有第一篇是成功的后续都是失败的，失败原因是被积极反爬了，所以我要尝试用虚拟IP，修改浏览器UA等功能的高级爬虫来进行尝试。</p>
<p>同时为了减少测试的等待时间，我们将分两种情况：</p>
<ol>
<li>首次启动时的分批写入：从0开始，每20篇立即写入</li>
<li>后续定时更新：完整爬取后一次性覆盖，避免数据倒退</li>
</ol>
<p>在更新完爬取机制之后的的确确是能够正常获取CSDN的数据了。那后端就还剩一个坑没填上了，也就是轮播图的问题。这个接口暂时还没开发。</p>
<h2 id="PR创建"><a href="#PR创建" class="headerlink" title="PR创建"></a>PR创建</h2><p>这一部分我从来没想过会如此麻烦，本以为是写好了直接push到仓库随后让导师审查一下并入主线就好了，结果想象到还有很多流程是我没考虑到的，这我才理解到为什么老师要催着我去先提交一份。</p>
<h3 id="doc签署"><a href="#doc签署" class="headerlink" title="doc签署"></a>doc签署</h3><p>之前一段时间，开源之夏的运营员私信问了我一次说是否有瓶颈，是否签署了劳务合同，是否有问题等常规的运营性的问题，也是为了确保是否能正常结项，我当时是信心十足的说没问题，但那也只是在我考虑了开发技术上的情况的确是没什么问题，但是我是没想到在PR的创建以及OpenHarmony的代码门禁上会好这么长时间。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/66.jpg" alt="66"></p>
<p>首先遇到的问题就是当我想创建pr的时候才发现我没有签署OpenHarmony的开源协议，在签署之后我才能去创建pr。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/65.jpg" alt="65"></p>
<p>签署完成，这一步倒是没有拦住我，我接着就去继续创建pr，但老师给出的要求是要先去创建一个issue，然后通过关联issue来去创建pr。</p>
<h3 id="创建issue"><a href="#创建issue" class="headerlink" title="创建issue"></a>创建issue</h3><p>首先我在当初和老师最初的交流中我本以为代码提交的流程不过是，我fork一下原仓库，随后我编写代码，将代码push到我的仓库最后再创建一个pr，让导师去同意一下就好了，就没有太多在意，前两个月都没管这个事，知道我UI大致做出来了项目有了最初版本的雏形了，在老师的提醒下我先去将当前尚不完善的代码进行了pr的创建。</p>
<p>在我创建pr之前，老师先让我去创建一个issue，在issue中编写一下档期啊你这个项目的介绍文档，仔细一想确实是个合理的过程，只不过此前我确实没有给第三方的仓库去进行过代码贡献，并不清楚具体的流程。</p>
<p>随后我创建了一个十分详细的文档放到了<a target="_blank" rel="noopener" href="https://gitcode.com/openharmony-sig/ostest_integration_test/issues/205">issue</a>的正文内容中。这种任务交给AI真的在合适不过了，快速的阅读项目，分析架构，给出整体的运作流程这种活，AI真的是干的又快又好，除非是需要对项目进行修改，刚需开发人员对项目的运作流程熟记于心，否则AI就是有绝对的优势。</p>
<p>随后老师说在评论区发送<code>start build</code>来执行门禁检查，当时我还没理解是什么意思，我就直接在我创建的issue下面去评论了<code>start build</code>然后也没有任何反应，但由于我当时并没有理解这个启动代码门禁检查是个什么意思，所以也就没管有没有反应就向老师反馈了，截了个图。现在看来真是蠢炸了，在issue下面构建个啥，又没有代码可以用来构建。不过我倒是很快意识到了问题的存在，但又因为不知道真正的流程是怎样的，所以就先去问了问AI，这才知道原来pr下方也是有评论区的，这真是此前闻所未闻了，也许是我github玩的还不够多吧，gitee，gitCode，github，gitlab这几家还是得多玩玩的，要不真成开源文盲了。</p>
<h3 id="签名推送"><a href="#签名推送" class="headerlink" title="签名推送"></a>签名推送</h3><p>在创建了issue，并编写了pr的简介之后，老师告诉我不光是没有签署开源协议，还没有进行commit的签名。“commit还有签名？”这是我当时内心的原话。用了这么久的git我是真的不知道commit还有签名这么个功能。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/67.jpg" alt="67"></p>
<p>我赶紧去问了问AI，仿照着老师提供的commit命令从新进行了尝试，随后在官网进行了一下查看，发现确实是有区别的。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/68.jpg" alt="68"></p>
<p>可以看到上面没有签名的它只有一行账号的信息，这是通过git账号登录或是ssh秘钥来去判断的是谁推送的commit，而经过签名的则会还有一行<code>Signed-off-by</code>。</p>
<h3 id="如何实现签名Commit"><a href="#如何实现签名Commit" class="headerlink" title="如何实现签名Commit"></a>如何实现签名Commit</h3><p>那么，如何使用git命令来实现commit签名呢？主要有两种方式：</p>
<h4 id="方式一：使用-s参数快速添加Signed-off-by"><a href="#方式一：使用-s参数快速添加Signed-off-by" class="headerlink" title="方式一：使用-s参数快速添加Signed-off-by"></a>方式一：使用-s参数快速添加Signed-off-by</h4><p>这是最简单的一种方式，只需在commit命令中添加<code>-s</code>或<code>--signoff</code>参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本语法</span></span><br><span class="line">git commit -s -m <span class="string">&quot;你的提交信息&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例</span></span><br><span class="line">git commit -s -m <span class="string">&quot;feat: 添加新功能&quot;</span></span><br></pre></td></tr></table></figure>
<p>这条命令会自动在你的提交信息末尾添加一行<code>Signed-off-by: 你的名字 &lt;你的邮箱&gt;</code>，这就是我们在截图中看到的签名行。</p>
<h4 id="方式二：使用GPG密钥进行加密签名"><a href="#方式二：使用GPG密钥进行加密签名" class="headerlink" title="方式二：使用GPG密钥进行加密签名"></a>方式二：使用GPG密钥进行加密签名</h4><p>如果你需要更高级的加密签名（在GitHub上会显示”Verified”徽章），可以使用GPG密钥：</p>
<ol>
<li><p><strong>检查是否已安装GPG</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --version</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>生成GPG密钥（如果没有）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --full-generate-key</span><br></pre></td></tr></table></figure>
<ul>
<li>选择密钥类型：通常选择默认的RSA和RSA</li>
<li>选择密钥长度：建议至少3072位</li>
<li>设置密钥有效期：根据需要选择</li>
<li>填写用户信息：姓名、邮箱等</li>
<li>设置密码：保护你的私钥</li>
</ul>
</li>
<li><p><strong>查看并复制GPG密钥ID</strong></p>
<p><code>bash
pg --list-secret-keys --keyid-format=long</code><br>找到以<code>sec</code>开头的行，格式类似<code>sec  rsa4096/3AA5C34371567BD2 2023-01-01 [SC]</code>，其中3AA5C34371567BD2`就是你的密钥ID。</p>
</li>
<li><p><strong>配置Git使用你的GPG密钥</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.signingkey 你的密钥ID</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在commit时使用GPG签名</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">每次commit时手动签名</span><br><span class="line">git commit -S -m <span class="string">&quot;你的提交信息&quot;</span></span><br><span class="line"></span><br><span class="line">或者设置默认签名所有commit</span><br><span class="line">git config --global commit.gpgsign <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>将GPG公钥添加到GitHub</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --armor --<span class="built_in">export</span> 你的密钥ID</span><br></pre></td></tr></table></figure>
<p>复制输出的公钥内容，然后添加到GitHub的”Settings &gt; SSH and GPG keys &gt; New GPG key”中。</p>
</li>
</ol>
<h4 id="方式三：使用SSH密钥进行签名"><a href="#方式三：使用SSH密钥进行签名" class="headerlink" title="方式三：使用SSH密钥进行签名"></a>方式三：使用SSH密钥进行签名</h4><p>GitHub也支持使用SSH密钥进行commit签名，这对于已经有SSH密钥的用户来说更加方便：</p>
<ol>
<li><p><strong>生成SSH密钥（如果没有）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 推荐使用更安全的Ed25519算法</span></span><br><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;你的邮箱&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用兼容性更好的RSA算法</span></span><br><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;你的邮箱&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置Git使用SSH密钥格式</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global gpg.format ssh</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>设置签名密钥路径</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.signingkey ~/.ssh/id_ed25519.pub</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>将SSH公钥添加到GitHub并标记为签名密钥</strong></p>
<ul>
<li>复制公钥内容：<code>cat ~/.ssh/id_ed25519.pub</code></li>
<li>添加到GitHub的”Settings &gt; SSH and GPG keys &gt; New SSH key”中</li>
<li>在”Key type”中选择”Signing Key”</li>
</ul>
</li>
<li><p><strong>使用SSH密钥签名commit</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每次commit时手动签名</span></span><br><span class="line">git commit -S -m <span class="string">&quot;你的提交信息&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者设置默认签名所有commit</span></span><br><span class="line">git config --global commit.gpgsign <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>通过以上三种方式，你就可以为你的commit添加签名，提高代码的安全性和可信度。对于开源项目来说，这也是一个很好的实践，可以证明提交确实来自于你本人。</p>
<h3 id="VScode的git探索"><a href="#VScode的git探索" class="headerlink" title="VScode的git探索"></a>VScode的git探索</h3><p>因为我平常已经习惯于用IDE，VScode或者是GithubDesktop这类可视化git工具来去进行推送了，所以想要去研究一下如何使用VScode进行签名commit，这种常用的功能应该会被VScode以及基于VScode的一系列IDE所集成。</p>
<p>在正常的编写完commit信息，准备点击commit的时候我开始了寻找。顺着直觉点开了右上角的更多按钮，下拉找到commit一栏。果然如我所料，VScode系列的这些IDE都有这个选项。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/69.jpg" alt="69"></p>
<h3 id="开源协议版权头的添加"><a href="#开源协议版权头的添加" class="headerlink" title="开源协议版权头的添加"></a>开源协议版权头的添加</h3><p>为了将过往全部commit都给变成签名commit，我就只好去删库从新创建，先将写好的项目代码复制一份单独备份到Github的私有仓库，随后将本地仓库文件全部删除，最后将gitcode上fork的仓库删除，从新fork。</p>
<p>随后将全部源码再次搬运回来，利用签名commit进行推送，再次创建新的pr并关联issue，在pr的评论区发送<code>start build</code>终于是经过了doc检查，开始了代码门禁的静态检查环节。</p>
<p>此时我的静态文件审查并没有通过，在查看门禁审查结果的时候发现问题出现在我的代码中全都没有添加版权头，所以出现了大量的“致命错误”。当然对此我也并不觉得惊讶，毕竟我此前看过的所有开源代码除了文件格式不允许出现注释，例如json，都会有一个开源协议的版权头，声明原作者的同时标明当前代码的开源协议，与此同时去进行版权的声明。</p>
<p>于是我就开始了我的漫漫复制黏贴之路。我本以为全加一遍就结束了，但没想到检查漏加的文件这一过程整整持续了两天才结束。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/70.jpg" alt="70"></p>
<p>在将数量下压到8个文件之后就始终无法再降了，我反复排查反复尝试，发现问题就出在鸿蒙项目的几个json5配置文件中，就是那几个json5配置文件的开源协议在我几次修改后都被意外删除。但我始终不知道原因，于是我尝试了一次在添加好配置文件的版权头之后不点击deveco右上角的同步数据按钮，直接进行commit进行推送，再次执行代码门禁检查发现果然通过了，我很快就进行了实验，我直接用cursor修改配置文件，而不从deveco进行修改，发现没问题，更改被正确的留存。在deveco修改完不点击同步数据按钮也没问题，版权头也没有被删除，而当我点击同步数据之后所有json5文件之中的版权头注释都消失了，这一点证明了我的猜想，就是deveco的自动数据同步过程删除了这些“非必要的”字段导致我的代码门禁始终不通过。</p>
<h2 id="首次代码的合并"><a href="#首次代码的合并" class="headerlink" title="首次代码的合并"></a>首次代码的合并</h2><p>在终于通过了代码门禁的静态检查之后，老师同意了我的合并请求，于是在九三阅兵的礼炮声中，我的代码被正式合并了。虽然到这里我的项目还没有完全完成，但这个时间点真的很有意义，至少对我来说是很触动的一个时间点。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/71.jpg" alt="71"></p>
<h2 id="正文渲染"><a href="#正文渲染" class="headerlink" title="正文渲染"></a>正文渲染</h2><p>首先我们需要区分正文详情页的UI样式和文章渲染的功能组件，这两者的目的不同且应当尽可能降低耦合度。</p>
<h3 id="正文渲染组件"><a href="#正文渲染组件" class="headerlink" title="正文渲染组件"></a>正文渲染组件</h3><p>首先正文的渲染是深度依赖于我前期在进行爬虫开发时所设定的数据结构。只需要判断当前语句块的类型，同时去进行对应组件的渲染就好了，整体的逻辑还是非常简单的。</p>
<h4 id="Markdown三方库组件配置初始化"><a href="#Markdown三方库组件配置初始化" class="headerlink" title="Markdown三方库组件配置初始化"></a>Markdown三方库组件配置初始化</h4><p>再考虑了一下之后我还是决定使用<a target="_blank" rel="noopener" href="https://ohpm.openharmony.cn/#/cn/detail/@luvi%2Flv-markdown-in">@luvi/lv-markdown-in(V2.0.15)</a>这个三方库来进行代码块的渲染，主要是在于它的配置项能单独给代码块这一项进行配置。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">markDownConfigInit</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> baseFontSize =  <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">fontSize</span></span><br><span class="line">  lvCode.<span class="title function_">setIndexState</span>(<span class="literal">true</span>)</span><br><span class="line">  lvText.<span class="title function_">setTextSize</span>(baseFontSize)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>额，好像也就这么点能设置的了。</p>
<h4 id="渲染逻辑"><a href="#渲染逻辑" class="headerlink" title="渲染逻辑"></a>渲染逻辑</h4><p>这里就直接扔代码把，大家都看得懂。等实机测试之后才能继续去进行样式的调优。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">CONTENT_TYPE_ENUM</span>,</span><br><span class="line">  <span class="variable constant_">DEVICE_TYPES</span>, <span class="title class_">NewsArticle</span>, <span class="title class_">NewsContentBlock</span> &#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; deviceInfo &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LvMarkdownIn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@luvi/lv-markdown-in&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章内容渲染组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> article 带渲染文章内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> baseFontSize 基准字体大小</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">NewsArticleView</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">article</span>: <span class="title class_">NewsArticle</span> = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">date</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">content</span>: [],</span><br><span class="line">    <span class="attr">source</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">baseFontSize</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">deviceType</span>: <span class="variable constant_">DEVICE_TYPES</span> =</span><br><span class="line">    deviceInfo.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> : <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">TABLET</span></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title function_">articleInfoBuilder</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Row</span>()&#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">`日期：<span class="subst">$&#123;<span class="variable language_">this</span>.article.date&#125;</span> <span class="subst">$&#123;<span class="variable language_">this</span>.article.source?<span class="string">&#x27;来源：&#x27;</span>:<span class="string">&#x27;&#x27;</span>&#125;</span><span class="subst">$&#123;<span class="variable language_">this</span>.article.source&#125;</span>`</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">baseFontSize</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 根组件</span></span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">article</span>.<span class="property">title</span>)</span><br><span class="line">        .<span class="title function_">alignSelf</span>(<span class="title class_">ItemAlign</span>.<span class="property">Start</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">baseFontSize</span> + <span class="variable language_">this</span>.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="number">8</span> : <span class="number">10</span>)</span><br><span class="line">      <span class="comment">// 日期来源行</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">articleInfoBuilder</span>()</span><br><span class="line">      </span><br><span class="line">      <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">article</span>.<span class="property">content</span>,<span class="function">(<span class="params"><span class="attr">item</span>:<span class="title class_">NewsContentBlock</span>,<span class="attr">i</span>:<span class="built_in">number</span></span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">TEXT</span>) &#123;</span><br><span class="line">          <span class="title class_">Text</span>(item.<span class="property">value</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">baseFontSize</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">IMAGE</span>)&#123;</span><br><span class="line">          <span class="title class_">Image</span>(item.<span class="property">value</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;80%&#x27;</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">VIDEO</span>)&#123;</span><br><span class="line">          <span class="title class_">Video</span>(&#123;</span><br><span class="line">            <span class="attr">src</span>:item.<span class="property">value</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">CODE</span>)&#123;</span><br><span class="line">          <span class="title class_">LvMarkdownIn</span>(&#123;</span><br><span class="line">            <span class="attr">text</span>:item.<span class="property">value</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.article_info_builder_bg&#x27;</span>))</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后就该回到详情页的NavDestination组件去继续了。</p>
<h3 id="Nav传参"><a href="#Nav传参" class="headerlink" title="Nav传参"></a>Nav传参</h3><h4 id="跳转导航更新"><a href="#跳转导航更新" class="headerlink" title="跳转导航更新"></a>跳转导航更新</h4><p>首先我们先将起始页的导航Builder以及跳转名称常量去进行一下更新</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="variable constant_">NAV_DESTS</span> &#123;</span><br><span class="line">  <span class="variable constant_">MAIN</span> = <span class="string">&#x27;Main&#x27;</span>,</span><br><span class="line">  <span class="variable constant_">ARTICLE</span> = <span class="string">&#x27;Article&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="title class_">NavDestMap</span>(<span class="attr">name</span>: <span class="built_in">string</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (name === <span class="variable constant_">NAV_DESTS</span>.<span class="property">MAIN</span>) &#123;</span><br><span class="line">    <span class="title class_">Main</span>()</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> (name === <span class="variable constant_">NAV_DESTS</span>.<span class="property">ARTICLE</span>) &#123;</span><br><span class="line">    <span class="title class_">ArticlePage</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后再去在NewsList的组件中去进行参数的修改，加入导航页面栈的传入接口。由于NewsList是存在于Feature特性能力层的功能组件，所以我们尽量不直接使用AppStorage去获取数据，而是通过传参的形式去获取数据。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">NewsList</span>(&#123; <span class="attr">newsList</span>: <span class="variable language_">this</span>.<span class="property">newsList</span> ?? [], <span class="attr">listScroller</span>: <span class="variable language_">this</span>.<span class="property">listScroller</span>, <span class="attr">navStuck</span>: <span class="variable language_">this</span>.<span class="property">navPathStuck</span> &#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Param</span> <span class="attr">navStuck</span>:<span class="title class_">NavPathStack</span> = <span class="keyword">new</span> <span class="title class_">NavPathStack</span>()</span><br></pre></td></tr></table></figure>
<p>随后再去给每一个Item去绑定点击事件。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">navStuck</span>.<span class="title function_">replacePath</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="variable constant_">NAV_DESTS</span>.<span class="property">ARTICLE</span>,</span><br><span class="line">    <span class="attr">param</span>:news</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>通过<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navigation#navpathinfo10">NavPathInfo</a>对象去进行传参，随后再在目标页面使用<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navdestination#onready11">onReady</a>回调函数去进行参数的接收。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">ArticlePage</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">baseFontSize</span>: <span class="built_in">number</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>)!.<span class="property">fontSize</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">article</span>:<span class="title class_">NewsArticle</span> = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">date</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">content</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">NavDestination</span>() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">onReady</span>(<span class="function">(<span class="params"><span class="attr">navDestinationContext</span>:<span class="title class_">NavDestinationContext</span></span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">article</span> = navDestinationContext.<span class="property">pathInfo</span>.<span class="property">param</span> <span class="keyword">as</span> <span class="title class_">NewsArticle</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后实际测试中发现文章的段落间隙过小，同时还存在标题字体过小的问题，于是我又进行了大量的样式调整。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2025 XBXyftx</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">CONTENT_TYPE_ENUM</span>, <span class="variable constant_">DEVICE_TYPES</span>, <span class="title class_">NewsArticle</span>, <span class="title class_">NewsContentBlock</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; deviceInfo &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LvMarkdownIn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@luvi/lv-markdown-in&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章内容渲染组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> article 带渲染文章内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> baseFontSize 基准字体大小</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">NewsArticleView</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">article</span>: <span class="title class_">NewsArticle</span> = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">date</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">content</span>: [],</span><br><span class="line">    <span class="attr">source</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">baseFontSize</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">deviceType</span>: <span class="variable constant_">DEVICE_TYPES</span> =</span><br><span class="line">    deviceInfo.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> : <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">TABLET</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title function_">articleInfoBuilder</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">`日期：<span class="subst">$&#123;<span class="variable language_">this</span>.article.date&#125;</span> <span class="subst">$&#123;<span class="variable language_">this</span>.article.source ? <span class="string">&#x27;来源：&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span><span class="subst">$&#123;<span class="variable language_">this</span>.article.source&#125;</span>`</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">baseFontSize</span>+<span class="number">4</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 根组件</span></span><br><span class="line">    <span class="title class_">Scroll</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>(&#123;<span class="attr">space</span>:<span class="number">10</span>+(<span class="variable language_">this</span>.<span class="property">baseFontSize</span>*<span class="number">0.3</span>)&#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">article</span>.<span class="property">title</span>)</span><br><span class="line">          .<span class="title function_">alignSelf</span>(<span class="title class_">ItemAlign</span>.<span class="property">Start</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">baseFontSize</span> + (<span class="variable language_">this</span>.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="number">12</span> : <span class="number">16</span>))</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="number">900</span>)</span><br><span class="line">        <span class="comment">// 日期来源行</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">articleInfoBuilder</span>()</span><br><span class="line"></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">article</span>.<span class="property">content</span>, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">NewsContentBlock</span>, <span class="attr">i</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">TEXT</span>) &#123;</span><br><span class="line">            <span class="title class_">Text</span>(item.<span class="property">value</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">baseFontSize</span>)</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">IMAGE</span>) &#123;</span><br><span class="line">            <span class="title class_">Image</span>(item.<span class="property">value</span>)</span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;80%&#x27;</span>)</span><br><span class="line">              .<span class="title function_">alignSelf</span>(<span class="title class_">ItemAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">VIDEO</span>) &#123;</span><br><span class="line">            <span class="title class_">Video</span>(&#123;</span><br><span class="line">              <span class="attr">src</span>: item.<span class="property">value</span></span><br><span class="line">            &#125;)</span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;80%&#x27;</span>)</span><br><span class="line">              .<span class="title function_">alignSelf</span>(<span class="title class_">ItemAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">CODE</span>) &#123;</span><br><span class="line">            <span class="title class_">LvMarkdownIn</span>(&#123;</span><br><span class="line">              <span class="attr">text</span>: item.<span class="property">value</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">20</span>)</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.article_info_builder_bg&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>)</span><br><span class="line">    .<span class="title function_">borderRadius</span>(<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将字体大小与可设置的字体大小进行绑定，同时将文章的标题，日期，来源，内容等全部进行绑定，随后在ForEach中根据文章内容类型的不同进行不同的渲染。</p>
<p>随后再加入更多针对手机平板差异的样式调整。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2025 XBXyftx</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">CONTENT_TYPE_ENUM</span>, <span class="variable constant_">DEVICE_TYPES</span>, <span class="title class_">NewsArticle</span>, <span class="title class_">NewsContentBlock</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; deviceInfo &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LvMarkdownIn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@luvi/lv-markdown-in&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章内容渲染组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> article 带渲染文章内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> baseFontSize 基准字体大小</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">NewsArticleView</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">article</span>: <span class="title class_">NewsArticle</span> = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">date</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">content</span>: [],</span><br><span class="line">    <span class="attr">source</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">baseFontSize</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">deviceType</span>: <span class="variable constant_">DEVICE_TYPES</span> =</span><br><span class="line">    deviceInfo.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> : <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">TABLET</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title function_">articleInfoBuilder</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">`日期：<span class="subst">$&#123;<span class="variable language_">this</span>.article.date&#125;</span> <span class="subst">$&#123;<span class="variable language_">this</span>.article.source ? <span class="string">&#x27;来源：&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span><span class="subst">$&#123;<span class="variable language_">this</span>.article.source&#125;</span>`</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">baseFontSize</span>+(<span class="variable language_">this</span>.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="number">8</span> : <span class="number">12</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 根组件</span></span><br><span class="line">    <span class="title class_">Scroll</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>(&#123;<span class="attr">space</span>:<span class="number">10</span>+(<span class="variable language_">this</span>.<span class="property">baseFontSize</span>*(<span class="variable language_">this</span>.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ?<span class="number">0.3</span>:<span class="number">0.5</span>))&#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">article</span>.<span class="property">title</span>)</span><br><span class="line">          .<span class="title function_">alignSelf</span>(<span class="title class_">ItemAlign</span>.<span class="property">Start</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">baseFontSize</span> + (<span class="variable language_">this</span>.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="number">12</span> : <span class="number">16</span>))</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="number">900</span>)</span><br><span class="line">        <span class="comment">// 日期来源行</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">articleInfoBuilder</span>()</span><br><span class="line"></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">article</span>.<span class="property">content</span>, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">NewsContentBlock</span>, <span class="attr">i</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">TEXT</span>) &#123;</span><br><span class="line">            <span class="title class_">Text</span>(item.<span class="property">value</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">baseFontSize</span>+ (<span class="variable language_">this</span>.<span class="property">deviceType</span> === <span class="variable constant_">DEVICE_TYPES</span>.<span class="property">PHONE</span> ? <span class="number">0</span> : <span class="number">6</span>))</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">IMAGE</span>) &#123;</span><br><span class="line">            <span class="title class_">Image</span>(item.<span class="property">value</span>)</span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;80%&#x27;</span>)</span><br><span class="line">              .<span class="title function_">alignSelf</span>(<span class="title class_">ItemAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">VIDEO</span>) &#123;</span><br><span class="line">            <span class="title class_">Video</span>(&#123;</span><br><span class="line">              <span class="attr">src</span>: item.<span class="property">value</span></span><br><span class="line">            &#125;)</span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;80%&#x27;</span>)</span><br><span class="line">              .<span class="title function_">alignSelf</span>(<span class="title class_">ItemAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="variable constant_">CONTENT_TYPE_ENUM</span>.<span class="property">CODE</span>) &#123;</span><br><span class="line">            <span class="title class_">LvMarkdownIn</span>(&#123;</span><br><span class="line">              <span class="attr">text</span>: item.<span class="property">value</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="number">5</span>)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">20</span>)</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.article_info_builder_bg&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>)</span><br><span class="line">    .<span class="title function_">borderRadius</span>(<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第二次pr创建"><a href="#第二次pr创建" class="headerlink" title="第二次pr创建"></a>第二次pr创建</h2><p>在完成了核心组件的开发之后我申请了第二次pr，这次就顺利多了，只修改了一次就顺利完成了代码门禁的静态代码检查。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/72.png" alt="72"></p>
<h2 id="微信公众号爬虫取代CSDN爬虫"><a href="#微信公众号爬虫取代CSDN爬虫" class="headerlink" title="微信公众号爬虫取代CSDN爬虫"></a>微信公众号爬虫取代CSDN爬虫</h2><p>CSDN是一个动态网站，全部博客文章都是使用动态加载来进行展示的，当同一IP短时间内重复访问或者是进行了非人类的操作请求时就很容易被封禁，同时其页面的加载速度并不固定导致同意篇文章的爬取反复出现成功与失败的情况。所以我决定暂时去除CSDN的爬虫，转而使用微信公众号的爬虫。</p>
<h2 id="轮播图爬虫开发"><a href="#轮播图爬虫开发" class="headerlink" title="轮播图爬虫开发"></a>轮播图爬虫开发</h2><h3 id="爬虫开发"><a href="#爬虫开发" class="headerlink" title="爬虫开发"></a>爬虫开发</h3><p>这个坑也是拖了很久没有填了，现在也是该填上了。</p>
<p>首先观察一下<a target="_blank" rel="noopener" href="https://www.openharmony.cn/mainPlay">OpenHarmony官网首页</a>轮播图的网页结构。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/73.png" alt="73"></p>
<p><img src="/2025/06/29/OpenSourceSummer2025/74.png" alt="74"></p>
<p>可以看到手机版和PC版的图片是不同的，同时图片的地址也是不同的，所以需要在爬取时标明手机版浏览器的UA信息。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright (c) 2025 XBXyftx</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin, urlparse</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MobileBannerCrawler</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    专门用于爬取OpenHarmony官网手机版的banner图片爬虫</span></span><br><span class="line"><span class="string">    模拟手机浏览器UA访问，获取手机版页面的banner-img类名图片</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.base_url = <span class="string">&quot;https://www.openharmony.cn&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.target_url = <span class="string">&quot;https://www.openharmony.cn/mainPlay&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.source = <span class="string">&quot;OpenHarmony-Mobile-Banner&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.session = requests.Session()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 手机端User-Agent池</span></span><br><span class="line">        <span class="variable language_">self</span>.mobile_user_agents = [</span><br><span class="line">            <span class="comment"># iPhone Safari</span></span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Mobile/15E148 Safari/604.1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.0 Mobile/15E148 Safari/604.1&#x27;</span>,</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Android Chrome</span></span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (Linux; Android 13; SM-G991B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (Linux; Android 12; SM-G975F) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (Linux; Android 11; Pixel 5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Mobile Safari/537.36&#x27;</span>,</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Huawei/Honor手机</span></span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (Linux; Android 12; NOH-AL00) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (Linux; Android 11; ELS-AN00) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36&#x27;</span>,</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 小米手机</span></span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (Linux; Android 13; MI 13) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (Linux; Android 12; MI 12) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36&#x27;</span>,</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># iPad</span></span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (iPad; CPU OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (iPad; CPU OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Mobile/15E148 Safari/604.1&#x27;</span>,</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置手机端请求头</span></span><br><span class="line">        <span class="variable language_">self</span>.setup_mobile_headers()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_mobile_headers</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;设置手机端请求头&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">import</span> random</span><br><span class="line">        </span><br><span class="line">        mobile_ua = random.choice(<span class="variable language_">self</span>.mobile_user_agents)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.session.headers.update(&#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: mobile_ua,</span><br><span class="line">            <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9,en;q=0.8&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate, br&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Upgrade-Insecure-Requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Sec-Fetch-Dest&#x27;</span>: <span class="string">&#x27;document&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Sec-Fetch-Mode&#x27;</span>: <span class="string">&#x27;navigate&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Sec-Fetch-Site&#x27;</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Sec-Fetch-User&#x27;</span>: <span class="string">&#x27;?1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Cache-Control&#x27;</span>: <span class="string">&#x27;max-age=0&#x27;</span>,</span><br><span class="line">            <span class="comment"># 模拟手机端viewport</span></span><br><span class="line">            <span class="string">&#x27;Viewport-Width&#x27;</span>: <span class="string">&#x27;390&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Device-Memory&#x27;</span>: <span class="string">&#x27;8&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;DPR&#x27;</span>: <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">f&quot;📱 已设置手机端请求头，User-Agent: <span class="subst">&#123;mobile_ua[:<span class="number">50</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_mobile_page_content</span>(<span class="params">self, url</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        获取手机版页面内容</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            logger.info(<span class="string">f&quot;📱 正在请求手机版页面: <span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 重新设置随机的手机端UA，防止被识别</span></span><br><span class="line">            <span class="variable language_">self</span>.setup_mobile_headers()</span><br><span class="line">            </span><br><span class="line">            response = <span class="variable language_">self</span>.session.get(url, timeout=<span class="number">15</span>)</span><br><span class="line">            response.raise_for_status()</span><br><span class="line">            response.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查响应是否是手机版</span></span><br><span class="line">            content_length = <span class="built_in">len</span>(response.text)</span><br><span class="line">            logger.info(<span class="string">f&quot;📱 页面加载成功，内容长度: <span class="subst">&#123;content_length&#125;</span> 字符&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 简单检查是否获取到了移动版本</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;viewport&#x27;</span> <span class="keyword">in</span> response.text.lower() <span class="keyword">or</span> <span class="string">&#x27;mobile&#x27;</span> <span class="keyword">in</span> response.text.lower():</span><br><span class="line">                logger.info(<span class="string">&quot;✅ 成功获取手机版页面内容&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                logger.warning(<span class="string">&quot;⚠️ 可能未获取到手机版页面，但继续处理&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;❌ 请求手机版页面失败: <span class="subst">&#123;url&#125;</span>, 错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;❌ 获取手机版页面内容时发生未知错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extract_banner_images</span>(<span class="params">self, html_content</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        从HTML内容中提取banner相关的图片</span></span><br><span class="line"><span class="string">        包括banner-img类名、轮播图、主要展示图片等</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        banner_images = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            soup = BeautifulSoup(html_content, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">            logger.info(<span class="string">&quot;🔍 开始解析HTML内容，查找banner相关图片...&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 1. 查找所有包含banner-img类名的元素</span></span><br><span class="line">            banner_img_elements = soup.find_all(class_=re.<span class="built_in">compile</span>(<span class="string">r&#x27;.*banner-img.*&#x27;</span>))</span><br><span class="line">            logger.info(<span class="string">f&quot;🔍 找到 <span class="subst">&#123;<span class="built_in">len</span>(banner_img_elements)&#125;</span> 个包含 banner-img 类名的元素&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 2. 查找其他banner相关的类名</span></span><br><span class="line">            banner_class_patterns = [</span><br><span class="line">                <span class="string">r&#x27;.*banner.*&#x27;</span>,</span><br><span class="line">                <span class="string">r&#x27;.*swiper.*slide.*&#x27;</span>,</span><br><span class="line">                <span class="string">r&#x27;.*carousel.*&#x27;</span>,</span><br><span class="line">                <span class="string">r&#x27;.*slider.*&#x27;</span>,</span><br><span class="line">                <span class="string">r&#x27;.*hero.*&#x27;</span>,</span><br><span class="line">                <span class="string">r&#x27;.*main.*banner.*&#x27;</span>,</span><br><span class="line">                <span class="string">r&#x27;.*top.*banner.*&#x27;</span></span><br><span class="line">            ]</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> pattern <span class="keyword">in</span> banner_class_patterns:</span><br><span class="line">                elements = soup.find_all(class_=re.<span class="built_in">compile</span>(pattern, re.IGNORECASE))</span><br><span class="line">                banner_img_elements.extend(elements)</span><br><span class="line">                logger.info(<span class="string">f&quot;🔍 通过模式 &#x27;<span class="subst">&#123;pattern&#125;</span>&#x27; 找到 <span class="subst">&#123;<span class="built_in">len</span>(elements)&#125;</span> 个元素&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 3. 处理找到的banner元素</span></span><br><span class="line">            <span class="keyword">for</span> idx, element <span class="keyword">in</span> <span class="built_in">enumerate</span>(banner_img_elements):</span><br><span class="line">                logger.debug(<span class="string">f&quot;处理第 <span class="subst">&#123;idx + <span class="number">1</span>&#125;</span> 个banner元素: <span class="subst">&#123;element.name&#125;</span>, class: <span class="subst">&#123;element.get(<span class="string">&#x27;class&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 处理img标签</span></span><br><span class="line">                <span class="keyword">if</span> element.name == <span class="string">&#x27;img&#x27;</span>:</span><br><span class="line">                    img_url = <span class="variable language_">self</span>.extract_image_url(element)</span><br><span class="line">                    <span class="keyword">if</span> img_url:</span><br><span class="line">                        image_info = <span class="variable language_">self</span>.create_image_info(img_url, element, <span class="string">f&quot;banner-img-<span class="subst">&#123;idx + <span class="number">1</span>&#125;</span>&quot;</span>)</span><br><span class="line">                        banner_images.append(image_info)</span><br><span class="line">                        logger.info(<span class="string">f&quot;✅ 提取到banner图片: <span class="subst">&#123;img_url&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 处理包含img子元素的容器</span></span><br><span class="line">                img_tags = element.find_all(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line">                <span class="keyword">for</span> img_idx, img_tag <span class="keyword">in</span> <span class="built_in">enumerate</span>(img_tags):</span><br><span class="line">                    img_url = <span class="variable language_">self</span>.extract_image_url(img_tag)</span><br><span class="line">                    <span class="keyword">if</span> img_url:</span><br><span class="line">                        image_info = <span class="variable language_">self</span>.create_image_info(img_url, img_tag, <span class="string">f&quot;banner-container-<span class="subst">&#123;idx + <span class="number">1</span>&#125;</span>-<span class="subst">&#123;img_idx + <span class="number">1</span>&#125;</span>&quot;</span>)</span><br><span class="line">                        banner_images.append(image_info)</span><br><span class="line">                        logger.info(<span class="string">f&quot;✅ 提取到嵌套banner图片: <span class="subst">&#123;img_url&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 处理CSS背景图片</span></span><br><span class="line">                bg_url = <span class="variable language_">self</span>.extract_background_image(element)</span><br><span class="line">                <span class="keyword">if</span> bg_url:</span><br><span class="line">                    image_info = <span class="variable language_">self</span>.create_image_info(bg_url, element, <span class="string">f&quot;banner-bg-<span class="subst">&#123;idx + <span class="number">1</span>&#125;</span>&quot;</span>)</span><br><span class="line">                    banner_images.append(image_info)</span><br><span class="line">                    logger.info(<span class="string">f&quot;✅ 提取到banner背景图片: <span class="subst">&#123;bg_url&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 4. 查找页面中所有较大的图片（可能是banner）</span></span><br><span class="line">            all_images = soup.find_all(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line">            logger.info(<span class="string">f&quot;🔍 页面总共有 <span class="subst">&#123;<span class="built_in">len</span>(all_images)&#125;</span> 张图片，筛选可能的banner图片...&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> idx, img <span class="keyword">in</span> <span class="built_in">enumerate</span>(all_images):</span><br><span class="line">                img_url = <span class="variable language_">self</span>.extract_image_url(img)</span><br><span class="line">                <span class="keyword">if</span> img_url:</span><br><span class="line">                    <span class="comment"># 检查图片URL是否包含banner相关关键词</span></span><br><span class="line">                    banner_keywords = [<span class="string">&#x27;banner&#x27;</span>, <span class="string">&#x27;slide&#x27;</span>, <span class="string">&#x27;carousel&#x27;</span>, <span class="string">&#x27;hero&#x27;</span>, <span class="string">&#x27;main&#x27;</span>, <span class="string">&#x27;top&#x27;</span>, <span class="string">&#x27;header&#x27;</span>]</span><br><span class="line">                    img_url_lower = img_url.lower()</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">any</span>(keyword <span class="keyword">in</span> img_url_lower <span class="keyword">for</span> keyword <span class="keyword">in</span> banner_keywords):</span><br><span class="line">                        image_info = <span class="variable language_">self</span>.create_image_info(img_url, img, <span class="string">f&quot;potential-banner-<span class="subst">&#123;idx + <span class="number">1</span>&#125;</span>&quot;</span>)</span><br><span class="line">                        banner_images.append(image_info)</span><br><span class="line">                        logger.info(<span class="string">f&quot;✅ 发现可能的banner图片（通过URL关键词）: <span class="subst">&#123;img_url&#125;</span>&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 检查img标签的class或其他属性</span></span><br><span class="line">                    class_list = img.get(<span class="string">&#x27;class&#x27;</span>, [])</span><br><span class="line">                    class_str = <span class="string">&#x27; &#x27;</span>.join(class_list) <span class="keyword">if</span> <span class="built_in">isinstance</span>(class_list, <span class="built_in">list</span>) <span class="keyword">else</span> <span class="built_in">str</span>(class_list)</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">any</span>(keyword <span class="keyword">in</span> class_str.lower() <span class="keyword">for</span> keyword <span class="keyword">in</span> banner_keywords):</span><br><span class="line">                        image_info = <span class="variable language_">self</span>.create_image_info(img_url, img, <span class="string">f&quot;class-banner-<span class="subst">&#123;idx + <span class="number">1</span>&#125;</span>&quot;</span>)</span><br><span class="line">                        banner_images.append(image_info)</span><br><span class="line">                        logger.info(<span class="string">f&quot;✅ 发现可能的banner图片（通过class）: <span class="subst">&#123;img_url&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 5. 额外查找：通过data属性查找可能的banner图片</span></span><br><span class="line">            data_banner_elements = soup.find_all(attrs=&#123;<span class="string">&quot;data-banner&quot;</span>: <span class="literal">True</span>&#125;) + soup.find_all(attrs=&#123;<span class="string">&quot;data-bg&quot;</span>: <span class="literal">True</span>&#125;)</span><br><span class="line">            <span class="keyword">for</span> idx, element <span class="keyword">in</span> <span class="built_in">enumerate</span>(data_banner_elements):</span><br><span class="line">                <span class="keyword">for</span> attr <span class="keyword">in</span> [<span class="string">&#x27;data-banner&#x27;</span>, <span class="string">&#x27;data-bg&#x27;</span>, <span class="string">&#x27;data-src&#x27;</span>, <span class="string">&#x27;data-original&#x27;</span>]:</span><br><span class="line">                    img_url = element.get(attr)</span><br><span class="line">                    <span class="keyword">if</span> img_url <span class="keyword">and</span> <span class="variable language_">self</span>.is_valid_image_url(img_url):</span><br><span class="line">                        img_url = urljoin(<span class="variable language_">self</span>.base_url, img_url)</span><br><span class="line">                        image_info = <span class="variable language_">self</span>.create_image_info(img_url, element, <span class="string">f&quot;data-banner-<span class="subst">&#123;idx + <span class="number">1</span>&#125;</span>&quot;</span>)</span><br><span class="line">                        banner_images.append(image_info)</span><br><span class="line">                        logger.info(<span class="string">f&quot;✅ 通过data属性提取到图片: <span class="subst">&#123;img_url&#125;</span>&quot;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 6. 去重</span></span><br><span class="line">            unique_images = []</span><br><span class="line">            seen_urls = <span class="built_in">set</span>()</span><br><span class="line">            <span class="keyword">for</span> img <span class="keyword">in</span> banner_images:</span><br><span class="line">                <span class="keyword">if</span> img[<span class="string">&#x27;url&#x27;</span>] <span class="keyword">not</span> <span class="keyword">in</span> seen_urls:</span><br><span class="line">                    unique_images.append(img)</span><br><span class="line">                    seen_urls.add(img[<span class="string">&#x27;url&#x27;</span>])</span><br><span class="line">            </span><br><span class="line">            logger.info(<span class="string">f&quot;🎯 共提取到 <span class="subst">&#123;<span class="built_in">len</span>(unique_images)&#125;</span> 张唯一的banner相关图片&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 7. 如果还是没有找到图片，记录页面结构用于调试</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(unique_images) == <span class="number">0</span>:</span><br><span class="line">                logger.warning(<span class="string">&quot;🔍 未找到banner图片，分析页面结构...&quot;</span>)</span><br><span class="line">                <span class="variable language_">self</span>._debug_page_structure(soup)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> unique_images</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;❌ 解析banner图片时发生错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_debug_page_structure</span>(<span class="params">self, soup</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        调试页面结构，输出关键信息</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 查找所有包含图片的元素</span></span><br><span class="line">            img_count = <span class="built_in">len</span>(soup.find_all(<span class="string">&#x27;img&#x27;</span>))</span><br><span class="line">            logger.info(<span class="string">f&quot;📊 页面调试信息：&quot;</span>)</span><br><span class="line">            logger.info(<span class="string">f&quot;   - 总图片数量: <span class="subst">&#123;img_count&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 输出前5个图片的信息</span></span><br><span class="line">            images = soup.find_all(<span class="string">&#x27;img&#x27;</span>)[:<span class="number">5</span>]</span><br><span class="line">            <span class="keyword">for</span> i, img <span class="keyword">in</span> <span class="built_in">enumerate</span>(images):</span><br><span class="line">                src = img.get(<span class="string">&#x27;src&#x27;</span>, img.get(<span class="string">&#x27;data-src&#x27;</span>, <span class="string">&#x27;无&#x27;</span>))</span><br><span class="line">                class_name = img.get(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;无&#x27;</span>)</span><br><span class="line">                alt = img.get(<span class="string">&#x27;alt&#x27;</span>, <span class="string">&#x27;无&#x27;</span>)</span><br><span class="line">                logger.info(<span class="string">f&quot;   - 图片<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: src=<span class="subst">&#123;src[:<span class="number">50</span>]&#125;</span>..., class=<span class="subst">&#123;class_name&#125;</span>, alt=<span class="subst">&#123;alt&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 查找所有可能的轮播或banner容器</span></span><br><span class="line">            possible_containers = soup.find_all([<span class="string">&#x27;div&#x27;</span>, <span class="string">&#x27;section&#x27;</span>], class_=re.<span class="built_in">compile</span>(<span class="string">r&#x27;.*(banner|swiper|carousel|slider|hero).*&#x27;</span>, re.IGNORECASE))</span><br><span class="line">            logger.info(<span class="string">f&quot;   - 可能的banner容器数量: <span class="subst">&#123;<span class="built_in">len</span>(possible_containers)&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> i, container <span class="keyword">in</span> <span class="built_in">enumerate</span>(possible_containers[:<span class="number">3</span>]):</span><br><span class="line">                class_name = container.get(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;无&#x27;</span>)</span><br><span class="line">                child_imgs = <span class="built_in">len</span>(container.find_all(<span class="string">&#x27;img&#x27;</span>))</span><br><span class="line">                logger.info(<span class="string">f&quot;   - 容器<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: class=<span class="subst">&#123;class_name&#125;</span>, 包含图片=<span class="subst">&#123;child_imgs&#125;</span>张&quot;</span>)</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;调试页面结构时出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extract_image_url</span>(<span class="params">self, img_element</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        从img元素中提取图片URL</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 尝试多种可能的图片URL属性</span></span><br><span class="line">        url_attributes = [<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;data-src&#x27;</span>, <span class="string">&#x27;data-original&#x27;</span>, <span class="string">&#x27;data-lazy&#x27;</span>, <span class="string">&#x27;data-echo&#x27;</span>, <span class="string">&#x27;srcset&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> attr <span class="keyword">in</span> url_attributes:</span><br><span class="line">            img_url = img_element.get(attr)</span><br><span class="line">            <span class="keyword">if</span> img_url:</span><br><span class="line">                <span class="comment"># 处理srcset属性（可能包含多个URL）</span></span><br><span class="line">                <span class="keyword">if</span> attr == <span class="string">&#x27;srcset&#x27;</span>:</span><br><span class="line">                    <span class="comment"># srcset格式: &quot;url1 1x, url2 2x&quot; 或 &quot;url1 480w, url2 800w&quot;</span></span><br><span class="line">                    urls = re.findall(<span class="string">r&#x27;(https?://[^\s,]+)&#x27;</span>, img_url)</span><br><span class="line">                    <span class="keyword">if</span> urls:</span><br><span class="line">                        img_url = urls[<span class="number">0</span>]  <span class="comment"># 使用第一个URL</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.is_valid_image_url(img_url):</span><br><span class="line">                    <span class="keyword">return</span> urljoin(<span class="variable language_">self</span>.base_url, img_url)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extract_background_image</span>(<span class="params">self, element</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        从元素的style属性中提取背景图片URL</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        style = element.get(<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;background-image&#x27;</span> <span class="keyword">in</span> style:</span><br><span class="line">            <span class="comment"># 匹配 background-image: url(&#x27;...&#x27;) 或 background-image: url(&quot;...&quot;)</span></span><br><span class="line">            bg_match = re.search(<span class="string">r&#x27;background-image:\s*url\([\&#x27;&quot;]?([^\&#x27;&quot;()]+)[\&#x27;&quot;]?\)&#x27;</span>, style)</span><br><span class="line">            <span class="keyword">if</span> bg_match:</span><br><span class="line">                bg_url = bg_match.group(<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.is_valid_image_url(bg_url):</span><br><span class="line">                    <span class="keyword">return</span> urljoin(<span class="variable language_">self</span>.base_url, bg_url)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_valid_image_url</span>(<span class="params">self, url</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        验证是否是有效的图片URL</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> url <span class="keyword">or</span> <span class="built_in">len</span>(url.strip()) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查是否是图片扩展名</span></span><br><span class="line">        image_extensions = [<span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;.jpeg&#x27;</span>, <span class="string">&#x27;.png&#x27;</span>, <span class="string">&#x27;.gif&#x27;</span>, <span class="string">&#x27;.bmp&#x27;</span>, <span class="string">&#x27;.webp&#x27;</span>, <span class="string">&#x27;.svg&#x27;</span>]</span><br><span class="line">        url_lower = url.lower()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 直接检查扩展名</span></span><br><span class="line">        <span class="keyword">for</span> ext <span class="keyword">in</span> image_extensions:</span><br><span class="line">            <span class="keyword">if</span> ext <span class="keyword">in</span> url_lower:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查是否包含图片相关路径</span></span><br><span class="line">        image_keywords = [<span class="string">&#x27;image&#x27;</span>, <span class="string">&#x27;img&#x27;</span>, <span class="string">&#x27;pic&#x27;</span>, <span class="string">&#x27;photo&#x27;</span>, <span class="string">&#x27;banner&#x27;</span>, <span class="string">&#x27;bg&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> keyword <span class="keyword">in</span> image_keywords:</span><br><span class="line">            <span class="keyword">if</span> keyword <span class="keyword">in</span> url_lower:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果URL看起来像是base64数据，跳过</span></span><br><span class="line">        <span class="keyword">if</span> url.startswith(<span class="string">&#x27;data:&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span> <span class="keyword">if</span> <span class="string">&#x27;image&#x27;</span> <span class="keyword">in</span> url <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_image_info</span>(<span class="params">self, img_url, element, image_id</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        创建图片信息对象</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 获取图片的alt属性或其他描述信息</span></span><br><span class="line">        alt_text = element.get(<span class="string">&#x27;alt&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        title_text = element.get(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        class_names = element.get(<span class="string">&#x27;class&#x27;</span>, [])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 尝试从URL中提取文件名</span></span><br><span class="line">        parsed_url = urlparse(img_url)</span><br><span class="line">        filename = os.path.basename(parsed_url.path) <span class="keyword">or</span> <span class="string">f&quot;banner_image_<span class="subst">&#123;image_id&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: image_id,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: img_url,</span><br><span class="line">            <span class="string">&quot;alt&quot;</span>: alt_text,</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: title_text,</span><br><span class="line">            <span class="string">&quot;filename&quot;</span>: filename,</span><br><span class="line">            <span class="string">&quot;classes&quot;</span>: class_names <span class="keyword">if</span> <span class="built_in">isinstance</span>(class_names, <span class="built_in">list</span>) <span class="keyword">else</span> [class_names] <span class="keyword">if</span> class_names <span class="keyword">else</span> [],</span><br><span class="line">            <span class="string">&quot;source&quot;</span>: <span class="variable language_">self</span>.source,</span><br><span class="line">            <span class="string">&quot;extracted_at&quot;</span>: datetime.now().isoformat(),</span><br><span class="line">            <span class="string">&quot;page_url&quot;</span>: <span class="variable language_">self</span>.target_url</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">download_image</span>(<span class="params">self, image_info, save_directory=<span class="string">&quot;downloads/banners&quot;</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        下载图片到本地</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 创建保存目录</span></span><br><span class="line">            os.makedirs(save_directory, exist_ok=<span class="literal">True</span>)</span><br><span class="line">            </span><br><span class="line">            img_url = image_info[<span class="string">&#x27;url&#x27;</span>]</span><br><span class="line">            filename = image_info[<span class="string">&#x27;filename&#x27;</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 确保文件名有扩展名</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(filename.lower().endswith(ext) <span class="keyword">for</span> ext <span class="keyword">in</span> [<span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;.jpeg&#x27;</span>, <span class="string">&#x27;.png&#x27;</span>, <span class="string">&#x27;.gif&#x27;</span>, <span class="string">&#x27;.webp&#x27;</span>, <span class="string">&#x27;.svg&#x27;</span>]):</span><br><span class="line">                <span class="comment"># 从URL中尝试获取扩展名</span></span><br><span class="line">                url_ext = os.path.splitext(urlparse(img_url).path)[<span class="number">1</span>]</span><br><span class="line">                <span class="keyword">if</span> url_ext:</span><br><span class="line">                    filename += url_ext</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    filename += <span class="string">&#x27;.jpg&#x27;</span>  <span class="comment"># 默认扩展名</span></span><br><span class="line">            </span><br><span class="line">            file_path = os.path.join(save_directory, filename)</span><br><span class="line">            </span><br><span class="line">            logger.info(<span class="string">f&quot;⬇️ 开始下载图片: <span class="subst">&#123;img_url&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            response = <span class="variable language_">self</span>.session.get(img_url, timeout=<span class="number">30</span>)</span><br><span class="line">            response.raise_for_status()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(response.content)</span><br><span class="line">            </span><br><span class="line">            file_size = <span class="built_in">len</span>(response.content)</span><br><span class="line">            logger.info(<span class="string">f&quot;✅ 图片下载成功: <span class="subst">&#123;file_path&#125;</span> (大小: <span class="subst">&#123;file_size&#125;</span> bytes)&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新图片信息</span></span><br><span class="line">            image_info[<span class="string">&#x27;local_path&#x27;</span>] = file_path</span><br><span class="line">            image_info[<span class="string">&#x27;file_size&#x27;</span>] = file_size</span><br><span class="line">            image_info[<span class="string">&#x27;downloaded&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;❌ 下载图片失败: <span class="subst">&#123;img_url&#125;</span>, 错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            image_info[<span class="string">&#x27;downloaded&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">            image_info[<span class="string">&#x27;download_error&#x27;</span>] = <span class="built_in">str</span>(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">crawl_mobile_banners</span>(<span class="params">self, download_images=<span class="literal">True</span>, save_directory=<span class="string">&quot;downloads/banners&quot;</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        主要方法：爬取手机版banner图片</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            download_images: 是否下载图片到本地</span></span><br><span class="line"><span class="string">            save_directory: 图片保存目录</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            包含所有banner图片信息的列表</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        logger.info(<span class="string">f&quot;🚀 开始爬取OpenHarmony手机版banner图片&quot;</span>)</span><br><span class="line">        logger.info(<span class="string">f&quot;🎯 目标URL: <span class="subst">&#123;self.target_url&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取手机版页面内容</span></span><br><span class="line">        html_content = <span class="variable language_">self</span>.get_mobile_page_content(<span class="variable language_">self</span>.target_url)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> html_content:</span><br><span class="line">            logger.error(<span class="string">&quot;❌ 无法获取页面内容，爬取失败&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 提取banner图片</span></span><br><span class="line">        banner_images = <span class="variable language_">self</span>.extract_banner_images(html_content)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> banner_images:</span><br><span class="line">            logger.warning(<span class="string">&quot;⚠️ 未找到任何banner图片&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">f&quot;🎉 成功提取到 <span class="subst">&#123;<span class="built_in">len</span>(banner_images)&#125;</span> 张banner图片&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 下载图片（如果需要）</span></span><br><span class="line">        <span class="keyword">if</span> download_images:</span><br><span class="line">            logger.info(<span class="string">f&quot;⬇️ 开始下载图片到目录: <span class="subst">&#123;save_directory&#125;</span>&quot;</span>)</span><br><span class="line">            download_success_count = <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> img_info <span class="keyword">in</span> banner_images:</span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.download_image(img_info, save_directory):</span><br><span class="line">                    download_success_count += <span class="number">1</span></span><br><span class="line">                time.sleep(<span class="number">0.5</span>)  <span class="comment"># 避免请求过快</span></span><br><span class="line">            </span><br><span class="line">            logger.info(<span class="string">f&quot;📁 图片下载完成，成功下载 <span class="subst">&#123;download_success_count&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(banner_images)&#125;</span> 张图片&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 保存结果到JSON文件</span></span><br><span class="line">        result_file = os.path.join(save_directory, <span class="string">&quot;banner_images_info.json&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            os.makedirs(os.path.dirname(result_file), exist_ok=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(result_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                json.dump(&#123;</span><br><span class="line">                    <span class="string">&quot;crawl_time&quot;</span>: datetime.now().isoformat(),</span><br><span class="line">                    <span class="string">&quot;target_url&quot;</span>: <span class="variable language_">self</span>.target_url,</span><br><span class="line">                    <span class="string">&quot;total_images&quot;</span>: <span class="built_in">len</span>(banner_images),</span><br><span class="line">                    <span class="string">&quot;images&quot;</span>: banner_images</span><br><span class="line">                &#125;, f, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br><span class="line">            </span><br><span class="line">            logger.info(<span class="string">f&quot;💾 图片信息已保存到: <span class="subst">&#123;result_file&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;❌ 保存图片信息失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> banner_images</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_banner_summary</span>(<span class="params">self, banner_images</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        获取banner图片的统计摘要</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> banner_images:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;total&quot;</span>: <span class="number">0</span>, <span class="string">&quot;downloaded&quot;</span>: <span class="number">0</span>, <span class="string">&quot;failed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;success_rate&quot;</span>: <span class="string">&quot;0%&quot;</span>&#125;</span><br><span class="line">        </span><br><span class="line">        total = <span class="built_in">len</span>(banner_images)</span><br><span class="line">        downloaded = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> img <span class="keyword">in</span> banner_images <span class="keyword">if</span> img.get(<span class="string">&#x27;downloaded&#x27;</span>, <span class="literal">False</span>))</span><br><span class="line">        failed = total - downloaded</span><br><span class="line">        </span><br><span class="line">        success_rate = <span class="string">f&quot;<span class="subst">&#123;(downloaded / total * <span class="number">100</span>):<span class="number">.1</span>f&#125;</span>%&quot;</span> <span class="keyword">if</span> total &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&quot;0%&quot;</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;total&quot;</span>: total,</span><br><span class="line">            <span class="string">&quot;downloaded&quot;</span>: downloaded,</span><br><span class="line">            <span class="string">&quot;failed&quot;</span>: failed,</span><br><span class="line">            <span class="string">&quot;success_rate&quot;</span>: success_rate</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    主函数：演示如何使用MobileBannerCrawler</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;📱 OpenHarmony手机版Banner图片爬虫启动...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    </span><br><span class="line">    crawler = MobileBannerCrawler()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 爬取banner图片</span></span><br><span class="line">        banner_images = crawler.crawl_mobile_banners(</span><br><span class="line">            download_images=<span class="literal">True</span>,</span><br><span class="line">            save_directory=<span class="string">&quot;downloads/mobile_banners&quot;</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 输出统计信息</span></span><br><span class="line">        summary = crawler.get_banner_summary(banner_images)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n📊 爬取结果统计:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;   总计图片: <span class="subst">&#123;summary[<span class="string">&#x27;total&#x27;</span>]&#125;</span> 张&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;   下载成功: <span class="subst">&#123;summary[<span class="string">&#x27;downloaded&#x27;</span>]&#125;</span> 张&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;   下载失败: <span class="subst">&#123;summary[<span class="string">&#x27;failed&#x27;</span>]&#125;</span> 张&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;   成功率: <span class="subst">&#123;summary[<span class="string">&#x27;success_rate&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 显示图片列表</span></span><br><span class="line">        <span class="keyword">if</span> banner_images:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n📋 Banner图片列表:&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> i, img <span class="keyword">in</span> <span class="built_in">enumerate</span>(banner_images, <span class="number">1</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   <span class="subst">&#123;i&#125;</span>. <span class="subst">&#123;img[<span class="string">&#x27;filename&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;      URL: <span class="subst">&#123;img[<span class="string">&#x27;url&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;      Alt: <span class="subst">&#123;img[<span class="string">&#x27;alt&#x27;</span>] <span class="keyword">or</span> <span class="string">&#x27;无&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;      下载状态: <span class="subst">&#123;<span class="string">&#x27;✅ 成功&#x27;</span> <span class="keyword">if</span> img.get(<span class="string">&#x27;downloaded&#x27;</span>) <span class="keyword">else</span> <span class="string">&#x27;❌ 失败&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 爬取过程中发生错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">import</span> traceback</span><br><span class="line">        traceback.print_exc()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 设置日志级别</span></span><br><span class="line">    logging.basicConfig(</span><br><span class="line">        level=logging.INFO,</span><br><span class="line">        <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>先在浏览器上去尝试访问一下这个接口，同时确定一下我们的数据结构。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;https://images.openharmony.cn/%E9%A6%96%E9%A1%B5/banner/20240411/4.1releas%E6%89%8B%E6%9C%BA.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;https://images.openharmony.cn/%E6%B4%BB%E5%8A%A8/%E5%88%9B%E6%96%B0%E8%B5%9B2023/20230831/%E4%B8%89%E6%96%B9%E5%BA%93%E7%A7%BB%E5%8A%A8%E7%AB%AF.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;https://images.openharmony.cn/%E6%B4%BB%E5%8A%A8/%E5%A4%A7%E8%B5%9B20250812/%E7%AC%AC%E4%B8%89%E5%B1%8A%E5%BC%80%E6%BA%90%E9%B8%BF%E8%92%99%E5%88%9B%E6%96%B0%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E8%B5%9B-%20750%20350.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;https://images.openharmony.cn/%E6%B4%BB%E5%8A%A8/%E6%8A%80%E6%9C%AF%E5%A4%A7%E4%BC%9A20250826/phone-750x350.jpg&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;获取手机版Banner图片成功（缓存），共 4 张&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-09T11:51:39.365251&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="客户端接口适配"><a href="#客户端接口适配" class="headerlink" title="客户端接口适配"></a>客户端接口适配</h3><h4 id="数据模型定义"><a href="#数据模型定义" class="headerlink" title="数据模型定义"></a>数据模型定义</h4><p>由此我们可以先定义一个数据模型来进行数据解析：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页顶部轮播图数据结构(测试用例并非后端接口数据结构)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">NewsSwiperResModule</span>&#123;</span><br><span class="line">  <span class="attr">success</span>:<span class="built_in">boolean</span></span><br><span class="line">  <span class="attr">images</span>:<span class="title class_">ResourceStr</span>[]</span><br><span class="line">  <span class="attr">total</span>:<span class="number">4</span></span><br><span class="line">  <span class="attr">message</span>:<span class="built_in">string</span></span><br><span class="line">  <span class="attr">timestamp</span>:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后将此前使用的固定数据进行替换：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2025 XBXyftx</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页上方轮播图组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">NewsSwiper</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">swiperData</span>: <span class="title class_">ResourceStr</span>[] = []</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Swiper</span>()&#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">swiperData</span>,<span class="function">(<span class="params"><span class="attr">item</span>:<span class="title class_">ResourceStr</span></span>)=&gt;</span>&#123;</span><br><span class="line">          <span class="title class_">Image</span>(item)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Fill</span>)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">              promptAction.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:<span class="string">&#x27;跳转原页面功能待开发&#x27;</span>&#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">20</span>)</span><br><span class="line">            .<span class="title function_">aspectRatio</span>(<span class="number">2.2</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;95%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">curve</span>(<span class="title class_">Curve</span>.<span class="property">EaseInOut</span>)</span><br><span class="line">      .<span class="title function_">loop</span>(<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">autoPlay</span>(<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">interval</span>(<span class="number">2000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Center</span>)</span><br><span class="line">    .<span class="title function_">borderRadius</span>(<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后再去测试一下我们所需要的轮播图接口状态查询接口的数据接口封装。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;service&quot;</span><span class="punctuation">:</span> <span class="string">&quot;banner&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cache_status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preparing&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;last_update&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cache_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;update_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;error_message&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;is_updating&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;first_load_completed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scheduler_jobs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;update_banner_cache&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;更新轮播图缓存&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;next_run&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-10T21:59:40.471794+08:00&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;api_endpoints&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mobile_banners&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/mobile&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;enhanced_banners&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/mobile/enhanced&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/status&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;manual_crawl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/crawl&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;clear_cache&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/cache/clear&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cache_info&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/cache&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status_explanation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;preparing&quot;</span><span class="punctuation">:</span> <span class="string">&quot;轮播图服务正在准备中，首次爬取尚未完成或当前正在更新&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ready&quot;</span><span class="punctuation">:</span> <span class="string">&quot;轮播图服务就绪，可以正常获取轮播图数据&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;轮播图服务出现错误，需要检查日志或手动重新爬取&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-10T18:59:54.090860&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>上面这是第一种类型，是当前缓存数据正在更新的状态，接下来我们等一会后继续去请求一下成功的。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;service&quot;</span><span class="punctuation">:</span> <span class="string">&quot;banner&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cache_status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ready&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;last_update&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-10T19:00:39.216129&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cache_count&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;update_count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;error_message&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;is_updating&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;first_load_completed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scheduler_jobs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;update_banner_cache&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;更新轮播图缓存&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;next_run&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-10T21:59:40.471794+08:00&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;api_endpoints&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mobile_banners&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/mobile&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;enhanced_banners&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/mobile/enhanced&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/status&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;manual_crawl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/crawl&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;clear_cache&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/cache/clear&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cache_info&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/banner/cache&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status_explanation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;preparing&quot;</span><span class="punctuation">:</span> <span class="string">&quot;轮播图服务正在准备中，首次爬取尚未完成或当前正在更新&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ready&quot;</span><span class="punctuation">:</span> <span class="string">&quot;轮播图服务就绪，可以正常获取轮播图数据&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;轮播图服务出现错误，需要检查日志或手动重新爬取&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-10T19:12:58.282317&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>所以我们可以看到我们所需要的数据其实仅仅是一个cache_status字段中的status就足以去判断当前轮播图接口的状态了，所以我们可以直接将数据模型构建成如下形式：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2025 XBXyftx</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SwiperState</span> &#123;</span><br><span class="line">  <span class="attr">cache_status</span>: <span class="title class_">CacheStatus</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CacheStatus</span> &#123;</span><br><span class="line">  <span class="attr">status</span>: <span class="variable constant_">CACHE_STATUS</span></span><br><span class="line">  <span class="attr">error_message</span>:<span class="literal">null</span>|<span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="variable constant_">CACHE_STATUS</span> &#123;</span><br><span class="line">  preparing = <span class="string">&#x27;preparing&#x27;</span>,</span><br><span class="line">  ready = <span class="string">&#x27;ready&#x27;</span>,</span><br><span class="line">  error = <span class="string">&#x27;error&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="接口封装"><a href="#接口封装" class="headerlink" title="接口封装"></a>接口封装</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2025 XBXyftx</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NewsSwiperResModule</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../modules/news/NewsSwiperModules&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&quot;../../utils&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; axiosHttp &#125; <span class="keyword">from</span> <span class="string">&quot;../http/AxiosHttp&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewsSwiperAPI</span>_LOG_TAG = <span class="string">&#x27;NewsSwiperAPI: &#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">NewsSwiperAPI</span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取轮播图数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getNewsSwiperImgData</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> axiosHttp.<span class="property">request</span>&lt;<span class="title class_">NewsSwiperResModule</span>&gt;(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&#x27;/api/banner/mobile&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsSwiperAPI_LOG_TAG&#125;</span><span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(res)&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> res.<span class="property">images</span></span><br><span class="line">    &#125;<span class="keyword">catch</span> (e)&#123;</span><br><span class="line">      <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsSwiperAPI_LOG_TAG&#125;</span><span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>依旧是基于先前封装好的AxiosHttp进行接口调用，处理异常并返回数据。</p>
<p>随后还需要封装一个服务状态查询的接口。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2025 XBXyftx</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">CACHE_STATUS</span>, <span class="title class_">SwiperState</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../modules/server/SwiperState&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&quot;../../utils&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; axiosHttp &#125; <span class="keyword">from</span> <span class="string">&quot;../http/AxiosHttp&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">SwiperStateAPI</span>_LOG_TAG = <span class="string">&#x27;SwiperStateAPI: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SwiperStateAPI</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 检测轮播图状态</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">isSwiperServerReady</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> axiosHttp.<span class="property">request</span>&lt;<span class="title class_">SwiperState</span>&gt;(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/api/banner/status&#x27;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="title class_">SwiperStateAPI</span>_LOG_TAG + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res))</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">cache_status</span>.<span class="property">status</span> === <span class="variable constant_">CACHE_STATUS</span>.<span class="property">preparing</span>) &#123;</span><br><span class="line"></span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;SwiperStateAPI_LOG_TAG&#125;</span>轮播图尚未准备完毕`</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.<span class="property">cache_status</span>.<span class="property">status</span> === <span class="variable constant_">CACHE_STATUS</span>.<span class="property">error</span>) &#123;</span><br><span class="line">        promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">`轮播图服务内部出现异常<span class="subst">$&#123;res.cache_status.error_message&#125;</span>`</span> &#125;)</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;SwiperStateAPI_LOG_TAG&#125;</span>轮播图服务内部出现异常<span class="subst">$&#123;res.cache_status.error_message&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.<span class="property">cache_status</span>.<span class="property">status</span> === <span class="variable constant_">CACHE_STATUS</span>.<span class="property">ready</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;SwiperStateAPI_LOG_TAG&#125;</span><span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="NewsManager功能拓展"><a href="#NewsManager功能拓展" class="headerlink" title="NewsManager功能拓展"></a>NewsManager功能拓展</h4><p>在之前编写新闻列表的数据管理模块式时已经完成了键值数据库和网络接口的绑定，但也仅局限于新闻列表，现在我们需要将他的功能进行拓展，使其能够同时管理轮播图的新闻数据。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2025 XBXyftx</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">APP_KV_DB</span> <span class="keyword">as</span> <span class="variable constant_">APP_KV_DB_ID</span>,</span><br><span class="line">  kvDatabase,</span><br><span class="line">  <span class="variable constant_">KV_DB_KEYS</span>,</span><br><span class="line">  logger,</span><br><span class="line">  <span class="title class_">NewsArticle</span>,</span><br><span class="line">  <span class="title class_">NewsListAPI</span>,</span><br><span class="line">  <span class="title class_">NewsSwiperAPI</span>,</span><br><span class="line">  <span class="title class_">NewsSwiperStateAPI</span>,</span><br><span class="line">  <span class="title class_">ServerHealthAPI</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.AbilityKit&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; distributedKVStore &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkData&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.BasicServicesKit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewsManager</span>_LOG_TAG = <span class="string">&#x27;NewsManager: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">NewsManager</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 当前应用的键值数据库实例对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">appKVDb</span>: distributedKVStore.<span class="property">SingleKVStore</span> | <span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 初始化函数，获取当前应用的键值对数据库实例。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">context</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">init</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    kvDatabase.<span class="title function_">init</span>(context)</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> kvDatabase.<span class="title function_">getKVStoreById</span>(<span class="variable constant_">APP_KV_DB_ID</span>)</span><br><span class="line">    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">appKVDb</span> = res</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>init: 获取appKVDb成功`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>初始化失败`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 从后端更新新闻文章列表数据，并持久化最新的新闻列表数据。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> times 递归尝试查询服务端的计数器参数，无需传入</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 是否成功获取以及持久化</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">updateNewsListToDB</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">await</span> <span class="title class_">ServerHealthAPI</span>.<span class="title function_">isServerReady</span>()) &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">news</span>: <span class="title class_">NewsArticle</span>[] | <span class="literal">null</span> = (<span class="keyword">await</span> <span class="title class_">NewsListAPI</span>.<span class="title function_">getAllNews</span>())</span><br><span class="line">      <span class="keyword">if</span> (news &amp;&amp; <span class="variable language_">this</span>.<span class="property">appKVDb</span>) &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>成功获取最新新闻，总条数: <span class="subst">$&#123;news.length&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">appKVDb</span>.<span class="title function_">put</span>(<span class="variable constant_">KV_DB_KEYS</span>.<span class="property">NEWS_ARTICLE_LIST</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(news))</span><br><span class="line">          logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>数据库写入成功，无异常`</span>)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">          logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>更新数据库NewsArticle数据发生异常，异常信息: <span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>获取新闻失败,新闻数据或键值数据库为空。`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>获取新闻失败，后端服务状态异常，返回false`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getNewsArticleListFromDB</span>(): <span class="title class_">Promise</span>&lt;<span class="title class_">NewsArticle</span>[] | <span class="literal">null</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appKVDb</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">res</span>: <span class="built_in">string</span> = (<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">appKVDb</span>.<span class="title function_">get</span>(<span class="variable constant_">KV_DB_KEYS</span>.<span class="property">NEWS_ARTICLE_LIST</span>)) <span class="keyword">as</span> <span class="built_in">string</span></span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>读取到数据库新闻列表数据: <span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">const</span> newsArticleList = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res) <span class="keyword">as</span> <span class="title class_">NewsArticle</span>[]</span><br><span class="line">        <span class="keyword">return</span> newsArticleList</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>尝试获取数据库新闻列表数据发生异常，异常信息: <span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">updateNewsSwiperToDB</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">await</span> <span class="title class_">NewsSwiperStateAPI</span>.<span class="title function_">isSwiperServerReady</span>()) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">swiperData</span>: <span class="title class_">ResourceStr</span>[] | <span class="literal">null</span> = <span class="keyword">await</span> <span class="title class_">NewsSwiperAPI</span>.<span class="title function_">getNewsSwiperImgData</span>()</span><br><span class="line">      <span class="keyword">if</span> (swiperData &amp;&amp; <span class="variable language_">this</span>.<span class="property">appKVDb</span>) &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>成功获取最新轮播图数据，总条数: <span class="subst">$&#123;swiperData.length&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">appKVDb</span>.<span class="title function_">put</span>(<span class="variable constant_">KV_DB_KEYS</span>.<span class="property">NEWS_SWIPER</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(swiperData))</span><br><span class="line">          logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>轮播图数据库写入成功，无异常`</span>)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">          logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>更新数据库NewsSwiper数据发生异常，异常信息: <span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>获取到的轮播图数据或键值数据库为空`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>获取轮播图数据失败，后端轮播图服务状态异常`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getNewsSwiperDataFromDB</span>(): <span class="title class_">Promise</span>&lt;<span class="title class_">ResourceStr</span>[] | <span class="literal">null</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">appKVDb</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">res</span>: <span class="built_in">string</span> = (<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">appKVDb</span>.<span class="title function_">get</span>(<span class="variable constant_">KV_DB_KEYS</span>.<span class="property">NEWS_SWIPER</span>)) <span class="keyword">as</span> <span class="built_in">string</span></span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>读取到数据库轮播图数据列表数据: <span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">const</span> newsSwiperData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res) <span class="keyword">as</span> <span class="title class_">ResourceStr</span>[]</span><br><span class="line">        <span class="keyword">return</span> newsSwiperData</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;NewsManager_LOG_TAG&#125;</span>尝试获取数据库轮播图数据发生异常，异常信息: <span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> newsManager = <span class="keyword">new</span> <span class="title class_">NewsManager</span>()</span><br></pre></td></tr></table></figure>
<p>随后将数据库更新串流至应用初始化流程。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">initAll</span>(<span class="params"><span class="attr">uiAbilityContext</span>: common.<span class="title class_">UIAbilityContext</span>, <span class="attr">applicationContext</span>: common.<span class="title class_">ApplicationContext</span></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> newsManager.<span class="title function_">init</span>(uiAbilityContext)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">configInit</span>(uiAbilityContext)</span><br><span class="line">  colorModManager.<span class="title function_">init</span>(applicationContext)</span><br><span class="line">  <span class="keyword">await</span> newsManager.<span class="title function_">updateNewsListToDB</span>()</span><br><span class="line">  <span class="keyword">await</span> newsManager.<span class="title function_">updateNewsSwiperToDB</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再将从数据库读取数据的过程串流至页面渲染中。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">aboutToAppear</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">newsList</span> = <span class="keyword">await</span> newsManager.<span class="title function_">getNewsArticleListFromDB</span>()</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newsList</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getPromptAction</span>().<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">`当前数据库新闻数据为空,请连接后端服务以更新数据`</span> &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">newsList</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getPromptAction</span>().<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">`从数据库查询到<span class="subst">$&#123;<span class="variable language_">this</span>.newsList.length&#125;</span>条新闻数据`</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">newsSwiperData</span> = <span class="keyword">await</span> newsManager.<span class="title function_">getNewsSwiperDataFromDB</span>()</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newsSwiperData</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getPromptAction</span>().<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">`当前数据库轮播图数据为空,请连接后端服务以更新数据`</span> &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">newsSwiperData</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>()</span><br><span class="line">      .<span class="title function_">getPromptAction</span>()</span><br><span class="line">      .<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">`从数据库查询到<span class="subst">$&#123;<span class="variable language_">this</span>.newsSwiperData.length&#125;</span>条轮播图数据`</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">NewsSwiper</span>(&#123; <span class="attr">swiperData</span>: <span class="variable language_">this</span>.<span class="property">newsSwiperData</span> ?? [] &#125;)</span><br></pre></td></tr></table></figure>
<p>然后！测试！！！</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/75.png" alt="75"></p>
<p><img src="/2025/06/29/OpenSourceSummer2025/76.jpg" alt="76"></p>
<p>ok，还有一处需要修改的，就是在下拉刷新时也要触发一下轮播图的刷新才对。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">reloadAllData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getPromptAction</span>().<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;刷新数据&#x27;</span> &#125;)</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">await</span> newsManager.<span class="title function_">updateNewsListToDB</span>() &amp;&amp; <span class="keyword">await</span> newsManager.<span class="title function_">updateNewsSwiperToDB</span>()) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newsList</span> = <span class="keyword">await</span> newsManager.<span class="title function_">getNewsArticleListFromDB</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newsSwiperData</span> = <span class="keyword">await</span> newsManager.<span class="title function_">getNewsSwiperDataFromDB</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getPromptAction</span>().<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;获取新数据失败请稍后再试。&#x27;</span> &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次测试。成功！！！至此当初项目计划书上缩写的内容就基本全部告一段落了。</p>
<h2 id="OpenHarmony博文接口开发"><a href="#OpenHarmony博文接口开发" class="headerlink" title="OpenHarmony博文接口开发"></a>OpenHarmony博文接口开发</h2><h3 id="针对于微信公众号关键词搜索的尝试"><a href="#针对于微信公众号关键词搜索的尝试" class="headerlink" title="针对于微信公众号关键词搜索的尝试"></a>针对于微信公众号关键词搜索的尝试</h3><p>去除了CSDN的数据源之后我原本准备用更多的微信公众号文章去进行补充，但是我在实践的时候发现了新的问题，就是针对微信公众号文章的搜索，微信官方并没有给出公共的接口，于是就造成了我无法直接去获取搜索引擎的请求地址，我最初想的是从电脑版微信的搜索栏下手，因为在我印象中电脑版微信的搜索栏与打开网页共用的是用一个页面，能不能直接点击右上角的用系统浏览器打开的方式来去用浏览器开发者工具获取地址，但我点开之后才发现在公众号搜索界面是没有那个用浏览器打开的按钮的。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/77.png" alt="77"></p>
<p>所以我就只能去寻找其他办法。通过阅读一些技术博客我了解到<a target="_blank" rel="noopener" href="https://weixin.sogou.com/">搜狗搜索引擎</a>中有专门接入微信公众号的搜索引擎接口于是我立刻前去尝试。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/78.png" alt="78"></p>
<p>的的确确是能搜到相关关键词的公众号文章，但也仅限于能搜到了。搜索结果全是按照所谓的“综合排名”去罗列的，就导致搜到的都是一些陈年老文，这与我们NowInOpenHarmony项目所需要的聚合最新资讯的理念相悖，新文章因为“热度”低导致都排的比较靠后，先要通过爬虫爬取的难度还是比较高的。首先是得反复大量的去模拟用户操作想后查找文章，并逐一截取日期并进行排序。所以我决定暂时放弃这个想法。当然我也不是没想过在URL里观察一下参数字段是否包含有排序方式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://weixin.sogou.com/weixin?ie=utf8&amp;s_from=input&amp;_sug_=y&amp;_sug_type_=&amp;<span class="built_in">type</span>=2&amp;query=OpenHarmony&amp;w=01019900&amp;sut=6711&amp;sst0=1757665204566&amp;lkt=1%2C1757665204461%2C1757665204461</span><br></pre></td></tr></table></figure>
<p>要判断该搜狗微信搜索URL中是否存在规定文章排序顺序的参数，需先拆解URL结构、明确各参数含义，再结合搜索引擎排序逻辑分析，具体如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>参数名</th>
<th>参数值示例</th>
<th>核心作用</th>
<th>是否与“排序”相关</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ie</code></td>
<td><code>utf8</code></td>
<td>指定页面编码格式为UTF-8，确保中文等字符正常显示</td>
<td>无</td>
</tr>
<tr>
<td><code>s_from</code></td>
<td><code>input</code></td>
<td>标识搜索请求的来源（此处为“手动输入关键词”），用于统计不同入口的搜索量</td>
<td>无</td>
</tr>
<tr>
<td><code>_sug_</code></td>
<td><code>y</code></td>
<td>控制是否开启“搜索建议”功能（<code>y</code>=开启，输入关键词时实时推荐相关词）</td>
<td>无</td>
</tr>
<tr>
<td><code>_sug_type_</code></td>
<td>空值</td>
<td>补充定义搜索建议的类型（空值表示默认类型）</td>
<td>无</td>
</tr>
<tr>
<td><code>type</code></td>
<td><code>2</code></td>
<td>限定搜索结果的内容类型（搜狗微信搜索中，<code>type=2</code>通常对应“公众号文章”）</td>
<td>无（仅筛选类型）</td>
</tr>
<tr>
<td><code>query</code></td>
<td><code>OpenHarmony</code></td>
<td>核心搜索关键词，即用户要查询的内容（此处为“OpenHarmony”）</td>
<td>无（仅定搜索词）</td>
</tr>
<tr>
<td><code>w</code></td>
<td><code>01019900</code></td>
<td>搜狗内部的设备或终端标识参数，用于适配不同设备的显示逻辑（如PC/移动端）</td>
<td>无</td>
</tr>
<tr>
<td><code>sut</code></td>
<td><code>6711</code></td>
<td>搜索会话的临时标识ID，用于追踪单次搜索的请求链路（如防重复请求）</td>
<td>无</td>
</tr>
<tr>
<td><code>sst0</code></td>
<td><code>1757665204566</code></td>
<td>时间戳（毫秒级，对应时间为2025年11月12日左右），用于标记请求发起时间</td>
<td>无</td>
</tr>
<tr>
<td><code>lkt</code></td>
<td><code>1%2C1757665204461%2C...</code></td>
<td>包含时间戳的复合参数，推测为“搜索行为追踪标识”（记录点击、请求间隔等）</td>
<td>无</td>
</tr>
</tbody>
</table>
</div>
<p>所以暂时放弃相关尝试，开始寻找替代方案。</p>
<h3 id="OpenHarmony官网博客"><a href="#OpenHarmony官网博客" class="headerlink" title="OpenHarmony官网博客"></a>OpenHarmony官网博客</h3><p>次前我们的接口数据仅仅获取了OpenHarmony官网的资讯页面信息，并没有获取博客的数据。</p>
<p>相同的方式，先点击一下博文板块的文章，随后去开发者工具的网络工具进行抓包。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/79.png" alt="79"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.openharmony.cn/backend/knowledge/secondaryPage/queryBatch?<span class="built_in">type</span>=2&amp;pageNum=1&amp;pageSize=6</span><br></pre></td></tr></table></figure>
<p>直接请求这个链接观察一下返回的数据。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pageSize&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pageNum&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalPage&quot;</span><span class="punctuation">:</span> <span class="number">28</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalNum&quot;</span><span class="punctuation">:</span> <span class="number">165</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1429</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenHarmony输入事件分发之多模输入&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenAtom OpenHarmony（以下简称“OpenHarmony”）面向用户提供了多种人机交互方式，除了支持多种传统输入设备，系统内部还会将各种设备有机结合，发挥分布式/跨设备等优势，事件作为主体媒介，面向多业务场景提供系统级支撑能力。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;textDetails&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;backgroundImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E5%8D%9A%E5%AE%A2/%E9%80%9A%E7%94%A8%E8%A7%A3%E6%9E%90.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mp.weixin.qq.com/s/0UdwzVaODNWO4AT6i6Guqw&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseImage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseUrl&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;startTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024.06.06&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;endTime&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;recommend&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;likesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;shareCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;browseCount&quot;</span><span class="punctuation">:</span> <span class="number">305</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;skip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1408</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenHarmony之Wi-Fi Display介绍&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Wi-Fi Display（缩写为WFD）经常和Miracast联系在一起。实际上，Miracast是Wi-Fi联盟（Wi-Fi Alliance）对支持WFD功能的设备的认证F名称。通过Miracast认证的设备将在最大程度内保持对WFD功能的支持和兼容。所以WFD是一个Miracast的规范。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;textDetails&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;backgroundImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E5%8D%9A%E5%AE%A2/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mp.weixin.qq.com/s/nUKiPwgaTxpiWR5GelqF9g&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseImage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseUrl&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;startTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024.04.15&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;endTime&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;recommend&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;likesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;shareCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;browseCount&quot;</span><span class="punctuation">:</span> <span class="number">157</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;skip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1401</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenHarmony应用启动流程分析——Application&amp;Ability初始化&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本文基于OpenAtom OpenHarmony（以下简称“OpenHarmony”） 4.0 Release版本的源码，对应用进程初始化后MainThread初始化及调用AttachApplication、LaunchApplication、LaunchAbility的过程做了分析和总结，该流程贯穿了应用程序的用户进程和系统服务进程。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;textDetails&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;backgroundImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E5%8D%9A%E5%AE%A2/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mp.weixin.qq.com/s/QyOiCRoMdp7uP4e3SvoDIg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseImage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseUrl&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;startTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024.03.15&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;endTime&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;recommend&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;likesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;shareCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;browseCount&quot;</span><span class="punctuation">:</span> <span class="number">160</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;skip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1399</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;一种OpenHarmony轻量系统适配方案&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本文在不改变原有系统基础框架的基础上， 介绍了一种OpenAtom OpenHarmony（以下简称“OpenHarmony”）轻量系统适配方案。本方案使用的是 OpenHarmony v3.2 Release版本源码。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;textDetails&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;backgroundImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E5%8D%9A%E5%AE%A2/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mp.weixin.qq.com/s/RwKs1gTDngWA4M1WJo8y5Q&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseImage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseUrl&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;startTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024.03.04&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;endTime&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;recommend&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;likesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;shareCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;browseCount&quot;</span><span class="punctuation">:</span> <span class="number">70</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;skip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1398</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;【开源三方库】新版本MPChart：打造更出色的OpenHarmony图表体验&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;随着移动应用的不断发展，数据可视化成为提高用户体验和数据交流的重要手段之一。在OpenAtom OpenHarmony（简称“OpenHarmony”）应用开发中，一个强大而灵活的图表库是实现这一目标的关键。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;textDetails&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;backgroundImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E5%8D%9A%E5%AE%A2/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mp.weixin.qq.com/s/iyy3OeYRLoqACDqRKDljrA&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseImage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseUrl&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;startTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024.03.01&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;endTime&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;recommend&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;likesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;shareCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;browseCount&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;skip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1391</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenHarmony之媒体组件模块简介&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本文基于OpenAtom OpenHarmony（以下简称“OpenHarmony”）3.2 Release源码foundation目录下的player_framework，在OpenHarmony 2.0 Release版本当中，这个模块的名字叫媒体组件模块&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;textDetails&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;backgroundImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://images.openharmony.cn/%E5%86%85%E5%AE%B9%E5%B0%81%E9%9D%A2/%E5%8D%9A%E5%AE%A2/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mp.weixin.qq.com/s/8FSFmkjUfI78tAyeFTNWGg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseImage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;advertiseUrl&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;startTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024.01.30&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;endTime&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;recommend&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;likesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;shareCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;browseCount&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;skip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>可以看到它所获取的数据就是我们此前在开发资讯接口时所见过的数据结构，而且这一次我发现了其实在URL的参数中就有PageSize这一项，其实我只需要去修改这个参数值就可以直接的去获取到对应数量的资讯，这一点似乎之前我没有注意到，而是直接去编写逻辑让爬虫模拟用户点击每一个文章卡片之后去获取这个资源URL，再去获取目标文章地址了。</p>
<h2 id="AI训练营的再优化过程"><a href="#AI训练营的再优化过程" class="headerlink" title="AI训练营的再优化过程"></a>AI训练营的再优化过程</h2><p>在上面的修改完成后，曾老师就组织了AI魔鬼训练营，我将会在一篇新的文章中去记录接下来的修改。</p>
<p><a href="/2025/09/13/AITrainingCamp/">传送门</a></p>
<h2 id="启动页的字体适配"><a href="#启动页的字体适配" class="headerlink" title="启动页的字体适配"></a>启动页的字体适配</h2><p>在此之前我一直只专注于各种各样的功能，现在整体的功能都完成了总算是可以开始扣一扣小细节问题了。</p>
<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>最早发现这个问题是出现在了因为AI训练营，曾老师给我推荐了一个远程AIcoding的神奇手机软件，Happy，很神奇，页确实很好用，于是我就决定用它配合向日葵来尝试一下远程编码的感觉，于是下载了普通手机形态的模拟器，将原本的程序在模拟器上一跑我才发现不对劲。</p>
<div style="
  background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
  border: 1px solid #404040;
  border-radius: 12px;
  padding: 20px;
  margin: 16px 0;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  transition: all 0.3s ease;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
  max-width: 500px;
">
  <div style="display: flex; align-items: center; margin-bottom: 12px;">
    <svg style="width: 20px; height: 20px; margin-right: 8px; fill: #ffffff;" viewbox="0 0 16 16">
      <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
    </svg>
    <div style="margin: 0; color: #ffffff; font-size: 18px; font-weight: 600;">
      <a target="_blank" rel="noopener" href="https://github.com/slopus/happy" style="color: #ffffff; text-decoration: none;">
        slopus/happy
      </a>
    </div>
  </div>
  <p style="color: #d4d4d4; margin: 0 0 16px 0; font-size: 14px; line-height: 1.5;">
    Mobile and Web client for Claude Code, with realtime voice, encryption and fully featured
  </p>
  <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 12px;">
    <span style="display: flex; align-items: center; color: #d4d4d4; font-size: 12px;">
      <span style="
        width: 12px;
        height: 12px;
        background: #3178c6;
        border-radius: 50%;
        margin-right: 6px;
      "></span>
      TypeScript
    </span>
    <span style="display: flex; align-items: center; color: #d4d4d4; font-size: 12px;">
      <svg style="width: 12px; height: 12px; margin-right: 4px; fill: #d4d4d4;" viewbox="0 0 16 16">
        <path d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25z"/>
      </svg>
      1.8k
    </span>
    <span style="display: flex; align-items: center; color: #d4d4d4; font-size: 12px;">
      <svg style="width: 12px; height: 12px; margin-right: 4px; fill: #d4d4d4;" viewbox="0 0 16 16">
        <path d="M5 3.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.122a2.25 2.25 0 10-1.5 0v.878A2.25 2.25 0 005.75 8.5h1.5v2.128a2.251 2.251 0 101.5 0V8.5h1.5a2.25 2.25 0 002.25-2.25v-.878a2.25 2.25 0 10-1.5 0v.878a.75.75 0 01-.75.75h-4.5A.75.75 0 015 6.25v-.878z"/>
      </svg>
      122
    </span>
    <span style="color: #22c55e; font-size: 12px; background: rgba(34, 197, 94, 0.1); padding: 2px 6px; border-radius: 4px;">
      MIT
    </span>
  </div>
  <div style="margin-top: 12px;">
    <a target="_blank" rel="noopener" href="https://github.com/slopus/happy" style="
         color: #ffffff;
         text-decoration: none;
         font-size: 12px;
         border: 1px solid #404040;
         padding: 6px 12px;
         border-radius: 6px;
         background: rgba(255, 255, 255, 0.05);
         transition: all 0.2s ease;
         display: inline-block;
       " onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
      查看仓库
    </a>
  </div>
</div>

<p><img src="/2025/06/29/OpenSourceSummer2025/80.png" alt="80"></p>
<p>对没错它很违和的折行了，这谁受得了，我必须得解决一下，单纯的限制宽度很显然是不显示的，我们虽然可以直接写text的组件宽度为百分之多少来去限制宽度，但是文字的大小不变的花还是会出现折行的情况，如果我直接手动进行单词的花粉并添加折行符号的话显示效果又不太好所以我决定去获取一下屏幕的宽度随后再计算一下文字大小。</p>
<h3 id="issue创建"><a href="#issue创建" class="headerlink" title="issue创建"></a>issue创建</h3><p>这次我决定要规范一下这个新功能的增加过程，于是先去github创建了一个issue。</p>
<div style="
  background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
  border: 1px solid #404040;
  border-left: 4px solid #28a745;
  border-radius: 12px;
  padding: 20px;
  margin: 16px 0;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  transition: all 0.3s ease;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
  max-width: 500px;
">
  <div style="display: flex; align-items: center; margin-bottom: 12px;">
    <svg style="width: 20px; height: 20px; margin-right: 8px; fill: #28a745;" viewbox="0 0 16 16">
      <path d="M8 9.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
      <path fill-rule="evenodd" d="M8 0a8 8 0 100 16A8 8 0 008 0zM1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0z"/>
    </svg>
    <span style="color: #28a745; font-size: 12px; font-weight: 600; margin-right: 8px;">OPEN</span>
    <div style="margin: 0; color: #ffffff; font-size: 16px; font-weight: 600;">
      <a target="_blank" rel="noopener" href="https://github.com/ifLabVibe/NowInOpenHarmony/issues/1" style="color: #ffffff; text-decoration: none;">
        启动页字体适配问题
      </a>
    </div>
  </div>
  <div style="display: flex; align-items: center; margin-bottom: 12px;">
    <span style="color: #d4d4d4; font-size: 12px; margin-right: 16px;">
      #1
    </span>
    <span style="color: #d4d4d4; font-size: 12px; margin-right: 16px;">
      ifLabVibe/NowInOpenHarmony
    </span>
  </div>
  <p style="color: #d4d4d4; margin: 0 0 16px 0; font-size: 14px; line-height: 1.5;">
    当前启动页缺少多设备适配，硬编码的数据仅针对PuraX系列手机屏幕宽度优化，在普通手机屏幕上会出现换行问题。
  </p>
  <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 12px;">
    <span style="display: flex; align-items: center; color: #d4d4d4; font-size: 12px;">
      <svg style="width: 12px; height: 12px; margin-right: 4px; fill: #d4d4d4;" viewbox="0 0 16 16">
        <path d="M8 2a.75.75 0 01.75.75v3.5h3.5a.75.75 0 010 1.5h-3.5v3.5a.75.75 0 01-1.5 0v-3.5h-3.5a.75.75 0 010-1.5h3.5v-3.5A.75.75 0 018 2z"/>
      </svg>
      XBXyftx
    </span>
    <span style="display: flex; align-items: center; color: #d4d4d4; font-size: 12px;">
      <svg style="width: 12px; height: 12px; margin-right: 4px; fill: #d4d4d4;" viewbox="0 0 16 16">
        <path d="M1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0zM8 0a8 8 0 100 16A8 8 0 008 0zm.5 4.75a.75.75 0 00-1.5 0v3.5a.75.75 0 00.471.696l2.5 1a.75.75 0 00.557-1.392L8.5 7.742V4.75z"/>
      </svg>
      Sep 18, 2025
    </span>
    <span style="color: #28a745; font-size: 12px; background: rgba(40, 167, 69, 0.1); padding: 2px 6px; border-radius: 4px;">
      需要修复
    </span>
  </div>
  <div style="margin-top: 12px;">
    <a target="_blank" rel="noopener" href="https://github.com/ifLabVibe/NowInOpenHarmony/issues/1" style="
         color: #ffffff;
         text-decoration: none;
         font-size: 12px;
         border: 1px solid #404040;
         padding: 6px 12px;
         border-radius: 6px;
         background: rgba(255, 255, 255, 0.05);
         transition: all 0.2s ease;
         display: inline-block;
       " onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
      查看Issue
    </a>
  </div>
</div>

<p>由于当前还属于是开源之夏的结项前的最后完善阶段，我就先将这个功能在开源之夏仓库的文件中进行修改，等后面完全结项之后我会去再开一个文章记录后续的完善以及新功能的增加过程。</p>
<h3 id="代码修改"><a href="#代码修改" class="headerlink" title="代码修改"></a>代码修改</h3><p>针对于屏幕宽度的获取我决定使用<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-i#windowproperties">WindowProperties</a>中的windowRect属性去获取。</p>
<h4 id="CodeGenine的回答"><a href="#CodeGenine的回答" class="headerlink" title="CodeGenine的回答"></a>CodeGenine的回答</h4><p>我突然想到我为什么不问一问华为官方所提供的编码助手呢，也许可以给我提供一些不一样的思路呢。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">AutoScaleTextExample</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">title</span>: <span class="built_in">string</span> = <span class="string">&quot;这是一个长文本示例，会根据容器宽度自动缩放&quot;</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">titleFS</span>: <span class="built_in">number</span> = <span class="number">20</span>; <span class="comment">// 初始字体大小</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">pWidth</span>: <span class="built_in">number</span> = <span class="number">300</span>; <span class="comment">// 容器初始宽度</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">title</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">titleFS</span>)</span><br><span class="line">        .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">        .<span class="title function_">onAreaChange</span>(<span class="function">(<span class="params"><span class="attr">oldValue</span>: <span class="title class_">Area</span>, <span class="attr">newValue</span>: <span class="title class_">Area</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 测量文本实际宽度</span></span><br><span class="line">          <span class="keyword">let</span> textWidth = measure.<span class="title function_">measureText</span>(&#123;</span><br><span class="line">            <span class="attr">textContent</span>: <span class="variable language_">this</span>.<span class="property">title</span>,</span><br><span class="line">            <span class="attr">fontSize</span>: <span class="variable language_">this</span>.<span class="property">titleFS</span></span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="comment">// 判断是否需要缩放</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">px2vp</span>(textWidth) &gt; <span class="variable language_">this</span>.<span class="property">pWidth</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">titleFS</span> &gt; <span class="number">12</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">titleFS</span>--; <span class="comment">// 逐步缩小字体</span></span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">px2vp</span>(textWidth) &lt; <span class="variable language_">this</span>.<span class="property">pWidth</span> - <span class="number">10</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">titleFS</span> &lt; <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">titleFS</span>++; <span class="comment">// 逐步放大字体（可选）</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">pWidth</span>)</span><br><span class="line">    .<span class="title function_">onAreaChange</span>(<span class="function">(<span class="params"><span class="attr">oldValue</span>: <span class="title class_">Area</span>, <span class="attr">newValue</span>: <span class="title class_">Area</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">pWidth</span> = newValue.<span class="property">width</span>; <span class="comment">// 更新容器当前宽度</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>确确实实是给我了我个新思路，通过监听区域变化获取区域宽度数据。然后自己编写一个函数去计算字体大小。其实和我原本的思路差不多只是所用的能力接口不同而已。</p>
<p>同时下面还给出了另一种思路。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Row</span>() &#123;</span><br><span class="line">  <span class="title class_">Text</span>(<span class="string">&quot;自适应文本&quot;</span>)</span><br><span class="line">    .<span class="title function_">layoutWeight</span>(<span class="number">1</span>) <span class="comment">// 占满剩余空间</span></span><br><span class="line">    .<span class="title function_">fontSize</span>(<span class="string">&#x27;4%&#x27;</span>)  <span class="comment">// 按容器宽度百分比设置字体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过设置字体大小为容器的百分比，这样就可以实现自适应字体大小了。</p>
<p>居然这么简单。我本来想的就是这个，只不过一时间没有看到文档中写可以用百分比去表示字体大小，就没有管。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Column</span>() &#123;</span><br><span class="line">  <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.logo&#x27;</span>))</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;20%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="number">100</span> &#125;)</span><br><span class="line">  <span class="title class_">Text</span>(<span class="string">&#x27;Welcome To&#x27;</span>)</span><br><span class="line">    .<span class="title function_">fontSize</span>(<span class="string">&#x27;12%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">fontColor</span>(<span class="string">&#x27;#ff00be53&#x27;</span>)</span><br><span class="line">  <span class="title class_">Text</span>(<span class="string">&#x27;NowInOpenHarmony&#x27;</span>)</span><br><span class="line">    .<span class="title function_">fontSize</span>(<span class="string">&#x27;50%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">fontColor</span>(<span class="string">&#x27;#ff00be53&#x27;</span>)</span><br><span class="line">    .<span class="title function_">fontWeight</span>(<span class="number">700</span>)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">expandSafeArea</span>()</span><br><span class="line">.<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#062872&#x27;</span>)</span><br><span class="line">.<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">.<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>设置了百分比字体大小进行尝试，我直接设置一个百分之五十这个很大的数是为了测试这种方式到底是否能生效，因为我仍然在质疑这种方式的可行性。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/81.jpg" alt="81"></p>
<p>卧槽很显然是不生效的，这和我当初学的时候是一样的结论，哪怕是因为组件宽度上的因素导致百分比显得很小，但上下两个文本的比例我设的差距很大但两者的大小显示却是一样的，这就说明确实是没有生效。让我们去看一下最新的文档中的说明。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/82.png" alt="82"></p>
<p>…… 我还能说什么呢，文档特别标注了不能使用百分比，但是……</p>
<h4 id="通过windowRect属性"><a href="#通过windowRect属性" class="headerlink" title="通过windowRect属性"></a>通过windowRect属性</h4><p>在onWindowStageCreate中获取Window实例对象并调用<code>getWindowProperties().windowRect.width</code>获取屏幕宽度，然后通过计算得到字体大小。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onWindowStageCreate</span>(<span class="attr">windowStage</span>: <span class="variable language_">window</span>.<span class="property">WindowStage</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Main window is created, set main page for this ability</span></span><br><span class="line">  hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onWindowStageCreate&#x27;</span>);</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(<span class="variable language_">this</span>.<span class="property">context</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">win</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> winWidth = win.<span class="title function_">getWindowProperties</span>().<span class="property">windowRect</span>.<span class="property">width</span></span><br><span class="line">    <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">WinWidth</span>, <span class="variable constant_">WINDOW_WIDTH</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">WinWidth</span>(winWidth))</span><br><span class="line">  &#125;)</span><br><span class="line">  windowStage.<span class="title function_">loadContent</span>(<span class="string">&#x27;pages/StartPage&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err.<span class="property">code</span>) &#123;</span><br><span class="line">      hilog.<span class="title function_">error</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Failed to load the content. Cause: %&#123;public&#125;s&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Succeeded in loading the content.&#x27;</span>);</span><br><span class="line">    appInit.<span class="title function_">markDownConfigInit</span>()</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ObservedV2</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 屏幕宽度包装类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">WinWidth</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 屏幕宽度值</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Trace</span> <span class="attr">value</span>: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">value</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">uiRouter</span>: <span class="title class_">Router</span> = <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getRouter</span>()</span><br><span class="line"><span class="meta">@Local</span> winWidth : <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">aboutToAppear</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">width</span>:<span class="built_in">number</span> = (<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">WinWidth</span>, <span class="variable constant_">WINDOW_WIDTH</span>)?.<span class="property">value</span>)??<span class="number">350</span></span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="string">`<span class="subst">$&#123;START_PAGE_TAGE&#125;</span>width: <span class="subst">$&#123;width&#125;</span>`</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">winWidth</span> = width</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里也是依据华为官方给出的断点分布图设置了个备用值来防止屏幕宽度获取失败的情况。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/83.png" alt="83"></p>
<p>可以看到这个获取的数据很大，于是我去看了一下文档。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/84.png" alt="84"></p>
<p>单位是px，那看来还得进行一下转换。小小修改一下。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">width</span>: <span class="built_in">number</span> = (<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">WinWidth</span>, <span class="variable constant_">WINDOW_WIDTH</span>)?.<span class="property">value</span>) ?? <span class="number">350</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">winWidth</span> = <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">px2vp</span>(width)</span><br><span class="line">logger.<span class="title function_">debug</span>(<span class="string">`<span class="subst">$&#123;START_PAGE_TAGE&#125;</span>winWidth: <span class="subst">$&#123;<span class="variable language_">this</span>.winWidth&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">updateFontSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> num = <span class="number">16</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">fontsize</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>((<span class="variable language_">this</span>.<span class="property">winWidth</span>*<span class="number">0.9</span>)/num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样的方式的确是可以顺利的去获取了，在puraX上是正常的，但是在模拟器上测试时却无法正常获取目标的宽度导致我们的text组件直接消失了。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/85.png" alt="85"></p>
<p>这让我想到了之前在搜索窗口获取内容时AI助手说过的一句话。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/86.png" alt="86"></p>
<p>“❌ 避免在 aboutToAppear 生命周期调用：此时窗口可能未完成布局，获取的尺寸不准确。”</p>
<p>既然如此，我在onWindowStageCreate调用很可能出现问题。</p>
<p>但是在API17和API18上测试都没发现问题，所以我决定先commit一下进行尝试。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onPageShow</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(<span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">getHostContext</span>()).<span class="title function_">then</span>(<span class="function">(<span class="params">win</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">winWidth</span> =<span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">px2vp</span>(win.<span class="title function_">getWindowProperties</span>().<span class="property">windowRect</span>.<span class="property">width</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">updateFontSize</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>哦！这样一来在模拟器可以了。但是真机上失效了，应该问题就在于模拟器和真机的区别。于是我决定回滚一手去提交。后面再研究研究。</p>
<p>再修改完这些之后我首先是去向孙炼老师提出了最后一次pr合并的申请，开源之夏到这里就算是正式结束了。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/87.jpg" alt="87"></p>
<p><img src="/2025/06/29/OpenSourceSummer2025/88.jpg" alt="88"></p>
<h3 id="github的pr创建与issue关联"><a href="#github的pr创建与issue关联" class="headerlink" title="github的pr创建与issue关联"></a>github的pr创建与issue关联</h3><p>在完成了gitcode这边的pr合并我就决定去github完善我自己的开源仓库，之前我是开启了一个issue去进行规范化的一个需求提出，所以我现在需要去创建一个pr关联目标issue并关闭issue。</p>
<p><img src="/2025/06/29/OpenSourceSummer2025/89.jpg" alt="89"></p>
<p>对于针对本仓库的pr，和对他人仓库fork之后提出合并的pr的流程有些不一样但本质都是一样的！！！我们要把握事物的本质，寻找事物之间的联系，联系是无处不在的。pr——pull request，其本质就是<strong>两个不同分支的代码合并</strong>，两者可以是单个分支的commit领先，也可以是两者互有领先的commit，当两者互有领先时，如果没有良好的合作规范的话就会出现两个分支之的不同commit修改了同一个位置的代码导致冲突的出现，这种冲突都会被git所高亮表示出来，需要由后申请合并的开发者去进行处理，修正冲突部分，所以一般来讲，早点推送！早点合并！要不就要处理冲突了（bushi）我们当然是推荐每个队伍都去便携一套合理的合作规范文档的，并且明确划分每个人的操作区域，不要修改自己负责区域之外的代码，尽可能的解耦、封装，这样才能有效的避免冲突，避免永远是要比修正要好的。</p>
<p>当然了这个过程对于CC来说是轻而易举的吧……我本来是这样想的。但事实很快给了我一巴掌。</p>
<p>第一次让cc尝试的时候我仅仅说了让他创建pr并且关联issue，没有添加任何更多的要求，CC就是直接按照完整的PR流程开始在新的分支去修改我的代码编写测试程序了，真的是很主动了但是也很让人崩溃。</p>
<p>我让他立刻强制回退了全部的代码修改本地以及远程。强制回退之后，我讲更新的代码从新从我gitcode仓库中打包然后再次解压到了我的github本地仓库中，然后第二次尝试是让他严禁修改任何代码仅仅是创建pr并且关联issue，这样也只能说是在极大程度上不会产生以外的代码修改，但我们依旧要手动的去进行commit，甚至是进行代码的zip打包。毕竟前两天也是出现了一些CC删掉了整个库并且篡改了git的记录导致无法通过回滚来进行恢复的悲剧。</p>
<p>第二次的尝试CC的操作让我很震惊，我本来以为只要是不修改我的代码就不会再出什么幺蛾子，但没想到他居然给我创建了一个空的PR，没错是空的，没有任何代码提交的空PR。这个罪证我也是留下来了。</p>
<div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 12px; padding: 20px; margin: 20px 0; color: white; position: relative; overflow: hidden; transition: all 0.3s ease; cursor: pointer; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-5px) scale(1.02)'; this.style.boxShadow='0 8px 25px rgba(40, 167, 69, 0.4)'; this.style.background='linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.3)'; this.style.background='linear-gradient(135deg, #28a745 0%, #20c997 100%)'">
  <div style="position: relative; z-index: 2;">
    <div style="display: flex; align-items: center; margin-bottom: 16px;">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="white" style="margin-right: 12px;">
        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
      </svg>
      <div style="margin: 0; font-size: 20px; font-weight: 600;">Pull Request #2</div>
    </div>
    <p style="margin: 0 0 16px 0; opacity: 0.9; font-size: 14px;">解决issue #1: 启动页字体适配问题</p>
    <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">🚀 首次提交</span>
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">📱 移动应用</span>
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">🎯 资讯聚合</span>
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">📊 +0 -0</span>
    </div>
    <a href="https://github.com/ifLabVibe/NowInOpenHarmony/pull/2" target="_blank" style="display: inline-flex; align-items: center; background: rgba(255,255,255,0.2); color: white; text-decoration: none; padding: 10px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); font-weight: 500; transition: all 0.2s ease;" onclick="event.stopPropagation()" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 8px rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="white" style="margin-right: 12px;">
        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
      </svg>
      查看 Pull Request
    </a>
  </div>
</div>

<p><img src="/2025/06/29/OpenSourceSummer2025/90.png" alt="90"></p>
<p>“No changes to show.<br>This commit has no content.”</p>
<p>没错它改了0行！！！交了一个空pr上去，有点气笑了真的。</p>
<p>不过这次的的确确是没有篡改我的代码，这一点至少是让我感到欣慰的。至于这个空pr嘛，倒也没什么实质性的影响，我就留着他当作是对我自己的警醒把。</p>
<p>紧接着我就再次强调了我的需求是将当前的更改全部提交作为一次pr，用于完成issue #1 的需求。</p>
<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; margin: 20px 0; color: white; position: relative; overflow: hidden; transition: all 0.3s ease; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);" onmouseover="this.style.transform='translateY(-5px) scale(1.02)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.4)'; this.style.background='linear-gradient(135deg, #7c4dff 0%, #8e24aa 100%)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'; this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'">
  <div style="position: relative; z-index: 2;">
    <div style="display: flex; align-items: center; margin-bottom: 16px;">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="white" style="margin-right: 12px;">
        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
      </svg>
      <div style="margin: 0; font-size: 20px; font-weight: 600;">Pull Request #3</div>
    </div>
    <p style="margin: 0 0 16px 0; opacity: 0.9; font-size: 14px;">修复启动页字体适配问题并实现响应式设计</p>
    <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">🔧 Bug修复</span>
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">📱 响应式设计</span>
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">🎨 UI优化</span>
      <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">📊 +123 -109</span>
    </div>
    <a href="https://github.com/ifLabVibe/NowInOpenHarmony/pull/3" target="_blank" style="display: inline-flex; align-items: center; background: rgba(255,255,255,0.2); color: white; text-decoration: none; padding: 10px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); font-weight: 500; transition: all 0.2s ease;" onclick="event.stopPropagation()" onmouseover="this.style.background='rgba(255,255,255,0.35)'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 8px rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="white" style="margin-right: 12px;">
        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
      </svg>
      查看 Pull Request
    </a>
  </div>
</div>

<p>这次就正常了。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><h4 id="整体流程回顾"><a href="#整体流程回顾" class="headerlink" title="整体流程回顾"></a>整体流程回顾</h4><p>解决字体适配的过程中我是特意的去规范化了一个开源项目的优化，从创建issue明确需求，再到发起PR合并代码，在开发期间将代码都放置于一个单独的分支上，不去直接并入主分支，防止主分支代码受到不成熟功能模块的干扰，最后再通过关联issue合并PR来完成整个项目的需求开发流程。</p>
<h4 id="PR的本质"><a href="#PR的本质" class="headerlink" title="PR的本质"></a>PR的本质</h4><p>在这个过程中很重要的一个点就是在于可以创建空PR的，PR的本质是在于<mark class="hl-label blue">不同分支之间的代码合并</mark>，所谓的不同分支并不只局限与fork的镜像仓库自然而然产生的新分支，自己的仓库再开发新的功能为了对代码进行同步而开创的新分支本质上也是属于不同分支，所以我们就可以利用自己的仓库的不同分支上的commit进度差异来去进行PR的创建。</p>
<h4 id="PR的意义"><a href="#PR的意义" class="headerlink" title="PR的意义"></a>PR的意义</h4><p>至于说我们为什么需要PR，我们可以从commit的目的以及需求的开发与解决的角度来讲。</p>
<p>一个需求，就像是微信最近新上的朋友圈评论可以发图片的功能，就是一个典型的在现有产品上进行升级的需求，产品的绝大多数功能是不需要改变的，代码也不需要改动，需要改动的仅仅是朋友圈方面的代码模块，以及为了相关数据存储需求而进行的数据库修改。这些都是为了这个需求而去进行的代码修改以及新功能模块的编写。一套优秀的代码肯定是高内聚低耦合的，对于应用端的代码与原有逻辑的原有模块来说，新需求的开发本该是 “精准打击” 而非 “牵一发而动全身”。但实际开发中，即便只改动朋友圈相关模块，也可能因为开发者对原有代码逻辑的理解偏差、或是不经意间的代码冗余，导致新写的代码与旧模块产生隐性冲突 —— 比如原本处理文字评论的接口，突然要兼容图片上传逻辑，若没做好参数校验，很可能让旧的文字评论功能出现异常。而 PR（Pull Request）恰恰能在代码合并到主分支前，拦住这些潜在风险。它就像一个 “前置审核岗”，让团队里熟悉原有代码架构的同事帮忙把关：看看新写的朋友圈图片存储逻辑是否符合数据库设计规范，新增的接口是否会影响其他依赖该接口的功能，甚至代码风格是否和项目统一 —— 毕竟就算功能实现了，混乱的代码格式也会给后续维护埋下隐患。</p>
<p>再往深了说，commit 的目的是记录每一次代码修改的 “脚印”，而 PR 则是把这些 “脚印” 串联成完整的 “开发故事”。比如开发朋友圈发图功能时，可能会有多个开发者分别负责前端图片预览、后端文件上传、数据库字段新增这几个子任务，每个人都会有自己的 commit 记录。如果直接把这些 commit 合并到主分支，一旦后续发现图片上传失败的问题，很难快速定位是前端参数传错了，还是后端存储逻辑出了问题。但有了 PR 之后，所有人的代码修改都会集中在同一个请求里，评审时可以清晰看到每个子任务的代码关联，出问题时也能顺着 PR 里的讨论记录、代码变更记录，快速定位到具体的修改环节。而且对于后续加入团队的成员来说，翻看历史 PR 记录，也能更清晰地了解每个功能的开发思路、代码修改的考量，比单纯看 commit 日志更容易理解整个项目的演进过程。</p>
<p>另外，从需求迭代的角度来看，PR 也是一个重要的 “质量闸门”。微信的朋友圈功能用户基数庞大，任何一个小的 bug 都可能影响大量用户，所以新功能上线前必须经过严格的验证。PR 的评审过程，不仅仅是看代码是否能跑通，更要考虑代码的健壮性、性能、安全性 —— 比如图片上传时是否做了大小限制，会不会因为超大图片导致服务器压力过大；用户上传的图片是否经过安全检测，避免携带恶意代码；多用户同时评论发图时，数据库会不会出现并发问题等等。这些问题如果等到代码合并后再发现，修复成本会高很多，甚至可能需要回滚版本，影响用户体验。而通过 PR 提前进行多维度评审，能让这些问题在早期就被发现并解决，确保每次需求迭代都是在 “可控、可追溯、高质量” 的前提下推进，既保护了原有功能的稳定性，也让新功能能够更顺畅地落地。</p>
<p>于是总的来说，PR是一次针对于同一需求的代码封装包裹，也是针对于主分支的一次版本升级，commit则是一次次开发中的尝试以及阶段性的成果，是程序员对于开发这个需求所进行的一切尝试的记录。</p>
<h2 id="开源项目开发流程可视化"><a href="#开源项目开发流程可视化" class="headerlink" title="开源项目开发流程可视化"></a>开源项目开发流程可视化</h2><p>在这次开源之夏的项目开发过程中，我深刻体会到了标准化开源项目开发流程的重要性。从需求提出到最终代码合并，每一个环节都有其存在的意义和价值。为了更好地展示这个完整的开发流程，我创建了下面这个可视化流程图：</p>
<div style="width: 100%; max-width: 1200px; margin: 20px auto; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); font-family: 'Arial', sans-serif;">
  <h3 style="text-align: center; color: white; margin-bottom: 30px; font-size: 24px; font-weight: bold;">开源项目开发流程图</h3>
  <!-- 流程节点容器 -->
  <div style="position: relative; display: flex; flex-direction: column; gap: 25px; align-items: center;">
    <!-- 第一步：需求提出 -->
    <div style="display: flex; align-items: center; justify-content: center; width: 100%; position: relative;">
      <div style="background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%); padding: 20px 30px; border-radius: 12px; color: white; text-align: center; min-width: 200px; box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(255, 107, 107, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 5px 15px rgba(255, 107, 107, 0.3)'">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">💡 需求提出</div>
        <div style="font-size: 14px; opacity: 0.9;">发现问题，确定改进方向</div>
      </div>
    </div>
    <!-- 箭头 -->
    <div style="color: white; font-size: 24px; animation: bounce 2s infinite;">↓</div>
    <!-- 第二步：Issue创建 -->
    <div style="display: flex; align-items: center; justify-content: center; width: 100%; position: relative;">
      <div style="background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); padding: 20px 30px; border-radius: 12px; color: white; text-align: center; min-width: 200px; box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(78, 205, 196, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 5px 15px rgba(78, 205, 196, 0.3)'">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">📋 Issue创建</div>
        <div style="font-size: 14px; opacity: 0.9;">详细描述需求和预期效果</div>
      </div>
    </div>
    <!-- 箭头 -->
    <div style="color: white; font-size: 24px; animation: bounce 2s infinite;">↓</div>
    <!-- 第三步：方案设计 -->
    <div style="display: flex; align-items: center; justify-content: center; width: 100%; position: relative;">
      <div style="background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%); padding: 20px 30px; border-radius: 12px; color: #2d5a3d; text-align: center; min-width: 200px; box-shadow: 0 5px 15px rgba(168, 230, 207, 0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(168, 230, 207, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 5px 15px rgba(168, 230, 207, 0.3)'">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">🎯 方案设计</div>
        <div style="font-size: 14px; opacity: 0.9;">制定技术实现方案</div>
      </div>
    </div>
    <!-- 箭头 -->
    <div style="color: white; font-size: 24px; animation: bounce 2s infinite;">↓</div>
    <!-- 第四步：分支创建 -->
    <div style="display: flex; align-items: center; justify-content: center; width: 100%; position: relative;">
      <div style="background: linear-gradient(135deg, #ffd93d 0%, #ff8a00 100%); padding: 20px 30px; border-radius: 12px; color: #8b4513; text-align: center; min-width: 200px; box-shadow: 0 5px 15px rgba(255, 217, 61, 0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(255, 217, 61, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 5px 15px rgba(255, 217, 61, 0.3)'">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">🌿 创建分支</div>
        <div style="font-size: 14px; opacity: 0.9;">建立独立开发环境</div>
      </div>
    </div>
    <!-- 箭头 -->
    <div style="color: white; font-size: 24px; animation: bounce 2s infinite;">↓</div>
    <!-- 第五步：编码开发 -->
    <div style="display: flex; align-items: center; justify-content: center; width: 100%; position: relative;">
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px 30px; border-radius: 12px; color: white; text-align: center; min-width: 200px; box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 5px 15px rgba(102, 126, 234, 0.3)'">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">💻 编码开发</div>
        <div style="font-size: 14px; opacity: 0.9;">实现功能逻辑</div>
      </div>
    </div>
    <!-- 箭头 -->
    <div style="color: white; font-size: 24px; animation: bounce 2s infinite;">↓</div>
    <!-- 第六步：测试 -->
    <div style="display: flex; align-items: center; justify-content: center; width: 100%; position: relative;">
      <div style="background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 100%); padding: 20px 30px; border-radius: 12px; color: white; text-align: center; min-width: 200px; box-shadow: 0 5px 15px rgba(255, 154, 86, 0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(255, 154, 86, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 5px 15px rgba(255, 154, 86, 0.3)'">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">🔍 测试</div>
        <div style="font-size: 14px; opacity: 0.9;">验证功能</div>
      </div>
    </div>
    <!-- 箭头 -->
    <div style="color: white; font-size: 24px; animation: bounce 2s infinite;">↓</div>
    <!-- 第七步：提交代码 -->
    <div style="display: flex; align-items: center; justify-content: center; width: 100%; position: relative;">
      <div style="background: linear-gradient(135deg, #56ccf2 0%, #2f80ed 100%); padding: 20px 30px; border-radius: 12px; color: white; text-align: center; min-width: 200px; box-shadow: 0 5px 15px rgba(86, 204, 242, 0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(86, 204, 242, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 5px 15px rgba(86, 204, 242, 0.3)'">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">💾 Commit</div>
        <div style="font-size: 14px; opacity: 0.9;">提交代码</div>
      </div>
    </div>
    <!-- 箭头 -->
    <div style="color: white; font-size: 24px; animation: bounce 2s infinite;">↓</div>
    <!-- 第八步：PR创建 -->
    <div style="display: flex; align-items: center; justify-content: center; width: 100%; position: relative;">
      <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 20px 30px; border-radius: 12px; color: #2d3436; text-align: center; min-width: 200px; box-shadow: 0 5px 15px rgba(168, 237, 234, 0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(168, 237, 234, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 5px 15px rgba(168, 237, 234, 0.3)'">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">🚀 创建PR</div>
        <div style="font-size: 14px; opacity: 0.9;">请求代码合并到主分支</div>
      </div>
    </div>
    <!-- 箭头 -->
    <div style="color: white; font-size: 24px; animation: bounce 2s infinite;">↓</div>
    <!-- 第九步：代码审查 -->
    <div style="display: flex; align-items: center; justify-content: center; width: 100%; position: relative;">
      <div style="background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); padding: 20px 30px; border-radius: 12px; color: #2d3436; text-align: center; min-width: 200px; box-shadow: 0 5px 15px rgba(255, 234, 167, 0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(255, 234, 167, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 5px 15px rgba(255, 234, 167, 0.3)'">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">👥 代码审查</div>
        <div style="font-size: 14px; opacity: 0.9;">团队成员评审代码质量</div>
      </div>
    </div>
    <!-- 箭头 -->
    <div style="color: white; font-size: 24px; animation: bounce 2s infinite;">↓</div>
    <!-- 第十步：合并完成 -->
    <div style="display: flex; align-items: center; justify-content: center; width: 100%; position: relative;">
      <div style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); padding: 20px 30px; border-radius: 12px; color: white; text-align: center; min-width: 200px; box-shadow: 0 5px 15px rgba(0, 184, 148, 0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(0, 184, 148, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 5px 15px rgba(0, 184, 148, 0.3)'">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">🎉 合并完成</div>
        <div style="font-size: 14px; opacity: 0.9;">代码成功合并，Issue关闭</div>
      </div>
    </div>
  </div>
  <!-- 动画样式 -->
  <style>
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-10px);
      }
      60% {
        transform: translateY(-5px);
      }
    }
  </style>
</div>

<h3 id="流程解析"><a href="#流程解析" class="headerlink" title="流程解析"></a>流程解析</h3><p>从这个可视化流程图中，我们可以清楚地看到开源项目开发的完整链路：</p>
<ol>
<li><p><strong>需求提出阶段</strong>：当我们在使用应用时发现了字体适配问题，这就是一个明确的改进需求。这个阶段重要的是要准确识别问题的本质，而不是仅仅看到表面现象。</p>
</li>
<li><p><strong>Issue创建阶段</strong>：将发现的问题规范化地记录下来，包括问题描述、复现步骤、预期效果等。这不仅是为了让其他开发者理解问题，也是为后续的开发工作建立明确的目标。</p>
</li>
<li><p><strong>方案设计阶段</strong>：在动手编码之前，先要分析技术实现路径。比如这次的字体适配问题，需要考虑使用设备信息API、响应式设计原则等技术方案。</p>
</li>
<li><p><strong>分支创建阶段</strong>：为了保护主分支的稳定性，我们在独立的分支上进行开发。这样即使开发过程中出现问题，也不会影响到项目的主要版本。</p>
</li>
<li><p><strong>开发编码阶段</strong>：这是一个迭代的过程，包含编码→测试→提交的循环。每个小的功能实现都应该及时commit，确保开发进度的可追溯性。</p>
</li>
<li><p><strong>PR创建阶段</strong>：当功能开发完成后，通过Pull Request将所有相关的commit整合起来，请求将代码合并到主分支。</p>
</li>
<li><p><strong>代码审查阶段</strong>：这是质量保障的关键环节。通过同行评审，确保代码质量、安全性和与现有系统的兼容性。</p>
</li>
<li><p><strong>合并完成阶段</strong>：审查通过后，代码正式合并到主分支，相关的Issue也会被关闭，标志着一个完整开发周期的结束。</p>
</li>
</ol>
<p>这个流程不仅适用于开源项目，在企业级开发中也同样有效。它确保了代码质量、开发可追溯性和团队协作的高效性。通过这次开源之夏的实践，我深刻理解了为什么成熟的开源项目都会采用这样的开发流程——它不仅仅是形式上的规范，更是保证项目长期健康发展的基石。</p>
<h2 id="总结与展望"><a href="#总结与展望" class="headerlink" title="总结与展望"></a>总结与展望</h2></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/XBXyftx">XBXyftx</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://xbxyftx.top">https://xbxyftx.top</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">此文章版权归XBXyftx所有，如有转载，请註明来自原作者</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%B8%BF%E8%92%99/">鸿蒙</a><a class="post-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF%E5%90%91/">技术向</a><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE/">项目</a><a class="post-meta__tags" href="/tags/%E5%BC%80%E6%BA%90%E4%B9%8B%E5%A4%8F/">开源之夏</a></div><div class="post-share"><div class="social-share" data-image="/imgs/ArticleTopImgs/OpenSourceSummerTopImg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/06/27/BlogSetup/" title="创客空间2025级新生训练营博客搭建赛道"><img class="cover" src="/imgs/ArticleTopImgs/BlogSetupTopImg.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">创客空间2025级新生训练营博客搭建赛道</div></div><div class="info-2"><div class="info-item-1">创客空间2025级新生训练营博客搭建赛道</div></div></div></a><a class="pagination-related" href="/2025/07/04/entrancePopup/" title="Butterfly主题实现入场弹窗效果"><img class="cover" src="https://bu.dusays.com/2025/07/04/686795125c127.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Butterfly主题实现入场弹窗效果</div></div><div class="info-2"><div class="info-item-1">讲解如何在butterfly主题中添加一个有相关配置项的入场文字弹窗</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/03/31/%E2%80%9CHongXiaoYi%E2%80%9D/" title="鸿小易项目开发笔记"><img class="cover" src="/imgs/ArticleTopImgs/hxyTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-31</div><div class="info-item-2">鸿小易项目开发笔记</div></div><div class="info-2"><div class="info-item-1">鸿小易，你的鸿蒙开发好帮手。</div></div></div></a><a class="pagination-related" href="/2025/03/11/MianShiTong2/" title="面试通项目开发笔记2"><img class="cover" src="/imgs/ArticleTopImgs/MSTTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-11</div><div class="info-item-2">面试通项目开发笔记2</div></div><div class="info-2"><div class="info-item-1">面试通项目开发笔记2（暂时停更）</div></div></div></a><a class="pagination-related" href="/2025/02/27/MianShiTong/" title="面试通项目开发笔记"><img class="cover" src="/imgs/ArticleTopImgs/MSTTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-27</div><div class="info-item-2">面试通项目开发笔记</div></div><div class="info-2"><div class="info-item-1">面试通项目开发笔记</div></div></div></a><a class="pagination-related" href="/2025/02/08/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="我的书架项目笔记"><img class="cover" src="/imgs/ArticleTopImgs/BookShelfTopImg.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-08</div><div class="info-item-2">我的书架项目笔记</div></div><div class="info-2"><div class="info-item-1">一个对利用NetWork Kit发送HTTP请求的实战练习项目</div></div></div></a><a class="pagination-related" href="/2025/01/30/%E5%BC%80%E5%BF%83%E4%B8%80%E7%AC%91%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="开心一笑项目笔记"><img class="cover" src="/imgs/ArticleTopImgs/JokeTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-30</div><div class="info-item-2">开心一笑项目笔记</div></div><div class="info-2"><div class="info-item-1">下拉刷新与触底加载逻辑的练习项目</div></div></div></a><a class="pagination-related" href="/2025/01/25/%E9%B8%BF%E8%92%99%E8%AE%B0%E8%B4%A6%E6%9C%AC%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="鸿蒙记账本项目笔记"><img class="cover" src="/imgs/ArticleTopImgs/JiZhangBenTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-25</div><div class="info-item-2">鸿蒙记账本项目笔记</div></div><div class="info-2"><div class="info-item-1">数据共享练习</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">XBXyftx</div><div class="author-info-description">博安千古情如此<br/>璇玉如华自醉从</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/XBXyftx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/XBXyftx" target="_blank" title="Github"><i class="fab fa-github" style="color: #c3ffff;"></i></a><a class="social-icon" href="mailto:shuaixbx02@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="/img/wechat.png" target="_blank" title="WeChat"><i class="fa-brands fa-weixin" style="color: #7bb342;"></i></a></div></div><div class="card-widget card-info visitor-info"><div class="card-content"><div class="visitor-welcome"><i class="fas fa-heart"></i><span id="visitor-text">欢迎来访！</span></div><div class="visitor-details"><div class="visitor-location"><i class="fas fa-map-marker-alt"></i><span id="visitor-location-text">正在获取位置信息...</span></div><div class="visitor-ip"><i class="fas fa-globe"></i><span>IP地址: </span><span id="visitor-ip-text">获取中...</span></div><div class="visitor-distance"><i class="fas fa-route"></i><span id="visitor-distance-text">距离博主 加载中...</span></div><div class="visitor-tip"><i class="fas fa-moon"></i><span id="visitor-tip-text">晚上好，夜生活嗨起来！</span></div></div></div><script>// 访问者信息获取
(function() {
  // IP地址获取API列表（按优先级排序）
  const ipApis = [
    'https://api.ip.sb/geoip',
    'https://ipapi.co/json/',
    'https://freegeoip.app/json/',
    'https://ipinfo.io/json'
  ];
  
  let currentApiIndex = 0;
  
  function tryGetLocation() {
    if (currentApiIndex >= ipApis.length) {
      // 所有API都失败了，显示错误信息
      handleError('所有IP服务都无法访问');
      return;
    }
    
    const currentApi = ipApis[currentApiIndex];
    
    fetch(currentApi)
      .then(response => {
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return response.json();
      })
      .then(data => {
        processLocationData(data, currentApi);
      })
      .catch(error => {
        console.warn(`API ${currentApi} 失败:`, error);
        currentApiIndex++;
        setTimeout(tryGetLocation, 1000); // 1秒后尝试下一个API
      });
  }
  
  function processLocationData(data, apiUrl) {
    let country, region, city, ip, latitude, longitude;
    
    // 根据不同API格式处理数据
    if (apiUrl.includes('ip.sb')) {
      country = data.country || '未知';
      region = data.region || '未知';
      city = data.city || '未知';
      ip = data.ip || '未知';
      latitude = data.latitude;
      longitude = data.longitude;
    } else if (apiUrl.includes('ipapi.co')) {
      country = data.country_name || '未知';
      region = data.region || '未知';
      city = data.city || '未知';
      ip = data.ip || '未知';
      latitude = data.latitude;
      longitude = data.longitude;
    } else if (apiUrl.includes('freegeoip.app')) {
      country = data.country_name || '未知';
      region = data.region_name || '未知';
      city = data.city || '未知';
      ip = data.ip || '未知';
      latitude = data.latitude;
      longitude = data.longitude;
    } else if (apiUrl.includes('ipinfo.io')) {
      country = data.country || '未知';
      const loc = data.region || '未知';
      region = loc;
      city = data.city || '未知';
      ip = data.ip || '未知';
      if (data.loc) {
        const coords = data.loc.split(',');
        latitude = parseFloat(coords[0]);
        longitude = parseFloat(coords[1]);
      }
    }
    
    // 更新IP地址
    document.getElementById('visitor-ip-text').textContent = ip;
    
    // 更新位置信息和欢迎文字
    let locationText = '';
    if (country === '中国' || country === 'China' || country === 'CN') {
      locationText = `${region} ${city}`;
                    document.getElementById('visitor-text').innerHTML = `欢迎来自 ${region} ${city} 的朋友♥️`;
    } else {
      locationText = `${country} ${region}`;
      document.getElementById('visitor-text').innerHTML = `欢迎来自 ${country} 的朋友♥️`;
    }
    document.getElementById('visitor-location-text').textContent = locationText;
    
    // 计算距离（可配置博主位置）
    if (latitude && longitude && !isNaN(latitude) && !isNaN(longitude)) {
      const bloggerLat = 39.9042; // 北京纬度
      const bloggerLng = 116.4074; // 北京经度
      const distance = calculateDistance(latitude, longitude, bloggerLat, bloggerLng);
      
      if (distance < 1) {
        document.getElementById('visitor-distance-text').textContent = `距离博主 ${(distance * 1000).toFixed(0)} 米！`;
      } else if (distance < 100) {
        document.getElementById('visitor-distance-text').textContent = `距离博主 ${distance.toFixed(1)} 公里！`;
      } else {
        document.getElementById('visitor-distance-text').textContent = `距离博主 ${distance.toFixed(0)} 公里！`;
      }
    } else {
      document.getElementById('visitor-distance-text').textContent = '距离计算中...';
    }
    
    // 根据时间设置问候语
    updateGreeting();
  }
  
  function updateGreeting() {
    const now = new Date();
    const hour = now.getHours();
    let greeting = '';
    let icon = 'fas fa-sun';
    
    if (hour >= 6 && hour < 12) {
      greeting = '上午好，新的一天开始了！';
      icon = 'fas fa-sun';
    } else if (hour >= 12 && hour < 14) {
      greeting = '中午好，记得吃午饭哦！';
      icon = 'fas fa-sun';
    } else if (hour >= 14 && hour < 18) {
      greeting = '下午好，午后时光真美好！';
      icon = 'fas fa-cloud-sun';
    } else if (hour >= 18 && hour < 22) {
      greeting = '晚上好，夜生活嗨起来！';
      icon = 'fas fa-moon';
    } else {
      greeting = '深夜了，注意休息哦！';
      icon = 'fas fa-moon';
    }
    
    const tipElement = document.getElementById('visitor-tip-text');
    const tipIcon = tipElement.parentElement.querySelector('i');
    tipElement.textContent = greeting;
    if (tipIcon) {
      tipIcon.className = icon;
    }
  }
  
  function handleError(message) {
    document.getElementById('visitor-ip-text').textContent = '获取失败';
    document.getElementById('visitor-location-text').textContent = '获取失败';
    document.getElementById('visitor-distance-text').textContent = '距离未知';
    document.getElementById('visitor-text').innerHTML = '欢迎来访！';
    console.error('获取访问者信息失败:', message);
  }
  
  // 计算两点间距离的函数（使用Haversine公式）
  function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // 地球半径，单位：千米
    const dLat = deg2rad(lat2 - lat1);
    const dLon = deg2rad(lon2 - lon1);
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
              Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  }
  
  function deg2rad(deg) {
    return deg * (Math.PI/180);
  }
  
  // 启动获取位置信息
  tryGetLocation();
  
  // 每分钟更新一次问候语
  setInterval(updateGreeting, 60000);
})(); </script></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">鸿蒙生态，星河璀璨！<br/><img src="https://bu.dusays.com/2025/09/10/68c18a5b2710f.jpg" alt="1748944170064.jpg" title="1748944170064.jpg" class="announcementImg"/></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">项目简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%90%8D%E7%A7%B0"><span class="toc-number">2.1.</span> <span class="toc-text">项目名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF"><span class="toc-number">2.2.</span> <span class="toc-text">项目背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E6%A0%87"><span class="toc-number">2.3.</span> <span class="toc-text">项目目标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%97%B6%E9%97%B4%E8%A7%84%E5%88%92"><span class="toc-number">3.</span> <span class="toc-text">项目时间规划</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98"><span class="toc-number">4.</span> <span class="toc-text">核心问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="toc-number">4.1.</span> <span class="toc-text">信息的获取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TodayOpenHarmony%E9%A1%B9%E7%9B%AE%E5%88%86%E6%9E%90"><span class="toc-number">4.1.1.</span> <span class="toc-text">TodayOpenHarmony项目分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E8%AE%AF%E5%86%85%E5%AE%B9%E4%BC%A0%E9%80%92%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">4.2.</span> <span class="toc-text">资讯内容传递的格式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%8E%E7%A1%AE%E9%9C%80%E6%B1%82"><span class="toc-number">4.2.1.</span> <span class="toc-text">明确需求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E8%AE%AF%E7%9A%84%E6%B8%B2%E6%9F%93%E5%BD%A2%E5%BC%8F"><span class="toc-number">4.3.</span> <span class="toc-text">资讯的渲染形式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%8F%AF%E8%A1%8C%E6%80%A7%E9%AA%8C%E8%AF%81"><span class="toc-number">5.</span> <span class="toc-text">方案设计与可行性验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%92%A8%E8%AF%A2%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96"><span class="toc-number">5.1.</span> <span class="toc-text">咨询信息获取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OpenHarmony%E5%AE%98%E7%BD%91%E8%B5%84%E8%AE%AF"><span class="toc-number">5.1.1.</span> <span class="toc-text">OpenHarmony官网资讯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6%E6%9E%84%E5%BB%BA"><span class="toc-number">5.1.2.</span> <span class="toc-text">后端项目框架构建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98%E4%B8%8E%E6%9B%B4%E6%96%B0%E6%9C%BA%E5%88%B6"><span class="toc-number">5.1.3.</span> <span class="toc-text">数据缓存与更新机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%A7%A3%E5%86%B3%E4%B8%BB%E7%BA%BF%E7%A8%8B%E9%98%BB%E5%A1%9E%E9%97%AE%E9%A2%98"><span class="toc-number">5.1.4.</span> <span class="toc-text">多线程解决主线程阻塞问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSDN%E5%B9%B3%E5%8F%B0%E8%B5%84%E8%AE%AF"><span class="toc-number">5.1.5.</span> <span class="toc-text">CSDN平台资讯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSDN%E8%B5%84%E8%AE%AF%E6%BA%90%E7%9A%84%E4%BB%A3%E7%A0%81%E5%9D%97%E7%BB%93%E6%9E%84%E4%B8%93%E9%A1%B9%E4%BC%98%E5%8C%96"><span class="toc-number">5.1.6.</span> <span class="toc-text">CSDN资讯源的代码块结构专项优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSDN%E8%B5%84%E6%BA%90%E6%95%B0%E9%87%8F%E9%97%AE%E9%A2%98"><span class="toc-number">5.1.7.</span> <span class="toc-text">CSDN资源数量问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%A1%8C%E6%80%A7%E9%AA%8C%E8%AF%81%E9%98%B6%E6%AE%B5%E6%B1%87%E6%8A%A5"><span class="toc-number">5.2.</span> <span class="toc-text">可行性验证阶段汇报</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%AD%A3%E5%BC%8F%E5%BC%80%E5%8F%91%E9%98%B6%E6%AE%B5"><span class="toc-number">6.</span> <span class="toc-text">后端正式开发阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%BA%90%E7%88%AC%E8%99%AB%E5%AE%8C%E5%96%84"><span class="toc-number">6.1.</span> <span class="toc-text">信息源爬虫完善</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CSDN%E7%88%AC%E8%99%AB%E7%9A%84404%E9%98%B2%E5%BE%A1%E6%9C%BA%E5%88%B6"><span class="toc-number">6.1.1.</span> <span class="toc-text">CSDN爬虫的404防御机制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSDN%E7%88%AC%E8%99%AB%E7%9A%84%E4%B8%BB%E7%BA%BF%E5%90%88%E5%B9%B6"><span class="toc-number">6.2.</span> <span class="toc-text">CSDN爬虫的主线合并</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%B5%8B%E8%AF%95"><span class="toc-number">6.3.</span> <span class="toc-text">后端测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%88%86%E9%A1%B5%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0"><span class="toc-number">6.4.</span> <span class="toc-text">不分页数据获取参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95"><span class="toc-number">6.5.</span> <span class="toc-text">核心接口测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91"><span class="toc-number">7.</span> <span class="toc-text">客户端开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">7.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E5%BA%94%E7%94%A8%E6%9E%84%E6%83%B3"><span class="toc-number">7.2.</span> <span class="toc-text">整体应用构想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E9%A1%B5%E9%9D%A2%E6%9E%84%E5%BB%BA"><span class="toc-number">7.3.</span> <span class="toc-text">启动页面构建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Navigation%E5%90%AF%E5%8A%A8%E9%A1%B5%E9%97%AE%E9%A2%98"><span class="toc-number">7.3.1.</span> <span class="toc-text">Navigation启动页问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E6%9E%84%E5%BB%BA"><span class="toc-number">7.4.</span> <span class="toc-text">API基础功能模块构建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%B7%A5%E5%85%B7%E5%B0%81%E8%A3%85"><span class="toc-number">7.4.1.</span> <span class="toc-text">网络请求工具封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#API%E6%B5%8B%E8%AF%95"><span class="toc-number">7.4.2.</span> <span class="toc-text">API测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E9%97%BBAPI"><span class="toc-number">7.4.3.</span> <span class="toc-text">新闻API</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8E%A5%E5%8F%A3"><span class="toc-number">7.5.</span> <span class="toc-text">数据库接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E9%A6%96%E9%80%89%E9%A1%B9%E6%8E%A5%E5%8F%A3"><span class="toc-number">7.6.</span> <span class="toc-text">用户首选项接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E6%8E%A5%E5%8F%A3"><span class="toc-number">7.7.</span> <span class="toc-text">应用初始化接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%99%A8%E5%B0%81%E8%A3%85"><span class="toc-number">7.7.1.</span> <span class="toc-text">数据管理器封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E6%8E%A5%E5%8F%A3%E6%9B%B4%E6%96%B0"><span class="toc-number">7.7.2.</span> <span class="toc-text">配置初始化接口更新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E6%9C%AA%E5%88%9D%E5%A7%8B%E5%8C%96%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3"><span class="toc-number">7.7.3.</span> <span class="toc-text">资源未初始化问题的解决</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E6%B5%85%E8%89%B2%E5%88%87%E6%8D%A2%E5%B7%A5%E5%85%B7"><span class="toc-number">7.8.</span> <span class="toc-text">深浅色切换工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B8%8E%E7%A0%94%E7%A9%B6"><span class="toc-number">7.8.1.</span> <span class="toc-text">持久化失败的问题排查与研究</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KV%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E6%96%B0%E9%97%BB%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">7.9.</span> <span class="toc-text">KV数据库与新闻数据管理器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#KV%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%8A%9F%E8%83%BD%E5%AE%8C%E5%96%84"><span class="toc-number">7.9.1.</span> <span class="toc-text">KV数据库的功能完善</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E9%A1%B5UI"><span class="toc-number">7.10.</span> <span class="toc-text">启动页UI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%A1%B5%E9%9D%A2UI"><span class="toc-number">7.11.</span> <span class="toc-text">主页面UI</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E9%85%8D%E8%89%B2"><span class="toc-number">7.11.1.</span> <span class="toc-text">页面配色</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Navigation%E6%A0%87%E9%A2%98%E7%9A%84%E4%BB%8E%E6%96%B0%E5%90%AF%E7%94%A8"><span class="toc-number">7.11.2.</span> <span class="toc-text">Navigation标题的从新启用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B3%E6%9D%BF%E7%AB%96%E5%B1%8F%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98"><span class="toc-number">7.12.</span> <span class="toc-text">平板竖屏显示问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2%E4%B8%8E%E6%96%AD%E7%82%B9%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%92%88%E5%AF%B9%E6%80%A7%E8%B0%83%E4%BC%98"><span class="toc-number">7.13.</span> <span class="toc-text">媒体查询与断点系统的针对性调优</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3%E8%B0%83%E4%BC%98"><span class="toc-number">7.13.1.</span> <span class="toc-text">媒体查询接口调优</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E6%96%AD%E7%82%B9%E5%AE%BD%E5%BA%A6%E8%B0%83%E6%95%B4"><span class="toc-number">7.13.2.</span> <span class="toc-text">窗口断点宽度调整</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E7%94%B1%E5%A4%9A%E7%AA%97%E6%A8%A1%E5%BC%8F%E9%92%88%E5%AF%B9%E8%B0%83%E4%BC%98"><span class="toc-number">7.13.3.</span> <span class="toc-text">自由多窗模式针对调优</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E7%95%8C%E9%9D%A2%E6%B8%B2%E6%9F%93%E5%B8%83%E5%B1%80"><span class="toc-number">7.14.</span> <span class="toc-text">主界面渲染布局</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%9C%E8%89%B2%E5%88%87%E6%8D%A2%E6%8C%89%E9%92%AE%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%B8%83%E5%B1%80"><span class="toc-number">7.14.1.</span> <span class="toc-text">颜色切换按钮的位置布局</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E5%B9%B3%E6%9D%BF%E5%92%8C%E6%89%8B%E6%9C%BA%E7%9A%84%E5%B7%AE%E5%BC%82%E5%8C%96%E5%B8%83%E5%B1%80"><span class="toc-number">7.14.2.</span> <span class="toc-text">针对平板和手机的差异化布局</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E5%90%B8%E9%A1%B6"><span class="toc-number">7.14.3.</span> <span class="toc-text">首页吸顶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%83%AD%E7%82%B9%E6%96%B0%E9%97%BB%E5%88%97%E8%A1%A8%E6%B8%B2%E6%9F%93"><span class="toc-number">7.14.4.</span> <span class="toc-text">热点新闻列表渲染</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%B8%E9%A1%B6%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC"><span class="toc-number">7.14.5.</span> <span class="toc-text">吸顶事件监听</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E9%A1%B6%E9%83%A8%E6%8C%89%E9%92%AE"><span class="toc-number">7.14.6.</span> <span class="toc-text">返回顶部按钮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%87%92%E5%8A%A0%E8%BD%BD%E6%94%B9%E9%80%A0"><span class="toc-number">7.14.7.</span> <span class="toc-text">懒加载改造</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0"><span class="toc-number">7.14.8.</span> <span class="toc-text">下拉刷新</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E7%88%AC%E8%99%AB%E9%80%BB%E8%BE%91%E8%B0%83%E4%BC%98"><span class="toc-number">8.</span> <span class="toc-text">后端爬虫逻辑调优</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CSDN%E7%88%AC%E8%99%AB%E6%95%B0%E6%8D%AE%E9%97%AE%E9%A2%98"><span class="toc-number">8.1.</span> <span class="toc-text">CSDN爬虫数据问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PR%E5%88%9B%E5%BB%BA"><span class="toc-number">9.</span> <span class="toc-text">PR创建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#doc%E7%AD%BE%E7%BD%B2"><span class="toc-number">9.1.</span> <span class="toc-text">doc签署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAissue"><span class="toc-number">9.2.</span> <span class="toc-text">创建issue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D%E6%8E%A8%E9%80%81"><span class="toc-number">9.3.</span> <span class="toc-text">签名推送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%AD%BE%E5%90%8DCommit"><span class="toc-number">9.4.</span> <span class="toc-text">如何实现签名Commit</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8-s%E5%8F%82%E6%95%B0%E5%BF%AB%E9%80%9F%E6%B7%BB%E5%8A%A0Signed-off-by"><span class="toc-number">9.4.1.</span> <span class="toc-text">方式一：使用-s参数快速添加Signed-off-by</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8GPG%E5%AF%86%E9%92%A5%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%E7%AD%BE%E5%90%8D"><span class="toc-number">9.4.2.</span> <span class="toc-text">方式二：使用GPG密钥进行加密签名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%89%EF%BC%9A%E4%BD%BF%E7%94%A8SSH%E5%AF%86%E9%92%A5%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D"><span class="toc-number">9.4.3.</span> <span class="toc-text">方式三：使用SSH密钥进行签名</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VScode%E7%9A%84git%E6%8E%A2%E7%B4%A2"><span class="toc-number">9.5.</span> <span class="toc-text">VScode的git探索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E6%BA%90%E5%8D%8F%E8%AE%AE%E7%89%88%E6%9D%83%E5%A4%B4%E7%9A%84%E6%B7%BB%E5%8A%A0"><span class="toc-number">9.6.</span> <span class="toc-text">开源协议版权头的添加</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E6%AC%A1%E4%BB%A3%E7%A0%81%E7%9A%84%E5%90%88%E5%B9%B6"><span class="toc-number">10.</span> <span class="toc-text">首次代码的合并</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E6%96%87%E6%B8%B2%E6%9F%93"><span class="toc-number">11.</span> <span class="toc-text">正文渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E6%96%87%E6%B8%B2%E6%9F%93%E7%BB%84%E4%BB%B6"><span class="toc-number">11.1.</span> <span class="toc-text">正文渲染组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Markdown%E4%B8%89%E6%96%B9%E5%BA%93%E7%BB%84%E4%BB%B6%E9%85%8D%E7%BD%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">11.1.1.</span> <span class="toc-text">Markdown三方库组件配置初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E9%80%BB%E8%BE%91"><span class="toc-number">11.1.2.</span> <span class="toc-text">渲染逻辑</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nav%E4%BC%A0%E5%8F%82"><span class="toc-number">11.2.</span> <span class="toc-text">Nav传参</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%B3%E8%BD%AC%E5%AF%BC%E8%88%AA%E6%9B%B4%E6%96%B0"><span class="toc-number">11.2.1.</span> <span class="toc-text">跳转导航更新</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1pr%E5%88%9B%E5%BB%BA"><span class="toc-number">12.</span> <span class="toc-text">第二次pr创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E7%88%AC%E8%99%AB%E5%8F%96%E4%BB%A3CSDN%E7%88%AC%E8%99%AB"><span class="toc-number">13.</span> <span class="toc-text">微信公众号爬虫取代CSDN爬虫</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AE%E6%92%AD%E5%9B%BE%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91"><span class="toc-number">14.</span> <span class="toc-text">轮播图爬虫开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91"><span class="toc-number">14.1.</span> <span class="toc-text">爬虫开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%8F%A3%E9%80%82%E9%85%8D"><span class="toc-number">14.2.</span> <span class="toc-text">客户端接口适配</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">14.2.1.</span> <span class="toc-text">数据模型定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%B0%81%E8%A3%85"><span class="toc-number">14.2.2.</span> <span class="toc-text">接口封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NewsManager%E5%8A%9F%E8%83%BD%E6%8B%93%E5%B1%95"><span class="toc-number">14.2.3.</span> <span class="toc-text">NewsManager功能拓展</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenHarmony%E5%8D%9A%E6%96%87%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">15.</span> <span class="toc-text">OpenHarmony博文接口开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E4%BA%8E%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%85%B3%E9%94%AE%E8%AF%8D%E6%90%9C%E7%B4%A2%E7%9A%84%E5%B0%9D%E8%AF%95"><span class="toc-number">15.1.</span> <span class="toc-text">针对于微信公众号关键词搜索的尝试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenHarmony%E5%AE%98%E7%BD%91%E5%8D%9A%E5%AE%A2"><span class="toc-number">15.2.</span> <span class="toc-text">OpenHarmony官网博客</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AI%E8%AE%AD%E7%BB%83%E8%90%A5%E7%9A%84%E5%86%8D%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B"><span class="toc-number">16.</span> <span class="toc-text">AI训练营的再优化过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E9%A1%B5%E7%9A%84%E5%AD%97%E4%BD%93%E9%80%82%E9%85%8D"><span class="toc-number">17.</span> <span class="toc-text">启动页的字体适配</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="toc-number">17.1.</span> <span class="toc-text">问题描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#issue%E5%88%9B%E5%BB%BA"><span class="toc-number">17.2.</span> <span class="toc-text">issue创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9"><span class="toc-number">17.3.</span> <span class="toc-text">代码修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CodeGenine%E7%9A%84%E5%9B%9E%E7%AD%94"><span class="toc-number">17.3.1.</span> <span class="toc-text">CodeGenine的回答</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87windowRect%E5%B1%9E%E6%80%A7"><span class="toc-number">17.3.2.</span> <span class="toc-text">通过windowRect属性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#github%E7%9A%84pr%E5%88%9B%E5%BB%BA%E4%B8%8Eissue%E5%85%B3%E8%81%94"><span class="toc-number">17.4.</span> <span class="toc-text">github的pr创建与issue关联</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">17.5.</span> <span class="toc-text">小结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%9B%9E%E9%A1%BE"><span class="toc-number">17.5.1.</span> <span class="toc-text">整体流程回顾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PR%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="toc-number">17.5.2.</span> <span class="toc-text">PR的本质</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PR%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-number">17.5.3.</span> <span class="toc-text">PR的意义</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">18.</span> <span class="toc-text">开源项目开发流程可视化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">18.1.</span> <span class="toc-text">开源项目开发流程图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90"><span class="toc-number">18.2.</span> <span class="toc-text">流程解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B"><span class="toc-number">19.</span> <span class="toc-text">总结与展望</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/09/13/AITrainingCamp/" title="AITrainingCamp"><img src="/imgs/ArticleTopImgs/AITrainingCampTopImg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AITrainingCamp"/></a><div class="content"><a class="title" href="/2025/09/13/AITrainingCamp/" title="AITrainingCamp">AITrainingCamp</a><time datetime="2025-09-13T06:12:42.000Z" title="发表于 2025-09-13 14:12:42">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/11/CodeInspiration/" title="由单向编程走向多向编程"><img src="/imgs/ArticleTopImgs/CodeInspirationTopImg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="由单向编程走向多向编程"/></a><div class="content"><a class="title" href="/2025/09/11/CodeInspiration/" title="由单向编程走向多向编程">由单向编程走向多向编程</a><time datetime="2025-09-11T07:26:54.000Z" title="发表于 2025-09-11 15:26:54">2025-09-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/04/entrancePopup/" title="Butterfly主题实现入场弹窗效果"><img src="https://bu.dusays.com/2025/07/04/686795125c127.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Butterfly主题实现入场弹窗效果"/></a><div class="content"><a class="title" href="/2025/07/04/entrancePopup/" title="Butterfly主题实现入场弹窗效果">Butterfly主题实现入场弹窗效果</a><time datetime="2025-07-04T05:58:26.000Z" title="发表于 2025-07-04 13:58:26">2025-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/29/OpenSourceSummer2025/" title="开源之夏NowInOpenHarmony"><img src="/imgs/ArticleTopImgs/OpenSourceSummerTopImg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="开源之夏NowInOpenHarmony"/></a><div class="content"><a class="title" href="/2025/06/29/OpenSourceSummer2025/" title="开源之夏NowInOpenHarmony">开源之夏NowInOpenHarmony</a><time datetime="2025-06-29T06:01:21.000Z" title="发表于 2025-06-29 14:01:21">2025-06-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/27/BlogSetup/" title="创客空间2025级新生训练营博客搭建赛道"><img src="/imgs/ArticleTopImgs/BlogSetupTopImg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="创客空间2025级新生训练营博客搭建赛道"/></a><div class="content"><a class="title" href="/2025/06/27/BlogSetup/" title="创客空间2025级新生训练营博客搭建赛道">创客空间2025级新生训练营博客搭建赛道</a><time datetime="2025-06-27T08:45:41.000Z" title="发表于 2025-06-27 16:45:41">2025-06-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/footerBg.png);"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By XBXyftx</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><span>备案号：京ICP备2025126467号</span></a></div><div></div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now = new Date(); 
function createtime() { 
var grt = new Date("4/25/2024 18:30"); // 在此处修改你的建站时间
now.setTime(now.getTime() + 250); 
days = (now - grt) / 1000 / 60 / 60 / 24; 
dnum = Math.floor(days); 
hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum); 
hnum = Math.floor(hours); 
if (String(hnum).length == 1) { hnum = "0" + hnum; } 
minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum); 
mnum = Math.floor(minutes); 
if (String(mnum).length == 1) { mnum = "0" + mnum; } 
seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
snum = Math.round(seconds); 
if (String(snum).length == 1) { snum = "0" + snum; } 
document.getElementById("timeDate").innerHTML = "本网站已运行 " + dnum + " 天 "; 
document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
} 
setInterval(createtime, 250);</script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa-solid fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa-solid fa-arrow-rotate-right"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa-solid fa-arrow-right"></i></a><a class="rightMenu-item" id="menu-radompage" href="javascript:window.location.href = window.location.origin;"><i class="fa-solid fa-house"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa-solid fa-copy"></i><span>复制</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:rmf.switchReadMode();"><i class="fa-solid fa-book"></i><span>阅读模式</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.js"></script><!-- 瀑布流JavaScript - 只在首页加载--><!-- 文章打字机效果 - 只在文章页面加载--><script src="/js/typewriter-effect.js"></script><!-- 网络监控器 - 帮助定位503问题--><script src="/js/network-monitor.js"></script><script src="/js/topimg-monitor.js"></script><!-- 入场弹窗功能--><script src="/js/entrance-popup-config.js"></script><script src="/js/entrance-popup.js"></script><!-- 基础懒加载功能--><script src="/js/lazy-loading.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikooxbx.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikooxbx.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('/js/twikoo.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script>localStorage.setItem('theme','dark')</script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script> // 强制锁定为暗黑模式 localStorage.setItem('theme', 'dark'); // 防止其他脚本覆盖模式 document.documentElement.setAttribute('data-theme', 'dark'); </script><link rel="stylesheet" href="/css/styles.css"><script> document.querySelectorAll('#post-comment).forEach(el => { el.style.backgroundColor = 'rgba(255, 255, 255, 0.6)'; }); </script><script src="/js/jquery-3.6.0.min.js"></script><script src="/js/rightmenu.js"></script><link rel="twikoo" href="/css/twikoo.css"><script src="/js/happy-title.js" async></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="/%5Bobject%20Object%5D"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="99" count="99" mobile="true" src="/%5Bobject%20Object%5D"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementsByClassName('recent-posts')[0];
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/06/24/typewriter/" alt=""><img width="48" height="48" src="/imgs/ArticleTopImgs/TypeWriteTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-06-24</span><a class="blog-slider__title" href="2025/06/24/typewriter/" alt="">Butterfly主题实现简介打字机</a><div class="blog-slider__text">详细介绍如何在Hexo的Butterfly主题中添加炫酷的打字机效果，包含完整的实现代码和配置方法。</div><a class="blog-slider__button" href="2025/06/24/typewriter/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/04/30/ToTheApril2025/" alt=""><img width="48" height="48" src="/imgs/ArticleTopImgs/AprilTopImg.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-30</span><a class="blog-slider__title" href="2025/04/30/ToTheApril2025/" alt="">致2025那个繁忙的4月</a><div class="blog-slider__text">人们总是匆匆向前，殊不知时光易逝啊……（本文图量较大加载较慢持续更新中！！！）</div><a class="blog-slider__button" href="2025/04/30/ToTheApril2025/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/03/16/yiDuo/" alt=""><img width="48" height="48" src="/imgs/ArticleTopImgs/yiduoTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-03-16</span><a class="blog-slider__title" href="2025/03/16/yiDuo/" alt="">关于鸿蒙的一多能力</a><div class="blog-slider__text">一多能力的学习笔记</div><a class="blog-slider__button" href="2025/03/16/yiDuo/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/02/04/V2/" alt=""><img width="48" height="48" src="/imgs/ArticleTopImgs/V2TopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-02-04</span><a class="blog-slider__title" href="2025/02/04/V2/" alt="">浅谈鸿蒙状态管理V1——&gt;V2</a><div class="blog-slider__text">用实际代码测试与我的开发经验，解析鸿蒙状态管理V2中难以理解的内容，帮助开发者们更好的理解和使用状态管理V2版本。</div><a class="blog-slider__button" href="2025/02/04/V2/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/04/20/RemoteCommunication/" alt=""><img width="48" height="48" src="/imgs/ArticleTopImgs/RCPTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-20</span><a class="blog-slider__title" href="2025/04/20/RemoteCommunication/" alt="">远场通信服务</a><div class="blog-slider__text">本文将介绍鸿蒙远场通信服务</div><a class="blog-slider__button" href="2025/04/20/RemoteCommunication/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>