<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>鸿蒙网络请求学习笔记 | XBXyftx</title><meta name="author" content="XBXyftx"><meta name="copyright" content="XBXyftx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="学习鸿蒙网络请求">
<meta property="og:type" content="article">
<meta property="og:title" content="鸿蒙网络请求学习笔记">
<meta property="og:url" content="https://xbxyftx.top/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="XBXyftx">
<meta property="og:description" content="学习鸿蒙网络请求">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xbxyftx.top/img/ArticleTopImgs/HttpTopImg.png">
<meta property="article:published_time" content="2025-01-27T09:26:07.000Z">
<meta property="article:modified_time" content="2025-05-01T17:12:32.554Z">
<meta property="article:author" content="XBXyftx">
<meta property="article:tag" content="鸿蒙">
<meta property="article:tag" content="技术向">
<meta property="article:tag" content="网络请求">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xbxyftx.top/img/ArticleTopImgs/HttpTopImg.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "鸿蒙网络请求学习笔记",
  "url": "https://xbxyftx.top/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
  "image": "https://xbxyftx.top/img/ArticleTopImgs/HttpTopImg.png",
  "datePublished": "2025-01-27T09:26:07.000Z",
  "dateModified": "2025-05-01T17:12:32.554Z",
  "author": [
    {
      "@type": "Person",
      "name": "XBXyftx",
      "url": "https://github.com/XBXyftx"
    }
  ]
}</script><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://xbxyftx.top/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":2000,"languages":{"author":"作者: XBXyftx","link":"链接: ","source":"来源: XBXyftx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '鸿蒙网络请求学习笔记',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><script src="/js/nyan.js"></script><script>localStorage.setItem('theme','dark')</script><script>document.documentElement.setAttribute('data-theme', 'dark');</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/transpancy.css"><script> // 强制锁定为暗黑模式 localStorage.setItem('theme', 'dark'); // 防止其他脚本覆盖模式 document.documentElement.setAttribute('data-theme', 'dark'); </script><link rel="stylesheet" href="/css/styles.css"><script> document.querySelectorAll('#post-comment').forEach(el => { el.style.backgroundColor = 'rgba(255, 255, 255, 0.6)'; }); </script><link rel="twikoo" href="/css/twikoo.css"><link rel="stylesheet" href="/css/rightmenu.css"><script src="/js/cache-manager.js"></script><script src="/js/nyan.js"></script><script src="/js/header-universe.js"></script><!-- 新增缓存管理脚本--><script src="/js/cache-manager.js"></script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="cat__scene"><div class="cat__main"><div class="cat__body"></div><div class="cat__body"></div><div class="cat__tail"></div><div class="cat__head"></div></div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
      setTimeout(() => {
        $loadingBox.style.display = 'none'
      }, 800)
    },
    initLoading: () => {
      $loadingBox.style.display = 'flex'
      $loadingBox.classList.remove('loaded')
      $body.style.overflow = 'hidden'
    }
  }

  preloader.initLoading()
  
  // 设置10秒超时
  const loadingTimeout = setTimeout(() => {
    preloader.endLoading()
  }, 10000)
  
  window.addEventListener('load', () => {
    clearTimeout(loadingTimeout)
    preloader.endLoading()
  })

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/bg.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-solid fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/swiper/"><i class="fa-fw fa-solid fa-star-of-david"></i><span> 图图图图图</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/ArticleTopImgs/HttpTopImg.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.png" alt="Logo"><span class="site-name">XBXyftx</span></a><a class="nav-page-title" href="/"><span class="site-name">鸿蒙网络请求学习笔记</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-solid fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/swiper/"><i class="fa-fw fa-solid fa-star-of-david"></i><span> 图图图图图</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">鸿蒙网络请求学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-01-27T09:26:07.000Z" title="发表于 2025-01-27 17:26:07">2025-01-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-01T17:12:32.554Z" title="更新于 2025-05-02 01:12:32">2025-05-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">12.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>48分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><p>在网络上提供服务器的一台电脑，比如提供数据服务</p>
<h3 id="http模块"><a href="#http模块" class="headerlink" title="http模块"></a>http模块</h3><p>鸿蒙内置的模块，专门用于处理http网络请求，用http协议与服务器进行交流</p>
<p>可以用 <code>import http from &#39;@ohos.net.http&#39;</code>来进行调用。</p>
<p>由于需要进行网络请求，所以我们还需要在配置文件 <code>module.json5</code>下添加如下代码</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;requestPermissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ohos.permission.INTERNET&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>完整代码如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;entry&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;entry&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$string:module_desc&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mainElement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;EntryAbility&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deviceTypes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;phone&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;tablet&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;2in1&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deliveryWithInstall&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;installationFree&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$profile:main_pages&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;requestPermissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ohos.permission.INTERNET&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;abilities&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;EntryAbility&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;srcEntry&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./ets/entryability/EntryAbility.ets&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$string:EntryAbility_desc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$media:layered_image&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$string:EntryAbility_label&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;startWindowIcon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$media:startIcon&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;startWindowBackground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$color:start_window_background&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;exported&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;skills&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;entities&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="string">&quot;entity.system.home&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="string">&quot;action.system.home&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h3><p>协议基本可以理解为格式，类似于写信写邮件的格式规范，规定了客户端与服务器通信时的格式。</p>
<p>三者关系大致如下图所示。</p>
<p><img src="https://raw.githubusercontent.com/XBXyftx/hexoimgs/main/20250127181340.png" alt="2"></p>
<h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3><p>URL（Uniform Resource Locator）统一资源定位符，相当于信封上目的地的地址，每一个有效的URL都指向着唯一的一个资源。</p>
<p>就比如我现在这篇博客的地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://xbxyftx.github.io/2025/01/27/%E9%B8%BF%E8%92%99http/</span><br></pre></td></tr></table></figure>
<p><code>https</code>是协议 <code>xbxyftx.github.io</code>是域名 <code>2025/01/27/%E9%B8%BF%E8%92%99http/</code>是资源地址。</p>
<p>域名指的是你要访问哪一台服务器，而一个服务器中会有很多的资源存放在不同的位置，所以需要在域名后加上资源地址来指向对应资源。<br>在URL的末尾我们可以再后缀上二外参数，比如<code>?name=XBXyftx&amp;age=22</code>，这样就可以在URL的末尾添加参数。<br>参数的格式为<code>key=value</code>，多个参数之间用<code>&amp;</code>连接。</p>
<h4 id="URL参数案例"><a href="#URL参数案例" class="headerlink" title="URL参数案例"></a>URL参数案例</h4><p>接口文档：<a target="_blank" rel="noopener" href="https://apifox.com/apidoc/shared-e3812a75-2d81-4388-abf4-af83a2758a9a/api-153085966">开心一笑接口文档</a></p>
<h5 id="项目基础结构"><a href="#项目基础结构" class="headerlink" title="项目基础结构"></a>项目基础结构</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;@ohos.net.http&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = http.<span class="title function_">createHttp</span>()</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Day01</span>_03_QueryParams &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">pname</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">jokeNum</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">jokes</span>: <span class="built_in">string</span>[] = []</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">cities</span>: <span class="built_in">string</span>[] = []</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;开心一笑&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">        <span class="title class_">TextInput</span>(&#123; <span class="attr">placeholder</span>: <span class="string">&#x27;输入笑话条数&#x27;</span>, <span class="attr">text</span>: $$this.<span class="property">jokeNum</span> &#125;)</span><br><span class="line">          .<span class="title function_">type</span>(<span class="title class_">InputType</span>.<span class="property">Number</span>)</span><br><span class="line">          .<span class="title function_">onSubmit</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// url：https://api-vue-base.itheima.net/api/joke/list</span></span><br><span class="line">            <span class="comment">// 参数: num 笑话数量</span></span><br><span class="line">            <span class="title class_">AlertDialog</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">              <span class="attr">message</span>: <span class="string">&#x27;输入的数值是:&#x27;</span> + <span class="variable language_">this</span>.<span class="property">jokeNum</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">jokes</span>, <span class="function">(<span class="params"><span class="attr">joke</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Text</span>(joke)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Divider</span>()</span><br><span class="line">        .<span class="title function_">color</span>(<span class="title class_">Color</span>.<span class="property">Pink</span>)</span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">3</span>)</span><br><span class="line">      <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;省份城市查询&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">        <span class="title class_">TextInput</span>(&#123; <span class="attr">placeholder</span>: <span class="string">&#x27;请输入查询的省份名&#x27;</span>, <span class="attr">text</span>: $$this.<span class="property">pname</span> &#125;)<span class="comment">// 键盘事件</span></span><br><span class="line">          .<span class="title function_">onSubmit</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// url：https://hmajax.itheima.net/api/city</span></span><br><span class="line">            <span class="comment">// 参数: pname 省份名</span></span><br><span class="line">            <span class="title class_">AlertDialog</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">              <span class="attr">message</span>: <span class="string">&#x27;输入的省份名是:&#x27;</span> + <span class="variable language_">this</span>.<span class="property">pname</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="title class_">Grid</span>() &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">cities</span>, <span class="function">(<span class="params"><span class="attr">city</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">GridItem</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(city)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">border</span>(&#123; <span class="attr">width</span>: <span class="number">1</span> &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">columnsTemplate</span>(<span class="string">&#x27;1fr &#x27;</span>.<span class="title function_">repeat</span>(<span class="number">4</span>))</span><br><span class="line">        .<span class="title function_">columnsGap</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_">rowsGap</span>(<span class="number">10</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上半部分是输入笑话条数，下半部分是输入省份名，点击查询后会返回对应的城市。而根据这两个URL的文档可知</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">地址: https://api-vue-base.itheima.net/api/joke/list</span><br><span class="line">根据查询参数获取若干条随机笑话</span><br><span class="line">参数名: num</span><br><span class="line">说明: 传递数量即可，比如 5</span><br><span class="line"></span><br><span class="line">地址:http://hmajax.itheima.net/api/city</span><br><span class="line">说明获取某个省所有的城市查询</span><br><span class="line">参数名:pname</span><br><span class="line">说明: 传递省份或直辖市名，比如 北京、广东省…</span><br></pre></td></tr></table></figure>
<h5 id="笑话查询"><a href="#笑话查询" class="headerlink" title="笑话查询"></a>笑话查询</h5><p>由于我们并不清楚其返回值是什么所以我们先将获取的结果打印出来，并根据打印出json字符串来定义接口。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">req.<span class="title function_">request</span>(<span class="string">`https://api-vue-base.itheima.net/api/joke/list?num=<span class="subst">$&#123;<span class="variable language_">this</span>.jokeNum&#125;</span>`</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title class_">AlertDialog</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>:res.<span class="property">result</span>.<span class="title function_">toString</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>打印出的结果如下<br><img src="https://raw.githubusercontent.com/XBXyftx/hexoImgs3/main/20250131000223.png" alt="1"></p>
<p>由此可知，我们可以定义一个接口来接收返回值。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">JokeResponse</span> &#123;</span><br><span class="line">  <span class="attr">msg</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">code</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">data</span>: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们就可以将请求到的结果转化为接口类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">req.<span class="title function_">request</span>(<span class="string">`https://api-vue-base.itheima.net/api/joke/list?num=<span class="subst">$&#123;<span class="variable language_">this</span>.jokeNum&#125;</span>`</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">jokes</span> = (<span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">JokeResponse</span>).<span class="property">data</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h5 id="省份城市查询"><a href="#省份城市查询" class="headerlink" title="省份城市查询"></a>省份城市查询</h5><p>同样的，我们先将获取的结果打印出来，并根据打印出json字符串来定义接口。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">CityResponse</span> &#123;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">list</span>: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们就可以将请求到的结果转化为接口类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">req.<span class="title function_">request</span>(<span class="string">`http://hmajax.itheima.net/api/city?pname=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(<span class="variable language_">this</span>.pname)&#125;</span>`</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> cityRes = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">CityResponse</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cities</span> = cityRes.<span class="property">list</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>由于用到了中文参数，所以需要进行编码，在TS中可以使用<code>encodeURIComponent()</code>方法来进行编码。</p>
<h5 id="完整代码和最终效果"><a href="#完整代码和最终效果" class="headerlink" title="完整代码和最终效果"></a>完整代码和最终效果</h5><p><img src="https://raw.githubusercontent.com/XBXyftx/hexoImgs3/main/Screenshot_2025-01-31T001706.png" alt="1"></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;@ohos.net.http&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">JokeResponse</span> &#123;</span><br><span class="line">  <span class="attr">msg</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">code</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">data</span>: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">CityResponse</span> &#123;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">list</span>: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = http.<span class="title function_">createHttp</span>()</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Day01</span>_03_QueryParams &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">pname</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">jokeNum</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">jokes</span>: <span class="built_in">string</span>[] = []</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">cities</span>: <span class="built_in">string</span>[] = []</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;开心一笑&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">        <span class="title class_">TextInput</span>(&#123; <span class="attr">placeholder</span>: <span class="string">&#x27;输入笑话条数&#x27;</span>, <span class="attr">text</span>: $$this.<span class="property">jokeNum</span> &#125;)</span><br><span class="line">          .<span class="title function_">type</span>(<span class="title class_">InputType</span>.<span class="property">Number</span>)</span><br><span class="line">          .<span class="title function_">onSubmit</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// url：https://api-vue-base.itheima.net/api/joke/list</span></span><br><span class="line">            <span class="comment">// 参数: num 笑话数量</span></span><br><span class="line">            req.<span class="title function_">request</span>(<span class="string">`https://api-vue-base.itheima.net/api/joke/list?num=<span class="subst">$&#123;<span class="variable language_">this</span>.jokeNum&#125;</span>`</span>)</span><br><span class="line">              .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">jokes</span> = (<span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">JokeResponse</span>).<span class="property">data</span></span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">jokes</span>, <span class="function">(<span class="params"><span class="attr">joke</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Text</span>(joke)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Divider</span>()</span><br><span class="line">        .<span class="title function_">color</span>(<span class="title class_">Color</span>.<span class="property">Pink</span>)</span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">3</span>)</span><br><span class="line">      <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;省份城市查询&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">        <span class="title class_">TextInput</span>(&#123; <span class="attr">placeholder</span>: <span class="string">&#x27;请输入查询的省份名&#x27;</span>, <span class="attr">text</span>: $$this.<span class="property">pname</span> &#125;)<span class="comment">// 键盘事件</span></span><br><span class="line">          .<span class="title function_">onSubmit</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// url：https://hmajax.itheima.net/api/city</span></span><br><span class="line">            <span class="comment">// 参数: pname 省份名</span></span><br><span class="line">            req.<span class="title function_">request</span>(<span class="string">`http://hmajax.itheima.net/api/city?pname=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(<span class="variable language_">this</span>.pname)&#125;</span>`</span>)</span><br><span class="line">              .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> cityRes = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">CityResponse</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">cities</span> = cityRes.<span class="property">list</span></span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="title class_">Grid</span>() &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">cities</span>, <span class="function">(<span class="params"><span class="attr">city</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">GridItem</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(city)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">border</span>(&#123; <span class="attr">width</span>: <span class="number">1</span> &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">columnsTemplate</span>(<span class="string">&#x27;1fr &#x27;</span>.<span class="title function_">repeat</span>(<span class="number">4</span>))</span><br><span class="line">        .<span class="title function_">columnsGap</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_">rowsGap</span>(<span class="number">10</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="升级V2"><a href="#升级V2" class="headerlink" title="升级V2"></a>升级V2</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;@ohos.net.http&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">JokeResponse</span> &#123;</span><br><span class="line">  <span class="attr">msg</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">code</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">data</span>: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">CityResponse</span> &#123;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">list</span>: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = http.<span class="title function_">createHttp</span>()</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Day01</span>_03_QueryParams &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">pname</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">jokeNum</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">jokes</span>: <span class="built_in">string</span>[] = []</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">cities</span>: <span class="built_in">string</span>[] = []</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;开心一笑&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">        <span class="title class_">TextInput</span>(&#123; <span class="attr">placeholder</span>: <span class="string">&#x27;输入笑话条数&#x27;</span>, <span class="attr">text</span>: $$this.<span class="property">jokeNum</span> &#125;)</span><br><span class="line">          .<span class="title function_">type</span>(<span class="title class_">InputType</span>.<span class="property">Number</span>)</span><br><span class="line">          .<span class="title function_">onSubmit</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// url：https://api-vue-base.itheima.net/api/joke/list</span></span><br><span class="line">            <span class="comment">// 参数: num 笑话数量</span></span><br><span class="line">            req.<span class="title function_">request</span>(<span class="string">`https://api-vue-base.itheima.net/api/joke/list?num=<span class="subst">$&#123;<span class="variable language_">this</span>.jokeNum&#125;</span>`</span>)</span><br><span class="line">              .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">jokes</span> = (<span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">JokeResponse</span>).<span class="property">data</span></span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">jokes</span>, <span class="function">(<span class="params"><span class="attr">joke</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Text</span>(joke)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Divider</span>()</span><br><span class="line">        .<span class="title function_">color</span>(<span class="title class_">Color</span>.<span class="property">Pink</span>)</span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">3</span>)</span><br><span class="line">      <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;省份城市查询&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">        <span class="title class_">TextInput</span>(&#123; <span class="attr">placeholder</span>: <span class="string">&#x27;请输入查询的省份名&#x27;</span>, <span class="attr">text</span>: $$this.<span class="property">pname</span> &#125;)<span class="comment">// 键盘事件</span></span><br><span class="line">          .<span class="title function_">onSubmit</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// url：https://hmajax.itheima.net/api/city</span></span><br><span class="line">            <span class="comment">// 参数: pname 省份名</span></span><br><span class="line">            req.<span class="title function_">request</span>(<span class="string">`http://hmajax.itheima.net/api/city?pname=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(<span class="variable language_">this</span>.pname)&#125;</span>`</span>)</span><br><span class="line">              .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> cityRes = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">CityResponse</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">cities</span> = cityRes.<span class="property">list</span></span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="title class_">Grid</span>() &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">cities</span>, <span class="function">(<span class="params"><span class="attr">city</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">GridItem</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(city)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">border</span>(&#123; <span class="attr">width</span>: <span class="number">1</span> &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">columnsTemplate</span>(<span class="string">&#x27;1fr &#x27;</span>.<span class="title function_">repeat</span>(<span class="number">4</span>))</span><br><span class="line">        .<span class="title function_">columnsGap</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_">rowsGap</span>(<span class="number">10</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="中文参数"><a href="#中文参数" class="headerlink" title="中文参数"></a>中文参数</h4><p>由于URL中不能包含中文，所以需要进行编码，在TS中可以使用<code>encodeURIComponent()</code>方法来进行编码。</p>
<h3 id="HTTP请求"><a href="#HTTP请求" class="headerlink" title="HTTP请求"></a>HTTP请求</h3><p>HTTP请求是客户端向服务器发送请求的一种方式，常见的请求方式有GET和POST。<br>GET请求是客户端向服务器发送请求，请求服务器返回对应资源。<br>POST请求是客户端向服务器发送请求，请求服务器接收数据。</p>
<h4 id="HTTP请求报文"><a href="#HTTP请求报文" class="headerlink" title="HTTP请求报文"></a>HTTP请求报文</h4><p>HTTP请求报文是客户端向服务器发送请求时，发送的请求信息。<br>请求报文的格式大致为以下几点：</p>
<ol>
<li><strong>请求行</strong>：请求方法、请求URL、HTTP版本</li>
<li><strong>请求头</strong>：请求头信息</li>
<li><strong>空行</strong>：分割请求头和请求体</li>
<li><strong>请求体</strong>：请求体信息</li>
</ol>
<p>而想看到请求报文我们可以利用浏览器的开发者工具来查看。<br>所以这里简单编写一段前端代码来模拟请求报文。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.net/axios/1.6.5/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btn1&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        btn.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> input1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input1&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> input2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input2&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> username = input1.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> password = input2.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">axios</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">method</span>:<span class="string">&#x27;post&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">url</span>:<span class="string">&#x27;http://hmajax.itheima.net/api/register&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">username</span>:username,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">password</span>:password</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(res.<span class="property">data</span>.<span class="property">message</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(err.<span class="property">response</span>.<span class="property">data</span>.<span class="property">message</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/5.png" alt="5"><br><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6.png" alt="6"><br><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/7.png" alt="7"></p>
<p>效果和下面详细讲解<code>Post</code>的TS效果一样。<br>而具体的报文内容如下：</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8.png" alt="8"></p>
<p>这张图片展示了请求行和请求头。</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.png" alt="9"></p>
<p>这张图片展示了请求体。</p>
<h3 id="HTTP响应"><a href="#HTTP响应" class="headerlink" title="HTTP响应"></a>HTTP响应</h3><p>HTTP响应是服务器向客户端返回响应的一种方式，常见的响应方式有200和404。<br>200表示请求成功，404表示请求失败。</p>
<h4 id="HTTP响应状态码"><a href="#HTTP响应状态码" class="headerlink" title="HTTP响应状态码"></a>HTTP响应状态码</h4><p>主要的响应码有以下几种：</p>
<ul>
<li><strong>1xx</strong>：表示请求已被接收，需要继续处理</li>
<li><strong>2xx</strong>：表示请求已成功被服务器接收、理解、并接受</li>
<li><strong>3xx</strong>：表示需要进一步的操作才能完成请求</li>
<li><strong>4xx</strong>：表示请求含有语法错误或无法完成请求</li>
<li><strong>5xx</strong>：表示服务器在处理请求的过程中发生了错误<br><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/12.png" alt="12"></li>
</ul>
<p>日常开发中，不同接口表示错误的方式不同：</p>
<ol>
<li>有的通过状态码来标识</li>
<li>有的通过响应体中的信息来标识</li>
</ol>
<p>根据实际情况来选择使用哪种来判断</p>
<h4 id="HTTP响应报文"><a href="#HTTP响应报文" class="headerlink" title="HTTP响应报文"></a>HTTP响应报文</h4><p>HTTP响应报文是服务器向客户端返回响应时，返回的响应信息。<br>响应报文的格式大致为以下几点：</p>
<ol>
<li><strong>状态行</strong>：HTTP版本、状态码、状态码描述</li>
<li><strong>响应头</strong>：响应头信息</li>
<li><strong>空行</strong>：分割响应头和响应体</li>
<li><strong>响应体</strong>：响应体信息</li>
</ol>
<p>而想看到响应报文我们可以利用浏览器的开发者工具来查看。</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.png" alt="10"><br><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/11.png" alt="11"></p>
<p>这两张图片分别展示了响应行和响应头以及响应体。<br>在响应中最重要的是响应体，因为这是服务器返回给客户端的信息。</p>
<h3 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h3><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/JSON">JSON</a> 是一种按照 JavaScript 对象语法的数据格式，虽然它是基于 JavaScript 语法，但它独立于 JavaScript，许多程序环境能够读取（解读）和生成 JSON。</p>
<p>目前json主要分为两种，json和json5。json5的诞生主要是为了解决json不支持添加注释的问题，两者功能类似。在鸿蒙的stage模型的工程文件中包含了大量的json5文件，是鸿蒙原生应用的重要组成部分。</p>
<p>其语法规则大致为以下几点：</p>
<ol>
<li><strong>是一个字符串（配置文件中两边可以不写引号）</strong></li>
<li><strong>属性名用双引号包裹，</strong></li>
<li><strong>属性值如果是字符串也必须用双引号包裹</strong></li>
<li><strong>对象</strong> <strong>{}</strong>,<strong>数组</strong> <strong>[]</strong></li>
</ol>
<p>就像是以下格式就是一个标准的json字符串</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;name&quot;</span>:<span class="string">&quot;XBXyftx&quot;</span>,</span><br><span class="line"> <span class="string">&quot;age&quot;</span>:<span class="number">22</span>,</span><br><span class="line"> <span class="string">&quot;fruits&quot;</span>:[<span class="string">&quot;apple&quot;</span>,<span class="string">&quot;pear&quot;</span>,<span class="string">&quot;grape&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然json经常被拿来和xml进行比较，就比如上面的json字符串，转化为xml就是这样：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>XBXyftx<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">age</span>&gt;</span>22<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">fruits</span>&gt;</span>apple<span class="tag">&lt;/<span class="name">fruits</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">fruits</span>&gt;</span>pear<span class="tag">&lt;/<span class="name">fruits</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">fruits</span>&gt;</span>grape<span class="tag">&lt;/<span class="name">fruits</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>而json相对于xml的主要优势在于：</p>
<ul>
<li>没有结束标签,长度更短,读写更快</li>
<li>能够直接被JavaScript解释器解析</li>
<li>可以使用数组</li>
</ul>
<h4 id="json与对象的互相转化"><a href="#json与对象的互相转化" class="headerlink" title="json与对象的互相转化"></a>json与对象的互相转化</h4><p>在鸿蒙中，我们可以使用<code>JSON.parse()</code>方法来解析json字符串。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IPeople</span>&#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>:<span class="built_in">number</span></span><br><span class="line">  <span class="attr">fruits</span>:<span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">json</span>:<span class="title class_">IPeople</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;name&quot;:&quot;XBXyftx&quot;,&quot;age&quot;:22,&quot;fruits&quot;:[&quot;apple&quot;,&quot;pear&quot;,&quot;grape&quot;]&#125;&#x27;</span>) <span class="keyword">as</span> <span class="title class_">IPeople</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(json.<span class="property">name</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(json.<span class="property">age</span>.<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(json.<span class="property">fruits</span>.<span class="title function_">join</span>())</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">XBXyftx</span></span><br><span class="line"><span class="number">22</span></span><br><span class="line">apple,pear,grape</span><br></pre></td></tr></table></figure>
<p>而当我们需要将对象转化成json字符串时，可以使用<code>JSON.stringify()</code>方法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">json2</span>:<span class="title class_">IPeople</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>:<span class="number">18</span>,</span><br><span class="line">  <span class="attr">fruits</span>:[<span class="string">&#x27;苹果&#x27;</span>,<span class="string">&#x27;香蕉&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(json2))</span><br></pre></td></tr></table></figure>
<p>输出结果如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;A&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">18</span>,<span class="string">&quot;fruits&quot;</span>:[<span class="string">&quot;苹果&quot;</span>,<span class="string">&quot;香蕉&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>
<h4 id="json和字符串数组的互相转化"><a href="#json和字符串数组的互相转化" class="headerlink" title="json和字符串数组的互相转化"></a>json和字符串数组的互相转化</h4><p>也可以用来解析字符串数组</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonArr = <span class="string">&#x27;[&quot;hello&quot;,&quot;西兰花&quot;]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">obj</span>:<span class="built_in">string</span>[] = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(jsonArr) <span class="keyword">as</span> <span class="built_in">string</span>[]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="title function_">join</span>())</span><br></pre></td></tr></table></figure>
<p>输出结果如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello,西兰花</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong><code>JSON.parse(jsonArr) as string[]</code>中最后的<code>as string[]</code>是用来指定返回值的类型的，因为<code>JSON.parse()</code>方法的返回值是<code>any</code>类型，所以我们需要手动指定返回值的类型。<br>如果将<code>as string[]</code>改为<code>as []</code>，则会对类型推断造成干扰。所以最好写全。</p>
<h2 id="http模块的使用"><a href="#http模块的使用" class="headerlink" title="http模块的使用"></a>http模块的使用</h2><h3 id="默认请求（Get）"><a href="#默认请求（Get）" class="headerlink" title="默认请求（Get）"></a>默认请求（Get）</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入http模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; http &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.NetworkKit&#x27;</span>;</span><br><span class="line"><span class="comment">//创建http请求模块</span></span><br><span class="line"><span class="keyword">const</span> req = http.<span class="title function_">createHttp</span>()</span><br><span class="line"><span class="comment">//发送请求到指定URL</span></span><br><span class="line">req.<span class="title function_">request</span>(<span class="string">&#x27;https://api-vue-base.itheima.net/api/joke&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">res</span>:http.<span class="title class_">HttpResponse</span></span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title class_">AlertDialog</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>:<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>then事件用于处理http请求接收到的响应数据，当成功获取到响应后就会进入到then代码块中。</p>
<p>获取到的数据如下图所示。</p>
<p><img src="https://raw.githubusercontent.com/XBXyftx/hexoimgs/main/20250127223839.png" alt></p>
<p>分析获取到的数据可知我们所需要的笑话的键值为 <code>&quot;result&quot;</code>，由此我们就可以使用<code>res.result.toString()</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;@ohos.net.http&#x27;</span>;</span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Notebook</span>_use &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;看笑话&#x27;</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> req = http.<span class="title function_">createHttp</span>()</span><br><span class="line">            req.<span class="title function_">request</span>(<span class="string">&#x27;https://api-vue-base.itheima.net/api/joke&#x27;</span>)</span><br><span class="line">              .<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">res</span>: http.<span class="title class_">HttpResponse</span></span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// AlertDialog.show(&#123; message: JSON.stringify(res) &#125;)</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">message</span> = res.<span class="property">result</span>.<span class="title function_">toString</span>()</span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们就可以根据返回的json数据来进行UI显示了。<br>这就是一个简单的http网络请求，和在本地写好数据集来进行UI显示的效果是一样的，整体思路是不变的。</p>
<h3 id="提交数据请求（Post）"><a href="#提交数据请求（Post）" class="headerlink" title="提交数据请求（Post）"></a>提交数据请求（Post）</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> req = http.<span class="title function_">createHttp</span>()</span><br><span class="line">req.<span class="title function_">request</span>(<span class="string">&#x27;请求地址&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">method</span>: http.<span class="property">RequestMethod</span>.<span class="property">POST</span>, <span class="comment">// 通过枚举的方式设置请求方法，如果是 get 可以省略</span></span><br><span class="line">  <span class="attr">extraData</span>: &#123;&#125; <span class="comment">// 数据写在 extraData 中 支持 对象 字符串 ArrayBuffer（二进制数据）</span></span><br><span class="line">  <span class="attr">extraData</span>:<span class="string">&#x27;key=value&amp;key2=value2&#x27;</span><span class="comment">// 字符串的话 写成 &#x27;key=value&amp;key2=value2&#x27;....</span></span><br><span class="line">  <span class="comment">// 对象的话需要额外设置其他参数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这是其基础格式，下面我们来进行一个简单的注册请求。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;@ohos.net.http&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = http.<span class="title function_">createHttp</span>()</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Day01</span>_05_SubmitData &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">username</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">password</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">15</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;请求方法和数据提交&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">      <span class="title class_">TextInput</span>(&#123; <span class="attr">text</span>: $$this.<span class="property">username</span>, <span class="attr">placeholder</span>: <span class="string">&#x27;用户名&#x27;</span> &#125;)</span><br><span class="line">      <span class="title class_">TextInput</span>(&#123; <span class="attr">text</span>: $$this.<span class="property">password</span>, <span class="attr">placeholder</span>: <span class="string">&#x27;密码&#x27;</span> &#125;)</span><br><span class="line">        .<span class="title function_">type</span>(<span class="title class_">InputType</span>.<span class="property">Password</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;提交数据&#x27;</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">AlertDialog</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">`用户名:<span class="subst">$&#123;<span class="variable language_">this</span>.username&#125;</span>| 密码:<span class="subst">$&#123;<span class="variable language_">this</span>.password&#125;</span>`</span></span><br><span class="line">          &#125;)</span><br><span class="line">          req.<span class="title function_">request</span>(<span class="string">&#x27;http://hmajax.itheima.net/api/register&#x27;</span>,&#123;</span><br><span class="line">            <span class="attr">method</span>:http.<span class="property">RequestMethod</span>.<span class="property">POST</span>,</span><br><span class="line">            <span class="attr">extraData</span>: <span class="string">`username=<span class="subst">$&#123;<span class="variable language_">this</span>.username&#125;</span>&amp;password=<span class="subst">$&#123;<span class="variable language_">this</span>.password&#125;</span>`</span></span><br><span class="line">          &#125;)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">              <span class="title class_">AlertDialog</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">                <span class="attr">message</span>:res.<span class="property">result</span>.<span class="title function_">toString</span>()</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">20</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.png" alt="3"></p>
<p>根据是否注册过后端会自动回传不同的数据。</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/4.png" alt="4"></p>
<h4 id="修改请求头"><a href="#修改请求头" class="headerlink" title="修改请求头"></a>修改请求头</h4><p>在实际应用开发中，大多数网络请求所发送的数据格式都是<code>JSON</code>格式的，所以我们需要修改请求头。来将我们的数据格式修改为<code>JSON</code>格式。</p>
<p>目标API文档：<a target="_blank" rel="noopener" href="https://apifox.com/apidoc/shared-e3812a75-2d81-4388-abf4-af83a2758a9a/api-153059638">注册账号-JSON</a></p>
<p>UI我们继续沿用上一个案例的UI。<br>我们重点需要掌握的是发送网络请求时如何修改请求头。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;提交数据&#x27;</span>)</span><br><span class="line">  .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    req.<span class="title function_">request</span>(<span class="string">&#x27;http://hmajax.itheima.net/api/register&#x27;</span>,&#123;</span><br><span class="line">      <span class="attr">method</span>:http.<span class="property">RequestMethod</span>.<span class="property">POST</span>,</span><br><span class="line">      <span class="attr">header</span>:&#123;</span><br><span class="line">        <span class="attr">contentType</span>:<span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">extraData</span>: &#123;</span><br><span class="line">        <span class="attr">username</span>:<span class="variable language_">this</span>.<span class="property">username</span>,</span><br><span class="line">        <span class="attr">password</span>:<span class="variable language_">this</span>.<span class="property">password</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="title class_">AlertDialog</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">          <span class="attr">message</span>:res.<span class="property">result</span>.<span class="title function_">toString</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h2 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h2><h3 id="什么是异步编程"><a href="#什么是异步编程" class="headerlink" title="什么是异步编程"></a>什么是异步编程</h3><p>在鸿蒙中，由于网络请求是一个耗时操作，所以我们不能直接在主线程中进行网络请求，否则会导致主线程卡死，所以我们需要使用异步编程来进行网络请求。<br>异步编程的核心思想就是将耗时操作放在子线程中执行，当子线程执行完毕后再将结果返回给主线程。<br>在鸿蒙中，我们可以使用<code>async</code>和<code>await</code>关键字来进行异步编程。<br><code>async</code>关键字用于声明一个异步函数，<code>await</code>关键字用于等待异步操作的完成。</p>
<p><strong>同步代码</strong>：逐行执行，需原地等待结果后，才继续向下执行<br><strong>异步代码</strong>：调用后耗时，不阻塞代码继续执行，将来完成后，触发回调函数传递结果<br><strong>划重点</strong>：异步代码的结果，通过 <code>回调函数</code> 获取</p>
<p>在鸿蒙系统中，异步执行机制的核心是<code>事件循环（Event Loop）</code>，它负责管理和调度任务队列中的任务。以下是详细解释：</p>
<ol>
<li>事件循环机制<br>事件循环是鸿蒙系统中异步编程的核心机制，它运行在主线程中，负责<strong>不断检查任务队列</strong>（Task Queue），并将任务按照<strong>优先级</strong>和<strong>顺序</strong>执行。<br>任务队列：任务队列是一个<strong>存储待执行任务的队列</strong>，任务可以是<strong>用户界面事件</strong>（如点击、按键）、<strong>系统事件</strong>（如定时器到期）、<strong>异步操作回调</strong>（如网络请求完成）等。<br>事件循环：事件循环会不断检查任务队列，当<strong>主线程空闲时</strong>，从任务队列中取出任务并执行。如果任务队列中有<strong>高优先级</strong>任务，事件循环会<strong>优先处理</strong>这些任务。</li>
<li><p>异步任务的挂起与恢复<br>当一个异步任务（如网络请求、文件读写）被挂起时，事件循环会继续执行其他任务，直到该异步任务可以继续执行。</p>
<ul>
<li>挂起：异步任务在执行到<strong>需要等待</strong>的操作（如 I/O 操作、定时器）时会被挂起，事件循环会将该<strong>任务的回调函数</strong>放入任务队列。</li>
<li>恢复：当<strong>异步操作完成</strong>（如网络请求返回结果），事件循环会将该任务的<strong>回调函数</strong>从任务队列中<strong>取出</strong>，并在<strong>主线程</strong>中执行。</li>
</ul>
</li>
<li><p>任务优先级与调度<br>事件循环会根据任务的优先级和调度算法，从任务队列中取出任务进行执行。高优先级任务会优先执行，确保关键任务能够及时处理。</p>
<ul>
<li>优先级队列：任务队列可以分为多个优先级队列，高优先级任务会优先被调度执行。</li>
<li>调度算法：事件循环会根据调度算法（如优先级、防饥饿机制）从任务队列中取出任务，确保任务的<strong>公平性和高效性</strong>。</li>
</ul>
</li>
<li>异步执行的优势<br>提高<strong>并发处理能力</strong>：事件循环机制允许在<strong>同一时间段内处理多个任务</strong>，<strong>避免</strong>了单个任务<strong>阻塞主线程</strong>，提高了系统的并发处理能力。<br>避免阻塞主线程：通过将耗时任务（如网络请求、文件读写）交给异步机制处理，主线程可以继续响应用户操作和更新 UI，<strong>避免应用卡顿</strong>。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 1. 同步代码</span></span><br><span class="line"><span class="comment">  * */</span></span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line"> <span class="keyword">const</span> num = <span class="number">1</span> + <span class="number">1</span></span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(num)    <span class="comment">// 12</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 2. 同步+异步（定时器）</span></span><br><span class="line"><span class="comment">  * */</span></span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>+<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>+<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"> &#125;, <span class="number">1000</span>)</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>+<span class="string">&#x27;&#x27;</span>)   <span class="comment">// 132</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 3. 同步+异步（网络请求）</span></span><br><span class="line"><span class="comment">  * */</span></span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> req = http.<span class="title function_">createHttp</span>()</span><br><span class="line"> req.<span class="title function_">request</span>(<span class="string">&#x27;https://api-vue-base.itheima.net/api/joke&#x27;</span>)</span><br><span class="line">   .<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">res</span>: http.<span class="title class_">HttpResponse</span></span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>)    <span class="comment">// 123</span></span><br></pre></td></tr></table></figure>
<p>这就是一个同步异步代码的简单示例，我们可以看到同步代码是逐行执行的，而异步代码则是在主线程中执行完毕后再将结果返回给主线程。</p>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>Promise是一种用于处理异步操作的对象，可以将异步操作转换为类似于同步操作的风格，以方便代码编写和维护<br><strong>简而言之</strong>：Promise 用来管理异步，方便编码。</p>
<p>实际开发中如果异步操作用到了 Promise 来进行管理那么：</p>
<ol>
<li>那么获取异步操作结果（成功 or 失败）的方式都是一样的</li>
<li>能够解决回调函数地狱（多层回调函数嵌套）的问题</li>
</ol>
<p>回调函数地域主要是在多次网络请求时有相互依赖关系，像是省、市、地区，需要在省的回调函数中发送获取市的网络请求，在市的回调函数中发送获取地区的网络请求，这样就会出现回调函数地狱的问题。<strong>非常难以维护！！！</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt;(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行任意代码，主要是异步</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 比如：获取随机数</span></span><br><span class="line">      <span class="keyword">const</span> randomNum = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">100</span>)</span><br><span class="line">      <span class="title function_">resolve</span>(randomNum.<span class="title function_">toString</span>())</span><br><span class="line">      <span class="title function_">reject</span>(randomNum.<span class="title function_">toString</span>())</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  p.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res:&#x27;</span>, res)</span><br><span class="line">  &#125;,<span class="function">(<span class="params"><span class="attr">err</span>:<span class="built_in">string</span></span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;err:&#x27;</span>,err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>这段代码中包含了一个Promise对象，Promise对象的构造函数中包含了一个回调函数，这个回调函数中包含了两个参数，<code>resolve</code>和<code>reject</code>，<code>resolve</code>用于将异步操作的结果返回给主线程，<code>reject</code>用于将异步操作的错误返回给主线程。<br>异步函数的状态有三种：</p>
<ul>
<li><code>pending</code>：初始状态，不是成功或失败状态</li>
<li><code>fulfilled</code>：意味着操作成功完成</li>
<li><code>rejected</code>：意味着操作失败</li>
</ul>
<p>当异步操作成功时，会调用<code>resolve</code>函数，将异步操作的结果返回给主线程，当异步操作失败时，会调用<code>reject</code>函数，将异步操作的错误返回给主线程。</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/14.png" alt="14"></p>
<p><strong>划重点</strong>：异步函数状态不可逆，只能由<code>pending</code>变为<code>fulfilled</code>或<code>rejected</code>，随后会<strong>凝固状态</strong>。<br>成功和失败之间不可互转。<br>上面这段代码的最终输出结果为<code>res: 40</code>40是一个随机数，而res则说明进入的是res成功的代码块中。<br>如果将<code>resolve(randomNum.toString())</code>注释掉改为以下样式</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt;(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行任意代码，主要是异步</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 比如：获取随机数</span></span><br><span class="line">    <span class="keyword">const</span> randomNum = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">100</span>)</span><br><span class="line">    <span class="comment">// resolve(randomNum.toString())</span></span><br><span class="line">    <span class="title function_">reject</span>(randomNum.<span class="title function_">toString</span>())</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">p.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res:&#x27;</span>, res)</span><br><span class="line">&#125;,<span class="function">(<span class="params"><span class="attr">err</span>:<span class="built_in">string</span></span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;err:&#x27;</span>,err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>则最终输出结果为<code>err: 40</code>，说明进入的是err失败的代码块中，这就是Promise的基本用法。</p>
<h4 id="Promise的链式调用"><a href="#Promise的链式调用" class="headerlink" title="Promise的链式调用"></a>Promise的链式调用</h4><p>当一个函数的返回值是一个<code>Promise</code>对象时，我们可以使用链式调用的方式来处理这个<code>Promise</code>对象。</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/15.png" alt="15"></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">randomNum</span>(<span class="params"><span class="attr">delay</span>: <span class="built_in">number</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> num = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">100</span>)</span><br><span class="line">    <span class="title function_">resolve</span>(num.<span class="title function_">toString</span>())</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">randomNum</span>(<span class="number">1000</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;随机数1：&#x27;</span>, res)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">randomNum</span>(<span class="number">2000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;随机数2：&#x27;</span>, res)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">randomNum</span>(<span class="number">3000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;随机数3：&#x27;</span>, res)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">randomNum</span>(<span class="number">3000</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>输出结果为<br><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/16.png" alt="16"></p>
<h4 id="链式编程的实际应用"><a href="#链式编程的实际应用" class="headerlink" title="链式编程的实际应用"></a>链式编程的实际应用</h4><p>直接一次性写好每次<code>Promise</code>的逻辑很显然不现实，在实际用用中，我们每一步的异步逻辑大概率都是不一样的，发送请求的URL，参数类型等都不尽相同。所有我们可以再每一个<code>then</code>函数中返回下一个<code>then</code>函数所需的<code>Promise</code>对象，这样就可以实现链式编程。</p>
<h4 id="Promise的静态方法"><a href="#Promise的静态方法" class="headerlink" title="Promise的静态方法"></a>Promise的静态方法</h4><p>日常开发中除了使用 Promise 对象以外，还可以通过 Promise 提供的静态方法来管理多个异步操作。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>() <span class="comment">// 多个Promise，全部成功，某一个失败</span></span><br><span class="line"><span class="title class_">Promsie</span>.<span class="title function_">race</span>() <span class="comment">// 多个 Promise，第一个成功 or 失败</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>() <span class="comment">// 成功状态的 Promise 对象</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">reject</span>()  <span class="comment">// 失败状态的 Promise 对象</span></span><br></pre></td></tr></table></figure>
<h5 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all()"></a>Promise.all()</h5><p>这个用的最多，多个 Promise，返回全部成功的结果，或者返回第一个失败的结果。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([p1, p2, <span class="string">&#x27;yes&#x27;</span>])</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res:&#x27;</span>, res)</span><br><span class="line">  &#125;, <span class="function">(<span class="params"><span class="attr">err</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;err:&#x27;</span>, err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/13.png" alt="13"></p>
<p>这里捕获了第一个失败的<code>Promise</code>对象，并返回了失败的结果。</p>
<p>如果全部成功则会返回一个数组，数组中包含了所有<code>Promise</code>对象的返回值。</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/19.png" alt="19"></p>
<h5 id="Promise-resolve"><a href="#Promise-resolve" class="headerlink" title="Promise.resolve()"></a>Promise.resolve()</h5><p>快速创建一个成功的<code>Promise</code>对象。<br>这里不做过多赘述，直接看图就行了</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/20.png" alt="20"></p>
<h5 id="Promise-reject"><a href="#Promise-reject" class="headerlink" title="Promise.reject()"></a>Promise.reject()</h5><p>快速创建一个失败的<code>Promise</code>对象。<br><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/21.png" alt="21"></p>
<h5 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race()"></a>Promise.race()</h5><p>传入 Promise 数组，返回第一个成功或者失败的结果。用于判断哪个<code>Promise</code>对象最快出结果。</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/22.png" alt="22"></p>
<p>在这段代码中，<code>Promise.race()</code>方法传入了一个包含三个<code>Promise</code>对象的数组。但第三个仅是一个字符串，并没有额外的操作。因此，<code>Promise.race()</code>方法会立即返回第一个成功的操作结果，其值为字符串<code>yes</code>。</p>
<p>而当我们将数组内全部改成<code>Promise</code>对象时，就会返回第一个成功的<code>Promise</code>对象。</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/23.png" alt="23"></p>
<p>这个结果的原因显而易见，就是<code>p2</code>的时间更短得出结果的速度更快。</p>
<h3 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h3><p><code>async/await</code>是一种用于<strong>处理异步操作</strong>的<code>Promise</code>语法糖，使得编写异步代码变得更加简单和易读。通过使用<code>async</code>关键字<strong>声明一个函数为异步函数</strong>，并使用<code>await</code>关键字等待<code>Promise</code>的解析（完成或拒绝），以同步的方式编写异步操作的代码。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;@ohos.net.http&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IResponse</span> &#123;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">list</span>: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Day03</span>_06_AreaChange &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;居住地选择&#x27;</span>;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">range</span>: <span class="built_in">string</span>[][] = [[<span class="string">&#x27;北京&#x27;</span>], [<span class="string">&#x27;北京市&#x27;</span>], [<span class="string">&#x27;东城区&#x27;</span>]]</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">selected</span>: <span class="built_in">number</span>[] = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">  <span class="comment">// values中设置的内容必须 在 range 中存在，否则会崩溃</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">values</span>: <span class="built_in">string</span>[] = [<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;北京市&#x27;</span>, <span class="string">&#x27;东城区&#x27;</span>]<span class="comment">//当前选中的值</span></span><br><span class="line">  <span class="comment">// 请求对象</span></span><br><span class="line">  <span class="attr">req</span>: http.<span class="property">HttpRequest</span> = http.<span class="title function_">createHttp</span>()</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">showSheet</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="comment">// 定时器 id</span></span><br><span class="line">  <span class="attr">timeId</span>: <span class="built_in">number</span> = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取省市区数据</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getAllData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> res1 = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">req</span>.<span class="title function_">request</span>(<span class="string">&#x27;https://hmajax.itheima.net/api/province&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> proRes = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res1.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">IResponse</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取第一个省对应的城市</span></span><br><span class="line">    <span class="keyword">const</span> res2 = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">req</span>.<span class="title function_">request</span>(<span class="string">&#x27;https://hmajax.itheima.net/api/city?pname=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(proRes.<span class="property">list</span>[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cityRes = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res2.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">IResponse</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// url?key=value&amp;key2=value2 格式不要写错啦</span></span><br><span class="line">    <span class="keyword">const</span> res3 = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">req</span>.<span class="title function_">request</span>(<span class="string">`https://hmajax.itheima.net/api/area?pname=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(proRes.list[<span class="number">0</span>])&#125;</span>&amp;cname=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(cityRes.list[<span class="number">0</span>])&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">const</span> areaRes = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res3.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">IResponse</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">range</span>[<span class="number">0</span>] = proRes.<span class="property">list</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">range</span>[<span class="number">1</span>] = cityRes.<span class="property">list</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">range</span>[<span class="number">2</span>] = areaRes.<span class="property">list</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 链式编程写法</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getAllData</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">        .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="number">20</span> &#125;)</span><br><span class="line">      <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;居住地:&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">values</span>.<span class="title function_">join</span>(<span class="string">&#x27;/&#x27;</span>))</span><br><span class="line">          .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">showSheet</span> = <span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.ic_public_arrow_right&#x27;</span>))</span><br><span class="line">          .<span class="title function_">width</span>(<span class="number">20</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Divider</span>()</span><br><span class="line">      <span class="title class_">Blank</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">bindSheet</span>($$this.<span class="property">showSheet</span>, <span class="variable language_">this</span>.<span class="title function_">areaSheet</span>(), &#123;</span><br><span class="line">      <span class="attr">height</span>: <span class="number">500</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title function_">areaSheet</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">TextPicker</span>(&#123;</span><br><span class="line">        <span class="attr">range</span>: <span class="variable language_">this</span>.<span class="property">range</span>,</span><br><span class="line">        <span class="attr">selected</span>: $$this.<span class="property">selected</span>,</span><br><span class="line">        <span class="comment">// value: $$this.values //</span></span><br><span class="line">      &#125;)</span><br><span class="line">        .<span class="title function_">canLoop</span>(<span class="literal">false</span>)</span><br><span class="line">        .<span class="title function_">onChange</span>(<span class="title function_">async</span> (value, index) =&gt; &#123;</span><br><span class="line">          <span class="comment">// this.values = value as string[]</span></span><br><span class="line">          <span class="comment">// 获取最新选中的省市区</span></span><br><span class="line">          <span class="keyword">const</span> _pname = value[<span class="number">0</span>]</span><br><span class="line">          <span class="keyword">const</span> _cname = value[<span class="number">1</span>]</span><br><span class="line">          <span class="keyword">const</span> _aname = value[<span class="number">2</span>]</span><br><span class="line">          <span class="comment">// 基于省份 获取最新的市</span></span><br><span class="line">          <span class="built_in">clearTimeout</span>(<span class="variable language_">this</span>.<span class="property">timeId</span>)</span><br><span class="line">          <span class="comment">// 没有开启定时器 开启定时器 并保存 id</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">timeId</span> = <span class="built_in">setTimeout</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 基于省 获取最新的市</span></span><br><span class="line">            <span class="comment">// 如果省 发生改变，那么重新获取对应的市区 并将选中值设置为 0</span></span><br><span class="line">            <span class="keyword">if</span> (_pname !== <span class="variable language_">this</span>.<span class="property">values</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">              <span class="keyword">const</span> res2 = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">req</span>.<span class="title function_">request</span>(<span class="string">&#x27;https://hmajax.itheima.net/api/city?pname=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(_pname))</span><br><span class="line">              <span class="keyword">const</span> cityRes = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res2.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">IResponse</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">range</span>[<span class="number">1</span>] = cityRes.<span class="property">list</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">values</span>[<span class="number">0</span>] = _pname</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">selected</span>[<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">              <span class="comment">// 市区应该是第一个</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">values</span>[<span class="number">1</span>] = cityRes.<span class="property">list</span>[<span class="number">0</span>]</span><br><span class="line">              <span class="comment">// 基于最新的市区 获取 对应的地区</span></span><br><span class="line">              <span class="keyword">const</span> res3 = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">req</span>.<span class="title function_">request</span>(<span class="string">`https://hmajax.itheima.net/api/area?pname=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(<span class="variable language_">this</span>.values[<span class="number">0</span>])&#125;</span>&amp;cname=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(<span class="variable language_">this</span>.values[<span class="number">1</span>])&#125;</span>`</span>)</span><br><span class="line">              <span class="keyword">const</span> areaRes = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res3.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">IResponse</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">range</span>[<span class="number">2</span>] = areaRes.<span class="property">list</span></span><br><span class="line">              <span class="comment">// 默认选中第一个</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">selected</span>[<span class="number">2</span>] = <span class="number">0</span></span><br><span class="line">              <span class="comment">// 保存最新的地区</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">values</span>[<span class="number">2</span>] = areaRes.<span class="property">list</span>[<span class="number">0</span>]</span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 省份没变，但是 市变了</span></span><br><span class="line">            <span class="keyword">if</span> (_cname !== <span class="variable language_">this</span>.<span class="property">values</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">              <span class="keyword">const</span> res3 = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">req</span>.<span class="title function_">request</span>(<span class="string">`https://hmajax.itheima.net/api/area?pname=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(<span class="variable language_">this</span>.values[<span class="number">0</span>])&#125;</span>&amp;cname=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(_cname)&#125;</span>`</span>)</span><br><span class="line">              <span class="keyword">const</span> areaRes = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res3.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">IResponse</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">range</span>[<span class="number">2</span>] = areaRes.<span class="property">list</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">values</span>[<span class="number">1</span>] = _cname</span><br><span class="line">              <span class="comment">// 默认选中第一个</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">selected</span>[<span class="number">2</span>] = <span class="number">0</span></span><br><span class="line">              <span class="comment">// 保存最新的地区</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">values</span>[<span class="number">2</span>] = areaRes.<span class="property">list</span>[<span class="number">0</span>]</span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">values</span>[<span class="number">2</span>] = _aname</span><br><span class="line"></span><br><span class="line">          &#125;, <span class="number">200</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码的核心思想在于注明当前选择的省市区<code>@Local values</code>，然后与用户新选择的省区市进行比较来处理不同的选择情况。<br>如果不记录已经选择的省区市，直接在每次数据有改变时就去获取一遍完整的数据则会导致一些奇怪的bug。</p>
<p>比如说在滑动选择了新的省后，我们重新获取包括省在内的完整数据，就导致闪烁一下后，选择的省市区又回到了初始状态。<br>这是因为在检测到用户进行的活动操作后发送的请求是根据状态变量的正确数据，但由于再一次获取并<strong>覆盖</strong>了<code>@Local range</code>的值，就导致省的数据<strong>又变回了默认的北京</strong>，导致数据发生<strong>二次变化</strong>，所有就又会再次执行获取完整数据的逻辑。<br>这样获取到的数据就又都是默认值了。才导致闪烁的效果。</p>
<p>因此我们要进行<strong>分类讨论</strong>，省在初始化后就不再改变，而当<strong>省变化时</strong>，只获取市和区的数据，当<strong>市变化时</strong>，只获取区的数据，当<strong>区变化时</strong>，只更新区的数据。</p>
<video width="100%" controls>
  <source src="17.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>在这段代码中我们使用了<code>async/await</code>关键字来处理异步操作，使得整个代码看起来更像是同步的。<br>同时由于在选择省市时容易出现短时间内反复变动的情况，如果在短时间内发送大量网络请求去获取数据会导致性能的大幅下降以及崩溃，所以我们使用了定时器来进行优化，进行<strong>代码防抖</strong>处理。</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/18.png" alt="18"></p>
<p>每次省市区出现变动时就先清楚上一次的定时器然后设定本次处理的定时器，在一段时间内选择的数据没有变化时才会进行数据的更新处理，这样就避免了短时间内反复变动的情况。</p>
<h3 id="async-await与Promise静态方法综合实践"><a href="#async-await与Promise静态方法综合实践" class="headerlink" title="async/await与Promise静态方法综合实践"></a>async/await与Promise静态方法综合实践</h3><p>这里我们来做一个综合案例，通过结合<code>async/await</code>与<code>Promise</code>静态方法来处理一个复杂的异步操作。</p>
<p>我们要针对于<code>https://hmajax.itheima.net/api/category/top</code>这个接口获取一级数据分类结果然后再通过获取的每类数据的ID获取二级数据。</p>
<h4 id="一级数据分类结果"><a href="#一级数据分类结果" class="headerlink" title="一级数据分类结果"></a>一级数据分类结果</h4><p>首先我们先针对于一级数据分类的结果进行结构分析。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;获取顶级分类成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1005000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;居家&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-05-06/201516e3-25d0-48f5-bcee-7f0cafb14176.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1005002&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;美食&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-05-06/cf82e5b4-bf1b-4c68-aa86-96f66e8e5282.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1010000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;服饰&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-05-06/33e1f5de-0fdb-4cfa-9ba9-781233024b53.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1011000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;母婴&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-05-06/b514a526-4010-4ce8-8cb9-757ed382f84a.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1013001&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;个护&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-05-06/d38a73b8-cd03-48aa-a60b-e7c4e16667ed.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1019000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;严选&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-05-06/4b02f01f-a365-4b6c-9f7a-8b0f591dda02.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1043000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;数码&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-05-06/9660870d-6a59-4624-8064-b3a8cbf50d5c.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;109243029&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;运动&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-05-06/7d19752c-baff-49b6-bd02-5ece1d729214.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;19999999&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;杂项&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-05-06/4ff20b9e-8150-4bd3-87a3-0cd6766938dd.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>整体结构比较简单，整体由一个包含了请求状态信息和返回信息的对象组成。</p>
<p>由此我们可以定义接口如下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一级分类结果</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TopCategoryResponse</span> &#123;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">data</span>: <span class="title class_">CategoryData</span>[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//每项分类结果</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">CategoryData</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">picture</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">children</span>?: <span class="title class_">CategoryData</span>[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>UI界面这里就不在过多赘述了，只讲关键代码。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">req = http.<span class="title function_">createHttp</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">aboutToAppear</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">req</span>.<span class="title function_">request</span>(<span class="string">&#x27;https://hmajax.itheima.net/api/category/top&#x27;</span>)</span><br><span class="line">  <span class="comment">//一级分类结果</span></span><br><span class="line">  <span class="keyword">const</span> topData = (<span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">TopCategoryResponse</span>).<span class="property">data</span></span><br><span class="line">  <span class="comment">//TODO</span></span><br><span class="line">  <span class="comment">//基于一级分类的结果去发送请求获取二级分类的结果</span></span><br><span class="line">  <span class="comment">//每一次请求的速度都不一致，为了统一获取数据就可以调用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们首先利用鸿蒙的网络请求模块创建了一个请求对象，随后将<code>aboutToAppear</code>生命周期钩子函数重构为<strong>异步函数</strong>，在函数中发送请求获取一级分类的结果，然后将结果解析为<code>TopCategoryResponse</code>类型的对象，最后将一级分类的结果赋值给<code>topData</code>变量。</p>
<h4 id="配合Promise静态方法获取二级数据分类结果"><a href="#配合Promise静态方法获取二级数据分类结果" class="headerlink" title="配合Promise静态方法获取二级数据分类结果"></a>配合Promise静态方法获取二级数据分类结果</h4><p>为了能消除网络请求带来的时间差异，同时获取到所有ID下的二级分类结果，我们可以使用<code>Promise.all</code>方法来同一控制多个异步请求进程。</p>
<p>为此我们首先需要生成一个Promise数组，来保存所有的Promise对象，然后将这个数组作为参数传递给<code>Promise.all</code>方法，这样就可以同时控制多个异步请求进程。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promiseList = topData.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">req</span>.<span class="title function_">request</span>(<span class="string">`https://hmajax.itheima.net/api/category/sub?id=<span class="subst">$&#123;item.id&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> resultArr = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(promiseList)</span><br></pre></td></tr></table></figure>
<p><code>map</code>方法会遍历<code>topData</code>数组，并将每一个元素作为参数传递给回调函数，回调函数中会返回一个Promise对象，这个Promise对象会发送一个请求，请求的URL由一级分类的ID组成，最后将所有的Promise对象组成一个数组，并赋值给<code>promiseList</code>变量。随后将<code>promiseList</code>数组作为参数传递给<code>Promise.all</code>方法，这样就可以同时控制多个异步请求进程，最后将所有的请求结果组成一个数组，并赋值给<code>resultArr</code>变量。</p>
<p>然后我们针对于二级数据分类结果的数据结构进行分析并定义接口。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;获取子级分类成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1005000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;居家&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-05-06/201516e3-25d0-48f5-bcee-7f0cafb14176.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1005009&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;茶咖酒具&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://yanxuan.nosdn.127.net/3102b963e7a3c74b9d2ae90e4380da65.png?quality=95&amp;imageView&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1007000&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水具杯壶&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://yanxuan.nosdn.127.net/45b50d5f8afbd6fdef97314647dcb7db.png?quality=95&amp;imageView&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1017000&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;宠物食品&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://yanxuan.nosdn.127.net/b42a85ef15f856081ea9f49e5f6893e2.png?quality=95&amp;imageView&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;109248004&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;宠物用品&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://yanxuan.nosdn.127.net/e766b09029ca00680d1e651b5cdc42bd.png?quality=95&amp;imageView&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>整体结构与一级分类结果类似，只是多了一个<code>children</code>属性，这个属性是一个数组，数组中包含了二级分类的结果。</p>
<p>由此我们可以定义接口如下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//二级分类结果</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">CategoryResponse</span> &#123;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">data</span>: <span class="title class_">CategoryData</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//每项分类结果</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">CategoryData</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">picture</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">children</span>?: <span class="title class_">CategoryData</span>[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样的接口结构也算是复习了一下递归定义的方法。</p>
<hr>
<h5 id="递归定义接口方法分析"><a href="#递归定义接口方法分析" class="headerlink" title="递归定义接口方法分析"></a>递归定义接口方法分析</h5><p>我们可以看到在二级数据分类结果的返回值结构中<code>&quot;id&quot;&quot;name&quot;&quot;picture&quot;</code>这三个字段与一级数据分类结果的返回数据对象的结构是一样的，而<code>&quot;children&quot;</code>字段中的对象也包含了<code>&quot;id&quot;&quot;name&quot;&quot;picture&quot;</code>这三个字段，所以我们可以将<code>&quot;children&quot;</code>字段的类型定义为<code>CategoryData[]</code>，同时因为一级数据分类结果以及二级分类结果的<code>data</code>对象并没有<code>children</code>字段，所以我们可以将<code>&quot;children&quot;</code>字段定义为<strong>可选的</strong>，这样就可以将一级数据分类结果以及二级分类结果的<code>data</code>对象都定义为<code>CategoryData</code>类型。</p>
<hr>
<h4 id="二级数据分类结果处理"><a href="#二级数据分类结果处理" class="headerlink" title="二级数据分类结果处理"></a>二级数据分类结果处理</h4><p>利用内置JSON解析函数解系数据并赋值给渲染数据列表即可。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">topCategoryList</span> = resultArr.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="title class_">JSON</span>.<span class="title function_">parse</span>(item.<span class="property">result</span>.<span class="title function_">toString</span>()) <span class="keyword">as</span> <span class="title class_">CategoryResponse</span>).<span class="property">data</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="24.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>至此本案例关键代码编写完成。</p>
<h2 id="请求库-axios"><a href="#请求库-axios" class="headerlink" title="请求库-axios"></a>请求库-axios</h2><p>Axios 是一个基于 Promise 的 HTTP 客户端，用于浏览器和 Node.js 环境。<br>它支持多种功能，如<strong>拦截请求和响应、转换请求数据和响应数据、取消请求</strong>等。<br>在 OpenHarmony 中，@ohos/axios 是对 Axios 的适配版本，使其能够在 OpenHarmony 的运行环境中工作。</p>
<h3 id="ohpm"><a href="#ohpm" class="headerlink" title="ohpm"></a>ohpm</h3><p>OHPM（OpenHarmony Package Manager）是 OpenHarmony 生态系统中的包管理工具，用于管理和共享 OpenHarmony 的第三方库。它由三方库中心仓网站、命令行工具和三方库中心仓仓库三个部分组成。</p>
<h3 id="安装axios"><a href="#安装axios" class="headerlink" title="安装axios"></a>安装axios</h3><p><a target="_blank" rel="noopener" href="https://ohpm.openharmony.cn/#/cn/detail/@ohos%2Faxios">@ohos/axios</a><br>这是<code>@ohos/axios</code>的第三方库地址。</p>
<h4 id="命令行安装"><a href="#命令行安装" class="headerlink" title="命令行安装"></a>命令行安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">ohpm i @ohos/axios</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载</span></span><br><span class="line">ohpm uninstall @ohos/axios</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>当然有可能遇到以下状况，一些奇怪的配置问题总是会缠绕着我们。</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/25.png" alt="25"></p>
<p>就需要用另一种方式来进行安装了。</p>
<h4 id="配置文件安装"><a href="#配置文件安装" class="headerlink" title="配置文件安装"></a>配置文件安装</h4><p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/26.png" alt="26"></p>
<p>打开图示配置文件，添加我们所需的第三方库名称以及版本号。</p>
<h4 id="仓颉组件冲突"><a href="#仓颉组件冲突" class="headerlink" title="仓颉组件冲突"></a>仓颉组件冲突</h4><p>我在试图解决<code>无法将“ohpm”项识别为 cmdlet、函数、脚本文件或可运行程序的名称</code>的问题时意外的在官网的论坛上看到了这样一条帖子：<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/forum/topic/0209157906052806276?fid=0109140870620153026">传送门</a></p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/27.png" alt="27"></p>
<p>（啊？？？不儿。）我虽然很震惊，但也很惊喜，至少找到一个看起来很靠谱的解决方案了。<br>我马上进行了尝试，将仓颉插件禁用然后重启DevEcoStudio，发现果然可以了。</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/28.png" alt="28"></p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/29.png" alt="29"></p>
<p>我们可以看到在第三方库的管理包中已经包含了我们所需的<code>@ohos/axios</code>库了。</p>
<p>enm…自家产品打架属实难蚌，希望华为快快修复吧，这还是挺影响开发的。</p>
<h3 id="axios的使用"><a href="#axios的使用" class="headerlink" title="axios的使用"></a>axios的使用</h3><p>首先axios的方法需要配置三个泛型参数，这主要是因为其默认类型为any，但ArkTS中并不支持Any类型。</p>
<p>而对于这三个参数官方的解释是这样的：</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/30.png" alt="30"></p>
<ul>
<li><code>T</code>：响应数据的类型。</li>
<li><code>R</code>：响应对象的类型。</li>
<li><code>D</code>：请求数据的类型。</li>
</ul>
<p>通过阅读源码我们可以知道第一个泛型参数<code>T</code>会直接传入到第二个泛型参数<code>R</code>的泛型参数中。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 源码</span></span><br><span class="line">request&lt;T = <span class="built_in">any</span>, R = <span class="title class_">AxiosResponse</span>&lt;T&gt;, D = <span class="built_in">any</span>&gt;(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>&lt;D&gt;): <span class="title class_">Promise</span>&lt;R&gt;;</span><br><span class="line">  get&lt;T = <span class="built_in">any</span>, R = <span class="title class_">AxiosResponse</span>&lt;T&gt;, D = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>&lt;D&gt;): <span class="title class_">Promise</span>&lt;R&gt;;</span><br><span class="line">  <span class="keyword">delete</span>&lt;T = <span class="built_in">any</span>, R = <span class="title class_">AxiosResponse</span>&lt;T&gt;, D = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>&lt;D&gt;): <span class="title class_">Promise</span>&lt;R&gt;;</span><br><span class="line">  head&lt;T = <span class="built_in">any</span>, R = <span class="title class_">AxiosResponse</span>&lt;T&gt;, D = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>&lt;D&gt;): <span class="title class_">Promise</span>&lt;R&gt;;</span><br><span class="line">  options&lt;T = <span class="built_in">any</span>, R = <span class="title class_">AxiosResponse</span>&lt;T&gt;, D = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>&lt;D&gt;): <span class="title class_">Promise</span>&lt;R&gt;;</span><br><span class="line">  post&lt;T = <span class="built_in">any</span>, R = <span class="title class_">AxiosResponse</span>&lt;T&gt;, D = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: D, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>&lt;D&gt;): <span class="title class_">Promise</span>&lt;R&gt;;</span><br><span class="line">  put&lt;T = <span class="built_in">any</span>, R = <span class="title class_">AxiosResponse</span>&lt;T&gt;, D = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: D, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>&lt;D&gt;): <span class="title class_">Promise</span>&lt;R&gt;;</span><br><span class="line">  postForm&lt;T = <span class="built_in">any</span>, R = <span class="title class_">AxiosResponse</span>&lt;T&gt;, D = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: D, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>&lt;D&gt;): <span class="title class_">Promise</span>&lt;R&gt;;</span><br><span class="line">  putForm&lt;T = <span class="built_in">any</span>, R = <span class="title class_">AxiosResponse</span>&lt;T&gt;, D = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: D, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>&lt;D&gt;): <span class="title class_">Promise</span>&lt;R&gt;;</span><br><span class="line">  patchForm&lt;T = <span class="built_in">any</span>, R = <span class="title class_">AxiosResponse</span>&lt;T&gt;, D = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: D, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>&lt;D&gt;): <span class="title class_">Promise</span>&lt;R&gt;;</span><br></pre></td></tr></table></figure>
<p>通过源码可知，第一个泛型参数<code>T</code>仅仅是我们请求所需的数据的类型，而第二个泛型参数<code>R</code>则是我们请求返回的响应对象的类型，其中还包含了其他的响应体信息，比如状态码，状态文字，头部信息等。</p>
<p>而对于第三个泛型参数<code>D</code>则是我们发送网络请求时所需携带的额外数据。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;获取笑话&#x27;</span>)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    axios.<span class="property">get</span>&lt;<span class="built_in">string</span>,<span class="title class_">AxiosResponse</span>&lt;<span class="built_in">string</span>&gt;,<span class="literal">null</span>&gt;(<span class="string">&#x27;https://api-vue-base.itheima.net/api/joke&#x27;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">res</span>:<span class="title class_">AxiosResponse</span>&lt;<span class="built_in">string</span>&gt;</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">joke</span> = res.<span class="property">data</span></span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>通过上述代码我们可以看到，我们请求的返回值类型为<code>string</code>，而响应对象的类型为<code>AxiosResponse&lt;string&gt;</code>，而发送网络请求时我们并没有携带任何额外的数据，所以第三个泛型参数为<code>null</code>。</p>
<p>在直接使用鸿蒙的网络请求模块时我们获取数据后还需要分析数据结构<strong>手动定义接口</strong>，用内置的JSON进行数据解析，但axios会帮助我们处理除了我们所需的有效数据以外的<strong>全部响应数据</strong>解析工作，我们只需要关注我们所需要的数据即可。</p>
<p>如果像是直接使用网络请求模块去定义一个变量获取数据，我们所获取到的是<code>Promise</code>对象。<br>而axios则是一个<code>AxiosResponse</code>对象。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">onClick</span>(<span class="title function_">async</span> ()=&gt;&#123;</span><br><span class="line">  <span class="comment">// axios.get&lt;string,AxiosResponse&lt;string&gt;,null&gt;(&#x27;https://api-vue-base.itheima.net/api/joke&#x27;)</span></span><br><span class="line">  <span class="comment">//   .then((res:AxiosResponse&lt;string&gt;)=&gt;&#123;</span></span><br><span class="line">  <span class="comment">//     this.joke = res.data</span></span><br><span class="line">  <span class="comment">//   &#125;)</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">jokeRes</span>:<span class="title class_">AxiosResponse</span>&lt;<span class="built_in">string</span>&gt; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;https://api-vue-base.itheima.net/api/joke&#x27;</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">joke</span> = jokeRes.<span class="property">data</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>我们可以看到，这种写法与用then函数的结果是一摸一样的，而且由于在定义变量时就锁定了他的返回值类型，所以我们就不需要再去传泛型参数了。</p>
<h4 id="get方法传参"><a href="#get方法传参" class="headerlink" title="get方法传参"></a>get方法传参</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;获取江西省的城市&#x27;</span>)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">cityRes</span>: <span class="title class_">AxiosResponse</span>&lt;<span class="title class_">CityRes</span>&gt; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;https://hmajax.itheima.net/api/city&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">params</span>: &#123;</span><br><span class="line">        <span class="string">&quot;pname&quot;</span>:<span class="string">&#x27;江西省&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:cityRes.<span class="property">data</span>.<span class="property">message</span>&#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">text</span>=cityRes.<span class="property">data</span>.<span class="property">message</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cityList</span> = cityRes.<span class="property">data</span>.<span class="property">list</span></span><br><span class="line">  &#125;)</span><br><span class="line"><span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">text</span>)</span><br><span class="line"><span class="title class_">List</span>(&#123;<span class="attr">space</span>:<span class="number">10</span>&#125;)&#123;</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">cityList</span>,<span class="function">(<span class="params"><span class="attr">item</span>:<span class="built_in">string</span>,i</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title class_">ListItem</span>()&#123;</span><br><span class="line">      <span class="title class_">Text</span>(item)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到在我们传递中文参数时我们无需使用<code>encodeURIComponent</code>函数进行编码，axios会自动帮我们进行编码。</p>
<p>同时对于嵌入在Url中的参数axios也提供了两种方式：</p>
<ul>
<li><p>一种是像用网络请求模块时一样直接拼接字符串或是模板字符串来将参数拼接在Url中。<br><strong>注意在用模板字符串时要使用<code>encondURIComponent</code>函数进行编码!!!</strong></p>
</li>
<li><p>另一种方式则是将所有的参数字段都以一个对象的方式传入第二个参数的<code>params</code>属性中。这样就可以由axios自动帮我们填入参数并进行编码。<br><strong>推荐使用第二种方式</strong></p>
</li>
</ul>
<h4 id="create方法创建axios实例"><a href="#create方法创建axios实例" class="headerlink" title="create方法创建axios实例"></a>create方法创建axios实例</h4><p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/31.png" alt="31"></p>
<p>我们从官方示例中可以看到，我们可以通过<code>create</code>方法来创建一个axios实例。<br>创建axios实例主要有以下几个目的：</p>
<ul>
<li>在公司的实际开发中绝多数接口的基地址都是一样的，只不过是后续资源路径不同，所以我们可以创建一个axios实例配置基地址以便获取公司服务器的资源。</li>
<li>统一设置超时时间，虽然异步操作防止了主线程被阻塞，但如果一个页面长时间处于加载动画，而不出现任何提示信息，用户很可能会怀疑是自己手机或者我们的软件出现了问题，所以我们可以设置一个超时时间，如果超过这个时间没有获取到数据，则提示用户网络连接超时。</li>
<li>统一设置请求头，对于大部分接口尤其是同一团队提供的接口，都有一部分共同的请求头，我们可以将这些请求头统一设置在axios实例中。</li>
</ul>
<p>总结来说还是为了提高代码复用率，提取公共能力并进行封装，防止相同代码重复书写增加开发、维护成本。</p>
<p>例如说：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://hmajax.itheima.net/api/province</span><br><span class="line">https://hmajax.itheima.net/api/city</span><br><span class="line">https://hmajax.itheima.net/api/area</span><br></pre></td></tr></table></figure>
<p>这三个接口的基地址都是<code>https://hmajax.itheima.net/api/</code>，而后面的资源路径不同，所以我们可以创建一个axios实例配置基地址。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">req = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>:<span class="string">&#x27;https://hmajax.itheima.net/api/&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样一来我们就可以将上面获取江西省城市名称列表的代码修改为以下形式：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;获取江西省的城市&#x27;</span>)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">cityRes</span>: <span class="title class_">AxiosResponse</span>&lt;<span class="title class_">CityRes</span>&gt; = <span class="keyword">await</span> req.<span class="title function_">get</span>(<span class="string">&#x27;/city&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">params</span>: &#123;</span><br><span class="line">        <span class="string">&quot;pname&quot;</span>:<span class="string">&#x27;江西省&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:cityRes.<span class="property">data</span>.<span class="property">message</span>&#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">text</span>=cityRes.<span class="property">data</span>.<span class="property">message</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cityList</span> = cityRes.<span class="property">data</span>.<span class="property">list</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>效果与直接调用axios提供的get方法是一样的。</p>
<h4 id="post请求"><a href="#post请求" class="headerlink" title="post请求"></a>post请求</h4><p>在post方法中我们依旧可以使用前面我们已经定义好基地址的axios实例。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;登录注册&#x27;</span>)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="title function_">async</span> ()=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">res</span>:<span class="title class_">AxiosResponse</span>&lt;<span class="title class_">SignUpRes</span>&gt; = <span class="keyword">await</span> req.<span class="property">post</span>&lt;<span class="title class_">SignUpRes</span>&gt;(<span class="string">&#x27;/register&#x27;</span>,&#123;</span><br><span class="line">      <span class="attr">username</span>:<span class="string">&#x27;XBX02yftx&#x27;</span>,</span><br><span class="line">      <span class="attr">password</span>:<span class="string">&#x27;12345678&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>:res.<span class="property">data</span>.<span class="property">message</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>这里是更简洁的写法，只传入了一个泛型参数，而通过上面源码的阅读我们可知，第一个泛型参数<code>T</code>会直接传入到第二个泛型参数<code>R</code>的泛型参数中。<br>而第三个泛型参数<code>D</code>则是我们发送网络请求时所需携带的额外数据，可以写也可以不写，如果写的话就需要我们单独定义一个类型来用于描述我们发送的数据结构。<br>没必要，所以只填第一个泛型参数是完全足够的。都是为了规范类型和代码提示功能。</p>
<h3 id="axios的通用方法"><a href="#axios的通用方法" class="headerlink" title="axios的通用方法"></a>axios的通用方法</h3><p>axios也是可以不用get、post等别名方法，直接用传参的方式来设置请求相关配置并进行请求的发送的。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;用通用方法注册账号&#x27;</span>)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="title function_">async</span> ()=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">res</span>:<span class="title class_">AxiosResponse</span>&lt;<span class="title class_">SignUpRes</span>&gt; = <span class="keyword">await</span> req&lt;<span class="title class_">SignUpRes</span>&gt;(&#123;</span><br><span class="line">      <span class="attr">url</span>:<span class="string">&#x27;/register&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>:<span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">username</span>:<span class="string">&#x27;XBX02yftx1s&#x27;</span>,</span><br><span class="line">        <span class="attr">password</span>:<span class="string">&#x27;12345678&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">text</span> = res.<span class="property">data</span>.<span class="property">message</span></span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>:res.<span class="property">data</span>.<span class="property">message</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p><strong>注意！！！</strong><code>data</code>对应的是请求体中的参数，而<code>params</code>对应的是嵌入在url中的参数。<br>这一点一定要分清！很重要！！！</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>这篇博客算是目前我写的最多最长的一篇博客了，一路边学边写，感觉这样的学习比只是写一遍代码印象要更深，毕竟是要给别人看，是试图在给别人讲明白。这就要求自己一定要把这个部分吃透才能去给别人讲。</p>
<p>总之还是那句话，让我们用尽全力的在这个世界上去留下抓痕吧！</p>
<p><img src="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/32.jpg" alt="32"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/XBXyftx">XBXyftx</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://xbxyftx.top">https://xbxyftx.top</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">此文章版权归XBXyftx所有，如有转载，请註明来自原作者</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%B8%BF%E8%92%99/">鸿蒙</a><a class="post-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF%E5%90%91/">技术向</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/">网络请求</a></div><div class="post-share"><div class="social-share" data-image="/img/ArticleTopImgs/HttpTopImg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/26/butterfly%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96/" title="Hexo+butterfly个人博客搭建与美化"><img class="cover" src="/img/ArticleTopImgs/ButterTopImg.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Hexo+butterfly个人博客搭建与美化</div></div><div class="info-2"><div class="info-item-1">博客搭建教程</div></div></div></a><a class="pagination-related" href="/2025/01/30/%E9%B8%BF%E8%92%99%E4%B8%AD%E6%96%87%E5%8C%85/" title="手动添加鸿蒙中文包"><img class="cover" src="/img/ArticleTopImgs/ChinesePackTopImg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">手动添加鸿蒙中文包</div></div><div class="info-2"><div class="info-item-1">手动添加鸿蒙中文配置包的方式</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/02/08/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="我的书架项目笔记"><img class="cover" src="/img/ArticleTopImgs/BookShelfTopImg.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-08</div><div class="info-item-2">我的书架项目笔记</div></div><div class="info-2"><div class="info-item-1">一个对利用NetWork Kit发送HTTP请求的实战练习项目</div></div></div></a><a class="pagination-related" href="/2025/03/31/%E2%80%9CHongXiaoYi%E2%80%9D/" title="鸿小易项目开发笔记"><img class="cover" src="/img/ArticleTopImgs/hxyTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-31</div><div class="info-item-2">鸿小易项目开发笔记</div></div><div class="info-2"><div class="info-item-1">鸿小易，你的鸿蒙开发好帮手。</div></div></div></a><a class="pagination-related" href="/2025/05/14/AccountKitTest/" title="华为账户一键登录功能测试"><img class="cover" src="/img/ArticleTopImgs/AccountTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">华为账户一键登录功能测试</div></div><div class="info-2"><div class="info-item-1">Account Kit的官方demo测试与华为账户登录的功能实现分析。</div></div></div></a><a class="pagination-related" href="/2025/04/20/RemoteCommunication/" title="远场通信服务"><img class="cover" src="/img/ArticleTopImgs/RCPTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-20</div><div class="info-item-2">远场通信服务</div></div><div class="info-2"><div class="info-item-1">本文将介绍鸿蒙远场通信服务</div></div></div></a><a class="pagination-related" href="/2025/03/16/yiDuo/" title="关于鸿蒙的一多能力"><img class="cover" src="/img/ArticleTopImgs/yiduoTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-16</div><div class="info-item-2">关于鸿蒙的一多能力</div></div><div class="info-2"><div class="info-item-1">一多能力的学习笔记</div></div></div></a><a class="pagination-related" href="/2025/03/13/Navigation/" title="Navigation与NavDestination"><img class="cover" src="/img/ArticleTopImgs/NavTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-13</div><div class="info-item-2">Navigation与NavDestination</div></div><div class="info-2"><div class="info-item-1">本文将介绍Navigation与NavDestination的使用方法。</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">XBXyftx</div><div class="author-info-description">博安千古情如此，璇玉如华自醉从</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/XBXyftx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/XBXyftx" target="_blank" title="Github"><i class="fab fa-github" style="color: #c3ffff;"></i></a><a class="social-icon" href="mailto:shuaixbx02@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="/img/wechat.png" target="_blank" title="WeChat"><i class="fa-brands fa-weixin" style="color: #7bb342;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">ICP备案完成！xbxyftx.top正式恢复运营！！！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.1.</span> <span class="toc-text">服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.</span> <span class="toc-text">http模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.3.</span> <span class="toc-text">HTTP协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URL"><span class="toc-number">1.4.</span> <span class="toc-text">URL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#URL%E5%8F%82%E6%95%B0%E6%A1%88%E4%BE%8B"><span class="toc-number">1.4.1.</span> <span class="toc-text">URL参数案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">项目基础结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%91%E8%AF%9D%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">笑话查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9C%81%E4%BB%BD%E5%9F%8E%E5%B8%82%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">省份城市查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%E5%92%8C%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C"><span class="toc-number">1.4.1.4.</span> <span class="toc-text">完整代码和最终效果</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7V2"><span class="toc-number">1.4.1.5.</span> <span class="toc-text">升级V2</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E5%8F%82%E6%95%B0"><span class="toc-number">1.4.2.</span> <span class="toc-text">中文参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E8%AF%B7%E6%B1%82"><span class="toc-number">1.5.</span> <span class="toc-text">HTTP请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87"><span class="toc-number">1.5.1.</span> <span class="toc-text">HTTP请求报文</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E5%93%8D%E5%BA%94"><span class="toc-number">1.6.</span> <span class="toc-text">HTTP响应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">1.6.1.</span> <span class="toc-text">HTTP响应状态码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87"><span class="toc-number">1.6.2.</span> <span class="toc-text">HTTP响应报文</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON"><span class="toc-number">1.7.</span> <span class="toc-text">JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#json%E4%B8%8E%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%BA%92%E7%9B%B8%E8%BD%AC%E5%8C%96"><span class="toc-number">1.7.1.</span> <span class="toc-text">json与对象的互相转化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#json%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%95%B0%E7%BB%84%E7%9A%84%E4%BA%92%E7%9B%B8%E8%BD%AC%E5%8C%96"><span class="toc-number">1.7.2.</span> <span class="toc-text">json和字符串数组的互相转化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">http模块的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E8%AF%B7%E6%B1%82%EF%BC%88Get%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">默认请求（Get）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%EF%BC%88Post%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">提交数据请求（Post）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-number">2.2.1.</span> <span class="toc-text">修改请求头</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">异步编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">什么是异步编程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise"><span class="toc-number">3.2.</span> <span class="toc-text">Promise</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Promise%E7%9A%84%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8"><span class="toc-number">3.2.1.</span> <span class="toc-text">Promise的链式调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%93%BE%E5%BC%8F%E7%BC%96%E7%A8%8B%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8"><span class="toc-number">3.2.2.</span> <span class="toc-text">链式编程的实际应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Promise%E7%9A%84%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.3.</span> <span class="toc-text">Promise的静态方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Promise-all"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">Promise.all()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Promise-resolve"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">Promise.resolve()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Promise-reject"><span class="toc-number">3.2.3.3.</span> <span class="toc-text">Promise.reject()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Promise-race"><span class="toc-number">3.2.3.4.</span> <span class="toc-text">Promise.race()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#async-await"><span class="toc-number">3.3.</span> <span class="toc-text">async&#x2F;await</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#async-await%E4%B8%8EPromise%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.4.</span> <span class="toc-text">async&#x2F;await与Promise静态方法综合实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%88%86%E7%B1%BB%E7%BB%93%E6%9E%9C"><span class="toc-number">3.4.1.</span> <span class="toc-text">一级数据分类结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E5%90%88Promise%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E8%8E%B7%E5%8F%96%E4%BA%8C%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%88%86%E7%B1%BB%E7%BB%93%E6%9E%9C"><span class="toc-number">3.4.2.</span> <span class="toc-text">配合Promise静态方法获取二级数据分类结果</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E5%AE%9A%E4%B9%89%E6%8E%A5%E5%8F%A3%E6%96%B9%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">3.4.2.1.</span> <span class="toc-text">递归定义接口方法分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%88%86%E7%B1%BB%E7%BB%93%E6%9E%9C%E5%A4%84%E7%90%86"><span class="toc-number">3.4.3.</span> <span class="toc-text">二级数据分类结果处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%BA%93-axios"><span class="toc-number">4.</span> <span class="toc-text">请求库-axios</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ohpm"><span class="toc-number">4.1.</span> <span class="toc-text">ohpm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85axios"><span class="toc-number">4.2.</span> <span class="toc-text">安装axios</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AE%89%E8%A3%85"><span class="toc-number">4.2.1.</span> <span class="toc-text">命令行安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="toc-number">4.2.2.</span> <span class="toc-text">配置文件安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%93%E9%A2%89%E7%BB%84%E4%BB%B6%E5%86%B2%E7%AA%81"><span class="toc-number">4.2.3.</span> <span class="toc-text">仓颉组件冲突</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#axios%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.3.</span> <span class="toc-text">axios的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#get%E6%96%B9%E6%B3%95%E4%BC%A0%E5%8F%82"><span class="toc-number">4.3.1.</span> <span class="toc-text">get方法传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#create%E6%96%B9%E6%B3%95%E5%88%9B%E5%BB%BAaxios%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.3.2.</span> <span class="toc-text">create方法创建axios实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#post%E8%AF%B7%E6%B1%82"><span class="toc-number">4.3.3.</span> <span class="toc-text">post请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#axios%E7%9A%84%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">4.4.</span> <span class="toc-text">axios的通用方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">5.</span> <span class="toc-text">结语</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/05/23/HarmonyOSPersistent/" title="鸿蒙开发数据持久化简述"><img src="/img/ArticleTopImgs/persistentTopImg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="鸿蒙开发数据持久化简述"/></a><div class="content"><a class="title" href="/2025/05/23/HarmonyOSPersistent/" title="鸿蒙开发数据持久化简述">鸿蒙开发数据持久化简述</a><time datetime="2025-05-23T12:46:19.000Z" title="发表于 2025-05-23 20:46:19">2025-05-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/18/SAS/" title="《数据分析方法（第二版）》重要概念"><img src="/img/ArticleTopImgs/SASTopImg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="《数据分析方法（第二版）》重要概念"/></a><div class="content"><a class="title" href="/2025/05/18/SAS/" title="《数据分析方法（第二版）》重要概念">《数据分析方法（第二版）》重要概念</a><time datetime="2025-05-18T06:49:47.000Z" title="发表于 2025-05-18 14:49:47">2025-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/16/HuaWeiCloud/" title="华为云Flexus云服务L实例+宝塔面板+Git Hook自动部署解决方案"><img src="/img/ArticleTopImgs/HuaWeiCloudTopImg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="华为云Flexus云服务L实例+宝塔面板+Git Hook自动部署解决方案"/></a><div class="content"><a class="title" href="/2025/05/16/HuaWeiCloud/" title="华为云Flexus云服务L实例+宝塔面板+Git Hook自动部署解决方案">华为云Flexus云服务L实例+宝塔面板+Git Hook自动部署解决方案</a><time datetime="2025-05-16T01:11:23.000Z" title="发表于 2025-05-16 09:11:23">2025-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/14/AccountKitTest/" title="华为账户一键登录功能测试"><img src="/img/ArticleTopImgs/AccountTopImg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="华为账户一键登录功能测试"/></a><div class="content"><a class="title" href="/2025/05/14/AccountKitTest/" title="华为账户一键登录功能测试">华为账户一键登录功能测试</a><time datetime="2025-05-14T03:10:51.000Z" title="发表于 2025-05-14 11:10:51">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/30/ToTheApril2025/" title="致2025那个繁忙的4月"><img src="/img/ArticleTopImgs/AprilTopImg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="致2025那个繁忙的4月"/></a><div class="content"><a class="title" href="/2025/04/30/ToTheApril2025/" title="致2025那个繁忙的4月">致2025那个繁忙的4月</a><time datetime="2025-04-30T00:15:30.000Z" title="发表于 2025-04-30 08:15:30">2025-04-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/footerBg.png);"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By XBXyftx</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><span>备案号：京ICP备2025126467号</span></a></div><div></div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now = new Date(); 
function createtime() { 
var grt = new Date("4/25/2024 18:30"); // 在此处修改你的建站时间
now.setTime(now.getTime() + 250); 
days = (now - grt) / 1000 / 60 / 60 / 24; 
dnum = Math.floor(days); 
hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum); 
hnum = Math.floor(hours); 
if (String(hnum).length == 1) { hnum = "0" + hnum; } 
minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum); 
mnum = Math.floor(minutes); 
if (String(mnum).length == 1) { mnum = "0" + mnum; } 
seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
snum = Math.round(seconds); 
if (String(snum).length == 1) { snum = "0" + snum; } 
document.getElementById("timeDate").innerHTML = "本网站已运行 " + dnum + " 天 "; 
document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
} 
setInterval(createtime, 250);</script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa-solid fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa-solid fa-arrow-rotate-right"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa-solid fa-arrow-right"></i></a><a class="rightMenu-item" id="menu-radompage" href="javascript:window.location.href = window.location.origin;"><i class="fa-solid fa-house"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa-solid fa-copy"></i><span>复制</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:rmf.switchReadMode();"><i class="fa-solid fa-book"></i><span>阅读模式</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikooxbx.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikooxbx.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script>localStorage.setItem('theme','dark')</script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script> // 强制锁定为暗黑模式 localStorage.setItem('theme', 'dark'); // 防止其他脚本覆盖模式 document.documentElement.setAttribute('data-theme', 'dark'); </script><link rel="stylesheet" href="/css/styles.css"><script> document.querySelectorAll('#post-comment).forEach(el => { el.style.backgroundColor = 'rgba(255, 255, 255, 0.6)'; }); </script><script src="/js/jquery-3.6.0.min.js"></script><script src="/js/rightmenu.js"></script><link rel="twikoo" href="/css/twikoo.css"><script src="/js/happy-title.js" async></script><script src="/js/cache-manager.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="/%5Bobject%20Object%5D"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="99" count="99" mobile="true" src="/%5Bobject%20Object%5D"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'da54ed7504284b8d97ecdbf93f821cdf';
  var gaud_map_key = 'c25dd516b6a1aa4c5269e50077fac6f4';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '115.982279,40.19409';
  var clock_default_rectangle_enable = 'true';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementsByClassName('recent-posts')[0];
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/04/30/ToTheApril2025/" alt=""><img width="48" height="48" src="/img/ArticleTopImgs/AprilTopImg.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-30</span><a class="blog-slider__title" href="2025/04/30/ToTheApril2025/" alt="">致2025那个繁忙的4月</a><div class="blog-slider__text">人们总是匆匆向前，殊不知时光易逝啊……</div><a class="blog-slider__button" href="2025/04/30/ToTheApril2025/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/03/16/yiDuo/" alt=""><img width="48" height="48" src="/img/ArticleTopImgs/yiduoTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-03-16</span><a class="blog-slider__title" href="2025/03/16/yiDuo/" alt="">关于鸿蒙的一多能力</a><div class="blog-slider__text">一多能力的学习笔记</div><a class="blog-slider__button" href="2025/03/16/yiDuo/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/02/04/V2/" alt=""><img width="48" height="48" src="/img/ArticleTopImgs/V2TopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-02-04</span><a class="blog-slider__title" href="2025/02/04/V2/" alt="">浅谈鸿蒙状态管理V1——&gt;V2</a><div class="blog-slider__text">用实际代码测试与我的开发经验，解析鸿蒙状态管理V2中难以理解的内容，帮助开发者们更好的理解和使用状态管理V2版本。</div><a class="blog-slider__button" href="2025/02/04/V2/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/04/20/RemoteCommunication/" alt=""><img width="48" height="48" src="/img/ArticleTopImgs/RCPTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-20</span><a class="blog-slider__title" href="2025/04/20/RemoteCommunication/" alt="">远场通信服务</a><div class="blog-slider__text">本文将介绍鸿蒙远场通信服务</div><a class="blog-slider__button" href="2025/04/20/RemoteCommunication/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/05/14/AccountKitTest/" alt=""><img width="48" height="48" src="/img/ArticleTopImgs/AccountTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-14</span><a class="blog-slider__title" href="2025/05/14/AccountKitTest/" alt="">华为账户一键登录功能测试</a><div class="blog-slider__text">Account Kit的官方demo测试与华为账户登录的功能实现分析。</div><a class="blog-slider__button" href="2025/05/14/AccountKitTest/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>