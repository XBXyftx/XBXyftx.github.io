<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>é¸¿æ˜“è®¯ | XBXyftx</title><meta name="author" content="XBXyftx"><meta name="copyright" content="XBXyftx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="é¸¿æ˜“è®¯ï¼Œé¸¿è’™æ–°é—»ä¸é¸¿è’™å¼€å‘é—®ç­”åŠ©æ‰‹åº”ç”¨ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="é¸¿æ˜“è®¯">
<meta property="og:url" content="https://xbxyftx.top/2025/11/18/HongYiXun/index.html">
<meta property="og:site_name" content="XBXyftx">
<meta property="og:description" content="é¸¿æ˜“è®¯ï¼Œé¸¿è’™æ–°é—»ä¸é¸¿è’™å¼€å‘é—®ç­”åŠ©æ‰‹åº”ç”¨ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xbxyftx.top/imgs/ArticleTopImgs/HongYiXunTopImg.png">
<meta property="article:published_time" content="2025-11-18T07:19:14.000Z">
<meta property="article:modified_time" content="2025-11-25T09:51:00.515Z">
<meta property="article:author" content="XBXyftx">
<meta property="article:tag" content="é¸¿è’™">
<meta property="article:tag" content="æŠ€æœ¯å‘">
<meta property="article:tag" content="V2">
<meta property="article:tag" content="é¡¹ç›®">
<meta property="article:tag" content="é¸¿æ˜“è®¯">
<meta property="article:tag" content="æ‰£å­">
<meta property="article:tag" content="æ™ºèƒ½ä½“">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xbxyftx.top/imgs/ArticleTopImgs/HongYiXunTopImg.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "é¸¿æ˜“è®¯",
  "url": "https://xbxyftx.top/2025/11/18/HongYiXun/",
  "image": "https://xbxyftx.top/imgs/ArticleTopImgs/HongYiXunTopImg.png",
  "datePublished": "2025-11-18T07:19:14.000Z",
  "dateModified": "2025-11-25T09:51:00.515Z",
  "author": [
    {
      "@type": "Person",
      "name": "XBXyftx",
      "url": "https://github.com/XBXyftx"
    }
  ]
}</script><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://xbxyftx.top/2025/11/18/HongYiXun/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="/css/typewriter-effect.css"><link rel="stylesheet" href="/css/entrance-popup.css"><link rel="stylesheet" href="/css/lazy-loading.css"><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":2000,"languages":{"author":"ä½œè€…: XBXyftx","link":"é“¾æ¥: ","source":"æ¥æº: XBXyftx","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡","cht_to_chs":"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡","day_to_night":"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: '/',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'é¸¿æ˜“è®¯',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post',
  typewriter: 'ğŸ¤–'
}</script><script src="/js/nyan.js"></script><script>localStorage.setItem('theme','dark')</script><script>document.documentElement.setAttribute('data-theme', 'dark');</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/transpancy.css"><script> // å¼ºåˆ¶é”å®šä¸ºæš—é»‘æ¨¡å¼ localStorage.setItem('theme', 'dark'); // é˜²æ­¢å…¶ä»–è„šæœ¬è¦†ç›–æ¨¡å¼ document.documentElement.setAttribute('data-theme', 'dark'); </script><link rel="stylesheet" href="/css/styles.css"><script> document.querySelectorAll('#post-comment').forEach(el => { el.style.backgroundColor = 'rgba(255, 255, 255, 0.6)'; }); </script><link rel="twikoo" href="/css/twikoo.css"><link rel="stylesheet" href="/css/rightmenu.css"><link rel="stylesheet" href="/css/sequential-loader.css"><script src="/js/sequential-loader-config.js"></script><script src="/js/sequential-image-loader.js" defer></script><script src="/js/sequential-integration.js" defer></script><script src="/js/custom-lightbox.js" defer></script><script src="/js/nyan.js"></script><script src="/js/header-universe.js"></script><!-- æ–°å¢ç¼“å­˜ç®¡ç†è„šæœ¬ - å·²ç¦ç”¨Service Worker--><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="cat__scene"><div class="cat__main"><div class="cat__body"></div><div class="cat__body"></div><div class="cat__tail"></div><div class="cat__head"></div></div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
      setTimeout(() => {
        $loadingBox.style.display = 'none'
      }, 800)
    },
    initLoading: () => {
      $loadingBox.style.display = 'flex'
      $loadingBox.classList.remove('loaded')
      $body.style.overflow = 'hidden'
    }
  }

  preloader.initLoading()
  
  // è®¾ç½®10ç§’è¶…æ—¶
  const loadingTimeout = setTimeout(() => {
    preloader.endLoading()
  }, 10000)
  
  window.addEventListener('load', () => {
    clearTimeout(loadingTimeout)
    preloader.endLoading()
  })

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(https://bu.dusays.com/2025/07/04/6867890f5d403.png);"></div><div class="entrance-popup" id="entrance-popup"><div class="popup-content"><div class="popup-header"><span class="popup-title">æ¸©é¦¨æç¤º</span><span class="popup-close">Ã—</span></div><div class="popup-body"><div class="popup-text"></div></div></div><div class="popup-overlay"></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-close-btn"><i class="fas fa-times"></i></div><div class="avatar-img text-center"><img src="/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> æ–‡åº“</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/coffer/"><i class="fa-fw fa-solid fa-key"></i><span> ç§˜å¯†åŸºåœ°</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-i"></i><span> Myself</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></li><li><a class="site-page child" href="/swiper/"><i class="fa-fw fa-solid fa-star-of-david"></i><span> æ˜¨æ—¥é‡ç°</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºæˆ‘</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-solid fa-comment"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/LianlianKan/"><i class="fa-fw fa-solid fa-gamepad"></i><span> è¿è¿çœ‹</span></a></div><div class="menus_item"><a class="site-page" href="/MarkdownPreview/"><i class="fa-fw fa-solid fa-file-code"></i><span> MDåœ¨çº¿ç¼–è¾‘å™¨</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/imgs/ArticleTopImgs/HongYiXunTopImg.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.png" alt="Logo"><span class="site-name">XBXyftx</span></a><a class="nav-page-title" href="/"><span class="site-name">é¸¿æ˜“è®¯</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> æ–‡åº“</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/coffer/"><i class="fa-fw fa-solid fa-key"></i><span> ç§˜å¯†åŸºåœ°</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-i"></i><span> Myself</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></li><li><a class="site-page child" href="/swiper/"><i class="fa-fw fa-solid fa-star-of-david"></i><span> æ˜¨æ—¥é‡ç°</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºæˆ‘</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-solid fa-comment"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/LianlianKan/"><i class="fa-fw fa-solid fa-gamepad"></i><span> è¿è¿çœ‹</span></a></div><div class="menus_item"><a class="site-page" href="/MarkdownPreview/"><i class="fa-fw fa-solid fa-file-code"></i><span> MDåœ¨çº¿ç¼–è¾‘å™¨</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">é¸¿æ˜“è®¯</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-11-18T07:19:14.000Z" title="å‘è¡¨äº 2025-11-18 15:19:14">2025-11-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-11-25T09:51:00.515Z" title="æ›´æ–°äº 2025-11-25 17:51:00">2025-11-25</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">20.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>80åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:100,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-11-25 17:51:00&quot;}" hidden></div><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å®Œæˆäº†é¸¿å°æ˜“ä»¥åŠNowInOpenHarmonyè¿™ä¸¤ä¸ªé¡¹ç›®çš„å¼€å‘ä¹‹åæˆ‘ä»¬ï¼Œå­å®‰å­¦é•¿å°†æˆ‘å¼•èç»™äº†é™ˆè‹¥æ„šè€å¸ˆï¼Œé™ˆè€å¸ˆè”ç³»åˆ°ä¸­è½¯å›½é™…ï¼Œæƒ³è¦è®©æˆ‘ä»¬å»å¼€å‘åº”ç”¨å¹¶ååŠ©æˆ‘ä»¬å°†åº”ç”¨ä¸Šæ¶ï¼Œè¿™å¯¹äºæˆ‘æ¥è¯´å¯è°“æ˜¯åƒè½½éš¾é€¢çš„æœºä¼šäº†ï¼Œæ¯•ç«Ÿæˆ‘ä¸€ç›´æ¸´æœ›èƒ½çœŸæ­£ä¸Šæ¶ä¸€ä¸ªåº”ç”¨ï¼Œä½†ä¸€è‡´è¢«åç«¯æœåŠ¡å™¨ï¼Œå¤‡æ¡ˆï¼Œèµ„è´¨ï¼Œå†…å®¹è¿‡äºç®€å•ç­‰ç­‰ä¸€ç³»åˆ—çš„é—®é¢˜æ‰€å¡ä½ï¼Œè¿™æ¬¡æœ‰äº†ä¸­è½¯çš„ååŠ©æˆ‘ä»¬åº”è¯¥å°±èƒ½æ›´åŠ ä¸“æ³¨äºå¼€å‘äº†ã€‚</p>
<p>è€Œä¸”è¿™ä¸€æ¬¡ï¼Œæˆ‘ä¸å†æ˜¯ç‹¬ç«‹å¼€å‘ï¼Œè€Œæ˜¯æœ‰äº†å­™å¦ˆä»¥åŠbqfï¼Œzxjcï¼Œhyxçš„åä½œï¼Œäº”ä¸ªäººçš„åŠ›é‡ï¼Œå†åŠ ä¸ŠCodexï¼ŒClaude Codeçš„ååŠ©æˆ‘ç›¸ä¿¡æˆ‘ä»¬ä¸€å®šèƒ½æˆåŠŸä¸Šæ¶çš„ã€‚</p>
<h2 id="é€‰é¢˜"><a href="#é€‰é¢˜" class="headerlink" title="é€‰é¢˜"></a>é€‰é¢˜</h2><p>ä¸­è½¯çš„è€å¸ˆç¡®å®æ˜¯ç»™äº†æˆ‘ä»¬å¾ˆå¤šå¯é€‰çš„é€‰é¢˜ï¼Œéƒ½æ˜¯å¾ˆæ ‡å‡†çš„ä¸¤ä¸ªä¸»åŠŸèƒ½çš„å°åº”ç”¨ï¼Œå¾ˆè½»é‡åŒ–ï¼Œä½†ä¹Ÿç¡®å®æ˜¯æ²¡ä»€ä¹ˆå®é™…ç”¨é€”åšå‡ºæ¥ä¹Ÿåªæ˜¯åœ¨åº”ç”¨å¸‚åœºä¸Šå……æ•°ç½¢äº†ï¼Œæ‰€ä»¥ä¸å¦‚è¯´æ˜¯å»åœ†ä¸€ä¸‹ä¹‹å‰çš„æ¢¦ï¼ŒæŠŠé¸¿å°æ˜“å’ŒNowInOpenHarmonyè¿™ä¸¤ä¸ªåº”ç”¨ç»™èåˆä¸ºä¸€ä¸ªæ–°åº”ç”¨ï¼Œäºæ˜¯â€œé¸¿æ˜“è®¯â€è¯ç”Ÿäº†ã€‚</p>
<h3 id="æ ¸å¿ƒåŠŸèƒ½"><a href="#æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½"></a>æ ¸å¿ƒåŠŸèƒ½</h3><div class="table-container">
<table>
<thead>
<tr>
<th>åŠŸèƒ½å±‚çº§</th>
<th>åŠŸèƒ½åç§°</th>
<th>å­åŠŸèƒ½/å…·ä½“å†…å®¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ä¸€çº§åŠŸèƒ½</strong></td>
<td>é¸¿è’™æ–°é—»èµ„è®¯</td>
<td>äºŒçº§åŠŸèƒ½1ï¼šé¸¿è’™æ–°é—»</td>
<td>å±•ç¤ºé¸¿è’™ç³»ç»Ÿç›¸å…³çš„æœ€æ–°è¡Œä¸šæ–°é—»ã€å®˜æ–¹åŠ¨æ€ã€æŠ€æœ¯æ›´æ–°ç­‰å†…å®¹</td>
</tr>
<tr>
<td></td>
<td></td>
<td>äºŒçº§åŠŸèƒ½2ï¼šå¼€æºé¸¿è’™æ–°é—»</td>
<td>èšç„¦å¼€æºé¸¿è’™é¡¹ç›®çš„è¿›å±•ã€ç¤¾åŒºåŠ¨æ€ã€ä»£ç æäº¤ã€å¼€æºåˆä½œç­‰ä¿¡æ¯</td>
</tr>
<tr>
<td><strong>ä¸€çº§åŠŸèƒ½</strong></td>
<td>é¸¿è’™æ™ºèƒ½é—®ç­”AIåŠ©æ‰‹</td>
<td>äºŒçº§åŠŸèƒ½1ï¼šå¿«é€Ÿé—®ç­”æ¨¡å¼</td>
<td>é’ˆå¯¹é¸¿è’™å¼€å‘ç›¸å…³çš„åŸºç¡€é—®é¢˜ã€å¸¸è§ç–‘é—®ï¼Œæä¾›å¿«é€Ÿç²¾å‡†çš„è§£ç­”</td>
</tr>
<tr>
<td></td>
<td></td>
<td>äºŒçº§åŠŸèƒ½2ï¼šDeepResearchæ¨¡å¼</td>
<td>é’ˆå¯¹å¤æ‚çš„é¸¿è’™å¼€å‘æŠ€æœ¯éš¾é¢˜ã€æ·±åº¦ç ”ç©¶éœ€æ±‚ï¼Œè¿›è¡Œå¤šç»´åº¦åˆ†æä¸è¯¦ç»†è§£ç­”</td>
</tr>
<tr>
<td><strong>ä¸€çº§åŠŸèƒ½</strong></td>
<td>è®¾ç½®</td>
<td>éšç§æ”¿ç­–</td>
<td>å±•ç¤ºåº”ç”¨æ•°æ®æ”¶é›†ã€ä½¿ç”¨ã€å­˜å‚¨åŠä¿æŠ¤ç›¸å…³çš„éšç§æ¡æ¬¾å†…å®¹</td>
</tr>
<tr>
<td></td>
<td></td>
<td>ç‰ˆæœ¬å·</td>
<td>æ˜¾ç¤ºå½“å‰åº”ç”¨çš„ç‰ˆæœ¬ä¿¡æ¯ï¼ˆç¤ºä¾‹ï¼šV1.0.0ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<h2 id="æ ¸å¿ƒé—®é¢˜è®°å½•"><a href="#æ ¸å¿ƒé—®é¢˜è®°å½•" class="headerlink" title="æ ¸å¿ƒé—®é¢˜è®°å½•"></a>æ ¸å¿ƒé—®é¢˜è®°å½•</h2><p>è¿™ä¸€æ¬¡æˆ‘ä¸å‡†å¤‡å†åƒè¿‡å»ä¸€æ ·äº‹æ— å·¨ç»†çš„å»è®°å½•å…¨éƒ¨æµç¨‹ï¼Œè€Œæ˜¯åªå»åˆ†æè®°å½•æ ¸å¿ƒé—®é¢˜çš„è§£å†³æ–¹æ¡ˆä»¥åŠä¸€äº›è¯•é”™æ–¹æ¡ˆï¼Œå¹¶ä¸”å¯¹äºAIç”Ÿæˆçš„ä»£ç å»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„è§£è¯»ã€‚</p>
<h3 id="AppInit"><a href="#AppInit" class="headerlink" title="AppInit"></a>AppInit</h3><p>åœ¨æˆ‘å¼€å‘NowInOpenHarmonyçš„æ—¶å€™ï¼Œæˆ‘å‚è€ƒå­å®‰å­¦é•¿æ›¾ç»é¡¹ç›®ä¸­çš„æ¨¡å¼ï¼Œå°†å…¨éƒ¨éœ€è¦è¿›è¡Œåˆå§‹åŒ–çš„æ¨¡å—åŠŸèƒ½ç»Ÿä¸€å°è£…åˆ°äº†Productæ¨¡å—çš„AppInitç±»ä¸­ï¼Œè¿™ä¹Ÿæ˜¯å¯ä»¥é’ˆå¯¹äºä¸åŒå½¢æ€çš„è®¾å¤‡é…ç½®ä¸åŒçš„AppInitæµç¨‹ã€‚è¿™ä¸€å—æˆ‘æ­¤å‰å¹¶æ²¡æœ‰å¾ˆå¤šå®è·µç»éªŒï¼Œå¯¹äºå…·ä½“çš„åˆå§‹åŒ–æµç¨‹è§„åˆ’ä»¥åŠæ—¥å¿—çš„æ‰“å°æ ¼å¼éƒ½æ˜¯ä»¥å®ç”¨ä¸»ä¹‰çš„æ¨¡å¼å»è¿›è¡Œç¼–å†™çš„ï¼Œä¸€åˆ‡ä»¥èƒ½æ’æŸ¥å‡ºBugä¸ºç›®æ ‡ï¼Œå°±æ²¡æœ‰å¾ˆè§„èŒƒã€‚æ‰€ä»¥æˆ‘å†³å®šè¦ç”¨AIå»å¸®æˆ‘è¿›è¡Œä¸€ä¸‹é‡æ„ã€‚</p>
<p>åœ¨æ­¤å‰çš„ç»éªŒä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“Claudeå¯¹äºArkTSçš„å¼€å‘æœ‰ä¸€å®šçš„åŸºç¡€è®¤çŸ¥ä½†æ˜¯å¯¹äºæ¥å£çš„ç‰ˆæœ¬ä»¥åŠTSäºArkTSçš„è¯­æ³•ä¸´ç•ŒåŒºæ²¡æœ‰å¾ˆå¥½çš„æŠŠæ¡ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©ä½¿ç”¨è¯¦å°½çš„æè¿°ä»¥åŠåœ¨ç°æœ‰ä»£ç ç»“æ„ä¸Šä¸¾ä¾‹è¯´æ˜çš„å½¢å¼ï¼Œæ¥è®©ClaudeæŠŠå…¶ä»–åº”ç”¨å¼€å‘ä¸­çš„é€šè¯†æ€§ç»éªŒè¿ç§»åˆ°æˆ‘çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä¹Ÿå¯ä»¥è¶æœºå­¦ä¹ ä¸€ä¸‹å¯¹äºå¤šPromiseçš„ç®¡ç†ä»¥åŠå¯¹äºæ—¥å¿—çš„æ ¼å¼åŒ–è¾“å‡ºã€‚</p>
<p>é¦–å…ˆæˆ‘å…ˆæ”¾ä¸€ä¸‹åœ¨NowInOpenHarmonyä¸­AppInitçš„ä»£ç ä½œä¸ºå¯¹æ¯”ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2025 XBXyftx</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">GET_USER_CONFIG</span>, logger, preferenceDB, <span class="title class_">UserConfigViewModel</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.AbilityKit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span>, promptAction &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; colorModManager, newsManager, userConfigManager &#125; <span class="keyword">from</span> <span class="string">&quot;feature&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; lvCode, lvText &#125; <span class="keyword">from</span> <span class="string">&quot;@luvi/lv-markdown-in&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AppInit</span>_LOG_TAG = <span class="string">&#x27;AppInit: &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åº”ç”¨åˆå§‹åŒ–æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppInit</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç”¨æˆ·é…ç½®é¡¹åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">configInit</span>(<span class="params"><span class="attr">context</span>: common.<span class="title class_">UIAbilityContext</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">isPreferenceDBInitSuccess</span>: <span class="built_in">boolean</span> = preferenceDB.<span class="title function_">init</span>(context)</span><br><span class="line">    <span class="keyword">if</span> (isPreferenceDBInitSuccess) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>é¦–é€‰é¡¹æ•°æ®å¯¹è±¡åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">      <span class="keyword">if</span> (userConfigManager.<span class="title function_">syncDataToAppStorage</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      promptAction.<span class="title function_">openToast</span>(&#123; <span class="attr">message</span>: <span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>é¦–é€‰é¡¹æ•°æ®å¯¹è±¡åˆå§‹åŒ–é”™è¯¯`</span> &#125;)</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>é¦–é€‰é¡¹æ•°æ®å¯¹è±¡åˆå§‹åŒ–é”™è¯¯`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">initAll</span>(<span class="params"><span class="attr">uiAbilityContext</span>: common.<span class="title class_">UIAbilityContext</span>, <span class="attr">applicationContext</span>: common.<span class="title class_">ApplicationContext</span></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> newsManager.<span class="title function_">init</span>(uiAbilityContext)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">configInit</span>(uiAbilityContext)</span><br><span class="line">    colorModManager.<span class="title function_">init</span>(applicationContext)</span><br><span class="line">    <span class="keyword">await</span> newsManager.<span class="title function_">updateNewsListToDB</span>()</span><br><span class="line">    <span class="keyword">await</span> newsManager.<span class="title function_">updateNewsSwiperToDB</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">markDownConfigInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> baseFontSize =</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">GET_USER_CONFIG</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>())!.<span class="property">fontSize</span></span><br><span class="line">    lvCode.<span class="title function_">setIndexState</span>(<span class="literal">true</span>)</span><br><span class="line">    lvText.<span class="title function_">setTextSize</span>(baseFontSize)</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;AppInit_LOG_TAG&#125;</span>Markdownåˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> appInit = <span class="keyword">new</span> <span class="title class_">AppInit</span>()</span><br></pre></td></tr></table></figure>
<p>æˆ‘åŸæœ¬çš„æ‰‹æ“ç‰ˆæœ¬åªæ˜¯åœ¨ä¸€ä½çš„æ»¥ç”¨awaitå»è¿›è¡Œå¼‚æ­¥çš„å¤„ç†ï¼Œå¹¶æ²¡ç”¨åˆ°å¾ˆå¤šPromiseåŸç”Ÿçš„å¯¹äºå¤šå¼‚æ­¥ä»»åŠ¡çš„ç®¡ç†æ–¹æ³•ã€‚</p>
<p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Claudeç»™å‡ºçš„ç‰ˆæœ¬ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2025 XBXyftx</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="variable constant_">APP_STORAGE_KEYS</span>, logger, preferenceDB, <span class="title class_">UserConfigViewModel</span>, <span class="variable constant_">LOG_TAG</span>, kvDatabase</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;common&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.AbilityKit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; colorModManager, newsManager, userConfigManager &#125; <span class="keyword">from</span> <span class="string">&quot;feature&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span>, promptAction &#125; <span class="keyword">from</span> <span class="string">&quot;@kit.ArkUI&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; lvCode, lvText &#125; <span class="keyword">from</span> <span class="string">&quot;@luvi/lv-markdown-in&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">InitStatus</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../modules/AppInit/InitStatus&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åº”ç”¨åˆå§‹åŒ–ç®¡ç†ç±»</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * è´Ÿè´£ç®¡ç†åº”ç”¨å¯åŠ¨æ—¶å„ä¸ªæ¨¡å—çš„åˆå§‹åŒ–æµç¨‹ï¼Œé‡‡ç”¨åˆ†é˜¶æ®µåˆå§‹åŒ–ç­–ç•¥</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–é˜¶æ®µè®¾è®¡ï¼š</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * **é˜¶æ®µ 1 - åŸºç¡€æ¨¡å—åˆå§‹åŒ–ï¼ˆonCreateï¼‰**</span></span><br><span class="line"><span class="comment"> * - æ•°æ®åº“åˆå§‹åŒ–ï¼šKVDatabaseã€PreferenceDB</span></span><br><span class="line"><span class="comment"> * - ç”¨æˆ·é…ç½®åŠ è½½ï¼šä»æŒä¹…åŒ–å­˜å‚¨æ¢å¤é…ç½®</span></span><br><span class="line"><span class="comment"> * - ä¸šåŠ¡ç®¡ç†å™¨åˆå§‹åŒ–ï¼šNewsManager ç­‰</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * **é˜¶æ®µ 2 - çª—å£ç›¸å…³åˆå§‹åŒ–ï¼ˆonWindowStageCreateï¼‰**</span></span><br><span class="line"><span class="comment"> * - AppStorageV2 åˆå§‹åŒ–ï¼šçª—å£å®½åº¦ç­‰å…¨å±€çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * - ä¸»é¢˜ç®¡ç†å™¨åˆå§‹åŒ–ï¼šColorModManagerï¼ˆä¾èµ– ApplicationContextï¼‰</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * **é˜¶æ®µ 3 - UI ä¾èµ–åˆå§‹åŒ–ï¼ˆé¡µé¢åŠ è½½åï¼‰**</span></span><br><span class="line"><span class="comment"> * - Markdown é…ç½®ï¼šä¾èµ– AppStorageV2 ä¸­çš„ç”¨æˆ·é…ç½®</span></span><br><span class="line"><span class="comment"> * - å…¶ä»– UI ç›¸å…³é…ç½®</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–é¡ºåºçš„é‡è¦æ€§ï¼š</span></span><br><span class="line"><span class="comment"> * - AppStorageV2 å¿…é¡»åœ¨ Window åˆ›å»ºåæ‰èƒ½ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> * - ç”¨æˆ·é…ç½®éœ€è¦å…ˆä» PreferenceDB åŠ è½½å†åŒæ­¥åˆ° AppStorageV2</span></span><br><span class="line"><span class="comment"> * - Markdown é…ç½®ä¾èµ– AppStorageV2 ä¸­çš„å­—ä½“å¤§å°è®¾ç½®</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * ```typescript</span></span><br><span class="line"><span class="comment"> * // åœ¨ EntryAbility ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> * class EntryAbility extends UIAbility &#123;</span></span><br><span class="line"><span class="comment"> *   // é˜¶æ®µ 1ï¼šåŸºç¡€åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> *   onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void &#123;</span></span><br><span class="line"><span class="comment"> *     appInit.initPhase1_BaseModules(this.context)</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *   // é˜¶æ®µ 2ï¼šçª—å£åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> *   onWindowStageCreate(windowStage: window.WindowStage): void &#123;</span></span><br><span class="line"><span class="comment"> *     appInit.initPhase2_WindowRelated(this.context.getApplicationContext())</span></span><br><span class="line"><span class="comment"> *     </span></span><br><span class="line"><span class="comment"> *     windowStage.loadContent(&#x27;pages/StartPage&#x27;, (err) =&gt; &#123;</span></span><br><span class="line"><span class="comment"> *       if (!err.code) &#123;</span></span><br><span class="line"><span class="comment"> *         // é˜¶æ®µ 3ï¼šUI ä¾èµ–åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> *         appInit.initPhase3_UIDependent()</span></span><br><span class="line"><span class="comment"> *       &#125;</span></span><br><span class="line"><span class="comment"> *     &#125;)</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> * ```</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> EntryAbility åº”ç”¨å…¥å£ï¼Œåè°ƒåˆå§‹åŒ–æµç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppInit</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–çŠ¶æ€è¿½è¸ª</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * è®°å½•å„ä¸ªæ¨¡å—çš„åˆå§‹åŒ–çŠ¶æ€ï¼Œä¾¿äºè°ƒè¯•å’Œé”™è¯¯å®šä½</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">initStatus</span>: <span class="title class_">InitStatus</span> = &#123;</span><br><span class="line">    <span class="attr">databases</span>: <span class="literal">false</span>,        <span class="comment">// æ•°æ®åº“åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line">    <span class="attr">userConfig</span>: <span class="literal">false</span>,       <span class="comment">// ç”¨æˆ·é…ç½®åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line">    <span class="attr">managers</span>: <span class="literal">false</span>,         <span class="comment">// ç®¡ç†å™¨åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line">    <span class="attr">appStorageV2</span>: <span class="literal">false</span>,     <span class="comment">// AppStorageV2 åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line">    <span class="attr">markdown</span>: <span class="literal">false</span>          <span class="comment">// Markdown åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ==================== é˜¶æ®µ 1ï¼šåŸºç¡€æ¨¡å—åˆå§‹åŒ– ====================</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é˜¶æ®µ 1ï¼šåŸºç¡€æ¨¡å—åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åœ¨ EntryAbility.onCreate() ä¸­è°ƒç”¨ï¼Œåˆå§‹åŒ–ä¸ä¾èµ–çª—å£çš„åŸºç¡€æ¨¡å—</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">uiAbilityContext</span> - UIAbility ä¸Šä¸‹æ–‡å¯¹è±¡</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> Promise&lt;boolean&gt; - åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment">   * 1. æ•°æ®åº“æ¨¡å—ï¼ˆKVæ•°æ®åº“ã€åå¥½è®¾ç½®æ•°æ®åº“ï¼‰</span></span><br><span class="line"><span class="comment">   * 2. ç”¨æˆ·é…ç½®åŠ è½½ï¼ˆä»æŒä¹…åŒ–å­˜å‚¨æ¢å¤ï¼‰</span></span><br><span class="line"><span class="comment">   * 3. ä¸šåŠ¡ç®¡ç†å™¨ï¼ˆæ–°é—»ç®¡ç†å™¨ç­‰ï¼‰</span></span><br><span class="line"><span class="comment">   * 4. æ•°æ®é¢„åŠ è½½ï¼ˆæ–°é—»åˆ—è¡¨ã€è½®æ’­å›¾ï¼‰</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * è°ƒç”¨æ—¶æœºï¼š</span></span><br><span class="line"><span class="comment">   * - åº”ç”¨å¯åŠ¨çš„æœ€æ—©é˜¶æ®µ</span></span><br><span class="line"><span class="comment">   * - åœ¨åˆ›å»ºçª—å£ä¹‹å‰</span></span><br><span class="line"><span class="comment">   * - åœ¨è®¿é—® UI ä¹‹å‰</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * æ³¨æ„äº‹é¡¹ï¼š</span></span><br><span class="line"><span class="comment">   * - æ­¤é˜¶æ®µä¸èƒ½è®¿é—® AppStorageV2</span></span><br><span class="line"><span class="comment">   * - ä¸èƒ½è¿›è¡Œ UI æ“ä½œ</span></span><br><span class="line"><span class="comment">   * - åº”å°½å¿«å®Œæˆï¼Œé¿å…é˜»å¡å¯åŠ¨</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment">   * ```typescript</span></span><br><span class="line"><span class="comment">   * onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void &#123;</span></span><br><span class="line"><span class="comment">   *   appInit.initPhase1_BaseModules(this.context).then(success =&gt; &#123;</span></span><br><span class="line"><span class="comment">   *     if (success) &#123;</span></span><br><span class="line"><span class="comment">   *       logger.info(&#x27;åŸºç¡€æ¨¡å—åˆå§‹åŒ–æˆåŠŸ&#x27;)</span></span><br><span class="line"><span class="comment">   *     &#125; else &#123;</span></span><br><span class="line"><span class="comment">   *       logger.error(&#x27;åŸºç¡€æ¨¡å—åˆå§‹åŒ–å¤±è´¥ï¼Œåº”ç”¨å¯èƒ½æ— æ³•æ­£å¸¸è¿è¡Œ&#x27;)</span></span><br><span class="line"><span class="comment">   *     &#125;</span></span><br><span class="line"><span class="comment">   *   &#125;)</span></span><br><span class="line"><span class="comment">   * &#125;</span></span><br><span class="line"><span class="comment">   * ```</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">initPhase1_BaseModules</span>(<span class="attr">uiAbilityContext</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>========== å¼€å§‹é˜¶æ®µ 1ï¼šåŸºç¡€æ¨¡å—åˆå§‹åŒ– ==========`</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// æ­¥éª¤ 1ï¼šåˆå§‹åŒ–æ•°æ®åº“</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>æ­¥éª¤ 1/4ï¼šåˆå§‹åŒ–æ•°æ®åº“æ¨¡å—...`</span>)</span><br><span class="line">      <span class="keyword">const</span> dbInitSuccess = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">initDatabases</span>(uiAbilityContext)</span><br><span class="line">      <span class="keyword">if</span> (!dbInitSuccess) &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥ï¼Œç»ˆæ­¢åˆå§‹åŒ–æµç¨‹ - è¯·æ£€æŸ¥åº”ç”¨æƒé™å’Œå­˜å‚¨ç©ºé—´`</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ­¥éª¤ 2ï¼šåŠ è½½ç”¨æˆ·é…ç½®</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>æ­¥éª¤ 2/4ï¼šåŠ è½½ç”¨æˆ·é…ç½®...`</span>)</span><br><span class="line">      <span class="keyword">const</span> configInitSuccess = <span class="variable language_">this</span>.<span class="title function_">initUserConfig</span>(uiAbilityContext)</span><br><span class="line">      <span class="keyword">if</span> (!configInitSuccess) &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>ç”¨æˆ·é…ç½®åˆå§‹åŒ–å¤±è´¥ï¼Œå°†ä½¿ç”¨é»˜è®¤é…ç½®`</span>)</span><br><span class="line">        <span class="comment">// é…ç½®åŠ è½½å¤±è´¥ä¸å½±å“åº”ç”¨è¿è¡Œï¼Œç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ­¥éª¤ 3ï¼šåˆå§‹åŒ–ä¸šåŠ¡ç®¡ç†å™¨</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>æ­¥éª¤ 3/4ï¼šåˆå§‹åŒ–ä¸šåŠ¡ç®¡ç†å™¨...`</span>)</span><br><span class="line">      <span class="keyword">const</span> managersInitSuccess = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">initManagers</span>(uiAbilityContext)</span><br><span class="line">      <span class="keyword">if</span> (!managersInitSuccess) &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥ - åº”ç”¨å¯ç»§ç»­è¿è¡Œä½†æ–°é—»åŠŸèƒ½ä¸å¯ç”¨`</span>)</span><br><span class="line">        <span class="comment">// ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥ä¸ç»ˆæ­¢æµç¨‹ï¼Œå…è®¸åº”ç”¨ç»§ç»­å¯åŠ¨</span></span><br><span class="line">        <span class="comment">// return false</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ­¥éª¤ 4ï¼šé¢„åŠ è½½æ•°æ®</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>æ­¥éª¤ 4/4ï¼šé¢„åŠ è½½åº”ç”¨æ•°æ®...`</span>)</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">preloadData</span>()</span><br><span class="line">      </span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>========== é˜¶æ®µ 1 å®Œæˆï¼šåŸºç¡€æ¨¡å—åˆå§‹åŒ–æˆåŠŸ ==========`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      </span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— é˜¶æ®µ 1 åˆå§‹åŒ–å¼‚å¸¸ - è¯¦ç»†ä¿¡æ¯ï¼š<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">      promptAction.<span class="title function_">openToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·é‡å¯åº”ç”¨&#x27;</span> &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–æ•°æ®åº“æ¨¡å—</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ– KV æ•°æ®åº“å’Œåå¥½è®¾ç½®æ•°æ®åº“</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">context</span> - UIAbility ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> Promise&lt;boolean&gt; - æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–é¡ºåºï¼š</span></span><br><span class="line"><span class="comment">   * 1. KV æ•°æ®åº“ï¼šç”¨äºç¼“å­˜ä¸šåŠ¡æ•°æ®ï¼ˆæ–°é—»åˆ—è¡¨ç­‰ï¼‰</span></span><br><span class="line"><span class="comment">   * 2. åå¥½è®¾ç½®æ•°æ®åº“ï¼šç”¨äºå­˜å‚¨ç”¨æˆ·é…ç½®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * å¤±è´¥å¤„ç†ï¼š</span></span><br><span class="line"><span class="comment">   * - KV æ•°æ®åº“å¤±è´¥ï¼šå¯èƒ½å½±å“ç¦»çº¿åŠŸèƒ½</span></span><br><span class="line"><span class="comment">   * - åå¥½è®¾ç½®å¤±è´¥ï¼šä¼šä½¿ç”¨é»˜è®¤é…ç½®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">initDatabases</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– KV æ•°æ®åº“</span></span><br><span class="line">    <span class="keyword">const</span> kvInitSuccess = kvDatabase.<span class="title function_">init</span>(context)</span><br><span class="line">    <span class="keyword">if</span> (kvInitSuccess) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ“ KV æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">databases</span> = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— KV æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥ - åŸå› ï¼šKVManager åˆ›å»ºå¤±è´¥æˆ– context æ— æ•ˆ`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–åå¥½è®¾ç½®æ•°æ®åº“</span></span><br><span class="line">    <span class="keyword">const</span> preferenceInitSuccess = preferenceDB.<span class="title function_">init</span>(context)</span><br><span class="line">    <span class="keyword">if</span> (preferenceInitSuccess) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ“ åå¥½è®¾ç½®æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— åå¥½è®¾ç½®æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥ - åŸå› ï¼šPreferences å®ä¾‹åˆ›å»ºå¤±è´¥`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–ç”¨æˆ·é…ç½®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * ä»åå¥½è®¾ç½®æ•°æ®åº“åŠ è½½ç”¨æˆ·é…ç½®ï¼Œæ¢å¤ç”¨æˆ·çš„ä¸ªæ€§åŒ–è®¾ç½®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">context</span> - UIAbility ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> <span class="variable">boolean</span> - æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * é…ç½®å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment">   * - å­—ä½“å¤§å°ï¼ˆFONT_SIZEï¼‰</span></span><br><span class="line"><span class="comment">   * - é¢œè‰²æ¨¡å¼ï¼ˆCOLOR_MODEï¼‰</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * æ•°æ®æµï¼š</span></span><br><span class="line"><span class="comment">   * PreferenceDB â†’ UserConfigManager â†’ å†…å­˜çŠ¶æ€</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * æ³¨æ„ï¼šæ­¤é˜¶æ®µè¿˜ä¸èƒ½åŒæ­¥åˆ° AppStorageV2ï¼Œå› ä¸ºçª—å£è¿˜æœªåˆ›å»º</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">initUserConfig</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> syncSuccess = userConfigManager.<span class="title function_">syncDataToAppStorage</span>()</span><br><span class="line">      <span class="keyword">if</span> (syncSuccess) &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ“ ç”¨æˆ·é…ç½®åŠ è½½æˆåŠŸ`</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">userConfig</span> = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âš  ç”¨æˆ·é…ç½®åŠ è½½å¤±è´¥ - åŸå› ï¼šPreferenceDB æ•°æ®è¯»å–å¤±è´¥ï¼Œå°†ä½¿ç”¨é»˜è®¤é…ç½®`</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— ç”¨æˆ·é…ç½®åŠ è½½å¼‚å¸¸ - åŸå› ï¼š<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–ä¸šåŠ¡ç®¡ç†å™¨</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–å„ä¸ªä¸šåŠ¡æ¨¡å—çš„ç®¡ç†å™¨</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">context</span> - UIAbility ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> Promise&lt;boolean&gt; - æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * ç®¡ç†å™¨åˆ—è¡¨ï¼š</span></span><br><span class="line"><span class="comment">   * - NewsManagerï¼šæ–°é—»æ•°æ®ç®¡ç†</span></span><br><span class="line"><span class="comment">   * - å…¶ä»–ä¸šåŠ¡ç®¡ç†å™¨...</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * æ³¨æ„ï¼šColorModManager ä¾èµ– ApplicationContextï¼Œåœ¨é˜¶æ®µ 2 åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">initManagers</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// åˆå§‹åŒ–æ–°é—»ç®¡ç†å™¨</span></span><br><span class="line">      <span class="keyword">const</span> newsManagerInitSuccess = <span class="keyword">await</span> newsManager.<span class="title function_">init</span>(context)</span><br><span class="line">      <span class="keyword">if</span> (newsManagerInitSuccess) &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ“ æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">managers</span> = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥ - åŸå› ï¼šæ— æ³•è·å– KV æ•°æ®åº“å®ä¾‹`</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— ç®¡ç†å™¨åˆå§‹åŒ–å¼‚å¸¸ - åŸå› ï¼š<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é¢„åŠ è½½åº”ç”¨æ•°æ®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åœ¨åå°é¢„åŠ è½½å¿…è¦çš„æ•°æ®ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * é¢„åŠ è½½ç­–ç•¥ï¼š</span></span><br><span class="line"><span class="comment">   * - å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»æµç¨‹</span></span><br><span class="line"><span class="comment">   * - å¤±è´¥ä¸å½±å“åº”ç”¨å¯åŠ¨</span></span><br><span class="line"><span class="comment">   * - ä¼˜å…ˆåŠ è½½ç”¨æˆ·å¯èƒ½ç«‹å³éœ€è¦çš„æ•°æ®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * é¢„åŠ è½½å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment">   * - æ–°é—»æ–‡ç« åˆ—è¡¨</span></span><br><span class="line"><span class="comment">   * - è½®æ’­å›¾æ•°æ®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">preloadData</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// å¼‚æ­¥æ›´æ–°æ–°é—»æ•°æ®ï¼Œä¸é˜»å¡å¯åŠ¨æµç¨‹</span></span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">        newsManager.<span class="title function_">updateNewsListToDB</span>(),</span><br><span class="line">        newsManager.<span class="title function_">updateNewsSwiperToDB</span>()</span><br><span class="line">      ]).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>æ•°æ®é¢„åŠ è½½å®Œæˆ`</span>)</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">Error</span></span>) =&gt;</span> &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>æ•°æ®é¢„åŠ è½½å¤±è´¥: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>ï¼Œå°†ä½¿ç”¨ç¼“å­˜æ•°æ®`</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>æ•°æ®é¢„åŠ è½½å¼‚å¸¸: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ==================== é˜¶æ®µ 2ï¼šçª—å£ç›¸å…³åˆå§‹åŒ– ====================</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é˜¶æ®µ 2ï¼šçª—å£ç›¸å…³åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åœ¨ EntryAbility.onWindowStageCreate() ä¸­è°ƒç”¨ï¼Œåˆå§‹åŒ–ä¾èµ–çª—å£çš„æ¨¡å—</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">applicationContext</span> - åº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> <span class="variable">boolean</span> - åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment">   * 1. é¢œè‰²æ¨¡å¼ç®¡ç†å™¨ï¼ˆéœ€è¦ ApplicationContext æ¥è®¾ç½®ç³»ç»Ÿä¸»é¢˜ï¼‰</span></span><br><span class="line"><span class="comment">   * 2. å…¶ä»–ä¾èµ–çª—å£çš„åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * è°ƒç”¨æ—¶æœºï¼š</span></span><br><span class="line"><span class="comment">   * - åœ¨çª—å£åˆ›å»ºå</span></span><br><span class="line"><span class="comment">   * - åœ¨åŠ è½½é¡µé¢ä¹‹å‰</span></span><br><span class="line"><span class="comment">   * - AppStorageV2 å¯ç”¨ä¹‹å</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * å‰ç½®æ¡ä»¶ï¼š</span></span><br><span class="line"><span class="comment">   * - é˜¶æ®µ 1 å¿…é¡»æˆåŠŸå®Œæˆ</span></span><br><span class="line"><span class="comment">   * - Window å¯¹è±¡å·²åˆ›å»º</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment">   * ```typescript</span></span><br><span class="line"><span class="comment">   * onWindowStageCreate(windowStage: window.WindowStage): void &#123;</span></span><br><span class="line"><span class="comment">   *   // åˆå§‹åŒ–çª—å£ç›¸å…³æ¨¡å—</span></span><br><span class="line"><span class="comment">   *   appInit.initPhase2_WindowRelated(this.context.getApplicationContext())</span></span><br><span class="line"><span class="comment">   *   </span></span><br><span class="line"><span class="comment">   *   // åŠ è½½é¡µé¢</span></span><br><span class="line"><span class="comment">   *   windowStage.loadContent(&#x27;pages/StartPage&#x27;, ...)</span></span><br><span class="line"><span class="comment">   * &#125;</span></span><br><span class="line"><span class="comment">   * ```</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initPhase2_WindowRelated</span>(<span class="attr">applicationContext</span>: common.<span class="property">ApplicationContext</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>========== å¼€å§‹é˜¶æ®µ 2ï¼šçª—å£ç›¸å…³åˆå§‹åŒ– ==========`</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// åˆå§‹åŒ–é¢œè‰²æ¨¡å¼ç®¡ç†å™¨</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>åˆå§‹åŒ–é¢œè‰²æ¨¡å¼ç®¡ç†å™¨...`</span>)</span><br><span class="line">      <span class="keyword">const</span> colorModInitSuccess = colorModManager.<span class="title function_">init</span>(applicationContext)</span><br><span class="line">      <span class="keyword">if</span> (colorModInitSuccess) &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ“ é¢œè‰²æ¨¡å¼ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">appStorageV2</span> = <span class="literal">true</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âš  é¢œè‰²æ¨¡å¼ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥ - åŸå› ï¼šApplicationContext æ— æ•ˆï¼Œå°†ä½¿ç”¨é»˜è®¤ä¸»é¢˜`</span>)</span><br><span class="line">        <span class="comment">// ä¸å½±å“åº”ç”¨è¿è¡Œ</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>========== é˜¶æ®µ 2 å®Œæˆï¼šçª—å£ç›¸å…³åˆå§‹åŒ–æˆåŠŸ ==========`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      </span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>é˜¶æ®µ 2 åˆå§‹åŒ–å¼‚å¸¸: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ==================== é˜¶æ®µ 3ï¼šUI ä¾èµ–åˆå§‹åŒ– ====================</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é˜¶æ®µ 3ï¼šUI ä¾èµ–æ¨¡å—åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åœ¨é¡µé¢åŠ è½½å®Œæˆåè°ƒç”¨ï¼Œåˆå§‹åŒ–ä¾èµ– AppStorageV2 çš„æ¨¡å—</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment">   * - Markdown é…ç½®ï¼šéœ€è¦ä» AppStorageV2 è·å–ç”¨æˆ·å­—ä½“å¤§å°è®¾ç½®</span></span><br><span class="line"><span class="comment">   * - å…¶ä»– UI ç›¸å…³é…ç½®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * è°ƒç”¨æ—¶æœºï¼š</span></span><br><span class="line"><span class="comment">   * - åœ¨ windowStage.loadContent() çš„å›è°ƒä¸­</span></span><br><span class="line"><span class="comment">   * - AppStorageV2 å·²å®Œå…¨å¯ç”¨</span></span><br><span class="line"><span class="comment">   * - åœ¨æ˜¾ç¤ºé¦–é¡µä¹‹å‰</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * ç‹¬ç«‹æ€§ï¼š</span></span><br><span class="line"><span class="comment">   * - æ­¤æ–¹æ³•ä¿æŒç‹¬ç«‹ï¼Œæ–¹ä¾¿å•ç‹¬è°ƒç”¨</span></span><br><span class="line"><span class="comment">   * - å¯åœ¨éœ€è¦æ—¶é‡æ–°é…ç½® Markdown</span></span><br><span class="line"><span class="comment">   * - ä¸å½±å“å…¶ä»–åˆå§‹åŒ–æµç¨‹</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * å‰ç½®æ¡ä»¶ï¼š</span></span><br><span class="line"><span class="comment">   * - é˜¶æ®µ 1 å’Œé˜¶æ®µ 2 å¿…é¡»å®Œæˆ</span></span><br><span class="line"><span class="comment">   * - AppStorageV2 ä¸­çš„ USER_CONFIG å¿…é¡»å·²åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment">   * ```typescript</span></span><br><span class="line"><span class="comment">   * windowStage.loadContent(&#x27;pages/StartPage&#x27;, (err) =&gt; &#123;</span></span><br><span class="line"><span class="comment">   *   if (err.code) &#123;</span></span><br><span class="line"><span class="comment">   *     hilog.error(DOMAIN, &#x27;testTag&#x27;, &#x27;é¡µé¢åŠ è½½å¤±è´¥: %&#123;public&#125;s&#x27;, JSON.stringify(err))</span></span><br><span class="line"><span class="comment">   *     return</span></span><br><span class="line"><span class="comment">   *   &#125;</span></span><br><span class="line"><span class="comment">   *   </span></span><br><span class="line"><span class="comment">   *   // é¡µé¢åŠ è½½æˆåŠŸï¼Œåˆå§‹åŒ– UI ä¾èµ–æ¨¡å—</span></span><br><span class="line"><span class="comment">   *   appInit.initPhase3_UIDependent()</span></span><br><span class="line"><span class="comment">   * &#125;)</span></span><br><span class="line"><span class="comment">   * ```</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initPhase3_UIDependent</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>========== å¼€å§‹é˜¶æ®µ 3ï¼šUI ä¾èµ–æ¨¡å—åˆå§‹åŒ– ==========`</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// åˆå§‹åŒ– Markdown é…ç½®</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>åˆå§‹åŒ– Markdown é…ç½®...`</span>)</span><br><span class="line">      <span class="keyword">const</span> markdownInitSuccess = <span class="variable language_">this</span>.<span class="title function_">markDownConfigInit</span>()</span><br><span class="line">      <span class="keyword">if</span> (markdownInitSuccess) &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ“ Markdown é…ç½®åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âš  Markdown é…ç½®åˆå§‹åŒ–å¤±è´¥ - åŸå› ï¼šæ— æ³•ä» AppStorageV2 è·å–ç”¨æˆ·é…ç½®ï¼Œå°†ä½¿ç”¨é»˜è®¤é…ç½®`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>========== é˜¶æ®µ 3 å®Œæˆï¼šUI ä¾èµ–æ¨¡å—åˆå§‹åŒ–æˆåŠŸ ==========`</span>)</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      </span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>é˜¶æ®µ 3 åˆå§‹åŒ–å¼‚å¸¸: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é…ç½® Markdown æ¸²æŸ“å¼•æ“</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * æ ¹æ®ç”¨æˆ·çš„å­—ä½“å¤§å°è®¾ç½®é…ç½® Markdown æ¸²æŸ“å‚æ•°</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> <span class="variable">boolean</span> - é…ç½®æ˜¯å¦æˆåŠŸ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * é…ç½®å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment">   * - ä»£ç å—è¡Œå·æ˜¾ç¤ºï¼šå¯ç”¨è¡Œå·</span></span><br><span class="line"><span class="comment">   * - æ–‡æœ¬åŸºç¡€å­—ä½“å¤§å°ï¼šä½¿ç”¨ç”¨æˆ·è®¾ç½®çš„å­—ä½“å¤§å°</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * ä¾èµ–å…³ç³»ï¼š</span></span><br><span class="line"><span class="comment">   * - ä¾èµ– AppStorageV2 ä¸­çš„ USER_CONFIG</span></span><br><span class="line"><span class="comment">   * - å¿…é¡»åœ¨ AppStorageV2 åˆå§‹åŒ–åè°ƒç”¨</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * ç‹¬ç«‹æ€§è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">   * - æ­¤æ–¹æ³•å¯ä»¥ç‹¬ç«‹è°ƒç”¨</span></span><br><span class="line"><span class="comment">   * - ç”¨æˆ·ä¿®æ”¹å­—ä½“å¤§å°åå¯é‡æ–°è°ƒç”¨æ­¤æ–¹æ³•</span></span><br><span class="line"><span class="comment">   * - ä¸å½±å“å…¶ä»–åˆå§‹åŒ–æµç¨‹</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼š</span></span><br><span class="line"><span class="comment">   * - <span class="doctag">@luvi</span>/lv-markdown-in: Markdown æ¸²æŸ“å¼•æ“</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment">   * ```typescript</span></span><br><span class="line"><span class="comment">   * // åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   * appInit.markDownConfigInit()</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * // ç”¨æˆ·ä¿®æ”¹å­—ä½“å¤§å°åé‡æ–°é…ç½®</span></span><br><span class="line"><span class="comment">   * userConfig.fontSize = 18</span></span><br><span class="line"><span class="comment">   * appInit.markDownConfigInit() // é‡æ–°åº”ç”¨é…ç½®</span></span><br><span class="line"><span class="comment">   * ```</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">markDownConfigInit</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// ä» AppStorageV2 è·å–ç”¨æˆ·å­—ä½“å¤§å°è®¾ç½®</span></span><br><span class="line">      <span class="keyword">const</span> userConfig = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(</span><br><span class="line">        <span class="title class_">UserConfigViewModel</span>,</span><br><span class="line">        <span class="variable constant_">APP_STORAGE_KEYS</span>.<span class="property">USER_CONFIG</span>,</span><br><span class="line">        <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">UserConfigViewModel</span>()</span><br><span class="line">      )</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (!userConfig) &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— æ— æ³•è·å–ç”¨æˆ·é…ç½® - åŸå› ï¼šAppStorageV2 ä¸­ä¸å­˜åœ¨ USER_CONFIGï¼ŒMarkdown ä½¿ç”¨é»˜è®¤å­—ä½“å¤§å°`</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> baseFontSize = userConfig.<span class="property">fontSize</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// é…ç½® Markdown æ¸²æŸ“å¼•æ“</span></span><br><span class="line">      lvCode.<span class="title function_">setIndexState</span>(<span class="literal">true</span>)           <span class="comment">// å¯ç”¨ä»£ç å—è¡Œå·</span></span><br><span class="line">      lvText.<span class="title function_">setTextSize</span>(baseFontSize)     <span class="comment">// è®¾ç½®æ–‡æœ¬åŸºç¡€å­—ä½“å¤§å°</span></span><br><span class="line">      </span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ“ Markdown é…ç½®æˆåŠŸï¼Œå­—ä½“å¤§å°: <span class="subst">$&#123;baseFontSize&#125;</span>`</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">markdown</span> = <span class="literal">true</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      </span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— Markdown é…ç½®å¼‚å¸¸ - åŸå› ï¼š<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ==================== å·¥å…·æ–¹æ³• ====================</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ‰“å°åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * ç”¨äºè°ƒè¯•å’Œé—®é¢˜è¯Šæ–­ï¼Œè¾“å‡ºå„æ¨¡å—çš„åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * - æˆåŠŸçš„æ¨¡å—ä½¿ç”¨ info çº§åˆ«</span></span><br><span class="line"><span class="comment">   * - å¤±è´¥çš„æ¨¡å—ä½¿ç”¨ warn çº§åˆ«ï¼Œä¾¿äºå¿«é€Ÿå®šä½é—®é¢˜</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@public</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">printInitStatus</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>========== åˆå§‹åŒ–çŠ¶æ€æŠ¥å‘Š ==========`</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°æ®åº“æ¨¡å—</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">databases</span>) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>[æ•°æ®åº“æ¨¡å—] âœ“ åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>[æ•°æ®åº“æ¨¡å—] âœ— åˆå§‹åŒ–å¤±è´¥ - å½±å“ï¼šç¦»çº¿åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”¨æˆ·é…ç½®</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">userConfig</span>) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>[ç”¨æˆ·é…ç½®] âœ“ åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>[ç”¨æˆ·é…ç½®] âœ— åˆå§‹åŒ–å¤±è´¥ - å½±å“ï¼šå°†ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆå­—ä½“16ã€è·Ÿéšç³»ç»Ÿä¸»é¢˜ï¼‰`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸šåŠ¡ç®¡ç†å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">managers</span>) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>[ä¸šåŠ¡ç®¡ç†å™¨] âœ“ åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>[ä¸šåŠ¡ç®¡ç†å™¨] âœ— åˆå§‹åŒ–å¤±è´¥ - å½±å“ï¼šæ–°é—»æ•°æ®åŠŸèƒ½ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–æ•°æ®åº“`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// AppStorageV2</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">appStorageV2</span>) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>[AppStorageV2] âœ“ åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>[AppStorageV2] âœ— åˆå§‹åŒ–å¤±è´¥ - å½±å“ï¼šä¸»é¢˜åˆ‡æ¢åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Markdown é…ç½®</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">markdown</span>) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>[Markdowné…ç½®] âœ“ åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>[Markdowné…ç½®] âœ— åˆå§‹åŒ–å¤±è´¥ - å½±å“ï¼šæ–‡ç« æ¸²æŸ“ä½¿ç”¨é»˜è®¤å­—ä½“`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>======================================`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è·å–åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * ä¾›å¤–éƒ¨æŸ¥è¯¢åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> åˆå§‹åŒ–çŠ¶æ€å¯¹è±¡çš„åªè¯»å‰¯æœ¬</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * è¿”å›åˆå§‹åŒ–çŠ¶æ€çš„æ·±æ‹·è´ï¼Œé¿å…å¤–éƒ¨ä¿®æ”¹å†…éƒ¨çŠ¶æ€</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">getInitStatus</span>(): <span class="title class_">InitStatus</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">databases</span>: <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">databases</span>,</span><br><span class="line">      <span class="attr">userConfig</span>: <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">userConfig</span>,</span><br><span class="line">      <span class="attr">managers</span>: <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">managers</span>,</span><br><span class="line">      <span class="attr">appStorageV2</span>: <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">appStorageV2</span>,</span><br><span class="line">      <span class="attr">markdown</span>: <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">markdown</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ£€æŸ¥æ˜¯å¦å®Œå…¨åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> <span class="variable">boolean</span> - æ‰€æœ‰æ¨¡å—æ˜¯å¦éƒ½åˆå§‹åŒ–æˆåŠŸ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * æ£€æŸ¥æ‰€æœ‰åˆå§‹åŒ–çŠ¶æ€æ˜¯å¦éƒ½ä¸º true</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">isFullyInitialized</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">databases</span> &amp;&amp;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">userConfig</span> &amp;&amp;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">managers</span> &amp;&amp;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">appStorageV2</span> &amp;&amp;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">markdown</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åº”ç”¨åˆå§‹åŒ–ç®¡ç†å™¨å•ä¾‹</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * å…¨å±€å”¯ä¸€çš„ AppInit å®ä¾‹ï¼Œåœ¨ EntryAbility ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment"> * ```typescript</span></span><br><span class="line"><span class="comment"> * import &#123; appInit &#125; from &#x27;../init/AppInit&#x27;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * // åœ¨ EntryAbility ä¸­æŒ‰é˜¶æ®µè°ƒç”¨</span></span><br><span class="line"><span class="comment"> * onCreate() &#123; appInit.initPhase1_BaseModules(this.context) &#125;</span></span><br><span class="line"><span class="comment"> * onWindowStageCreate() &#123; appInit.initPhase2_WindowRelated(...) &#125;</span></span><br><span class="line"><span class="comment"> * // é¡µé¢åŠ è½½å &#123; appInit.initPhase3_UIDependent() &#125;</span></span><br><span class="line"><span class="comment"> * ```</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> appInit = <span class="keyword">new</span> <span class="title class_">AppInit</span>()</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æ˜¯æ–°ç‰ˆçš„å…¨éƒ¨æºç ï¼Œç”±äºè¿™ä¸€æ¬¡æˆ‘æ˜¯å¸¦ç€å­¦ä¹ çš„å¿ƒæ€å»ç¼–å†™ä»£ç çš„ï¼Œæ‰€ä»¥æˆ‘è®©Claudeç»™å‡ºäº†è¾ƒä¸ºè¯¦ç»†çš„æ³¨é‡Šä¹Ÿæ–¹ä¾¿æˆ‘ä»¬å­¦ä¹ ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬åˆ†æ®µæ‹†è§£ä¸€ä¸‹è¿™ä¸ªä»£ç ã€‚</p>
<h4 id="åˆ†æ®µåˆå§‹åŒ–"><a href="#åˆ†æ®µåˆå§‹åŒ–" class="headerlink" title="åˆ†æ®µåˆå§‹åŒ–"></a>åˆ†æ®µåˆå§‹åŒ–</h4><p>é¦–å…ˆClaudeå¯¹äºæ•´ä½“åˆå§‹åŒ–çš„æµç¨‹è¿›è¡Œäº†é˜¶æ®µçš„åˆ’åˆ†ï¼Œå®ƒå°†åˆå§‹åŒ–çš„è¿‡ç¨‹åˆ‡åˆ†æˆäº†ä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>åŸºç¡€æ¨¡å—åˆå§‹åŒ–</li>
<li>çª—å£ç›¸å…³æ¨¡å—åˆå§‹åŒ–</li>
<li>UI ä¾èµ–æ¨¡å—åˆå§‹åŒ–</li>
</ul>
<p>è¿™ä¸‰ä¸ªé˜¶æ®µåˆ†åˆ«å¯¹åº”äº†ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><code>initPhase1_BaseModules()</code></li>
<li><code>initPhase2_WindowRelated()</code></li>
<li><code>initPhase3_UIDependent()</code></li>
</ul>
<p>è¿™ä¸ªé˜¶æ®µçš„åˆ’åˆ†æ˜¯ä¾æ®äºæ¨¡å—çš„ä¾èµ–å…³ç³»å’Œåˆå§‹åŒ–çš„æ—¶é—´ç‚¹ã€‚</p>
<ul>
<li>åŸºç¡€æ¨¡å—åˆå§‹åŒ–ï¼šåŒ…æ‹¬æ•°æ®åº“ã€ç”¨æˆ·é…ç½®ã€ä¸šåŠ¡ç®¡ç†å™¨ã€AppStorageV2 å’Œ Markdown é…ç½®ã€‚è¿™äº›æ¨¡å—æ˜¯å…¶ä»–æ¨¡å—çš„åŸºç¡€ï¼Œå¿…é¡»åœ¨åº”ç”¨å¯åŠ¨æ—¶å°±åˆå§‹åŒ–å®Œæˆã€‚</li>
<li>çª—å£ç›¸å…³æ¨¡å—åˆå§‹åŒ–ï¼šåŒ…æ‹¬çª—å£ç®¡ç†å™¨ã€çª—å£è£…é¥°å™¨ç­‰ã€‚è¿™äº›æ¨¡å—ä¾èµ–äºåŸºç¡€æ¨¡å—ï¼Œå¿…é¡»åœ¨çª—å£åˆ›å»ºæ—¶åˆå§‹åŒ–ã€‚</li>
<li>UI ä¾èµ–æ¨¡å—åˆå§‹åŒ–ï¼šåŒ…æ‹¬ç•Œé¢å…ƒç´ ã€äº‹ä»¶å¤„ç†ç­‰ã€‚è¿™äº›æ¨¡å—ä¾èµ–äºçª—å£ç›¸å…³æ¨¡å—ï¼Œå¿…é¡»åœ¨ç•Œé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ã€‚</li>
</ul>
<h4 id="å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œé¡ºåºç®¡ç†"><a href="#å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œé¡ºåºç®¡ç†" class="headerlink" title="å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œé¡ºåºç®¡ç†"></a>å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œé¡ºåºç®¡ç†</h4><p>åœ¨æˆ‘å•ç‹¬èŠ±äº†ä¸€æ®µæ—¶é—´å“è¯»äº†ä¸€ä¸‹Claudeçš„ä»£ç ä¹‹åæ‰å‘ç°ä¸€æ®µå¥½çš„ä»£ç æ˜¯çœŸçš„å¯ä»¥èµå¿ƒæ‚¦ç›®ï¼Œå¯ä»¥è¢«ç§°ä¹‹ä¸ºè‰ºæœ¯å“äº†ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ç»“åˆç€<code>EntryAbility</code>çš„ä»£ç æ¥ç†è§£è®²è§£ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬è¦æ¸…æ¥šçš„ä¸€ç‚¹åœ¨äºæˆ‘ä»¬ä¸åŒé˜¶æ®µä¹‹é—´ä»¥åŠä¸åŒé˜¶æ®µå†…éƒ¨å­˜åœ¨ç€ä¸€å®šé‡çš„å½¼æ­¤ä¾å­˜ï¼Œéœ€è¦ä¸¥æ ¼ä¾ç…§æ­£ç¡®çš„é¡ºåºæ‰§è¡Œï¼Œå°±æ¯”å¦‚è¯´æ˜¯æˆ‘ä»¬çš„æ–°é—»æ•°æ®Manageræ¨¡å—éƒ½è¦ä¾èµ–äºé”®å€¼æ•°æ®åº“çš„åˆå§‹åŒ–ï¼Œæ‰€æœ‰çš„é…ç½®æ•°æ®Manageræ¨¡å—éƒ½ä¾èµ–äºç”¨æˆ·é¦–é€‰é¡¹æ•°æ®åº“çš„åˆå§‹åŒ–ã€‚æ‰€ä»¥åˆå§‹åŒ–çš„é¡ºåºè‡³å…³é‡è¦ã€‚</p>
<p>è€Œå½“å‰æˆ‘ä»¬çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­åŒ…å«äº†å¤§é‡çš„å¼‚æ­¥ä»»åŠ¡ï¼Œè¿™äº›å¼‚æ­¥ä»»åŠ¡çš„å®é™…æ‰§è¡Œæ—¶é•¿å„ä¸ç›¸åŒï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„æ˜¯åˆ©ç”¨Promiseç±»å†…ç½®çš„ä¸€ç³»åˆ—é™æ€æ–¹æ³•æ¥å»æ§åˆ¶å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼Œé€šè¿‡åœ¨ä¸Šä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„thenå›è°ƒå‡½æ•°ä¸­å»æ‹‰èµ·ä¸‹ä¸€ä¸ªä¸ä¹‹å­˜åœ¨ä¾èµ–å…³ç³»çš„å¼‚æ­¥ä»»åŠ¡è¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œä»è€Œå®ç°å¼‚æ­¥ä»»åŠ¡çš„æœ‰åºæ‰§è¡Œã€‚è¿™é‡Œä¸ç¦è®©æˆ‘è”æƒ³åˆ°äº†å½“åˆæ•°æ®ç»“æ„æ‰€å­¦è¿‡çš„æ‹“æ‰‘ç»“æ„ï¼Œåªæœ‰å®Œæˆå…¨éƒ¨çš„å‰ç½®èŠ‚ç‚¹æ‰èƒ½è¾¾åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶åº”ç”¨çœŸçš„å¾ˆå¹¿ï¼Œå¯ä»¥è¯´æ˜¯åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­æ— å¤„ä¸åœ¨çš„äº†ã€‚</p>
<p>è¿™é‡Œæˆ‘å…ˆå»æ”¾ä¸€ä¸‹<code>EntryAbility</code>çš„æºç ç„¶åå’±ä»¬å‚ç…§ç€æºç é€ä¸€è®²è§£ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2025 XBXyftx</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AbilityConstant</span>, <span class="title class_">UIAbility</span>, <span class="title class_">Want</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hilog &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.PerformanceAnalysisKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span>, <span class="variable language_">window</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; appInit &#125; <span class="keyword">from</span> <span class="string">&#x27;../init/AppInit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; userConfigManager &#125; <span class="keyword">from</span> <span class="string">&#x27;feature&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">APP_STORAGE_KEYS</span>, <span class="title class_">WinWidth</span>, logger, <span class="variable constant_">LOG_TAG</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;common&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ—¥å¿—åŸŸæ ‡è¯†</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * ç”¨äº hilog æ—¥å¿—è¾“å‡ºï¼Œæ ‡è¯†æ—¥å¿—æ¥æº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DOMAIN</span> = <span class="number">0x0000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * hilog æ—¥å¿—æ ‡ç­¾</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * ç”¨äºè¿‡æ»¤å’Œæœç´¢æ—¥å¿—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TAG</span> = <span class="string">&#x27;EntryAbility&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åº”ç”¨å…¥å£ Ability</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * ä½œä¸ºåº”ç”¨çš„ä¸»å…¥å£ï¼Œè´Ÿè´£ï¼š</span></span><br><span class="line"><span class="comment"> * - åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</span></span><br><span class="line"><span class="comment"> * - åº”ç”¨åˆå§‹åŒ–æµç¨‹åè°ƒ</span></span><br><span class="line"><span class="comment"> * - çª—å£åˆ›å»ºå’Œé¡µé¢åŠ è½½</span></span><br><span class="line"><span class="comment"> * - å…¨å±€çŠ¶æ€ç®¡ç†</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment"> * ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è°ƒç”¨é¡ºåºï¼š</span></span><br><span class="line"><span class="comment"> * 1. onCreate(): åº”ç”¨åˆ›å»ºæ—¶è°ƒç”¨ï¼Œè¿›è¡ŒåŸºç¡€åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * 2. onWindowStageCreate(): çª—å£åˆ›å»ºæ—¶è°ƒç”¨ï¼Œåˆå§‹åŒ– UI ç›¸å…³æ¨¡å—</span></span><br><span class="line"><span class="comment"> * 3. onForeground(): åº”ç”¨è¿›å…¥å‰å°</span></span><br><span class="line"><span class="comment"> * 4. onBackground(): åº”ç”¨è¿›å…¥åå°ï¼Œä¿å­˜æ•°æ®</span></span><br><span class="line"><span class="comment"> * 5. onWindowStageDestroy(): çª—å£é”€æ¯</span></span><br><span class="line"><span class="comment"> * 6. onDestroy(): åº”ç”¨é”€æ¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–ç­–ç•¥ï¼š</span></span><br><span class="line"><span class="comment"> * - åˆ†é˜¶æ®µåˆå§‹åŒ–ï¼šåŸºç¡€æ¨¡å— â†’ çª—å£æ¨¡å— â†’ UI ä¾èµ–æ¨¡å—</span></span><br><span class="line"><span class="comment"> * - å¼‚æ­¥å¤„ç†ï¼šä¸é˜»å¡ä¸»çº¿ç¨‹</span></span><br><span class="line"><span class="comment"> * - é”™è¯¯å®¹é”™ï¼šå…³é”®æ¨¡å—å¤±è´¥æ—¶æœ‰é™çº§æ–¹æ¡ˆ</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> AppInit åº”ç”¨åˆå§‹åŒ–ç®¡ç†å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">EntryAbility</span> <span class="keyword">extends</span> <span class="title class_ inherited__">UIAbility</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é˜¶æ®µ 1 åˆå§‹åŒ– Promise</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * ç”¨äºåœ¨çª—å£åˆ›å»ºæ—¶ç­‰å¾…é˜¶æ®µ 1 å®Œæˆï¼Œç¡®ä¿åˆå§‹åŒ–é¡ºåºæ­£ç¡®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">phase1Promise</span>: <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åº”ç”¨åˆ›å»ºç”Ÿå‘½å‘¨æœŸå›è°ƒ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ï¼Œæ˜¯åˆå§‹åŒ–çš„ç¬¬ä¸€ä¸ªé˜¶æ®µ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">want</span> - å¯åŠ¨æ„å›¾ï¼ŒåŒ…å«å¯åŠ¨å‚æ•°</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">launchParam</span> - å¯åŠ¨å‚æ•°ï¼ŒåŒ…å«å¯åŠ¨åŸå› ç­‰ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–å†…å®¹ï¼ˆé˜¶æ®µ 1ï¼‰ï¼š</span></span><br><span class="line"><span class="comment">   * - æ•°æ®åº“åˆå§‹åŒ–ï¼ˆKVæ•°æ®åº“ã€åå¥½è®¾ç½®æ•°æ®åº“ï¼‰</span></span><br><span class="line"><span class="comment">   * - ç”¨æˆ·é…ç½®åŠ è½½</span></span><br><span class="line"><span class="comment">   * - ä¸šåŠ¡ç®¡ç†å™¨åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   * - æ•°æ®é¢„åŠ è½½</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * æ³¨æ„äº‹é¡¹ï¼š</span></span><br><span class="line"><span class="comment">   * - æ­¤æ—¶çª—å£è¿˜æœªåˆ›å»ºï¼Œä¸èƒ½è®¿é—® UI</span></span><br><span class="line"><span class="comment">   * - ä¸èƒ½ä½¿ç”¨ AppStorageV2</span></span><br><span class="line"><span class="comment">   * - åº”å¿«é€Ÿå®Œæˆï¼Œé¿å…é˜»å¡å¯åŠ¨</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * é”™è¯¯å¤„ç†ï¼š</span></span><br><span class="line"><span class="comment">   * - åˆå§‹åŒ–å¤±è´¥ä¼šè®°å½•æ—¥å¿—</span></span><br><span class="line"><span class="comment">   * - å…³é”®æ¨¡å—å¤±è´¥å¯èƒ½å½±å“åº”ç”¨åŠŸèƒ½</span></span><br><span class="line"><span class="comment">   * - éå…³é”®æ¨¡å—å¤±è´¥åº”ç”¨ä»å¯è¿è¡Œ</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">onCreate</span>(<span class="attr">want</span>: <span class="title class_">Want</span>, <span class="attr">launchParam</span>: <span class="title class_">AbilityConstant</span>.<span class="property">LaunchParam</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="variable constant_">TAG</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onCreate&#x27;</span>);</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>åº”ç”¨å¯åŠ¨ï¼Œå¼€å§‹åˆå§‹åŒ–æµç¨‹`</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é˜¶æ®µ 1ï¼šåŸºç¡€æ¨¡å—åˆå§‹åŒ–ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼Œä¿å­˜ Promise ä¾›åç»­ç­‰å¾…ï¼‰</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">phase1Promise</span> = appInit.<span class="title function_">initPhase1_BaseModules</span>(<span class="variable language_">this</span>.<span class="property">context</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åº”ç”¨é”€æ¯ç”Ÿå‘½å‘¨æœŸå›è°ƒ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åœ¨åº”ç”¨é€€å‡ºæ—¶è°ƒç”¨ï¼Œè¿›è¡Œèµ„æºæ¸…ç†</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * æ¸…ç†å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment">   * - é‡Šæ”¾æ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="comment">   * - å–æ¶ˆäº‹ä»¶ç›‘å¬</span></span><br><span class="line"><span class="comment">   * - æ¸…ç†ä¸´æ—¶æ•°æ®</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">onDestroy</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="variable constant_">TAG</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onDestroy&#x27;</span>);</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>åº”ç”¨é”€æ¯`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * çª—å£é˜¶æ®µåˆ›å»ºç”Ÿå‘½å‘¨æœŸå›è°ƒ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åœ¨çª—å£åˆ›å»ºåè°ƒç”¨ï¼Œæ˜¯åˆå§‹åŒ–çš„ç¬¬äºŒå’Œç¬¬ä¸‰é˜¶æ®µ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">windowStage</span> - çª—å£èˆå°å¯¹è±¡ï¼Œç”¨äºç®¡ç†çª—å£å’ŒåŠ è½½é¡µé¢</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment">   * - ç­‰å¾…é˜¶æ®µ 1 å®Œæˆï¼ˆç¡®ä¿åˆå§‹åŒ–é¡ºåºï¼‰</span></span><br><span class="line"><span class="comment">   * - é˜¶æ®µ 2ï¼šçª—å£ç›¸å…³åˆå§‹åŒ–ï¼ˆé¢œè‰²æ¨¡å¼ç®¡ç†å™¨ç­‰ï¼‰</span></span><br><span class="line"><span class="comment">   * - AppStorageV2 åˆå§‹åŒ–ï¼ˆçª—å£å®½åº¦ï¼‰</span></span><br><span class="line"><span class="comment">   * - é¡µé¢åŠ è½½ï¼ˆStartPageï¼‰</span></span><br><span class="line"><span class="comment">   * - é˜¶æ®µ 3ï¼šUI ä¾èµ–åˆå§‹åŒ–ï¼ˆMarkdown é…ç½®ç­‰ï¼‰</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * AppStorageV2 åˆå§‹åŒ–æ—¶æœºï¼š</span></span><br><span class="line"><span class="comment">   * - çª—å£åˆ›å»ºåï¼Œé¡µé¢åŠ è½½å‰</span></span><br><span class="line"><span class="comment">   * - å¿…é¡»åœ¨è®¿é—® AppStorageV2 ä¹‹å‰å®Œæˆ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * é¡µé¢åŠ è½½ç­–ç•¥ï¼š</span></span><br><span class="line"><span class="comment">   * - é¦–å…ˆåŠ è½½å¯åŠ¨é¡µï¼ˆStartPageï¼‰</span></span><br><span class="line"><span class="comment">   * - å¯åŠ¨é¡µä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸»é¡µï¼ˆIndexï¼‰</span></span><br><span class="line"><span class="comment">   * - ä½¿ç”¨è·¯ç”±åŠ¨ç”»æå‡ç”¨æˆ·ä½“éªŒ</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">onWindowStageCreate</span>(<span class="attr">windowStage</span>: <span class="variable language_">window</span>.<span class="property">WindowStage</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="variable constant_">TAG</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onWindowStageCreate&#x27;</span>);</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>çª—å£åˆ›å»ºï¼Œç­‰å¾…é˜¶æ®µ 1 å®Œæˆ...`</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç­‰å¾…é˜¶æ®µ 1 å®Œæˆï¼ˆå¦‚æœè¿˜åœ¨è¿›è¡Œä¸­ï¼‰</span></span><br><span class="line">    <span class="keyword">const</span> phase1Promise = <span class="variable language_">this</span>.<span class="property">phase1Promise</span> || <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="literal">false</span>)</span><br><span class="line">    </span><br><span class="line">    phase1Promise.<span class="title function_">then</span>(<span class="function">(<span class="params">phase1Success</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// è®°å½•é˜¶æ®µ 1 ç»“æœ</span></span><br><span class="line">      <span class="keyword">if</span> (phase1Success) &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>âœ“ é˜¶æ®µ 1 åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>âœ— é˜¶æ®µ 1 åˆå§‹åŒ–å¤±è´¥ï¼Œåº”ç”¨å¯èƒ½æ— æ³•æ­£å¸¸è¿è¡Œ`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// é˜¶æ®µ 2ï¼šçª—å£ç›¸å…³æ¨¡å—åˆå§‹åŒ–</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>å¼€å§‹é˜¶æ®µ 2 åˆå§‹åŒ–...`</span>)</span><br><span class="line">      <span class="keyword">const</span> phase2Success = appInit.<span class="title function_">initPhase2_WindowRelated</span>(<span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">getApplicationContext</span>())</span><br><span class="line">      <span class="keyword">if</span> (phase2Success) &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>âœ“ é˜¶æ®µ 2 åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>âš  é˜¶æ®µ 2 åˆå§‹åŒ–å¤±è´¥ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—å½±å“`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// åˆå§‹åŒ– AppStorageV2ï¼šå­˜å‚¨çª—å£å®½åº¦</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(<span class="variable language_">this</span>.<span class="property">context</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">win</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> winWidth = win.<span class="title function_">getWindowProperties</span>().<span class="property">windowRect</span>.<span class="property">width</span></span><br><span class="line">        <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">WinWidth</span>, <span class="variable constant_">APP_STORAGE_KEYS</span>.<span class="property">WINDOW_WIDTH</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">WinWidth</span>(winWidth))</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>çª—å£å®½åº¦å·²å­˜å‚¨åˆ° AppStorageV2: <span class="subst">$&#123;winWidth&#125;</span>px`</span>)</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">Error</span></span>) =&gt;</span> &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>è·å–çª—å£å®½åº¦å¤±è´¥: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// åŠ è½½å¯åŠ¨é¡µé¢</span></span><br><span class="line">      windowStage.<span class="title function_">loadContent</span>(<span class="string">&#x27;pages/StartPage&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err.<span class="property">code</span>) &#123;</span><br><span class="line">          hilog.<span class="title function_">error</span>(<span class="variable constant_">DOMAIN</span>, <span class="variable constant_">TAG</span>, <span class="string">&#x27;Failed to load the content. Cause: %&#123;public&#125;s&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">          logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>é¡µé¢åŠ è½½å¤±è´¥: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(err)&#125;</span>`</span>)</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="variable constant_">TAG</span>, <span class="string">&#x27;Succeeded in loading the content.&#x27;</span>);</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>å¯åŠ¨é¡µåŠ è½½æˆåŠŸ`</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é˜¶æ®µ 3ï¼šUI ä¾èµ–æ¨¡å—åˆå§‹åŒ–</span></span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>å¼€å§‹é˜¶æ®µ 3 åˆå§‹åŒ–...`</span>)</span><br><span class="line">        <span class="keyword">const</span> phase3Success = appInit.<span class="title function_">initPhase3_UIDependent</span>()</span><br><span class="line">        <span class="keyword">if</span> (phase3Success) &#123;</span><br><span class="line">          logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>âœ“ é˜¶æ®µ 3 åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>âš  é˜¶æ®µ 3 åˆå§‹åŒ–å¤±è´¥ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—å½±å“`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç­‰å¾…æ‰€æœ‰å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œæ‰“å°æœ€ç»ˆçŠ¶æ€æŠ¥å‘Š</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">printFinalInitStatus</span>()</span><br><span class="line">        &#125;, <span class="number">100</span>) <span class="comment">// ç»™å¼‚æ­¥æ“ä½œç•™å‡ºå®Œæˆæ—¶é—´</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">Error</span></span>) =&gt;</span> &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>âœ— é˜¶æ®µ 1 åˆå§‹åŒ–å¼‚å¸¸: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>åº”ç”¨å¯åŠ¨å¤±è´¥ï¼Œè¯·é‡å¯åº”ç”¨`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ‰“å°æœ€ç»ˆåˆå§‹åŒ–çŠ¶æ€æŠ¥å‘Š</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åœ¨æ‰€æœ‰åˆå§‹åŒ–é˜¶æ®µå®Œæˆåè°ƒç”¨ï¼Œè¾“å‡ºå®Œæ•´çš„çŠ¶æ€æŠ¥å‘Š</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">printFinalInitStatus</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>========================================`</span>)</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>      åº”ç”¨åˆå§‹åŒ–å®ŒæˆçŠ¶æ€æŠ¥å‘Š`</span>)</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>========================================`</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰“å°è¯¦ç»†çŠ¶æ€</span></span><br><span class="line">    appInit.<span class="title function_">printInitStatus</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥å®Œæ•´åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (appInit.<span class="title function_">isFullyInitialized</span>()) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>`</span>)</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>ğŸ‰ åº”ç”¨å®Œå…¨åˆå§‹åŒ–æˆåŠŸï¼Œæ‰€æœ‰åŠŸèƒ½å¯ç”¨`</span>)</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>`</span>)</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>âš ï¸  åº”ç”¨åˆå§‹åŒ–ä¸å®Œæ•´ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™`</span>)</span><br><span class="line">      <span class="keyword">const</span> status = appInit.<span class="title function_">getInitStatus</span>()</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>è¯¦ç»†çŠ¶æ€: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(status)&#125;</span>`</span>)</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>========================================`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * çª—å£é˜¶æ®µé”€æ¯ç”Ÿå‘½å‘¨æœŸå›è°ƒ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åœ¨çª—å£é”€æ¯æ—¶è°ƒç”¨ï¼Œé‡Šæ”¾ UI ç›¸å…³èµ„æº</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * æ¸…ç†å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment">   * - é‡Šæ”¾ UI èµ„æº</span></span><br><span class="line"><span class="comment">   * - å–æ¶ˆçª—å£ç›‘å¬</span></span><br><span class="line"><span class="comment">   * - æ¸…ç†ä¸´æ—¶ UI çŠ¶æ€</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">onWindowStageDestroy</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="variable constant_">TAG</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onWindowStageDestroy&#x27;</span>);</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>çª—å£é”€æ¯`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åº”ç”¨è¿›å…¥å‰å°ç”Ÿå‘½å‘¨æœŸå›è°ƒ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * å½“åº”ç”¨ä»åå°åˆ‡æ¢åˆ°å‰å°æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * å¯èƒ½çš„æ“ä½œï¼š</span></span><br><span class="line"><span class="comment">   * - åˆ·æ–°æ•°æ®ï¼šæ£€æŸ¥æ˜¯å¦æœ‰æ–°å†…å®¹</span></span><br><span class="line"><span class="comment">   * - æ¢å¤çŠ¶æ€ï¼šæ¢å¤ç”¨æˆ·æ“ä½œçŠ¶æ€</span></span><br><span class="line"><span class="comment">   * - é‡æ–°è¿æ¥ï¼šé‡æ–°å»ºç«‹ç½‘ç»œè¿æ¥</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">onForeground</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="variable constant_">TAG</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onForeground&#x27;</span>);</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>åº”ç”¨è¿›å…¥å‰å°`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åº”ç”¨è¿›å…¥åå°ç”Ÿå‘½å‘¨æœŸå›è°ƒ</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * å½“åº”ç”¨ä»å‰å°åˆ‡æ¢åˆ°åå°æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * æ•°æ®ä¿å­˜ï¼š</span></span><br><span class="line"><span class="comment">   * - è‡ªåŠ¨ä¿å­˜ç”¨æˆ·é…ç½®åˆ°æŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line"><span class="comment">   * - ç¡®ä¿ç”¨æˆ·æ•°æ®ä¸ä¸¢å¤±</span></span><br><span class="line"><span class="comment">   * - ä¸ºä¸‹æ¬¡å¯åŠ¨åšå‡†å¤‡</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * ä¿å­˜å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment">   * - ç”¨æˆ·å­—ä½“å¤§å°è®¾ç½®</span></span><br><span class="line"><span class="comment">   * - ç”¨æˆ·é¢œè‰²æ¨¡å¼åå¥½</span></span><br><span class="line"><span class="comment">   * - å…¶ä»–ç”¨æˆ·é…ç½®é¡¹</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * æ‰§è¡Œæ—¶æœºï¼š</span></span><br><span class="line"><span class="comment">   * - ç”¨æˆ·æŒ‰Homeé”®é€€å‡º</span></span><br><span class="line"><span class="comment">   * - åˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨</span></span><br><span class="line"><span class="comment">   * - ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶è¢«æŒ‚èµ·</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">onBackground</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="variable constant_">TAG</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onBackground&#x27;</span>);</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>åº”ç”¨è¿›å…¥åå°ï¼Œå¼€å§‹ä¿å­˜ç”¨æˆ·æ•°æ®`</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŒæ­¥ç”¨æˆ·é…ç½®åˆ°æŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line">    <span class="keyword">const</span> syncSuccess = userConfigManager.<span class="title function_">syncDataToPreference</span>()</span><br><span class="line">    <span class="keyword">if</span> (syncSuccess) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>ç”¨æˆ·é…ç½®ä¿å­˜æˆåŠŸ`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>ç”¨æˆ·é…ç½®ä¿å­˜å¤±è´¥ï¼Œè®¾ç½®å¯èƒ½ä¸¢å¤±`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡AppInitçš„æºä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„å¼‚æ­¥æ“ä½œå…¶å®æ˜¯å…¨éƒ¨è¢«åŒ…è£¹åœ¨äº†<code>initPhase1</code>ä¸­ï¼Œ<code>initPhase1</code>æ˜¯åœ¨<code>Ability</code>çš„<code>onCreate</code>ä¸­è°ƒç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰€æœ‰çš„å¼‚æ­¥æ“ä½œéƒ½æ˜¯åœ¨<code>Ability</code>çš„<code>onCreate</code>ä¸­å®Œæˆçš„ã€‚ä½†æ˜¯é—®é¢˜åœ¨äºåé¢çš„<code>onWindowStageCreate</code>çª—å£åˆ›å»ºé˜¶æ®µä¸æˆ‘ä»¬çš„<code>onCreate</code>å‡½æ•°æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ä»£ç å—ï¼Œå½¼æ­¤ä¹‹é—´çš„å±€éƒ¨å˜é‡å¹¶ä¸äº’é€šï¼Œæˆ‘ä»¬åœ¨<code>onCreate</code>çš„å‡½æ•°ä¸­åˆ›å»ºçš„<code>Promiseå®ä¾‹å¯¹è±¡</code>æ— æ³•åœ¨<code>onWindowStageCreate</code>ä¸­è®¿é—®ï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯é˜¶æ®µäºŒçš„æ‰§è¡Œé¡ºåºï¼Œæˆ‘ä»¬è¦å°†<code>appInit.initPhase1_BaseModules</code>å¯¹è±¡çš„å¯è§åŒºåŸŸæ‰©å¤§ï¼Œæ‰©å¤§è‡³å½“å‰<code>EntryAbility</code>ç±»çš„å±€éƒ¨å˜é‡ä¸­ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é˜¶æ®µ 1 åˆå§‹åŒ– Promise</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * ç”¨äºåœ¨çª—å£åˆ›å»ºæ—¶ç­‰å¾…é˜¶æ®µ 1 å®Œæˆï¼Œç¡®ä¿åˆå§‹åŒ–é¡ºåºæ­£ç¡®</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="attr">phase1Promise</span>: <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; | <span class="literal">null</span> = <span class="literal">null</span></span><br></pre></td></tr></table></figure>
<p>å°†ä½œç”¨åŸŸæå‡ä¹‹åï¼Œæˆ‘ä»¬åœ¨<code>onCreate</code>å‡½æ•°ä¸­å»è¿›è¡Œpromiseå¯¹è±¡çš„å¯åŠ¨ï¼Œå°†å¯åŠ¨åçš„å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™<code>this.phase1Promise</code>ï¼Œç„¶ååœ¨<code>onWindowStageCreate</code>å‡½æ•°ä¸­å»ç­‰å¾…è¿™ä¸ªpromiseå¯¹è±¡çš„å®Œæˆã€‚åœ¨å®Œæˆåå»è°ƒç”¨<code>appInit.initPhase2_UI</code>å‡½æ•°è¿›è¡Œé˜¶æ®µäºŒçš„åˆå§‹åŒ–ã€‚äºŒé˜¶æ®µä¹‹æ‰€ä»¥æ˜¯æ²¡æœ‰è¢«å•ç‹¬æå‡ä½œç”¨åŸŸï¼Œè¿™æ˜¯å› ä¸ºäºŒé˜¶æ®µå’Œä¸‰é˜¶æ®µéƒ½æ˜¯åŒæ­¥çš„ã€‚ä¸‰é˜¶æ®µä¼šå¾ˆè‡ªç„¶çš„æ’åœ¨äºŒé˜¶æ®µçš„åé¢ï¼Œæ— éœ€é¢å¤–è¿›è¡Œæ›´å¤šæ“ä½œã€‚</p>
<p>åœ¨ä¸‰ä¸ªé˜¶æ®µçš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€æ­¥çš„åˆå§‹åŒ–æˆåŠŸä¹‹åéƒ½ä¼šåœ¨initStatusè¿™ä¸ªå¯¹è±¡ä¸­å»è®°å½•å…¶åˆå§‹åŒ–çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸå°±ä¼šåœ¨å¯¹åº”çš„é”®å€¼ä¸­å»è®°å½•ä¸ºtrueï¼Œå¤±è´¥å°±ä¼šè®°å½•ä¸ºfalseã€‚éšååœ¨ä¸‰ä¸ªåˆå§‹åŒ–é˜¶æ®µçš„æœ€åä¼šç»Ÿä¸€è¿›è¡Œç»“æœçš„è¾“å‡ºã€‚</p>
<p>è€Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°åŒæ­¥è¿›ç¨‹è¿ç»­æ‰§è¡Œï¼ŒæŒç»­åˆ°åº”ç”¨å‡†å¤‡é˜¶æ®µçš„æœ€åä¹Ÿæ²¡æœ‰æµå‡ºç©ºé—²å»å¤„ç†å¼‚æ­¥å‡½æ•°ï¼Œå¯¼è‡´æœ€åè¾“å‡ºçš„ç»“æœä¸ºå¤±è´¥æ˜¯å› ä¸ºè¿˜æ²¡æœ‰æ‰§è¡Œï¼ˆåœ¨æ—©æœŸç‰ˆæœ¬æ—¶ï¼Œæˆ‘ä»¬çš„çš„ç¡®ç¡®é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">11-18 13:28:07.652   8088-8088     A00000/com.xbxy...EntryAbility  apppool               I     Ability onCreate</span><br><span class="line">11-18 13:28:07.652   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     EntryAbility: åº”ç”¨å¯åŠ¨ï¼Œå¼€å§‹åˆå§‹åŒ–æµç¨‹</span><br><span class="line">11-18 13:28:07.652   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     AppInit: ========== å¼€å§‹é˜¶æ®µ 1ï¼šåŸºç¡€æ¨¡å—åˆå§‹åŒ– ==========</span><br><span class="line">11-18 13:28:07.652   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     AppInit: æ­¥éª¤ 1/4ï¼šåˆå§‹åŒ–æ•°æ®åº“æ¨¡å—...</span><br><span class="line">11-18 13:28:07.653   8088-8088     A03D00/com.xbx...ngYiXun/JSAPP  apppool               I     KVDatabase: Succeeded <span class="keyword">in</span> creating KVManager.</span><br><span class="line">11-18 13:28:07.653   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     KVDatabase: æ•°æ®åº“ç®¡ç†å¯¹è±¡åˆ›å»ºæˆåŠŸã€‚</span><br><span class="line">11-18 13:28:07.653   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     AppInit: âœ“ KV æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.653   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     AppInit: âœ“ åå¥½è®¾ç½®æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.653   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     AppInit: æ­¥éª¤ 2/4ï¼šåŠ è½½ç”¨æˆ·é…ç½®...</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     PreferenceDB: Has ColorMode data: <span class="literal">true</span></span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               W     PreferenceDB: Get data ColorMode: 0</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     UserConfigManager: æ£€æµ‹åˆ°COLOR_MODE = 0</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               W     PreferenceDB: Get data ColorMode: 0</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     PreferenceDB: Has FontSize data: <span class="literal">true</span></span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               W     PreferenceDB: Get data FontSize: 18</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     UserConfigManager: æ£€æµ‹åˆ°FONT_SIZE = 18</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               W     PreferenceDB: Get data FontSize: 18</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     PreferenceDB: Has FontSize data: <span class="literal">true</span></span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     PreferenceDB: Has ColorMode data: <span class="literal">true</span></span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               W     PreferenceDB: Get data ColorMode: 0</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               W     PreferenceDB: Get data FontSize: 18</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               W     UserConfigManager: ç”¨æˆ·é¦–é€‰é¡¹æŒä¹…åŒ–æ•°æ®è¯»å–æˆåŠŸ,colorMode=0,fontSize=18</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     AppInit: âœ“ ç”¨æˆ·é…ç½®åŠ è½½æˆåŠŸ</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     AppInit: æ­¥éª¤ 3/4ï¼šåˆå§‹åŒ–ä¸šåŠ¡ç®¡ç†å™¨...</span><br><span class="line">11-18 13:28:07.655   8088-8088     A03D00/com.xbx...ngYiXun/JSAPP  apppool               I     KVDatabase: Succeeded <span class="keyword">in</span> creating KVManager.</span><br><span class="line">11-18 13:28:07.655   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     KVDatabase: æ•°æ®åº“ç®¡ç†å¯¹è±¡åˆ›å»ºæˆåŠŸã€‚</span><br><span class="line">11-18 13:28:07.665   8088-8088     A00000/com.xbxy...EntryAbility  apppool               I     Ability onWindowStageCreate</span><br><span class="line">11-18 13:28:07.665   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     EntryAbility: çª—å£åˆ›å»ºï¼Œå¼€å§‹çª—å£ç›¸å…³åˆå§‹åŒ–</span><br><span class="line">11-18 13:28:07.666   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     AppInit: ========== å¼€å§‹é˜¶æ®µ 2ï¼šçª—å£ç›¸å…³åˆå§‹åŒ– ==========</span><br><span class="line">11-18 13:28:07.666   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     AppInit: åˆå§‹åŒ–é¢œè‰²æ¨¡å¼ç®¡ç†å™¨...</span><br><span class="line">11-18 13:28:07.666   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     ColorModManager: applicationContextåˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.666   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     ColorModManager: initColoModSetting 0: AppStorageV2colorModel = 0</span><br><span class="line">11-18 13:28:07.666   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     AppInit: âœ“ é¢œè‰²æ¨¡å¼ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.666   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     AppInit: ========== é˜¶æ®µ 2 å®Œæˆï¼šçª—å£ç›¸å…³åˆå§‹åŒ–æˆåŠŸ ==========</span><br><span class="line">11-18 13:28:07.666   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     EntryAbility: é˜¶æ®µ 2 åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.669   8088-8088     A00000/com.xbxy...EntryAbility  apppool               I     Ability onForeground</span><br><span class="line">11-18 13:28:07.669   8088-8088     A01234/com.xbx...Xun/XBXLogger  apppool               I     EntryAbility: åº”ç”¨è¿›å…¥å‰å°</span><br><span class="line">11-18 13:28:07.707   8088-8088     A00000/com.xbxy...EntryAbility  com.xbxyf...ongYiXun  I     Succeeded <span class="keyword">in</span> loading the content.</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     EntryAbility: å¯åŠ¨é¡µåŠ è½½æˆåŠŸ</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: ========== å¼€å§‹é˜¶æ®µ 3ï¼šUI ä¾èµ–æ¨¡å—åˆå§‹åŒ– ==========</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: åˆå§‹åŒ– Markdown é…ç½®...</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: âœ“ Markdown é…ç½®æˆåŠŸï¼Œå­—ä½“å¤§å°: 18</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: âœ“ Markdown é…ç½®åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: ========== é˜¶æ®µ 3 å®Œæˆï¼šUI ä¾èµ–æ¨¡å—åˆå§‹åŒ–æˆåŠŸ ==========</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: ========== åº”ç”¨åˆå§‹åŒ–å…¨éƒ¨å®Œæˆ ==========</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: ========== åˆå§‹åŒ–çŠ¶æ€æŠ¥å‘Š ==========</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: [æ•°æ®åº“æ¨¡å—] âœ“ åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: [ç”¨æˆ·é…ç½®] âœ“ åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  W     AppInit: [ä¸šåŠ¡ç®¡ç†å™¨] âœ— åˆå§‹åŒ–å¤±è´¥ - å½±å“ï¼šæ–°é—»æ•°æ®åŠŸèƒ½ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–æ•°æ®åº“</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: [AppStorageV2] âœ“ åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: [Markdowné…ç½®] âœ“ åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: ======================================</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     EntryAbility: é˜¶æ®µ 3 åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  W     EntryAbility: åº”ç”¨åˆå§‹åŒ–ä¸å®Œæ•´ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™</span><br><span class="line">11-18 13:28:07.707   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  W     EntryAbility: åˆå§‹åŒ–çŠ¶æ€: &#123;<span class="string">&quot;databases&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;userConfig&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;managers&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;appStorageV2&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;markdown&quot;</span>:<span class="literal">true</span>&#125;</span><br><span class="line">11-18 13:28:07.708   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     KVDatabase: æˆåŠŸè·å–storeId:HongYiXunKVDBæ•°æ®åº“å®ä¾‹å¯¹è±¡</span><br><span class="line">11-18 13:28:07.708   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     NewsManager: init: è·å–appKVDbæˆåŠŸ</span><br><span class="line">11-18 13:28:07.708   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: âœ“ æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.708   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: æ­¥éª¤ 4/4ï¼šé¢„åŠ è½½åº”ç”¨æ•°æ®...</span><br><span class="line">11-18 13:28:07.708   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  D     AxiosHttp: è¿›å…¥AxiosHttp.request URL = /api/health</span><br><span class="line">11-18 13:28:07.721   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  D     AxiosHttp: è¿›å…¥AxiosHttp.request URL = /api/banner/status</span><br><span class="line">11-18 13:28:07.722   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     AppInit: ========== é˜¶æ®µ 1 å®Œæˆï¼šåŸºç¡€æ¨¡å—åˆå§‹åŒ–æˆåŠŸ ==========</span><br><span class="line">11-18 13:28:07.722   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     EntryAbility: é˜¶æ®µ 1 åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">11-18 13:28:07.723   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  I     EntryAbility: çª—å£å®½åº¦å·²å­˜å‚¨åˆ° AppStorageV2: 1320px</span><br><span class="line">11-18 13:28:07.725   8088-8088     A01234/com.xbx...Xun/XBXLogger  com.xbxyf...ongYiXun  D     StartPage: winWidth: 440</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AppInit: [ä¸šåŠ¡ç®¡ç†å™¨] âœ— åˆå§‹åŒ–å¤±è´¥ - å½±å“ï¼šæ–°é—»æ•°æ®åŠŸèƒ½ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–æ•°æ®åº“</span><br></pre></td></tr></table></figure>
<p>ä»è¿™ä¸€æ¡å’Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AppInit: âœ“ æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">AppInit: æ­¥éª¤ 4/4ï¼šé¢„åŠ è½½åº”ç”¨æ•°æ®...</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ¡çš„è¾“å‡ºé¡ºåºå¯ä»¥çœ‹å‡ºï¼Œå¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œé¡ºåºé—®é¢˜æ˜¯ç¡®å®å­˜åœ¨çš„ï¼Œæ˜¯éœ€è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<p>æ‰€ä»¥ä¸ºäº†ç¨‹åºçš„ç¨³å®šæ€§ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç•™å‡ºä¸€æ®µå¼ºåˆ¶ç©ºé—²æ—¶é—´å»ç»™å¼‚æ­¥æ“ä½œè¿›è¡Œã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ è½½å¯åŠ¨é¡µé¢</span></span><br><span class="line">windowStage.<span class="title function_">loadContent</span>(<span class="string">&#x27;pages/StartPage&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err.<span class="property">code</span>) &#123;</span><br><span class="line">    hilog.<span class="title function_">error</span>(<span class="variable constant_">DOMAIN</span>, <span class="variable constant_">TAG</span>, <span class="string">&#x27;Failed to load the content. Cause: %&#123;public&#125;s&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>é¡µé¢åŠ è½½å¤±è´¥: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(err)&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="variable constant_">TAG</span>, <span class="string">&#x27;Succeeded in loading the content.&#x27;</span>);</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>å¯åŠ¨é¡µåŠ è½½æˆåŠŸ`</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é˜¶æ®µ 3ï¼šUI ä¾èµ–æ¨¡å—åˆå§‹åŒ–</span></span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>å¼€å§‹é˜¶æ®µ 3 åˆå§‹åŒ–...`</span>)</span><br><span class="line">  <span class="keyword">const</span> phase3Success = appInit.<span class="title function_">initPhase3_UIDependent</span>()</span><br><span class="line">  <span class="keyword">if</span> (phase3Success) &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>âœ“ é˜¶æ®µ 3 åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>âš  é˜¶æ®µ 3 åˆå§‹åŒ–å¤±è´¥ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—å½±å“`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç­‰å¾…æ‰€æœ‰å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œæ‰“å°æœ€ç»ˆçŠ¶æ€æŠ¥å‘Š</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">printFinalInitStatus</span>()</span><br><span class="line">  &#125;, <span class="number">100</span>) <span class="comment">// ç»™å¼‚æ­¥æ“ä½œç•™å‡ºå®Œæˆæ—¶é—´</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>jså’Œtsçš„å¼‚æ­¥é€»è¾‘æ˜¯ä»»åŠ¡é˜Ÿåˆ—ï¼Œæˆ‘ä»¬é€šè¿‡å®šæ—¶å™¨ï¼Œå°†æ‰“å°å‡½æ•°çš„è°ƒç”¨å¡åœ¨å…¨éƒ¨å¼‚æ­¥æ“ä½œå¡åœ¨æ‰“å°ä¹‹å‰ï¼Œå¼ºåˆ¶å°†æ‰“å°å‡½æ•°çš„æ‰§è¡Œå¡åˆ°ä»»åŠ¡é˜Ÿåˆ—çš„æœ€åã€‚è¿™é‡Œè®¾ç½®ä¸º100msæ˜¯å› ä¸ºåœ¨æ­£å¸¸æƒ…å†µä¸‹è¿™äº›æ“ä½œçš„æ‰§è¡Œæ€»æ—¶é•¿åº”è¯¥æ˜¯è¿œè¿œä½äº100msï¼Œè‹¥æ˜¯é«˜äº100msåˆ™è¯´æ˜ä»–çš„æ‰§è¡Œè¿‡ç¨‹ä¸­å¤§æ¦‚ç‡å‘ç”Ÿäº†å¼‚å¸¸ã€‚</p>
<p>éšåï¼Œå¯¹äº<code>printFinalInitStatus</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè´Ÿè´£ç»Ÿä¸€çš„è¾“å‡ºä¸‰ä¸ªé˜¶æ®µçš„åˆå§‹åŒ–çŠ¶æ€æŠ¥å‘Šã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰“å°æœ€ç»ˆåˆå§‹åŒ–çŠ¶æ€æŠ¥å‘Š</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * åœ¨æ‰€æœ‰åˆå§‹åŒ–é˜¶æ®µå®Œæˆåè°ƒç”¨ï¼Œè¾“å‡ºå®Œæ•´çš„çŠ¶æ€æŠ¥å‘Š</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">printFinalInitStatus</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>========================================`</span>)</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>      åº”ç”¨åˆå§‹åŒ–å®ŒæˆçŠ¶æ€æŠ¥å‘Š`</span>)</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>========================================`</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ‰“å°è¯¦ç»†çŠ¶æ€</span></span><br><span class="line">  appInit.<span class="title function_">printInitStatus</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ£€æŸ¥å®Œæ•´åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">if</span> (appInit.<span class="title function_">isFullyInitialized</span>()) &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>`</span>)</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>ğŸ‰ åº”ç”¨å®Œå…¨åˆå§‹åŒ–æˆåŠŸï¼Œæ‰€æœ‰åŠŸèƒ½å¯ç”¨`</span>)</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>`</span>)</span><br><span class="line">    logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>âš ï¸  åº”ç”¨åˆå§‹åŒ–ä¸å®Œæ•´ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™`</span>)</span><br><span class="line">    <span class="keyword">const</span> status = appInit.<span class="title function_">getInitStatus</span>()</span><br><span class="line">    logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>è¯¦ç»†çŠ¶æ€: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(status)&#125;</span>`</span>)</span><br><span class="line">    logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.ENTRY_ABILITY&#125;</span>========================================`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>printInitStatus()</code>æ‰“å°çš„æ˜¯æ¯ä¸ªå°æ¨¡å—çš„ç»†åˆ™ï¼Œè€Œ<code>isFullyInitialized()</code>åˆ™æ˜¯æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ¨¡å—éƒ½åˆå§‹åŒ–æˆåŠŸï¼Œæ‰“å°çš„æ˜¯æ•´ä½“çš„åˆå§‹åŒ–æƒ…å†µï¼Œä¸¤è€…å¹¶ä¸ä¸€è‡´ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">Ability onCreate</span><br><span class="line">EntryAbility: åº”ç”¨å¯åŠ¨ï¼Œå¼€å§‹åˆå§‹åŒ–æµç¨‹</span><br><span class="line">AppInit: ========== å¼€å§‹é˜¶æ®µ 1ï¼šåŸºç¡€æ¨¡å—åˆå§‹åŒ– ==========</span><br><span class="line">AppInit: æ­¥éª¤ 1/4ï¼šåˆå§‹åŒ–æ•°æ®åº“æ¨¡å—...</span><br><span class="line">KVDatabase: Succeeded <span class="keyword">in</span> creating KVManager.</span><br><span class="line">KVDatabase: æ•°æ®åº“ç®¡ç†å¯¹è±¡åˆ›å»ºæˆåŠŸã€‚</span><br><span class="line">AppInit: âœ“ KV æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">AppInit: âœ“ åå¥½è®¾ç½®æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">AppInit: æ­¥éª¤ 2/4ï¼šåŠ è½½ç”¨æˆ·é…ç½®...</span><br><span class="line">PreferenceDB: Has ColorMode data: <span class="literal">false</span></span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">false</span></span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">false</span></span><br><span class="line">UserConfigManager: æ— ç”¨æˆ·é…ç½®æŒä¹…åŒ–æ•°æ®ï¼Œæ‰§è¡Œé»˜è®¤é…ç½®è®¾ç½®</span><br><span class="line">PreferenceDB: Has ColorMode data: <span class="literal">false</span></span><br><span class="line">UserConfigManager: preferenceDB.hasData(PreferenceEnum.COLOR_MODE)=<span class="literal">false</span></span><br><span class="line">PreferenceDB: push data: key=ColorMode,value=2</span><br><span class="line">PreferenceDB: Has FontSize data: <span class="literal">false</span></span><br><span class="line">UserConfigManager: preferenceDB.hasData(PreferenceEnum.FONT_SIZE)=<span class="literal">false</span></span><br><span class="line">PreferenceDB: push data: key=FontSize,value=16</span><br><span class="line">PreferenceDB: Get data ColorMode: 2</span><br><span class="line">PreferenceDB: Get data FontSize: 16</span><br><span class="line">UserConfigManager: ç”¨æˆ·é¦–é€‰é¡¹æŒä¹…åŒ–æ•°æ®è¯»å–æˆåŠŸ,colorMode=2,fontSize=16</span><br><span class="line">AppInit: âœ“ ç”¨æˆ·é…ç½®åŠ è½½æˆåŠŸ</span><br><span class="line">AppInit: æ­¥éª¤ 3/4ï¼šåˆå§‹åŒ–ä¸šåŠ¡ç®¡ç†å™¨...</span><br><span class="line">KVDatabase: Succeeded <span class="keyword">in</span> creating KVManager.</span><br><span class="line">KVDatabase: æ•°æ®åº“ç®¡ç†å¯¹è±¡åˆ›å»ºæˆåŠŸã€‚</span><br><span class="line">Ability onWindowStageCreate</span><br><span class="line">EntryAbility: çª—å£åˆ›å»ºï¼Œç­‰å¾…é˜¶æ®µ 1 å®Œæˆ...</span><br><span class="line">Ability onForeground</span><br><span class="line">EntryAbility: åº”ç”¨è¿›å…¥å‰å°</span><br><span class="line">PreferenceDB: The key FontSize changed</span><br><span class="line">PreferenceDB: The key ColorMode changed</span><br><span class="line">KVDatabase: æˆåŠŸè·å–storeId:HongYiXunKVDBæ•°æ®åº“å®ä¾‹å¯¹è±¡</span><br><span class="line">NewsManager: init: è·å–appKVDbæˆåŠŸ</span><br><span class="line">AppInit: âœ“ æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">AppInit: æ­¥éª¤ 4/4ï¼šé¢„åŠ è½½åº”ç”¨æ•°æ®...</span><br><span class="line">AxiosHttp: è¿›å…¥AxiosHttp.request URL = /api/health</span><br><span class="line">AxiosHttp: è¿›å…¥AxiosHttp.request URL = /api/banner/status</span><br><span class="line">AppInit: ========== é˜¶æ®µ 1 å®Œæˆï¼šåŸºç¡€æ¨¡å—åˆå§‹åŒ–æˆåŠŸ ==========</span><br><span class="line">EntryAbility: âœ“ é˜¶æ®µ 1 åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">EntryAbility: å¼€å§‹é˜¶æ®µ 2 åˆå§‹åŒ–...</span><br><span class="line">AppInit: ========== å¼€å§‹é˜¶æ®µ 2ï¼šçª—å£ç›¸å…³åˆå§‹åŒ– ==========</span><br><span class="line">AppInit: åˆå§‹åŒ–é¢œè‰²æ¨¡å¼ç®¡ç†å™¨...</span><br><span class="line">ColorModManager: applicationContextåˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">ColorModManager: initColoModSetting 2: AppStorageV2colorModel = 2</span><br><span class="line">AppInit: âœ“ é¢œè‰²æ¨¡å¼ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">AppInit: ========== é˜¶æ®µ 2 å®Œæˆï¼šçª—å£ç›¸å…³åˆå§‹åŒ–æˆåŠŸ ==========</span><br><span class="line">EntryAbility: âœ“ é˜¶æ®µ 2 åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">Succeeded <span class="keyword">in</span> loading the content.</span><br><span class="line">EntryAbility: å¯åŠ¨é¡µåŠ è½½æˆåŠŸ</span><br><span class="line">EntryAbility: å¼€å§‹é˜¶æ®µ 3 åˆå§‹åŒ–...</span><br><span class="line">AppInit: ========== å¼€å§‹é˜¶æ®µ 3ï¼šUI ä¾èµ–æ¨¡å—åˆå§‹åŒ– ==========</span><br><span class="line">AppInit: åˆå§‹åŒ– Markdown é…ç½®...</span><br><span class="line">AppInit: âœ“ Markdown é…ç½®æˆåŠŸï¼Œå­—ä½“å¤§å°: 16</span><br><span class="line">AppInit: âœ“ Markdown é…ç½®åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">AppInit: ========== é˜¶æ®µ 3 å®Œæˆï¼šUI ä¾èµ–æ¨¡å—åˆå§‹åŒ–æˆåŠŸ ==========</span><br><span class="line">EntryAbility: âœ“ é˜¶æ®µ 3 åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">EntryAbility: çª—å£å®½åº¦å·²å­˜å‚¨åˆ° AppStorageV2: 1320px</span><br></pre></td></tr></table></figure>
<p>åœ¨ç»è¿‡å¦‚æ­¤å¤„ç†ä¹‹åï¼Œè¾“å‡ºç»“æœçš„ç¨³å®šæ€§å¾—åˆ°äº†å¤§å¹…æå‡ï¼Œç»è¿‡20æ¬¡çš„å¯åŠ¨æµ‹è¯•å‡æœªå†å‡ºç°å¼‚æ­¥å‡½æ•°æ‰§è¡Œé¡ºåºå¯¼è‡´çš„åˆå§‹åŒ–çŠ¶æ€é”™è¯¯ã€‚</p>
<h4 id="å¼‚æ­¥ä»»åŠ¡ç®¡ç†çš„å…³é”®å‡½æ•°"><a href="#å¼‚æ­¥ä»»åŠ¡ç®¡ç†çš„å…³é”®å‡½æ•°" class="headerlink" title="å¼‚æ­¥ä»»åŠ¡ç®¡ç†çš„å…³é”®å‡½æ•°"></a>å¼‚æ­¥ä»»åŠ¡ç®¡ç†çš„å…³é”®å‡½æ•°</h4><p>åœ¨æˆ‘ä»¬AppInitçš„å¼‚æ­¥å‡½æ•°æ§åˆ¶ä¸­ä½¿ç”¨äº†å¤§é‡çš„Promiseç±»å†…ç½®çš„é™æ€æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿä½¿ç”¨äº†<code>async/await</code>çš„å¤„ç†æ–¹å¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥ç€é‡è§£æä¸€ä¸‹è¿™äº›æ–¹æ³•çš„ä½œç”¨ã€‚</p>
<h5 id="async-awaitä¸Promise"><a href="#async-awaitä¸Promise" class="headerlink" title="async/awaitä¸Promise"></a><code>async/await</code>ä¸Promise</h5><p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®<code>async/await</code>ä¸Promiseçš„å…³ç³»ï¼Œ<code>async/await</code>æ˜¯Promiseçš„è¯­æ³•ç³–ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨åŒæ­¥çš„ä»£ç é£æ ¼ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨å›è°ƒå‡½æ•°æˆ–è€…<code>then</code>æ–¹æ³•ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä»å‡½æ•°çš„è¿”å›å€¼ç±»å‹æ¥çœ‹ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–ä¸šåŠ¡ç®¡ç†å™¨</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–å„ä¸ªä¸šåŠ¡æ¨¡å—çš„ç®¡ç†å™¨</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">context</span> - UIAbility ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> Promise&lt;boolean&gt; - æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment"> * ç®¡ç†å™¨åˆ—è¡¨ï¼š</span></span><br><span class="line"><span class="comment"> * - NewsManagerï¼šæ–°é—»æ•°æ®ç®¡ç†</span></span><br><span class="line"><span class="comment"> * - å…¶ä»–ä¸šåŠ¡ç®¡ç†å™¨...</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * æ³¨æ„ï¼šColorModManager ä¾èµ– ApplicationContextï¼Œåœ¨é˜¶æ®µ 2 åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">initManagers</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ–°é—»ç®¡ç†å™¨</span></span><br><span class="line">    <span class="keyword">const</span> newsManagerInitSuccess = <span class="keyword">await</span> newsManager.<span class="title function_">init</span>(context)</span><br><span class="line">    <span class="keyword">if</span> (newsManagerInitSuccess) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ“ æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">managers</span> = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥ - åŸå› ï¼šæ— æ³•è·å– KV æ•°æ®åº“å®ä¾‹`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— ç®¡ç†å™¨åˆå§‹åŒ–å¼‚å¸¸ - åŸå› ï¼š<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°ä¸­åªåŒ…å«äº†ä¸€ä¸ªå¼‚æ­¥çš„è€—æ—¶æ“ä½œï¼ŒåŒæ—¶æˆ‘ä»¬çš„booleanç±»å‹çš„è¿”å›å€¼è¡¨ç¤ºçš„å«ä¹‰æ˜¯åˆå§‹åŒ–ç®¡ç†å™¨æ˜¯å¦æˆåŠŸï¼Œæ˜¯å¼ºä¾èµ–äºæ–°é—»ç®¡ç†å™¨çš„åˆå§‹åŒ–ç»“æœçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç­‰å¾…æ–°é—»ç®¡ç†å™¨çš„åˆå§‹åŒ–å®Œæˆä¹‹åæ‰èƒ½è¿”å›ç»“æœã€‚å¯¹äºè¿™ç§å•ä¸€çš„å¼‚æ­¥æ“ä½œå‡½æ•°æˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>async/await</code>çš„æ–¹å¼æ¥å¤„ç†ï¼Œå’Œä½¿ç”¨<code>then</code>æ–¹æ³•çš„æ–¹å¼æ²¡æœ‰åŒºåˆ«ï¼ŒåŒæ—¶å¯ä»¥ä½¿ä»£ç é£æ ¼æ›´åŠ ç®€æ´ã€‚</p>
<p>æˆ‘ä»¬å¦‚æœç›´æ¥è°ƒç”¨<code>initManagers</code>è¿™ä¸ªå‡½æ•°ï¼Œè·å–åˆ°çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œè€Œå¹¶ä¸æ˜¯booleanç±»å‹çš„ç»“æœã€‚åªæœ‰ç­‰å¾…å…¶æ“ä½œå®Œæˆåï¼Œé€šè¿‡<code>await</code>æˆ–è€…<code>.then()</code>æ‰èƒ½è·å–åˆ°çœŸæ­£çš„booleanå€¼ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä¸€ä¸ªå‡½æ•°è¢«æ ‡è®°ä¸º<code>async</code>æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ã€‚è¿™æ„å‘³ç€è°ƒç”¨è€…å¿…é¡»ä½¿ç”¨å¼‚æ­¥æ–¹å¼ï¼ˆ<code>await</code>æˆ–<code>.then()</code>ï¼‰æ¥å¤„ç†ç»“æœã€‚è¿™ç§è®¾è®¡è™½ç„¶ç®€åŒ–äº†å¼‚æ­¥ä»£ç çš„ç¼–å†™ï¼Œä½†ä¹Ÿæ„å‘³ç€ä»»ä½•è°ƒç”¨<code>async</code>å‡½æ•°çš„ä»£ç ä¹Ÿéƒ½å˜æˆäº†å¼‚æ­¥çš„ï¼Œå½¢æˆäº†å¼‚æ­¥è°ƒç”¨çš„é“¾æ¡æ•ˆåº”ã€‚åœ¨å¤æ‚çš„åˆå§‹åŒ–æµç¨‹ä¸­ï¼Œè¿™ç§å¼‚æ­¥ä¼ æ’­éœ€è¦è°¨æ…ç®¡ç†ï¼Œä»¥é¿å…å‡ºç°æ‰§è¡Œé¡ºåºä¸ç¡®å®šçš„é—®é¢˜ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ›´è¿›ä¸€æ­¥çš„è§£æä¸€ä¸‹æ‰€è°“çš„å¼‚æ­¥è°ƒç”¨é“¾æ•ˆåº”ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–ä¸šåŠ¡ç®¡ç†å™¨</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–å„ä¸ªä¸šåŠ¡æ¨¡å—çš„ç®¡ç†å™¨</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">context</span> - UIAbility ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> Promise&lt;boolean&gt; - æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment"> * ç®¡ç†å™¨åˆ—è¡¨ï¼š</span></span><br><span class="line"><span class="comment"> * - NewsManagerï¼šæ–°é—»æ•°æ®ç®¡ç†</span></span><br><span class="line"><span class="comment"> * - å…¶ä»–ä¸šåŠ¡ç®¡ç†å™¨...</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * æ³¨æ„ï¼šColorModManager ä¾èµ– ApplicationContextï¼Œåœ¨é˜¶æ®µ 2 åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">initManagers</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ–°é—»ç®¡ç†å™¨</span></span><br><span class="line">    <span class="keyword">const</span> newsManagerInitSuccess = <span class="keyword">await</span> newsManager.<span class="title function_">init</span>(context)</span><br><span class="line">    <span class="keyword">if</span> (newsManagerInitSuccess) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ“ æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">managers</span> = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥ - åŸå› ï¼šæ— æ³•è·å– KV æ•°æ®åº“å®ä¾‹`</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>âœ— ç®¡ç†å™¨åˆå§‹åŒ–å¼‚å¸¸ - åŸå› ï¼š<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–å‡½æ•°ï¼Œè·å–å½“å‰åº”ç”¨çš„é”®å€¼å¯¹æ•°æ®åº“å®ä¾‹ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">context</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">init</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">  kvDatabase.<span class="title function_">init</span>(context)</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> kvDatabase.<span class="title function_">getKVStoreById</span>(<span class="variable constant_">APP_KV_DB_ID</span>)</span><br><span class="line">  <span class="keyword">if</span> (res) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">appKVDb</span> = res</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>init: è·å–appKVDbæˆåŠŸ`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>åˆå§‹åŒ–å¤±è´¥`</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡ ID è·å–æ•°æ®åº“å®ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * æ ¹æ®æŒ‡å®šçš„æ•°æ®åº“ ID è·å–æˆ–åˆ›å»ºä¸€ä¸ª KV æ•°æ®åº“å®ä¾‹</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">storeId</span> - æ•°æ®åº“å®ä¾‹çš„å”¯ä¸€æ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> Promise&lt;SingleKVStore | null&gt; - æ•°æ®åº“å®ä¾‹å¯¹è±¡ï¼Œå¤±è´¥æ—¶è¿”å› null</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment"> * å‰ç½®æ¡ä»¶ï¼š</span></span><br><span class="line"><span class="comment"> * - å¿…é¡»å…ˆè°ƒç”¨ init() æ–¹æ³•åˆå§‹åŒ– KVManager</span></span><br><span class="line"><span class="comment"> * - å¦‚æœ kvManager æœªåˆå§‹åŒ–ï¼Œå°†ç›´æ¥è¿”å› null</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * æ•°æ®åº“é…ç½®ï¼š</span></span><br><span class="line"><span class="comment"> * - createIfMissing: true - æ•°æ®åº“ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º</span></span><br><span class="line"><span class="comment"> * - securityLevel: S1 - å®‰å…¨çº§åˆ«ï¼ˆS1 ä¸ºæœ€ä½çº§åˆ«ï¼Œé€‚åˆå…¬å¼€æ•°æ®ï¼‰</span></span><br><span class="line"><span class="comment"> * - kvStoreType: SINGLE_VERSION - å•ç‰ˆæœ¬æ•°æ®åº“ï¼ˆä¸æ”¯æŒåˆ†å¸ƒå¼åŒæ­¥ï¼‰</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * ç›‘å¬æœºåˆ¶ï¼š</span></span><br><span class="line"><span class="comment"> * - è‡ªåŠ¨ç›‘å¬æ•°æ®åº“æœåŠ¡çŠ¶æ€å˜åŒ–</span></span><br><span class="line"><span class="comment"> * - å½“æ•°æ®åº“æœåŠ¡å¼‚å¸¸æ—¶ä¼šè®°å½•è­¦å‘Šæ—¥å¿—</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨å»ºè®®ï¼š</span></span><br><span class="line"><span class="comment"> * - å»ºè®®ä¸ºä¸åŒç±»å‹çš„æ•°æ®åˆ›å»ºä¸åŒçš„æ•°æ®åº“å®ä¾‹</span></span><br><span class="line"><span class="comment"> * - æœ¬åº”ç”¨ä¸­ä½¿ç”¨ APP_KV_DB å¸¸é‡ä½œä¸ºç»Ÿä¸€çš„ storeId</span></span><br><span class="line"><span class="comment"> * - æ•°æ®åº“å®ä¾‹å¯ä»¥è¢«ç¼“å­˜å¤ç”¨ï¼Œæ— éœ€æ¯æ¬¡éƒ½é‡æ–°è·å–</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * ```typescript</span></span><br><span class="line"><span class="comment"> * // è·å–æ•°æ®åº“å®ä¾‹</span></span><br><span class="line"><span class="comment"> * const store = await kvDatabase.getKVStoreById(APP_KV_DB)</span></span><br><span class="line"><span class="comment"> * if (store) &#123;</span></span><br><span class="line"><span class="comment"> *   // å­˜å‚¨æ•°æ®</span></span><br><span class="line"><span class="comment"> *   await store.put(KV_DB_KEYS.NEWS_ARTICLE_LIST, JSON.stringify(newsList))</span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> *   // è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment"> *   const data = await store.get(KV_DB_KEYS.NEWS_ARTICLE_LIST)</span></span><br><span class="line"><span class="comment"> *   const articles = JSON.parse(data as string)</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> * ```</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€æœ‰é”™è¯¯éƒ½ä¼šè¢«æ•è·å¹¶è®°å½•æ—¥å¿—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getKVStoreById</span>(<span class="attr">storeId</span>:<span class="built_in">string</span>):<span class="title class_">Promise</span>&lt;distributedKVStore.<span class="property">SingleKVStore</span>|<span class="literal">null</span>&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">kvManager</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">options</span>:distributedKVStore.<span class="property">Options</span> = &#123;</span><br><span class="line">        <span class="attr">createIfMissing</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">securityLevel</span>: distributedKVStore.<span class="property">SecurityLevel</span>.<span class="property">S1</span>,</span><br><span class="line">        <span class="attr">kvStoreType</span>:distributedKVStore.<span class="property">KVStoreType</span>.<span class="property">SINGLE_VERSION</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">kVStore</span>:distributedKVStore.<span class="property">SingleKVStore</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">kvManager</span>.<span class="title function_">getKVStore</span>(storeId,options)</span><br><span class="line">      <span class="keyword">if</span> (kVStore) &#123;</span><br><span class="line">        logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.KV_DATABASE&#125;</span>æˆåŠŸè·å–storeId:<span class="subst">$&#123;storeId&#125;</span>æ•°æ®åº“å®ä¾‹å¯¹è±¡`</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">kvManager</span>.<span class="title function_">on</span>(<span class="string">&#x27;distributedDataServiceDie&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.KV_DATABASE&#125;</span>æ•°æ®åº“æœåŠ¡è®¢é˜…å‘ç”Ÿå˜æ›´`</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> kVStore</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (e)&#123;</span><br><span class="line">      <span class="keyword">let</span> err = e <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.KV_DATABASE&#125;</span>è·å–KVæ•°æ®åº“å®ä¾‹å¯¹è±¡å¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯: <span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates and obtains a KVStore database by specifying &#123;<span class="doctag">@code</span> Options&#125; and &#123;<span class="doctag">@code</span> storeId&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">storeId</span> - Identifies the KVStore database. The value of this parameter must be unique</span></span><br><span class="line"><span class="comment"> * for the same application, and different applications can share the same value. The storeId can consist</span></span><br><span class="line"><span class="comment"> * of only letters, digits, and underscores (_), and cannot exceed 128 characters.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> Options </span>&#125; <span class="variable">options</span> - Indicates the &#123;<span class="doctag">@code</span> Options&#125; object used for creating and</span></span><br><span class="line"><span class="comment"> * obtaining the KVStore database.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type"> Promise&lt;T&gt; </span>&#125; &#123;<span class="type">T</span>&#125;: the &#123;<span class="doctag">@code</span> SingleKVStore&#125; or &#123;<span class="doctag">@code</span> DeviceKVStore&#125; instance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> &#123;<span class="type"> BusinessError </span>&#125; 401 - Parameter error.Possible causes:1.Mandatory parameters are left unspecified;</span></span><br><span class="line"><span class="comment"> * &lt;br&gt;2.Incorrect parameters types;</span></span><br><span class="line"><span class="comment"> * &lt;br&gt;3.Parameter verification failed.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> &#123;<span class="type"> BusinessError </span>&#125; 15100002 - Open existed database with changed options.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> &#123;<span class="type"> BusinessError </span>&#125; 15100003 - Database corrupted.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@syscap</span> SystemCapability.DistributedDataManager.KVStore.Core</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 9</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">getKVStore&lt;T&gt;(<span class="attr">storeId</span>: <span class="built_in">string</span>, <span class="attr">options</span>: <span class="title class_">Options</span>): <span class="title class_">Promise</span>&lt;T&gt;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘å°†æ•´ä¸ªè°ƒç”¨é“¾æ¡æ‰€æ¶‰åŠåˆ°çš„å…¨éƒ¨å‡½æ•°éƒ½åˆ—å‡ºæ¥äº†ï¼Œå…¶å®å¯ä»¥çœ‹å‡ºæ•´ä¸ªå¼‚æ­¥è°ƒç”¨é“¾æ¡çš„æ ¹æºæ˜¯æ¥è‡ª<code>getKVStore</code>å‡½æ•°ï¼Œè¿™æ˜¯æˆ‘ä»¬ä½œä¸ºåº”ç”¨å¼€å‘è€…æ‰€èƒ½æ¥è§¦åˆ°çš„æœ€åº•å±‚çš„ä¸€ä¸ªç³»ç»Ÿæ¥å£ï¼Œæ›´æ·±å±‚çš„å®ç°å°±ä¸å¼€å‘è€…æ— å…³äº†ï¼Œå°±å¦‚åŒè®¡ç®—æœºç½‘ç»œä¸­ä¸‹å±‚åè®®å¯¹ä¸Šå±‚é€æ˜ä¸€æ ·ã€‚ä¸ºäº†æ–¹ä¾¿åº”ç”¨çš„æ•°æ®ç®¡ç†æˆ‘ä»¬å°è£…äº†<code>KVDatabase</code>ç±»ã€<code>NewsManager</code>ç±»ã€<code>AppInit</code>ç±»ã€‚</p>
<h5 id="å±‚å±‚å°è£…çš„ç»“æ„åˆ†æ"><a href="#å±‚å±‚å°è£…çš„ç»“æ„åˆ†æ" class="headerlink" title="å±‚å±‚å°è£…çš„ç»“æ„åˆ†æ"></a>å±‚å±‚å°è£…çš„ç»“æ„åˆ†æ</h5><p>è®©æˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹æ•´ä¸ªè°ƒç”¨é“¾æ¡çš„å±‚çº§å…³ç³»ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬1å±‚(ç³»ç»Ÿæ¥å£): kvManager.getKVStore() -&gt; Promise&lt;SingleKVStore&gt;</span><br><span class="line">              â†“</span><br><span class="line">ç¬¬2å±‚(æ•°æ®åº“å°è£…): kvDatabase.getKVStoreById() -&gt; Promise&lt;SingleKVStore | null&gt;</span><br><span class="line">              â†“</span><br><span class="line">ç¬¬3å±‚(ä¸šåŠ¡ç®¡ç†å™¨): newsManager.init() -&gt; Promise&lt;boolean&gt;</span><br><span class="line">              â†“</span><br><span class="line">ç¬¬4å±‚(åˆå§‹åŒ–ç®¡ç†å™¨): appInit.initManagers() -&gt; Promise&lt;boolean&gt;</span><br><span class="line">              â†“</span><br><span class="line">ç¬¬5å±‚(é˜¶æ®µåˆå§‹åŒ–): appInit.initPhase1_BaseModules() -&gt; Promise&lt;boolean&gt;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸€å±‚å°è£…éƒ½åœ¨åŸæœ‰åŠŸèƒ½çš„åŸºç¡€ä¸Šæ·»åŠ äº†æ–°çš„èŒè´£ï¼š</p>
<ul>
<li><strong>ç¬¬2å±‚ KVDatabase</strong>ï¼šæ·»åŠ äº†é”™è¯¯å¤„ç†ã€æ—¥å¿—è®°å½•ã€å®ä¾‹ç®¡ç†</li>
<li><strong>ç¬¬3å±‚ NewsManager</strong>ï¼šæ·»åŠ äº†ä¸šåŠ¡é€»è¾‘å°è£…ã€æ•°æ®åº“å®ä¾‹ç¼“å­˜</li>
<li><strong>ç¬¬4å±‚ initManagers</strong>ï¼šæ·»åŠ äº†çŠ¶æ€è¿½è¸ªã€å¤šç®¡ç†å™¨åè°ƒ</li>
<li><strong>ç¬¬5å±‚ initPhase1</strong>ï¼šæ·»åŠ äº†é˜¶æ®µåˆ’åˆ†ã€æ­¥éª¤ç¼–æ’ã€è¿›åº¦æŠ¥å‘Š</li>
</ul>
<h5 id="å±‚å±‚å°è£…å¯¹åº”ç”¨æ¶æ„çš„å½±å“"><a href="#å±‚å±‚å°è£…å¯¹åº”ç”¨æ¶æ„çš„å½±å“" class="headerlink" title="å±‚å±‚å°è£…å¯¹åº”ç”¨æ¶æ„çš„å½±å“"></a>å±‚å±‚å°è£…å¯¹åº”ç”¨æ¶æ„çš„å½±å“</h5><h6 id="æ­£é¢å½±å“"><a href="#æ­£é¢å½±å“" class="headerlink" title="æ­£é¢å½±å“"></a>æ­£é¢å½±å“</h6><p><strong>1. èŒè´£åˆ†ç¦»ä¸å•ä¸€èŒè´£åŸåˆ™</strong></p>
<p>æ¯ä¸€å±‚å°è£…éƒ½æœ‰å…¶æ˜ç¡®çš„èŒè´£è¾¹ç•Œï¼Œè¿™ç§è®¾è®¡ç¬¦åˆSOLIDåŸåˆ™ä¸­çš„å•ä¸€èŒè´£åŸåˆ™ï¼š</p>
<ul>
<li><code>KVDatabase</code>ç±»ï¼šè´Ÿè´£é”®å€¼æ•°æ®åº“çš„åº•å±‚æ“ä½œï¼Œå±è”½ç³»ç»Ÿæ¥å£çš„å¤æ‚æ€§</li>
<li><code>NewsManager</code>ç±»ï¼šè´Ÿè´£æ–°é—»æ•°æ®çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¸å…³å¿ƒæ•°æ®åº“çš„å…·ä½“å®ç°</li>
<li><code>AppInit</code>ç±»ï¼šè´Ÿè´£åº”ç”¨çš„åˆå§‹åŒ–æµç¨‹ç¼–æ’ï¼Œä¸å…³å¿ƒå„æ¨¡å—çš„å†…éƒ¨å®ç°ç»†èŠ‚</li>
</ul>
<p>è¿™ç§åˆ†å±‚ä½¿å¾—æ¯ä¸ªæ¨¡å—çš„ä»£ç æ›´åŠ å†…èšï¼Œä¿®æ”¹æŸä¸€å±‚çš„å®ç°ä¸ä¼šå½±å“å…¶ä»–å±‚ã€‚æ¯”å¦‚æˆ‘ä»¬åç»­å¦‚æœè¦å°†é”®å€¼æ•°æ®åº“æ¢æˆå…³ç³»å‹æ•°æ®åº“ï¼Œåªéœ€è¦ä¿®æ”¹<code>KVDatabase</code>ç±»çš„å®ç°ï¼Œè€Œ<code>NewsManager</code>å’Œ<code>AppInit</code>çš„ä»£ç æ— éœ€æ”¹åŠ¨ã€‚</p>
<p><strong>2. ä»£ç å¤ç”¨æ€§æå‡</strong></p>
<p>é€šè¿‡å°è£…ï¼Œæˆ‘ä»¬é¿å…äº†ä»£ç é‡å¤ã€‚æ¯”å¦‚<code>kvDatabase.getKVStoreById()</code>è¿™ä¸ªæ–¹æ³•åœ¨é¡¹ç›®ä¸­è¢«å¤šä¸ªManagerè°ƒç”¨ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NewsManagerä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">await</span> kvDatabase.<span class="title function_">getKVStoreById</span>(<span class="variable constant_">APP_KV_DB_ID</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœªæ¥å¯èƒ½çš„UserManagerä¸­ä¹Ÿä¼šä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> userStore = <span class="keyword">await</span> kvDatabase.<span class="title function_">getKVStoreById</span>(<span class="variable constant_">USER_KV_DB_ID</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ConfigManagerä¸­ä¹Ÿä¼šä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> configStore = <span class="keyword">await</span> kvDatabase.<span class="title function_">getKVStoreById</span>(<span class="variable constant_">CONFIG_KV_DB_ID</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ²¡æœ‰è¿™å±‚å°è£…ï¼Œæ¯ä¸ªManageréƒ½éœ€è¦é‡å¤ç¼–å†™è·å–æ•°æ®åº“çš„é€»è¾‘ã€é”™è¯¯å¤„ç†ã€æ—¥å¿—è®°å½•ç­‰ä»£ç ï¼Œè¿™ä¼šå¯¼è‡´å¤§é‡çš„ä»£ç é‡å¤å’Œç»´æŠ¤å›°éš¾ã€‚</p>
<p><strong>3. é”™è¯¯å¤„ç†çš„å±‚æ¬¡åŒ–</strong></p>
<p>æ¯ä¸€å±‚éƒ½å¯ä»¥æ ¹æ®è‡ªå·±çš„èŒè´£æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†ç­–ç•¥ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬2å±‚: KVDatabase - æ•è·ç³»ç»Ÿå¼‚å¸¸,è¿”å›null</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getKVStoreById</span>(<span class="attr">storeId</span>:<span class="built_in">string</span>):<span class="title class_">Promise</span>&lt;distributedKVStore.<span class="property">SingleKVStore</span>|<span class="literal">null</span>&gt;&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> kVStore = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">kvManager</span>.<span class="title function_">getKVStore</span>(storeId,options)</span><br><span class="line">    <span class="keyword">return</span> kVStore</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`è·å–KVæ•°æ®åº“å®ä¾‹å¯¹è±¡å¼‚å¸¸`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>  <span class="comment">// è½¬æ¢å¼‚å¸¸ä¸ºnullå€¼</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬3å±‚: NewsManager - æ£€æŸ¥null,è¿”å›boolean</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">init</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> kvDatabase.<span class="title function_">getKVStoreById</span>(<span class="variable constant_">APP_KV_DB_ID</span>)</span><br><span class="line">  <span class="keyword">if</span> (res) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">appKVDb</span> = res</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>  <span class="comment">// å°†nullè½¬æ¢ä¸ºå¤±è´¥çŠ¶æ€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬4å±‚: AppInit - è®°å½•è¯¦ç»†çŠ¶æ€,å½±å“æ•´ä½“åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">initManagers</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> newsManagerInitSuccess = <span class="keyword">await</span> newsManager.<span class="title function_">init</span>(context)</span><br><span class="line">  <span class="keyword">if</span> (newsManagerInitSuccess) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">managers</span> = <span class="literal">true</span>  <span class="comment">// è®°å½•åˆ°çŠ¶æ€è¿½è¸ª</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newsManagerInitSuccess</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§å±‚æ¬¡åŒ–çš„é”™è¯¯å¤„ç†ä½¿å¾—å¼‚å¸¸å¯ä»¥åœ¨æœ€åˆé€‚çš„å±‚çº§è¢«å¤„ç†ï¼Œä¸Šå±‚ä»£ç ä¸éœ€è¦å…³å¿ƒåº•å±‚çš„å…·ä½“å¼‚å¸¸ç±»å‹ï¼Œåªéœ€è¦å…³å¿ƒæ“ä½œæ˜¯å¦æˆåŠŸã€‚</p>
<h6 id="è´Ÿé¢å½±å“"><a href="#è´Ÿé¢å½±å“" class="headerlink" title="è´Ÿé¢å½±å“"></a>è´Ÿé¢å½±å“</h6><p><strong>1. æ€§èƒ½å¼€é”€</strong></p>
<p>æ¯ä¸€å±‚çš„å°è£…éƒ½ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š</p>
<ul>
<li><strong>å‡½æ•°è°ƒç”¨æ ˆçš„å¢åŠ </strong>ï¼šä»<code>getKVStore</code>åˆ°æœ€ç»ˆçš„<code>initPhase1</code>ï¼Œéœ€è¦ç»è¿‡5å±‚å‡½æ•°è°ƒç”¨</li>
<li><strong>Promiseé“¾æ¡çš„å»¶é•¿</strong>ï¼šæ¯ä¸€å±‚éƒ½æ˜¯ä¸€ä¸ªPromiseï¼Œæ„å‘³ç€è‡³å°‘5æ¬¡çš„PromiseçŠ¶æ€è½¬æ¢</li>
<li><strong>é”™è¯¯å¤„ç†çš„é‡å¤</strong>ï¼šæ¯ä¸€å±‚éƒ½å¯èƒ½æœ‰try-catchï¼Œå¢åŠ äº†é”™è¯¯æ£€æŸ¥çš„æ¬¡æ•°</li>
</ul>
<p>ä¸è¿‡åœ¨åº”ç”¨åˆå§‹åŒ–è¿™ç§éé«˜é¢‘åœºæ™¯ä¸­ï¼Œè¿™äº›æ€§èƒ½å¼€é”€æ˜¯å¯ä»¥æ¥å—çš„ã€‚å¦‚æœæ˜¯åœ¨é«˜é¢‘è°ƒç”¨çš„åœºæ™¯ï¼ˆæ¯”å¦‚æ»šåŠ¨åˆ—è¡¨çš„æ¸²æŸ“ï¼‰ï¼Œå°±éœ€è¦ä»”ç»†æƒè¡¡å°è£…å±‚æ¬¡ã€‚</p>
<p><strong>2. è°ƒè¯•å¤æ‚åº¦å¢åŠ </strong></p>
<p>å½“å‡ºç°é—®é¢˜æ—¶ï¼Œéœ€è¦é€å±‚æ’æŸ¥æ‰èƒ½å®šä½é—®é¢˜æ ¹æºã€‚æ¯”å¦‚å½“æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥æ—¶ï¼Œå¯èƒ½çš„åŸå› æœ‰ï¼š</p>
<ul>
<li>ç³»ç»Ÿå±‚ï¼š<code>kvManager.getKVStore()</code>è°ƒç”¨å¤±è´¥</li>
<li>å°è£…å±‚ï¼š<code>KVDatabase</code>åˆå§‹åŒ–å¤±è´¥ï¼ŒkvManagerä¸ºnull</li>
<li>ä¸šåŠ¡å±‚ï¼šstoreIdé…ç½®é”™è¯¯</li>
<li>è°ƒç”¨å±‚ï¼šcontextä¼ é€’é”™è¯¯</li>
</ul>
<p>éœ€è¦é€šè¿‡æ—¥å¿—è¾“å‡ºæ‰èƒ½å¿«é€Ÿå®šä½é—®é¢˜æ‰€åœ¨çš„å±‚çº§ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨æ¯ä¸€å±‚éƒ½æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è®°å½•ã€‚</p>
<p><strong>3. å¼‚æ­¥é“¾æ¡çš„ä¼ æ’­æ•ˆåº”</strong></p>
<p>è¿™æ˜¯æœ€é‡è¦ä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«å¿½è§†çš„å½±å“ã€‚ä¸€æ—¦åº•å±‚å‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œæ•´ä¸ªè°ƒç”¨é“¾æ¡éƒ½ä¼šå˜æˆå¼‚æ­¥ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åº•å±‚æ˜¯å¼‚æ­¥çš„</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getKVStore</span>() -&gt; <span class="title class_">Promise</span>&lt;T&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼è‡´æ‰€æœ‰ä¸Šå±‚éƒ½å¿…é¡»æ˜¯å¼‚æ­¥çš„</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getKVStoreById</span>() -&gt; <span class="title class_">Promise</span>&lt;<span class="title class_">SingleKVStore</span>|<span class="literal">null</span>&gt;</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">init</span>() -&gt; <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">initManagers</span>() -&gt; <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">initPhase1_BaseModules</span>() -&gt; <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”šè‡³å½±å“åˆ°è°ƒç”¨æ–¹</span></span><br><span class="line"><span class="title function_">onCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// å¿…é¡»ä½¿ç”¨å¼‚æ­¥æ–¹å¼è°ƒç”¨</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">phase1Promise</span> = appInit.<span class="title function_">initPhase1_BaseModules</span>(<span class="variable language_">this</span>.<span class="property">context</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§â€å¼‚æ­¥ä¼ æŸ“â€æ˜¯ä¸å¯é¿å…çš„ï¼Œä¸€æ—¦æŸä¸ªåº•å±‚å‡½æ•°è¿”å›Promiseï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„ä¸Šå±‚å‡½æ•°éƒ½å¿…é¡»å¤„ç†è¿™ä¸ªå¼‚æ­¥æ€§ã€‚</p>
<h5 id="å±‚å±‚å°è£…å¯¹å¼‚æ­¥ç®¡ç†çš„å½±å“"><a href="#å±‚å±‚å°è£…å¯¹å¼‚æ­¥ç®¡ç†çš„å½±å“" class="headerlink" title="å±‚å±‚å°è£…å¯¹å¼‚æ­¥ç®¡ç†çš„å½±å“"></a>å±‚å±‚å°è£…å¯¹å¼‚æ­¥ç®¡ç†çš„å½±å“</h5><h6 id="1-å¼‚æ­¥æ“ä½œçš„ä¸²è¡ŒåŒ–"><a href="#1-å¼‚æ­¥æ“ä½œçš„ä¸²è¡ŒåŒ–" class="headerlink" title="1. å¼‚æ­¥æ“ä½œçš„ä¸²è¡ŒåŒ–"></a>1. å¼‚æ­¥æ“ä½œçš„ä¸²è¡ŒåŒ–</h6><p>ç”±äºæ¯ä¸€å±‚éƒ½ä¾èµ–äºä¸‹ä¸€å±‚çš„æ‰§è¡Œç»“æœï¼Œè¿™äº›å¼‚æ­¥æ“ä½œå¿…ç„¶æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">initPhase1_BaseModules</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// æ­¥éª¤1: åˆå§‹åŒ–æ•°æ®åº“ (å¼‚æ­¥)</span></span><br><span class="line">  <span class="keyword">const</span> dbInitSuccess = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">initDatabases</span>(uiAbilityContext)</span><br><span class="line">  <span class="keyword">if</span> (!dbInitSuccess) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ­¥éª¤2: åŠ è½½ç”¨æˆ·é…ç½® (åŒæ­¥,ä½†ä¾èµ–æ­¥éª¤1)</span></span><br><span class="line">  <span class="keyword">const</span> configInitSuccess = <span class="variable language_">this</span>.<span class="title function_">initUserConfig</span>(uiAbilityContext)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ­¥éª¤3: åˆå§‹åŒ–ç®¡ç†å™¨ (å¼‚æ­¥,ä¾èµ–æ­¥éª¤1)</span></span><br><span class="line">  <span class="keyword">const</span> managersInitSuccess = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">initManagers</span>(uiAbilityContext)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ­¥éª¤4: é¢„åŠ è½½æ•°æ® (å¼‚æ­¥,ä¾èµ–æ­¥éª¤3)</span></span><br><span class="line">  <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">preloadData</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶æˆ‘ä»¬ä½¿ç”¨äº†<code>await</code>æ¥ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆï¼Œä½†è¿™ç§ä¸²è¡ŒåŒ–ä¹Ÿæ„å‘³ç€æ€»è€—æ—¶æ˜¯æ‰€æœ‰æ­¥éª¤è€—æ—¶çš„æ€»å’Œã€‚å¦‚æœæŸä¸ªæ­¥éª¤è€—æ—¶è¾ƒé•¿ï¼Œä¼šç›´æ¥å½±å“æ•´ä½“çš„åˆå§‹åŒ–é€Ÿåº¦ã€‚</p>
<h6 id="2-å¼‚æ­¥æ“ä½œçš„å¹¶è¡Œä¼˜åŒ–"><a href="#2-å¼‚æ­¥æ“ä½œçš„å¹¶è¡Œä¼˜åŒ–" class="headerlink" title="2. å¼‚æ­¥æ“ä½œçš„å¹¶è¡Œä¼˜åŒ–"></a>2. å¼‚æ­¥æ“ä½œçš„å¹¶è¡Œä¼˜åŒ–</h6><p>åœ¨å±‚å±‚å°è£…çš„æ¶æ„ä¸‹ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥åœ¨åˆé€‚çš„å±‚çº§å¼•å…¥å¹¶è¡Œä¼˜åŒ–ã€‚æ¯”å¦‚åœ¨<code>preloadData()</code>ä¸­ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">preloadData</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨Promise.allå®ç°å¹¶è¡ŒåŠ è½½</span></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">      newsManager.<span class="title function_">updateNewsListToDB</span>(),</span><br><span class="line">      newsManager.<span class="title function_">updateNewsSwiperToDB</span>()</span><br><span class="line">    ]).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`æ•°æ®é¢„åŠ è½½å®Œæˆ`</span>)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">Error</span></span>) =&gt;</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`æ•°æ®é¢„åŠ è½½å¤±è´¥: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    logger.<span class="title function_">warn</span>(<span class="string">`æ•°æ®é¢„åŠ è½½å¼‚å¸¸: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>Promise.all()</code>è®©æ–°é—»åˆ—è¡¨å’Œè½®æ’­å›¾çš„åŠ è½½å¹¶è¡Œè¿›è¡Œï¼Œè€Œä¸æ˜¯ä¸²è¡Œç­‰å¾…ã€‚è¿™ç§ä¼˜åŒ–å¯ä»¥åœ¨ä¸ç ´åå°è£…ç»“æ„çš„å‰æä¸‹æå‡æ€§èƒ½ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é¢å¤–æ·»åŠ ä¸€äº›é’ˆå¯¹äº<code>Promise.all()</code>çš„åŸç†è§£æï¼š</p>
<p><strong>Promise.all()çš„å·¥ä½œæœºåˆ¶</strong></p>
<p><code>Promise.all()</code>æ˜¯JavaScript/TypeScriptä¸­ç”¨äºå¤„ç†å¤šä¸ªå¼‚æ­¥æ“ä½œçš„é™æ€æ–¹æ³•ï¼Œå®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼š</p>
<ol>
<li><strong>å¹¶è¡Œå¯åŠ¨</strong>ï¼šæ¥æ”¶ä¸€ä¸ªPromiseæ•°ç»„ï¼Œä¼šç«‹å³å¯åŠ¨æ‰€æœ‰Promiseï¼Œè€Œä¸æ˜¯ç­‰å¾…å‰ä¸€ä¸ªå®Œæˆ</li>
<li><strong>å…¨éƒ¨ç­‰å¾…</strong>ï¼šç­‰å¾…æ•°ç»„ä¸­æ‰€æœ‰Promiseéƒ½resolveåæ‰è¿”å›ç»“æœ</li>
<li><strong>å¿«é€Ÿå¤±è´¥</strong>ï¼šåªè¦æœ‰ä¸€ä¸ªPromise rejectï¼Œæ•´ä¸ªPromise.all()å°±ä¼šç«‹å³reject</li>
</ol>
<p>è®©æˆ‘ä»¬é€šè¿‡ä»£ç å¯¹æ¯”æ¥ç†è§£ä¸²è¡Œä¸å¹¶è¡Œçš„åŒºåˆ«ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸²è¡Œæ‰§è¡Œï¼šæ€»è€—æ—¶ = è€—æ—¶1 + è€—æ—¶2</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">serialLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼šå‡è®¾è€—æ—¶2ç§’</span></span><br><span class="line">  <span class="keyword">const</span> newsList = <span class="keyword">await</span> newsManager.<span class="title function_">updateNewsListToDB</span>()  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æ–°é—»åˆ—è¡¨åŠ è½½å®Œæˆ: <span class="subst">$&#123;<span class="built_in">Date</span>.now() - startTime&#125;</span>ms`</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç¬¬äºŒä¸ªè¯·æ±‚ï¼šå‡è®¾è€—æ—¶1.5ç§’</span></span><br><span class="line">  <span class="keyword">const</span> swiper = <span class="keyword">await</span> newsManager.<span class="title function_">updateNewsSwiperToDB</span>()   </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`è½®æ’­å›¾åŠ è½½å®Œæˆ: <span class="subst">$&#123;<span class="built_in">Date</span>.now() - startTime&#125;</span>ms`</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ€»è€—æ—¶çº¦ï¼š2000ms + 1500ms = 3500ms</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ä¸²è¡Œæ€»è€—æ—¶: <span class="subst">$&#123;<span class="built_in">Date</span>.now() - startTime&#125;</span>ms`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹¶è¡Œæ‰§è¡Œï¼šæ€»è€—æ—¶ = max(è€—æ—¶1, è€—æ—¶2)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">parallelLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¸¤ä¸ªè¯·æ±‚åŒæ—¶å‘èµ·</span></span><br><span class="line">  <span class="keyword">const</span> results = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">    newsManager.<span class="title function_">updateNewsListToDB</span>(),    <span class="comment">// è€—æ—¶2ç§’</span></span><br><span class="line">    newsManager.<span class="title function_">updateNewsSwiperToDB</span>()   <span class="comment">// è€—æ—¶1.5ç§’</span></span><br><span class="line">  ])</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ€»è€—æ—¶çº¦ï¼šmax(2000ms, 1500ms) = 2000ms</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`å¹¶è¡Œæ€»è€—æ—¶: <span class="subst">$&#123;<span class="built_in">Date</span>.now() - startTime&#125;</span>ms`</span>)</span><br><span class="line">  <span class="comment">// æ€§èƒ½æå‡ï¼š(3500-2000)/3500 = 42.8%</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æˆ‘ä»¬çš„å®é™…åœºæ™¯ä¸­ï¼Œå¦‚æœæ–°é—»åˆ—è¡¨åŠ è½½éœ€è¦800msï¼Œè½®æ’­å›¾åŠ è½½éœ€è¦600msï¼š</p>
<ul>
<li><strong>ä¸²è¡Œæ‰§è¡Œ</strong>ï¼šæ€»è€—æ—¶ = 800ms + 600ms = 1400ms</li>
<li><strong>å¹¶è¡Œæ‰§è¡Œ</strong>ï¼šæ€»è€—æ—¶ = max(800ms, 600ms) = 800ms</li>
<li><strong>æ€§èƒ½æå‡</strong>ï¼šçº¦43%çš„å¯åŠ¨é€Ÿåº¦æå‡</li>
</ul>
<p><strong>Promise.all()çš„å†…éƒ¨æ‰§è¡Œæµç¨‹</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise.all()çš„ç®€åŒ–å®ç°åŸç†</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">promiseAll</span>(<span class="params"><span class="attr">promises</span>: <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;[]</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>[]&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">results</span>: <span class="built_in">any</span>[] = []</span><br><span class="line">    <span class="keyword">let</span> completedCount = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…³é”®ï¼šç«‹å³å¯åŠ¨æ‰€æœ‰Promise</span></span><br><span class="line">    promises.<span class="title function_">forEach</span>(<span class="function">(<span class="params">promise, index</span>) =&gt;</span> &#123;</span><br><span class="line">      promise</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">          results[index] = value  <span class="comment">// ä¿æŒç»“æœé¡ºåº</span></span><br><span class="line">          completedCount++</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// æ‰€æœ‰Promiseéƒ½å®Œæˆæ—¶ï¼Œresolveæ•´ä½“ç»“æœ</span></span><br><span class="line">          <span class="keyword">if</span> (completedCount === promises.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(results)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// ä»»ä½•ä¸€ä¸ªPromiseå¤±è´¥ï¼Œç«‹å³reject</span></span><br><span class="line">          <span class="title function_">reject</span>(error)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»è¿™ä¸ªå®ç°å¯ä»¥çœ‹å‡ºå‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<ol>
<li><strong>ç«‹å³æ‰§è¡Œ</strong>ï¼š<code>forEach</code>ä¼šç«‹å³éå†æ‰€æœ‰Promiseï¼Œè§¦å‘å®ƒä»¬çš„æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç­‰å¾…å‰ä¸€ä¸ªå®Œæˆ</li>
<li><strong>ç»“æœé¡ºåº</strong>ï¼šé€šè¿‡<code>results[index]</code>ä¿è¯è¿”å›ç»“æœçš„é¡ºåºä¸è¾“å…¥é¡ºåºä¸€è‡´ï¼Œå³ä½¿æŸä¸ªPromiseå…ˆå®Œæˆ</li>
<li><strong>è®¡æ•°æœºåˆ¶</strong>ï¼šé€šè¿‡<code>completedCount</code>è¿½è¸ªå·²å®Œæˆçš„Promiseæ•°é‡</li>
<li><strong>å¿«é€Ÿå¤±è´¥</strong>ï¼šä»»ä½•ä¸€ä¸ªPromiseçš„rejectéƒ½ä¼šå¯¼è‡´æ•´ä½“rejectï¼Œä¸ä¼šç­‰å¾…å…¶ä»–Promise</li>
</ol>
<p><strong>åœ¨æˆ‘ä»¬é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨</strong></p>
<p>å›åˆ°æˆ‘ä»¬çš„<code>preloadData()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">preloadData</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">      newsManager.<span class="title function_">updateNewsListToDB</span>(),</span><br><span class="line">      newsManager.<span class="title function_">updateNewsSwiperToDB</span>()</span><br><span class="line">    ]).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`æ•°æ®é¢„åŠ è½½å®Œæˆ`</span>)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">Error</span></span>) =&gt;</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">`æ•°æ®é¢„åŠ è½½å¤±è´¥: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    logger.<span class="title function_">warn</span>(<span class="string">`æ•°æ®é¢„åŠ è½½å¼‚å¸¸: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„è®¾è®¡ç»†èŠ‚ï¼šæˆ‘ä»¬<strong>æ²¡æœ‰ä½¿ç”¨await</strong>æ¥ç­‰å¾…<code>Promise.all()</code>ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“å‰å®ç°ï¼šä¸é˜»å¡ä¸»æµç¨‹</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([...]).<span class="title function_">then</span>(...)  <span class="comment">// å¼‚æ­¥æ‰§è¡Œï¼Œç«‹å³è¿”å›</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœä½¿ç”¨awaitï¼šä¼šé˜»å¡ä¸»æµç¨‹</span></span><br><span class="line"><span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([...])  <span class="comment">// å¿…é¡»ç­‰å¾…å®Œæˆæ‰èƒ½ç»§ç»­</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åšçš„åŸå› æ˜¯ï¼š</p>
<ul>
<li>æ•°æ®é¢„åŠ è½½å±äº<strong>éå…³é”®è·¯å¾„</strong>ï¼Œå¤±è´¥ä¸åº”è¯¥é˜»æ­¢åº”ç”¨å¯åŠ¨</li>
<li>ç”¨æˆ·å¯ä»¥å…ˆçœ‹åˆ°ç•Œé¢ï¼Œæ•°æ®ç¨ååŠ è½½å®Œæˆåå†æ˜¾ç¤º</li>
<li>å¦‚æœç½‘ç»œè¾ƒæ…¢ï¼Œä¸ä¼šè®©ç”¨æˆ·ç­‰å¾…è¿‡é•¿æ—¶é—´æ‰çœ‹åˆ°ç•Œé¢</li>
</ul>
<p><strong>Promise.all()çš„é£é™©ä¸æ›¿ä»£æ–¹æ¡ˆ</strong></p>
<p>è™½ç„¶<code>Promise.all()</code>å¾ˆå¼ºå¤§ï¼Œä½†ä¹Ÿæœ‰å…¶å±€é™æ€§ï¼š</p>
<p><strong>é£é™©1ï¼šä¸€ä¸ªå¤±è´¥å¯¼è‡´å…¨éƒ¨å¤±è´¥</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœæ–°é—»åˆ—è¡¨åŠ è½½å¤±è´¥ï¼Œè½®æ’­å›¾å³ä½¿æˆåŠŸä¹Ÿä¼šè¢«å¿½ç•¥</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">  newsManager.<span class="title function_">updateNewsListToDB</span>(),  <span class="comment">// å¤±è´¥</span></span><br><span class="line">  newsManager.<span class="title function_">updateNewsSwiperToDB</span>() <span class="comment">// æˆåŠŸä½†è¢«å¿½ç•¥</span></span><br><span class="line">]).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ•´ä½“å¤±è´¥ï¼Œæ— æ³•è·å–è½®æ’­å›¾æ•°æ®</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨Promise.allSettled()</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise.allSettled()ä¼šç­‰å¾…æ‰€æœ‰Promiseå®Œæˆï¼Œä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥</span></span><br><span class="line"><span class="keyword">const</span> results = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">allSettled</span>([</span><br><span class="line">  newsManager.<span class="title function_">updateNewsListToDB</span>(),</span><br><span class="line">  newsManager.<span class="title function_">updateNewsSwiperToDB</span>()</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">results.<span class="title function_">forEach</span>(<span class="function">(<span class="params">result, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (result.<span class="property">status</span> === <span class="string">&#x27;fulfilled&#x27;</span>) &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`ä»»åŠ¡<span class="subst">$&#123;index&#125;</span>æˆåŠŸ: <span class="subst">$&#123;result.value&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    logger.<span class="title function_">warn</span>(<span class="string">`ä»»åŠ¡<span class="subst">$&#123;index&#125;</span>å¤±è´¥: <span class="subst">$&#123;result.reason&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼æ›´åŠ å¥å£®ï¼Œå³ä½¿æŸä¸ªæ•°æ®æºå¤±è´¥ï¼Œå…¶ä»–æ•°æ®ä»ç„¶å¯ä»¥æ­£å¸¸æ˜¾ç¤ºã€‚</p>
<p><strong>é£é™©2ï¼šå¹¶å‘è¯·æ±‚è¿‡å¤šå¯¼è‡´èµ„æºç«äº‰</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸å¥½çš„åšæ³•ï¼šåŒæ—¶å‘èµ·100ä¸ªè¯·æ±‚</span></span><br><span class="line"><span class="keyword">const</span> promises = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">  promises.<span class="title function_">push</span>(<span class="title function_">fetchData</span>(i))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(promises)  <span class="comment">// å¯èƒ½å¯¼è‡´æµè§ˆå™¨/æœåŠ¡å™¨å´©æºƒ</span></span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šåˆ†æ‰¹æ‰§è¡Œ</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¥½çš„åšæ³•ï¼šæ¯æ¬¡æœ€å¤š5ä¸ªå¹¶å‘</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">batchLoad</span>(<span class="params"><span class="attr">tasks</span>: <span class="title class_">Function</span>[], <span class="attr">concurrency</span>: <span class="built_in">number</span> = <span class="number">5</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">results</span>: <span class="built_in">any</span>[] = []</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; tasks.<span class="property">length</span>; i += concurrency) &#123;</span><br><span class="line">    <span class="keyword">const</span> batch = tasks.<span class="title function_">slice</span>(i, i + concurrency)</span><br><span class="line">    <span class="keyword">const</span> batchResults = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(batch.<span class="title function_">map</span>(<span class="function"><span class="params">task</span> =&gt;</span> <span class="title function_">task</span>()))</span><br><span class="line">    results.<span class="title function_">push</span>(...batchResults)</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`å®Œæˆæ‰¹æ¬¡ <span class="subst">$&#123;i / concurrency + <span class="number">1</span>&#125;</span>ï¼Œå·²åŠ è½½ <span class="subst">$&#123;results.length&#125;</span>/<span class="subst">$&#123;tasks.length&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> results</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜</strong></p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ æ€§èƒ½ç›‘æ§æ¥éªŒè¯å¹¶è¡Œä¼˜åŒ–çš„æ•ˆæœï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">preloadData</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> promises = [</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">measureTime</span>(<span class="string">&#x27;æ–°é—»åˆ—è¡¨&#x27;</span>, newsManager.<span class="title function_">updateNewsListToDB</span>()),</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">measureTime</span>(<span class="string">&#x27;è½®æ’­å›¾&#x27;</span>, newsManager.<span class="title function_">updateNewsSwiperToDB</span>())</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(promises)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> totalTime = <span class="title class_">Date</span>.<span class="title function_">now</span>() - startTime</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>æ•°æ®é¢„åŠ è½½å®Œæˆï¼Œæ€»è€—æ—¶: <span class="subst">$&#123;totalTime&#125;</span>ms`</span>)</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>æ•°æ®é¢„åŠ è½½å¤±è´¥: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾…åŠ©æ–¹æ³•ï¼šæµ‹é‡å•ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">async</span> measureTime&lt;T&gt;(<span class="attr">taskName</span>: <span class="built_in">string</span>, <span class="attr">promise</span>: <span class="title class_">Promise</span>&lt;T&gt;): <span class="title class_">Promise</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> start = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> promise</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span><span class="subst">$&#123;taskName&#125;</span> å®Œæˆï¼Œè€—æ—¶: <span class="subst">$&#123;<span class="built_in">Date</span>.now() - start&#125;</span>ms`</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span><span class="subst">$&#123;taskName&#125;</span> å¤±è´¥ï¼Œè€—æ—¶: <span class="subst">$&#123;<span class="built_in">Date</span>.now() - start&#125;</span>ms`</span>)</span><br><span class="line">    <span class="keyword">throw</span> error</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™æ ·çš„ç›‘æ§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¼€å‘é˜¶æ®µå°±å‘ç°æ€§èƒ½ç“¶é¢ˆï¼Œå¹¶é’ˆå¯¹æ€§åœ°è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p><strong>å°ç»“</strong></p>
<p><code>Promise.all()</code>æ˜¯å¼‚æ­¥ç¼–ç¨‹ä¸­éå¸¸é‡è¦çš„å·¥å…·ï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¿æŒä»£ç æ¸…æ™°åº¦çš„åŒæ—¶æ˜¾è‘—æå‡æ€§èƒ½ã€‚å…³é”®è¦ç‚¹ï¼š</p>
<ol>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤šä¸ªç‹¬ç«‹çš„å¼‚æ­¥æ“ä½œï¼Œå½¼æ­¤ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»</li>
<li><strong>æ€§èƒ½æ”¶ç›Š</strong>ï¼šæ€»è€—æ—¶ä»æ‰€æœ‰ä»»åŠ¡ä¹‹å’Œé™ä½åˆ°æœ€æ…¢ä»»åŠ¡çš„è€—æ—¶</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šéœ€è¦è€ƒè™‘éƒ¨åˆ†å¤±è´¥çš„æƒ…å†µï¼Œå¿…è¦æ—¶ä½¿ç”¨<code>Promise.allSettled()</code></li>
<li><strong>å¹¶å‘æ§åˆ¶</strong>ï¼šå¤§é‡å¹¶å‘è¯·æ±‚æ—¶è¦è€ƒè™‘åˆ†æ‰¹æ‰§è¡Œï¼Œé¿å…èµ„æºè€—å°½</li>
<li><strong>ç›‘æ§è°ƒä¼˜</strong>ï¼šæ·»åŠ æ€§èƒ½ç›‘æ§ï¼Œç”¨æ•°æ®é©±åŠ¨ä¼˜åŒ–å†³ç­–</li>
</ol>
<p>å…³é”®ç‚¹åœ¨äºè¯†åˆ«å“ªäº›æ“ä½œæ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼š</p>
<ul>
<li><strong>æ•°æ®åº“åˆå§‹åŒ–å’Œç”¨æˆ·é…ç½®åŠ è½½</strong>ï¼šä¸èƒ½å¹¶è¡Œï¼Œå› ä¸ºé…ç½®åŠ è½½ä¾èµ–æ•°æ®åº“</li>
<li><strong>æ–°é—»åˆ—è¡¨å’Œè½®æ’­å›¾åŠ è½½</strong>ï¼šå¯ä»¥å¹¶è¡Œï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»</li>
</ul>
<p>è¿™ä¹Ÿæ˜¯æˆ‘ä¹‹å‰æ‰€æåˆ°çš„æ‹“æ‰‘å­¦ï¼Œæˆ‘ä»¬éœ€è¦ç†æ¸…æ¥šå„ä¸ªæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ‰èƒ½è®¾è®¡å‡ºåˆç†çš„å¹¶è¡Œç­–ç•¥ã€‚</p>
<h6 id="3-å¼‚æ­¥çŠ¶æ€çš„ç®¡ç†å¤æ‚åº¦"><a href="#3-å¼‚æ­¥çŠ¶æ€çš„ç®¡ç†å¤æ‚åº¦" class="headerlink" title="3. å¼‚æ­¥çŠ¶æ€çš„ç®¡ç†å¤æ‚åº¦"></a>3. å¼‚æ­¥çŠ¶æ€çš„ç®¡ç†å¤æ‚åº¦</h6><p>åœ¨å¤šå±‚å¼‚æ­¥è°ƒç”¨ä¸­ï¼ŒçŠ¶æ€ç®¡ç†å˜å¾—æ›´åŠ å¤æ‚ã€‚æˆ‘ä»¬éœ€è¦è¿½è¸ªæ¯ä¸€å±‚çš„æ‰§è¡ŒçŠ¶æ€ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="attr">initStatus</span>: <span class="title class_">InitStatus</span> = &#123;</span><br><span class="line">  <span class="attr">databases</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">userConfig</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">managers</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">appStorageV2</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">markdown</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªçŠ¶æ€å¯¹è±¡éœ€è¦åœ¨åˆé€‚çš„æ—¶æœºæ›´æ–°ï¼Œä½†ç”±äºå¼‚æ­¥æ“ä½œçš„å­˜åœ¨ï¼Œæ›´æ–°æ—¶æœºå¾ˆå®¹æ˜“å‡ºé”™ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç¤ºä¾‹: åœ¨å¼‚æ­¥æ“ä½œå®Œæˆå‰å°±æ ‡è®°ä¸ºæˆåŠŸ</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">initManagers</span>(<span class="params"></span>) &#123;</span><br><span class="line">  newsManager.<span class="title function_">init</span>(context)  <span class="comment">// å¿˜è®°await</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">managers</span> = <span class="literal">true</span>  <span class="comment">// é”™è¯¯!æ­¤æ—¶initå¯èƒ½è¿˜æœªå®Œæˆ</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®ç¤ºä¾‹: ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆåå†æ›´æ–°çŠ¶æ€</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">initManagers</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> success = <span class="keyword">await</span> newsManager.<span class="title function_">init</span>(context)  <span class="comment">// æ­£ç¡®ä½¿ç”¨await</span></span><br><span class="line">  <span class="keyword">if</span> (success) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">managers</span> = <span class="literal">true</span>  <span class="comment">// æ­¤æ—¶å¯ä»¥ç¡®ä¿initå·²å®Œæˆ</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> success</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="4-å¼‚æ­¥é“¾æ¡ä¸­çš„é”™è¯¯ä¼ æ’­"><a href="#4-å¼‚æ­¥é“¾æ¡ä¸­çš„é”™è¯¯ä¼ æ’­" class="headerlink" title="4. å¼‚æ­¥é“¾æ¡ä¸­çš„é”™è¯¯ä¼ æ’­"></a>4. å¼‚æ­¥é“¾æ¡ä¸­çš„é”™è¯¯ä¼ æ’­</h6><p>åœ¨å±‚å±‚å°è£…çš„å¼‚æ­¥è°ƒç”¨ä¸­ï¼Œé”™è¯¯çš„ä¼ æ’­è·¯å¾„éœ€è¦ç²¾å¿ƒè®¾è®¡ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åº•å±‚æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getKVStore</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Database connection failed&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸­é—´å±‚æ•è·å¹¶è½¬æ¢</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getKVStoreById</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">kvManager</span>.<span class="title function_">getKVStore</span>(storeId, options)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`è·å–KVæ•°æ®åº“å¼‚å¸¸`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>  <span class="comment">// è½¬æ¢ä¸ºnull,ä¸ç»§ç»­å‘ä¸ŠæŠ›å¼‚å¸¸</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šå±‚æ£€æŸ¥nullå€¼</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> kvDatabase.<span class="title function_">getKVStoreById</span>(<span class="variable constant_">APP_KV_DB_ID</span>)</span><br><span class="line">  <span class="keyword">if</span> (res) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>  <span class="comment">// å°†nullè½¬æ¢ä¸ºfalse</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€ä¸Šå±‚å¤„ç†falseå€¼</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">initPhase1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> dbInitSuccess = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">initDatabases</span>(context)</span><br><span class="line">  <span class="keyword">if</span> (!dbInitSuccess) &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥,ç»ˆæ­¢åˆå§‹åŒ–æµç¨‹`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>  <span class="comment">// å‘è°ƒç”¨è€…è¿”å›å¤±è´¥çŠ¶æ€</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§è®¾è®¡æ¨¡å¼å°†å¼‚å¸¸è½¬æ¢ä¸ºè¿”å›å€¼ï¼Œä½¿å¾—é”™è¯¯å¤„ç†æ›´åŠ å¯æ§ï¼Œé¿å…äº†æœªæ•è·å¼‚å¸¸å¯¼è‡´çš„åº”ç”¨å´©æºƒã€‚ä½†ä»£ä»·æ˜¯éœ€è¦åœ¨æ¯ä¸€å±‚éƒ½è¿›è¡ŒçŠ¶æ€æ£€æŸ¥ã€‚</p>
<h4 id="å®è·µç»éªŒæ€»ç»“"><a href="#å®è·µç»éªŒæ€»ç»“" class="headerlink" title="å®è·µç»éªŒæ€»ç»“"></a>å®è·µç»éªŒæ€»ç»“</h4><p>é€šè¿‡è¿™æ¬¡AppInitçš„é‡æ„å’Œå¼‚æ­¥ç®¡ç†çš„å®è·µï¼Œæˆ‘æ€»ç»“å‡ºä»¥ä¸‹å‡ ç‚¹ç»éªŒï¼š</p>
<p><strong>1. å°è£…å±‚æ¬¡è¦é€‚åº¦</strong></p>
<p>ä¸æ˜¯å°è£…å±‚æ¬¡è¶Šå¤šè¶Šå¥½ï¼Œä¹Ÿä¸æ˜¯è¶Šå°‘è¶Šå¥½ã€‚å…³é”®æ˜¯æ¯ä¸€å±‚éƒ½è¦æœ‰å…¶å­˜åœ¨çš„ä»·å€¼ï¼š</p>
<ul>
<li>å¦‚æœæŸä¸€å±‚åªæ˜¯ç®€å•çš„è½¬å‘è°ƒç”¨ï¼Œæ²¡æœ‰æ·»åŠ ä»»ä½•é¢å¤–é€»è¾‘ï¼Œé‚£è¿™ä¸€å±‚å¯èƒ½æ˜¯å¤šä½™çš„</li>
<li>å¦‚æœæŸä¸€å±‚æ‰¿æ‹…äº†è¿‡å¤šçš„èŒè´£ï¼Œé‚£å¯èƒ½éœ€è¦è¿›ä¸€æ­¥æ‹†åˆ†</li>
</ul>
<p><strong>2. å¼‚æ­¥æ“ä½œè¦æ˜ç¡®æ ‡æ³¨</strong></p>
<p>åœ¨tså’ŒArkTSä¸­ï¼Œä¸€å®šè¦æ˜ç¡®æ ‡æ³¨å‡½æ•°çš„è¿”å›ç±»å‹ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¥½çš„åšæ³•: æ˜ç¡®æ ‡æ³¨è¿”å›Promise&lt;boolean&gt;</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">init</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸å¥½çš„åšæ³•: ä¾èµ–ç±»å‹æ¨æ–­</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">init</span>(<span class="attr">context</span>: common.<span class="property">UIAbilityContext</span>)  <span class="comment">// è¿”å›ç±»å‹ä¸æ˜ç¡®</span></span><br></pre></td></tr></table></figure>
<p>æ˜ç¡®çš„ç±»å‹æ ‡æ³¨å¯ä»¥å¸®åŠ©IDEæä¾›æ›´å¥½çš„ä»£ç è¡¥å…¨ï¼Œä¹Ÿèƒ½è®©å…¶ä»–å¼€å‘è€…ä¸€çœ¼çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ã€‚</p>
<p><strong>3. æ—¥å¿—è®°å½•è¦åˆ†å±‚è¯¦ç»†</strong></p>
<p>æ¯ä¸€å±‚éƒ½åº”è¯¥æœ‰è‡ªå·±çš„æ—¥å¿—è®°å½•ï¼Œä¸”è¦åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.APP_INIT&#125;</span>æ­¥éª¤ 1/4: åˆå§‹åŒ–æ•°æ®åº“æ¨¡å—...`</span>)</span><br><span class="line">logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.KV_DATABASE&#125;</span>æˆåŠŸè·å–storeId:<span class="subst">$&#123;storeId&#125;</span>æ•°æ®åº“å®ä¾‹å¯¹è±¡`</span>)</span><br><span class="line">logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>init: è·å–appKVDbæˆåŠŸ`</span>)</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸åŒçš„LOG_TAGå’Œè¯¦ç»†çš„æè¿°ï¼Œå¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜æ‰€åœ¨çš„å±‚çº§ã€‚</p>
<p><strong>4. çŠ¶æ€ç®¡ç†è¦åŠæ—¶å‡†ç¡®</strong></p>
<p>åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåç«‹å³æ›´æ–°çŠ¶æ€ï¼Œä¸è¦å»¶è¿Ÿï¼Œè¿™ä¹ŸåŒ…å«äº†æ•°æ®åº“ä¸­æ‰€å­¦çš„åŸå­åŒ–æ“ä½œçš„æ€æƒ³ï¼Œæˆ‘ä»¬è™½ç„¶ä¸å¯èƒ½åœ¨å¼‚æ­¥æ“ä½œæ‰§è¡ŒæˆåŠŸçš„â€œæ—¶åˆ»â€è¿›è¡Œåˆ†ç§’ä¸å·®çš„åŒæ­¥çŠ¶æ€æ›´æ–°ï¼Œä½†æˆ‘ä»¬å¯ä»¥å°†æ“ä½œå®Œæˆåˆ°çŠ¶æ€æ›´æ–°ä¹‹é—´çš„æ“ä½œå°½å¯èƒ½çš„ç¼©å°ï¼Œå‹ç¼©åˆ°æ‰€æœ‰æ“ä½œäº§ç”Ÿçš„å»¶æ—¶éƒ½å¯ä»¥å°åˆ°å¿½ç•¥ä¸è®¡ï¼Œå°†ä»»åŠ¡å¯¹è±¡ä¸å…¶çŠ¶æ€æ ‡è¯†ç¬¦è¿›è¡Œâ€œå¼ºç»‘å®šâ€ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> newsManagerInitSuccess = <span class="keyword">await</span> newsManager.<span class="title function_">init</span>(context)</span><br><span class="line"><span class="keyword">if</span> (newsManagerInitSuccess) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">initStatus</span>.<span class="property">managers</span> = <span class="literal">true</span>  <span class="comment">// ç«‹å³æ›´æ–°çŠ¶æ€</span></span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="string">`æ–°é—»ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>5. è¦ä¸ºå¼‚æ­¥æ“ä½œé¢„ç•™ç¼“å†²æ—¶é—´</strong></p>
<p>å¦‚åŒæˆ‘ä»¬åœ¨<code>printFinalInitStatus()</code>ä¸­ä½¿ç”¨<code>setTimeout</code>ä¸€æ ·ï¼Œè¦è€ƒè™‘åˆ°å¼‚æ­¥æ“ä½œçš„ä¸ç¡®å®šæ€§ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">printFinalInitStatus</span>()</span><br><span class="line">&#125;, <span class="number">100</span>) <span class="comment">// ç»™å¼‚æ­¥æ“ä½œç•™å‡ºå®Œæˆæ—¶é—´</span></span><br></pre></td></tr></table></figure>
<p>è¿™ç§è®¾è®¡è™½ç„¶çœ‹èµ·æ¥ä¸å¤Ÿä¼˜é›…ï¼Œä½†åœ¨å¤æ‚çš„å¼‚æ­¥åœºæ™¯ä¸­æ˜¯å¿…è¦çš„å®¹é”™æœºåˆ¶ã€‚<br>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<h5 id="å¯¹äºAIè¾…åŠ©å¼€å‘çš„æ€è€ƒ"><a href="#å¯¹äºAIè¾…åŠ©å¼€å‘çš„æ€è€ƒ" class="headerlink" title="å¯¹äºAIè¾…åŠ©å¼€å‘çš„æ€è€ƒ"></a>å¯¹äºAIè¾…åŠ©å¼€å‘çš„æ€è€ƒ</h5><p>åœ¨è¿™æ¬¡é‡æ„ä¸­ï¼ŒClaudeæä¾›çš„ä»£ç è´¨é‡ç¡®å®å¾ˆé«˜ï¼Œä½†ä¹Ÿæš´éœ²äº†ä¸€äº›AIçš„å±€é™æ€§ï¼š</p>
<ol>
<li><strong>AIå¯¹å¼‚æ­¥æ‰§è¡Œé¡ºåºçš„ç†è§£æœ‰é™</strong>ï¼šæœ€åˆçš„ç‰ˆæœ¬æ²¡æœ‰è€ƒè™‘åˆ°å¼‚æ­¥æ“ä½œå¯èƒ½æ™šäºçŠ¶æ€æ‰“å°æ‰§è¡Œçš„é—®é¢˜ï¼Œéœ€è¦äººå·¥å‘ç°å¹¶ä¿®å¤</li>
<li><strong>AIå€¾å‘äºè¿‡åº¦å·¥ç¨‹åŒ–</strong>ï¼šç”Ÿæˆçš„ä»£ç æ³¨é‡Šéå¸¸è¯¦ç»†ï¼Œå°è£…å±‚æ¬¡ä¹Ÿå¾ˆå®Œæ•´ï¼Œä½†å¯èƒ½å¯¹å°å‹é¡¹ç›®æ¥è¯´è¿‡äºå¤æ‚</li>
<li><strong>AIç¼ºä¹å®é™…è¿è¡Œç¯å¢ƒçš„æ„ŸçŸ¥</strong>ï¼šåªæœ‰åœ¨çœŸå®è®¾å¤‡ä¸Šè¿è¡Œæ‰èƒ½å‘ç°æ—¥å¿—é¡ºåºçš„é—®é¢˜</li>
</ol>
<p>å› æ­¤ï¼ŒAIè¾…åŠ©å¼€å‘çš„æœ€ä½³å®è·µåº”è¯¥æ˜¯ï¼š<strong>AIè´Ÿè´£ç”Ÿæˆè§„èŒƒåŒ–çš„ä»£ç æ¡†æ¶ï¼Œäººç±»è´Ÿè´£æ ¹æ®å®é™…è¿è¡Œæƒ…å†µè¿›è¡Œè°ƒä¼˜</strong>ã€‚å°±åƒè¿™æ¬¡é‡æ„ï¼ŒClaudeæä¾›äº†ä¼˜ç§€çš„æ¶æ„è®¾è®¡å’Œè¯¦ç»†çš„æ³¨é‡Šï¼Œè€Œæˆ‘é€šè¿‡å®é™…æµ‹è¯•å‘ç°å¹¶ä¿®å¤äº†å¼‚æ­¥æ‰§è¡Œé¡ºåºçš„é—®é¢˜ï¼Œä¸¤è€…ç»“åˆæ‰èƒ½äº§å‡ºé«˜è´¨é‡çš„ä»£ç ã€‚</p>
<h3 id="å¯¹äºåŠ è½½æ•°æ®æµçš„æ”¹é€ "><a href="#å¯¹äºåŠ è½½æ•°æ®æµçš„æ”¹é€ " class="headerlink" title="å¯¹äºåŠ è½½æ•°æ®æµçš„æ”¹é€ "></a>å¯¹äºåŠ è½½æ•°æ®æµçš„æ”¹é€ </h3><h4 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h4><p>å½“ä¸‹æˆ‘é¢ä¸´çš„å¦ä¸€ä¸ªä¸¥å³»çš„é—®é¢˜å°±åœ¨äºæ•°æ®æºçš„åŠ è½½é€Ÿåº¦è¿‡æ…¢ã€‚è¿™ä¸€æ–¹é¢æ˜¯æˆ‘çš„æœåŠ¡å™¨ä»…ä»…æ˜¯æš‚æ—¶å…±äº«äº†æˆ‘çš„åšå®¢æœåŠ¡å™¨ï¼Œå±äºæ˜¯æœ€åŸºç¡€çš„ä¸€æ¡£æœåŠ¡å™¨ï¼Œå¸¦å®½å¾ˆå°ï¼Œå¦å¤–ä¸€æ–¹é¢æ˜¯åœ¨äºæˆ‘å½“ä¸‹ä½¿ç”¨çš„æ˜¯<code>/api/news/?all=true</code>è¿™æ ·ä¸€ä¸ªæœ€åŸºæœ¬çš„æ¥å£ï¼Œä»–ä¼šé»˜è®¤çš„å°†å…¨éƒ¨çš„æ•°æ®ä¸åŠ åˆ†ç±»ä¸åŠ åˆ†é¡µçš„ä¸€å£æ°”å…¨éƒ¨å‘é€è¿‡æ¥ï¼Œè¿™å°±å¯¼è‡´æ•°åMçš„æ•°æ®åœ¨æˆ‘æœåŠ¡å™¨æœ¬å°±å±€é™çš„å¸¦å®½ä¸Šè·‘çš„æ„ˆå‘ç¼“æ…¢äº†ï¼Œæˆ‘ç»å¯¹ä¸èƒ½æ”¾å¼€å¸¦å®½é™åˆ¶ï¼Œè¦ä¸ç„¶å•è¯æ›´æ–°å°±ä¼šå°†æˆ‘æœåŠ¡å™¨çš„ä¸‹è¡Œå¸¦å®½å®Œå…¨å µæ­»ã€‚ä¸è¿‡åé¢å®Œæˆåéƒ¨ç½²åˆ°ä¸­è½¯é‚£è¾¹çš„æœåŠ¡å™¨åº”è¯¥å°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜äº†ã€‚</p>
<p>ä½†åœ¨å½“å‰ç¯å¢ƒä¸‹ï¼Œæˆ‘çš„å•æ¬¡åˆ·æ–°ä¼šé•¿è¾¾20ç§’å·¦å³çš„åŠ è½½æ—¶é—´ï¼Œå¯¹äºé¦–æ¬¡å¯åŠ¨ä¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒè‡´å‘½çš„é—®é¢˜ï¼Œæ¯•ç«Ÿå¯åŠ¨é¡µçš„å»¶æ—¶æ˜¯è¿œè¿œä¸å¤ŸåŠ è½½å…¨éƒ¨æ•°æ®çš„ï¼Œåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶æ³¨å®šæ˜¯æ²¡æœ‰æ•°æ®çš„ã€‚é¦–å…ˆè¿™ä¸ªæ¥å£å¹¶ä¸æ˜¯æµå¼è¾“å‡ºæ¥å£ï¼Œæˆ‘ä»¬å¿…é¡»ç­‰å¾…è¿™ä¸ªæ¥å£çš„å•æ¬¡å“åº”è¢«å®Œæ•´çš„æ¥æ”¶åæ‰ä¼šå¼€å§‹å»è¿›è¡Œæ•°æ®åº“æ•°æ®çš„æ›´æ–°ä»¥åŠæ¸²æŸ“æ•°æ®çš„æ›´æ–°ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯è¿›è¡Œåˆ†é¡µå¤„ç†ï¼Œå¯¹äºæ•°æ®è¿›è¡Œåˆ†é¡µè·å–å¤„ç†ï¼Œé€šè¿‡<code>page_size</code>å’Œ<code>page</code>ï¼Œä¸¤ä¸ªå‚æ•°æ¥å»è¿›è¡Œæ•°æ®çš„åˆ†é¡µï¼Œåœ¨å•æ¬¡å“åº”ä¸­ä¼šåŒ…å«æœ‰<code>&quot;has_next&quot;&quot;has_prev&quot;</code>è¿™æ ·ä¸¤ä¸ªå‚æ•°æ¥ä¸ºå®¢æˆ·ç«¯çš„æ•°æ®æµæä¾›ç»“æŸæ ‡è¯†ç¬¦ã€‚å¯¹äºæœ€åä¸€é¡µçš„æ•°æ®å¯èƒ½ä¼šå‡ºç°page_sizeçš„å¤§å°æ¯”å‰©ä½™çš„æ•°æ®é‡å¤§çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µåœ¨æˆ‘çš„åç«¯ä¸­æ˜¯ä¼šè‡ªåŠ¨çš„å»å¤„ç†çš„å¹¶ä¸ä¼šå‡ºç°è¶Šç•Œçš„å¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬å‰ç«¯çš„åˆ†é¡µæ•°æ®æµä»…éœ€è¦åœæ­¢åœ¨å½“<code>&quot;has_next&quot;</code>ä¸ºfalseæ—¶å»ç»ˆæ­¢å³å¯ã€‚</p>
<p>å¯¹äºè¿™ç§æ–¹å¼å› ä¸ºä¸­é—´ä¼šåŠ å…¥å¾ˆå¤šçš„ç¡®è®¤æ˜¯å¦å®Œæ•´è·å–ï¼Œä»¥åŠå½“å‰æ•°æ®å¤„äºæ•´æ®µæ•°æ®æµä¸­çš„ä»€ä¹ˆä½ç½®çš„æµç¨‹ï¼Œè¿™éƒ½æ˜¯ä¸ºäº†ä¿è¯åœ¨æ›´æ–°æ•°æ®åº“æ•°æ®æ—¶èƒ½å¤Ÿæ­£ç¡®çš„æŒ‰ç…§åç«¯æ’å¥½çš„æ—¥æœŸé¡ºåºå»è¿›è¡Œå­˜å…¥ï¼Œæ‰€ä»¥æ•´ä½“çš„è·å–æ—¶é—´ä¼šè¢«æ‹‰é•¿ï¼Œä½†æ˜¯åœ¨å‰å°ä¹Ÿå°±æ˜¯ç”¨æˆ·èƒ½æ„ŸçŸ¥çš„åˆ°çš„æµç¨‹ä¸Šæ¥çœ‹æ˜¯å¯ä»¥è¢«å‹ç¼©åˆ°ä¸€ç§’åˆ°ä¸¤ç§’ä¹‹å†…å°±å®Œæˆçš„ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å°†å½“å‰æ˜¾ç¤ºçš„æ•°æ®çš„å‰20æ¡æ›´æ–°ä¸ºæœ€æ–°åå°±ç»“æŸ<code>Refresh</code>ç»„ä»¶çš„<code>onRefreshing</code>æµç¨‹ï¼Œéšåæˆ‘ä»¬å°±ä¼šåœ¨åå°å»è¿›è¡Œå®Œæ•´çš„æ•°æ®è·å–æµç¨‹ï¼Œå°†è¿™ä¸ªæµç¨‹ç»Ÿä¸€çš„å‹ç¼©è‡³ä¸€ä¸ªå‡½æ•°ä¸­è¿›è¡Œæ§åˆ¶ï¼Œä»…éœ€è¦ä¿®æ”¹ä¸€ä¸ª<code>Refresh</code>ç»„ä»¶çš„æ ‡è¯†ç¬¦å°±å¯ä»¥å®Œæˆç”¨æˆ·æ„ŸçŸ¥å±‚é¢çš„æé€Ÿã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå…³é”®å‡½æ•°çš„å®ç°å§ã€‚</p>
<h4 id="æ ¸å¿ƒå‡½æ•°è§£æ"><a href="#æ ¸å¿ƒå‡½æ•°è§£æ" class="headerlink" title="æ ¸å¿ƒå‡½æ•°è§£æ"></a>æ ¸å¿ƒå‡½æ•°è§£æ</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ä¸¤é˜¶æ®µåˆ·æ–° - ç¬¬ä¸€é˜¶æ®µï¼šå¿«é€ŸåŠ è½½å„åˆ†æ å‰20æ¡æœ€æ–°æ•°æ®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * ä½¿ç”¨ Promise.all å¹¶å‘åŠ è½½æ‰€æœ‰å·²å¼€å‘æ ç›®çš„å‰20æ¡æ•°æ®ï¼Œå¿«é€Ÿå“åº”ç”¨æˆ·</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> Promise&lt;&#123; success: boolean, loadedCount: number &#125;&gt; - åŠ è½½ç»“æœå’ŒæˆåŠŸåŠ è½½çš„æ ç›®æ•°</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * åˆ·æ–°ç­–ç•¥ï¼š</span></span><br><span class="line"><span class="comment">   * - ä»…åŠ è½½å·²å¼€å‘çš„æ ç›®ï¼ˆisDeveloped === trueï¼‰</span></span><br><span class="line"><span class="comment">   * - æ¯ä¸ªæ ç›®è·å–æœ€æ–° 20 æ¡æ•°æ®</span></span><br><span class="line"><span class="comment">   * - ä½¿ç”¨ Promise.all å¹¶å‘è¯·æ±‚ï¼Œæœ€å¤§åŒ–é€Ÿåº¦</span></span><br><span class="line"><span class="comment">   * - å•ä¸ªæ ç›®å¤±è´¥ä¸å½±å“å…¶ä»–æ ç›®</span></span><br><span class="line"><span class="comment">   * - åŒæ—¶åˆ·æ–°è½®æ’­å›¾æ•°æ®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * é€‚ç”¨åœºæ™¯ï¼š</span></span><br><span class="line"><span class="comment">   * - ç”¨æˆ·ä¸‹æ‹‰åˆ·æ–°æ—¶çš„ç¬¬ä¸€é˜¶æ®µ</span></span><br><span class="line"><span class="comment">   * - éœ€è¦å¿«é€Ÿçœ‹åˆ°æœ€æ–°å†…å®¹</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment">   * ```typescript</span></span><br><span class="line"><span class="comment">   * const result = await newsManager.quickRefreshCategories()</span></span><br><span class="line"><span class="comment">   * if (result.success) &#123;</span></span><br><span class="line"><span class="comment">   *   console.log(`å¿«é€Ÿåˆ·æ–°å®Œæˆï¼ŒåŠ è½½äº† $&#123;result.loadedCount&#125; ä¸ªæ ç›®`)</span></span><br><span class="line"><span class="comment">   * &#125;</span></span><br><span class="line"><span class="comment">   * ```</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">quickRefreshCategories</span>(): <span class="title class_">Promise</span>&lt;<span class="title class_">QuickRefreshResult</span>&gt; &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å¿«é€Ÿåˆ·æ–°] å¼€å§‹ç¬¬ä¸€é˜¶æ®µï¼šå¹¶å‘åŠ è½½å„åˆ†æ å‰20æ¡æ•°æ®`</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title class_">ServerHealthAPI</span>.<span class="title function_">isServerReady</span>())) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å¿«é€Ÿåˆ·æ–°] æœåŠ¡ç«¯æœªå°±ç»ª`</span>)</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">QuickRefreshResult</span> = &#123; <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">loadedCount</span>: <span class="number">0</span> &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">appKVDb</span>) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å¿«é€Ÿåˆ·æ–°] æ•°æ®åº“æœªåˆå§‹åŒ–`</span>)</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">QuickRefreshResult</span> = &#123; <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">loadedCount</span>: <span class="number">0</span> &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// ç­›é€‰å‡ºå·²å¼€å‘çš„æ ç›®</span></span><br><span class="line">      <span class="keyword">const</span> developedCategories = <span class="variable constant_">NEWS_CATEGORIES</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">cat</span> =&gt;</span> cat.<span class="property">isDeveloped</span>)</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å¿«é€Ÿåˆ·æ–°] éœ€è¦åˆ·æ–° <span class="subst">$&#123;developedCategories.length&#125;</span> ä¸ªæ ç›®`</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºå¹¶å‘åŠ è½½ä»»åŠ¡æ•°ç»„</span></span><br><span class="line">      <span class="keyword">const</span> loadTasks = developedCategories.<span class="title function_">map</span>(<span class="title function_">async</span> (<span class="attr">category</span>: <span class="title class_">NewsCategoryInfo</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          logger.<span class="title function_">debug</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å¿«é€Ÿåˆ·æ–°] å¼€å§‹åŠ è½½ã€<span class="subst">$&#123;category.displayName&#125;</span>ã€‘å‰20æ¡`</span>)</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// è°ƒç”¨åˆ†ç±» API è·å–å‰20æ¡æ•°æ®</span></span><br><span class="line">          <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title class_">NewsListAPI</span>.<span class="title function_">getNewsByCategory</span>(category.<span class="property">apiCategory</span>, <span class="number">1</span>, <span class="number">20</span>)</span><br><span class="line">          </span><br><span class="line">          <span class="keyword">if</span> (response &amp;&amp; response.<span class="property">articles</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// è¯»å–ç°æœ‰æ•°æ®</span></span><br><span class="line">            <span class="keyword">let</span> <span class="attr">existingArticles</span>: <span class="title class_">NewsArticle</span>[] = []</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">const</span> existingData = (<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">appKVDb</span>!.<span class="title function_">get</span>(category.<span class="property">dbKey</span>)) <span class="keyword">as</span> <span class="built_in">string</span></span><br><span class="line">              existingArticles = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(existingData) <span class="keyword">as</span> <span class="title class_">NewsArticle</span>[]</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">              existingArticles = []</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆå¹¶å»é‡ï¼ˆæ–°æ•°æ®ä¼˜å…ˆï¼‰</span></span><br><span class="line">            <span class="keyword">const</span> articleMap = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">NewsArticle</span>&gt;()</span><br><span class="line">            existingArticles.<span class="title function_">forEach</span>(<span class="function"><span class="params">article</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (article.<span class="property">id</span>) articleMap.<span class="title function_">set</span>(article.<span class="property">id</span>, article)</span><br><span class="line">            &#125;)</span><br><span class="line">            response.<span class="property">articles</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">article</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (article.<span class="property">id</span>) articleMap.<span class="title function_">set</span>(article.<span class="property">id</span>, article)</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æŒ‰æ—¥æœŸå€’åºæ’åº</span></span><br><span class="line">            <span class="keyword">const</span> mergedArticles = <span class="title class_">Array</span>.<span class="title function_">from</span>(articleMap.<span class="title function_">values</span>())</span><br><span class="line">              .<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> b.<span class="property">date</span>.<span class="title function_">localeCompare</span>(a.<span class="property">date</span>))</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å†™å…¥æ•°æ®åº“</span></span><br><span class="line">            <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">appKVDb</span>!.<span class="title function_">put</span>(category.<span class="property">dbKey</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(mergedArticles))</span><br><span class="line">            </span><br><span class="line">            logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å¿«é€Ÿåˆ·æ–°] âœ“ ã€<span class="subst">$&#123;category.displayName&#125;</span>ã€‘åŠ è½½æˆåŠŸ: <span class="subst">$&#123;response.articles.length&#125;</span>æ¡`</span>)</span><br><span class="line">            <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">CategoryLoadResult</span> = &#123; <span class="attr">category</span>: category.<span class="property">displayName</span>, <span class="attr">success</span>: <span class="literal">true</span>, <span class="attr">count</span>: response.<span class="property">articles</span>.<span class="property">length</span> &#125;</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å¿«é€Ÿåˆ·æ–°] ã€<span class="subst">$&#123;category.displayName&#125;</span>ã€‘æ— æ•°æ®`</span>)</span><br><span class="line">            <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">CategoryLoadResult</span> = &#123; <span class="attr">category</span>: category.<span class="property">displayName</span>, <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">count</span>: <span class="number">0</span> &#125;</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å¿«é€Ÿåˆ·æ–°] ã€<span class="subst">$&#123;category.displayName&#125;</span>ã€‘åŠ è½½å¤±è´¥: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">          <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">CategoryLoadResult</span> = &#123; <span class="attr">category</span>: category.<span class="property">displayName</span>, <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">count</span>: <span class="number">0</span> &#125;</span><br><span class="line">          <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åŒæ—¶åŠ è½½è½®æ’­å›¾æ•°æ®</span></span><br><span class="line">      <span class="keyword">const</span> swiperTask = <span class="variable language_">this</span>.<span class="title function_">updateNewsSwiperToDB</span>()</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¹¶å‘æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡</span></span><br><span class="line">      <span class="keyword">const</span> results = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([...loadTasks, swiperTask])</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// ç»Ÿè®¡ç»“æœï¼ˆæœ€åä¸€ä¸ªæ˜¯è½®æ’­å›¾ä»»åŠ¡ï¼‰</span></span><br><span class="line">      <span class="keyword">const</span> categoryResults = results.<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>) <span class="keyword">as</span> <span class="title class_">CategoryLoadResult</span>[]</span><br><span class="line">      <span class="keyword">const</span> swiperSuccess = results[results.<span class="property">length</span> - <span class="number">1</span>] <span class="keyword">as</span> <span class="built_in">boolean</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> successCount = categoryResults.<span class="title function_">filter</span>(<span class="function"><span class="params">r</span> =&gt;</span> r.<span class="property">success</span>).<span class="property">length</span></span><br><span class="line">      <span class="keyword">const</span> totalArticles = categoryResults.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, r</span>) =&gt;</span> sum + r.<span class="property">count</span>, <span class="number">0</span>)</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> endTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      <span class="keyword">const</span> duration = endTime - startTime</span><br><span class="line"></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å¿«é€Ÿåˆ·æ–°] âœ“ ç¬¬ä¸€é˜¶æ®µå®Œæˆ: <span class="subst">$&#123;successCount&#125;</span>/<span class="subst">$&#123;developedCategories.length&#125;</span> ä¸ªæ ç›®æˆåŠŸ, å…±<span class="subst">$&#123;totalArticles&#125;</span>æ¡æ•°æ®, è€—æ—¶<span class="subst">$&#123;duration&#125;</span>ms`</span>)</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å¿«é€Ÿåˆ·æ–°] è½®æ’­å›¾åˆ·æ–°: <span class="subst">$&#123;swiperSuccess ? <span class="string">&#x27;æˆåŠŸ&#x27;</span> : <span class="string">&#x27;å¤±è´¥&#x27;</span>&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">finalResult</span>: <span class="title class_">QuickRefreshResult</span> = &#123; </span><br><span class="line">        <span class="attr">success</span>: successCount &gt; <span class="number">0</span>, </span><br><span class="line">        <span class="attr">loadedCount</span>: successCount </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> finalResult</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">let</span> err = error <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å¿«é€Ÿåˆ·æ–°] å¼‚å¸¸: <span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">QuickRefreshResult</span> = &#123; <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">loadedCount</span>: <span class="number">0</span> &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ä¸¤é˜¶æ®µåˆ·æ–° - ç¬¬äºŒé˜¶æ®µï¼šåå°å®Œæ•´åŠ è½½æ‰€æœ‰åˆ†æ æ•°æ®</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * åœ¨åå°é€ä¸ªåŠ è½½å„æ ç›®çš„å…¨éƒ¨æ•°æ®ï¼Œå¹¶æä¾›è¿›åº¦å›è°ƒå®æ—¶æ›´æ–° UI</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">onProgress</span> - è¿›åº¦å›è°ƒå‡½æ•°ï¼Œå‚æ•°ä¸º &#123; category: æ ç›®å, current: å½“å‰è¿›åº¦, total: æ€»æ•° &#125;</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> Promise&lt;&#123; success: boolean, updatedCount: number &#125;&gt; - åŠ è½½ç»“æœå’ŒæˆåŠŸæ›´æ–°çš„æ ç›®æ•°</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@remarks</span></span></span><br><span class="line"><span class="comment">   * åˆ·æ–°ç­–ç•¥ï¼š</span></span><br><span class="line"><span class="comment">   * - åå°é€ä¸ªåŠ è½½å·²å¼€å‘æ ç›®çš„å…¨éƒ¨æ•°æ®</span></span><br><span class="line"><span class="comment">   * - æ¯ä¸ªæ ç›®å®Œæˆåç«‹å³å›è°ƒï¼Œé€šçŸ¥ UI æ›´æ–°</span></span><br><span class="line"><span class="comment">   * - å•ä¸ªæ ç›®å¤±è´¥ä¸å½±å“å…¶ä»–æ ç›®</span></span><br><span class="line"><span class="comment">   * - æŒ‰æ—¥æœŸå€’åºæ’åºåå­˜å‚¨</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * é€‚ç”¨åœºæ™¯ï¼š</span></span><br><span class="line"><span class="comment">   * - å¿«é€Ÿåˆ·æ–°å®Œæˆåçš„åå°ä»»åŠ¡</span></span><br><span class="line"><span class="comment">   * - ç¡®ä¿æ•°æ®å®Œæ•´æ€§å’Œæœ€æ–°æ€§</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment">   * ```typescript</span></span><br><span class="line"><span class="comment">   * newsManager.fullRefreshCategories((progress) =&gt; &#123;</span></span><br><span class="line"><span class="comment">   *   console.log(`$&#123;progress.category&#125;: $&#123;progress.current&#125;/$&#123;progress.total&#125;`)</span></span><br><span class="line"><span class="comment">   * &#125;).then(result =&gt; &#123;</span></span><br><span class="line"><span class="comment">   *   console.log(`å®Œæ•´åˆ·æ–°å®Œæˆï¼Œæ›´æ–°äº† $&#123;result.updatedCount&#125; ä¸ªæ ç›®`)</span></span><br><span class="line"><span class="comment">   * &#125;)</span></span><br><span class="line"><span class="comment">   * ```</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">fullRefreshCategories</span>(</span><br><span class="line">    <span class="attr">onProgress</span>?: <span class="function">(<span class="params"><span class="attr">progress</span>: <span class="title class_">RefreshProgress</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  ): <span class="title class_">Promise</span>&lt;<span class="title class_">FullRefreshResult</span>&gt; &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å®Œæ•´åˆ·æ–°] å¼€å§‹ç¬¬äºŒé˜¶æ®µï¼šåå°åŠ è½½å…¨éƒ¨åˆ†æ æ•°æ®`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title class_">ServerHealthAPI</span>.<span class="title function_">isServerReady</span>())) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å®Œæ•´åˆ·æ–°] æœåŠ¡ç«¯æœªå°±ç»ª`</span>)</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">FullRefreshResult</span> = &#123; <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">updatedCount</span>: <span class="number">0</span> &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">appKVDb</span>) &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å®Œæ•´åˆ·æ–°] æ•°æ®åº“æœªåˆå§‹åŒ–`</span>)</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">FullRefreshResult</span> = &#123; <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">updatedCount</span>: <span class="number">0</span> &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      <span class="keyword">const</span> developedCategories = <span class="variable constant_">NEWS_CATEGORIES</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">cat</span> =&gt;</span> cat.<span class="property">isDeveloped</span>)</span><br><span class="line">      <span class="keyword">const</span> totalCategories = developedCategories.<span class="property">length</span></span><br><span class="line">      <span class="keyword">let</span> updatedCount = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// é€ä¸ªåŠ è½½æ ç›®ï¼ˆé¿å…å¹¶å‘è¿‡å¤šå¯¼è‡´æœåŠ¡å™¨å‹åŠ›ï¼‰</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; developedCategories.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> category = developedCategories[i]</span><br><span class="line">        <span class="keyword">const</span> current = i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å®Œæ•´åˆ·æ–°] [<span class="subst">$&#123;current&#125;</span>/<span class="subst">$&#123;totalCategories&#125;</span>] åŠ è½½ã€<span class="subst">$&#123;category.displayName&#125;</span>ã€‘å…¨éƒ¨æ•°æ®`</span>)</span><br><span class="line"></span><br><span class="line">          <span class="comment">// è·å–è¯¥åˆ†ç±»çš„æ‰€æœ‰æ•°æ®</span></span><br><span class="line">          <span class="keyword">const</span> allNews = <span class="keyword">await</span> <span class="title class_">NewsListAPI</span>.<span class="title function_">getAllNewsByCategory</span>(category.<span class="property">apiCategory</span>)</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (allNews &amp;&amp; allNews.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// æŒ‰æ—¥æœŸå€’åºæ’åº</span></span><br><span class="line">            <span class="keyword">const</span> sortedNews = allNews.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> b.<span class="property">date</span>.<span class="title function_">localeCompare</span>(a.<span class="property">date</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ç›´æ¥è¦†ç›–å­˜å‚¨ï¼ˆå·²ç»æ˜¯æœ€æ–°å®Œæ•´æ•°æ®ï¼‰</span></span><br><span class="line">            <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">appKVDb</span>.<span class="title function_">put</span>(category.<span class="property">dbKey</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(sortedNews))</span><br><span class="line">            </span><br><span class="line">            updatedCount++</span><br><span class="line">            logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å®Œæ•´åˆ·æ–°] âœ“ [<span class="subst">$&#123;current&#125;</span>/<span class="subst">$&#123;totalCategories&#125;</span>] ã€<span class="subst">$&#123;category.displayName&#125;</span>ã€‘å®Œæˆ: <span class="subst">$&#123;sortedNews.length&#125;</span>æ¡`</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å›è°ƒè¿›åº¦æ›´æ–°</span></span><br><span class="line">            <span class="keyword">if</span> (onProgress) &#123;</span><br><span class="line">              <span class="keyword">const</span> <span class="attr">progress</span>: <span class="title class_">RefreshProgress</span> = &#123;</span><br><span class="line">                <span class="attr">category</span>: category.<span class="property">displayName</span>,</span><br><span class="line">                <span class="attr">current</span>: current,</span><br><span class="line">                <span class="attr">total</span>: totalCategories</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="title function_">onProgress</span>(progress)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å®Œæ•´åˆ·æ–°] [<span class="subst">$&#123;current&#125;</span>/<span class="subst">$&#123;totalCategories&#125;</span>] ã€<span class="subst">$&#123;category.displayName&#125;</span>ã€‘æ— æ•°æ®`</span>)</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å®Œæ•´åˆ·æ–°] [<span class="subst">$&#123;current&#125;</span>/<span class="subst">$&#123;totalCategories&#125;</span>] ã€<span class="subst">$&#123;category.displayName&#125;</span>ã€‘å¤±è´¥: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> endTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      <span class="keyword">const</span> duration = endTime - startTime</span><br><span class="line"></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å®Œæ•´åˆ·æ–°] âœ“ ç¬¬äºŒé˜¶æ®µå®Œæˆ: <span class="subst">$&#123;updatedCount&#125;</span>/<span class="subst">$&#123;totalCategories&#125;</span> ä¸ªæ ç›®æˆåŠŸ, è€—æ—¶<span class="subst">$&#123;duration&#125;</span>ms`</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">finalResult</span>: <span class="title class_">FullRefreshResult</span> = &#123;</span><br><span class="line">        <span class="attr">success</span>: updatedCount &gt; <span class="number">0</span>,</span><br><span class="line">        <span class="attr">updatedCount</span>: updatedCount</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> finalResult</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">let</span> err = error <span class="keyword">as</span> <span class="title class_">BusinessError</span></span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_MANAGER&#125;</span>[å®Œæ•´åˆ·æ–°] å¼‚å¸¸: <span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">FullRefreshResult</span> = &#123; <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">updatedCount</span>: <span class="number">0</span> &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸¤é˜¶æ®µåˆ·æ–°æ•°æ®</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * ç¬¬ä¸€é˜¶æ®µï¼šå¿«é€ŸåŠ è½½å„åˆ†æ å‰20æ¡ + è½®æ’­å›¾ï¼Œç«‹å³ç»“æŸåˆ·æ–°åŠ¨ç”»</span></span><br><span class="line"><span class="comment"> * ç¬¬äºŒé˜¶æ®µï¼šåå°å®Œæ•´åŠ è½½å…¨éƒ¨æ•°æ®ï¼Œå®æ—¶æ›´æ–° UI</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> Promise&lt;boolean&gt; - ç¬¬ä¸€é˜¶æ®µæ˜¯å¦æˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">reloadAllData</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_LIST&#125;</span>[ä¸¤é˜¶æ®µåˆ·æ–°] å¼€å§‹åˆ·æ–°`</span>)</span><br><span class="line">  promptAction.<span class="title function_">openToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;æ­£åœ¨å¿«é€Ÿåˆ·æ–°æœ€æ–°æ•°æ®...&#x27;</span>, <span class="attr">duration</span>: <span class="number">1500</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ========== ç¬¬ä¸€é˜¶æ®µï¼šå¿«é€Ÿåˆ·æ–°ï¼ˆå¹¶å‘åŠ è½½å‰20æ¡ï¼‰ ==========</span></span><br><span class="line">    <span class="keyword">const</span> quickResult = <span class="keyword">await</span> newsManager.<span class="title function_">quickRefreshCategories</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (quickResult.<span class="property">success</span>) &#123;</span><br><span class="line">      <span class="comment">// åˆ·æ–°æˆåŠŸï¼Œé‡æ–°åŠ è½½è½®æ’­å›¾æ•°æ®</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newsSwiperData</span> = <span class="keyword">await</span> newsManager.<span class="title function_">getNewsSwiperDataFromDB</span>()</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// è§¦å‘ NewsList ç»„ä»¶é‡æ–°åŠ è½½åˆ†ç±»æ•°æ®</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">refreshTrigger</span>++</span><br><span class="line">      </span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_LIST&#125;</span>[ä¸¤é˜¶æ®µåˆ·æ–°] âœ“ ç¬¬ä¸€é˜¶æ®µå®Œæˆ: <span class="subst">$&#123;quickResult.loadedCount&#125;</span>ä¸ªæ ç›®`</span>)</span><br><span class="line">      promptAction.<span class="title function_">openToast</span>(&#123; </span><br><span class="line">        <span class="attr">message</span>: <span class="string">`åˆ·æ–°æˆåŠŸï¼Œå·²æ›´æ–°<span class="subst">$&#123;quickResult.loadedCount&#125;</span>ä¸ªæ ç›®`</span>, </span><br><span class="line">        <span class="attr">duration</span>: <span class="number">2000</span> </span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ========== ç¬¬äºŒé˜¶æ®µï¼šåå°å®Œæ•´åˆ·æ–°ï¼ˆé€ä¸ªåŠ è½½å…¨éƒ¨æ•°æ®ï¼‰ ==========</span></span><br><span class="line">      <span class="comment">// ä¸é˜»å¡ UIï¼Œåœ¨åå°æ‰§è¡Œ</span></span><br><span class="line">      newsManager.<span class="title function_">fullRefreshCategories</span>(<span class="function">(<span class="params">progress</span>) =&gt;</span> &#123;</span><br><span class="line">        logger.<span class="title function_">debug</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_LIST&#125;</span>[ä¸¤é˜¶æ®µåˆ·æ–°] [<span class="subst">$&#123;progress.current&#125;</span>/<span class="subst">$&#123;progress.total&#125;</span>] ã€<span class="subst">$&#123;progress.category&#125;</span>ã€‘å®Œæˆ`</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ¯ä¸ªæ ç›®å®Œæˆåè§¦å‘ UI æ›´æ–°</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">refreshTrigger</span>++</span><br><span class="line">        </span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">fullResult</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fullResult.<span class="property">success</span>) &#123;</span><br><span class="line">          logger.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_LIST&#125;</span>[ä¸¤é˜¶æ®µåˆ·æ–°] âœ“ ç¬¬äºŒé˜¶æ®µå®Œæˆ: <span class="subst">$&#123;fullResult.updatedCount&#125;</span>ä¸ªæ ç›®`</span>)</span><br><span class="line">          promptAction.<span class="title function_">openToast</span>(&#123; </span><br><span class="line">            <span class="attr">message</span>: <span class="string">`åå°æ›´æ–°å®Œæˆï¼Œæ‰€æœ‰æ•°æ®å·²æ˜¯æœ€æ–°`</span>, </span><br><span class="line">            <span class="attr">duration</span>: <span class="number">2000</span> </span><br><span class="line">          &#125;)</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// æœ€åä¸€æ¬¡è§¦å‘æ›´æ–°</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">refreshTrigger</span>++</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          logger.<span class="title function_">warn</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_LIST&#125;</span>[ä¸¤é˜¶æ®µåˆ·æ–°] ç¬¬äºŒé˜¶æ®µéƒ¨åˆ†å¤±è´¥`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">Error</span></span>) =&gt;</span> &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_LIST&#125;</span>[ä¸¤é˜¶æ®µåˆ·æ–°] ç¬¬äºŒé˜¶æ®µå¼‚å¸¸: <span class="subst">$&#123;error.message&#125;</span>`</span>)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_LIST&#125;</span>[ä¸¤é˜¶æ®µåˆ·æ–°] ç¬¬ä¸€é˜¶æ®µå¤±è´¥`</span>)</span><br><span class="line">      promptAction.<span class="title function_">openToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;åˆ·æ–°å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥&#x27;</span>, <span class="attr">duration</span>: <span class="number">2000</span> &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;LOG_TAG.NEWS_LIST&#125;</span>[ä¸¤é˜¶æ®µåˆ·æ–°] å¼‚å¸¸: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(error)&#125;</span>`</span>)</span><br><span class="line">    promptAction.<span class="title function_">openToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;åˆ·æ–°å¤±è´¥ï¼Œè¯·ç¨åå†è¯•&#x27;</span>, <span class="attr">duration</span>: <span class="number">2000</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†é€šè¿‡å‡ ä¸ªæ–¹é¢å»ç»§ç»­è§£æã€‚</p>
<h5 id="æ•°æ®ç»“æ„å±‚é¢"><a href="#æ•°æ®ç»“æ„å±‚é¢" class="headerlink" title="æ•°æ®ç»“æ„å±‚é¢"></a>æ•°æ®ç»“æ„å±‚é¢</h5></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/XBXyftx">XBXyftx</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://xbxyftx.top">https://xbxyftx.top</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æ­¤æ–‡ç« ç‰ˆæƒå½’XBXyftxæ‰€æœ‰ï¼Œå¦‚æœ‰è½¬è½½ï¼Œè¯·è¨»æ˜æ¥è‡ªåŸä½œè€…</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%B8%BF%E8%92%99/">é¸¿è’™</a><a class="post-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF%E5%90%91/">æŠ€æœ¯å‘</a><a class="post-meta__tags" href="/tags/V2/">V2</a><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE/">é¡¹ç›®</a><a class="post-meta__tags" href="/tags/%E9%B8%BF%E6%98%93%E8%AE%AF/">é¸¿æ˜“è®¯</a><a class="post-meta__tags" href="/tags/%E6%89%A3%E5%AD%90/">æ‰£å­</a><a class="post-meta__tags" href="/tags/%E6%99%BA%E8%83%BD%E4%BD%93/">æ™ºèƒ½ä½“</a></div><div class="post-share"><div class="social-share" data-image="/imgs/ArticleTopImgs/HongYiXunTopImg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/01/ThoughtsOnVibeCoding/" title="åœ¨è™šæ„ä¸ç°å®ä¹‹é—´ï¼Œå®ˆä½é‚£æŸçµæ„Ÿä¹‹å…‰"><img class="cover" src="/imgs/ArticleTopImgs/ThoughtsOnVibeCodingTopImg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">åœ¨è™šæ„ä¸ç°å®ä¹‹é—´ï¼Œå®ˆä½é‚£æŸçµæ„Ÿä¹‹å…‰</div></div><div class="info-2"><div class="info-item-1">å¯¹äºVibe Codingä»¥åŠæ›´æ³›åŒ–çš„AIä½¿ç”¨çš„ä¸€äº›æƒ³æ³•ï¼ˆæŒç»­æ›´æ–°ä¸­ï¼‰</div></div></div></a><a class="pagination-related" href="/2025/11/28/EverydayAlgorithm/" title="æ¯æ—¥ç®—æ³•"><img class="cover" src="/imgs/ArticleTopImgs/EverydayAlgorithmTopImg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">æ¯æ—¥ç®—æ³•</div></div><div class="info-2"><div class="info-item-1">æ¯å¤©éƒ½è¦åˆ·ç®—æ³•ï¼ï¼ï¼</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/03/31/%E2%80%9CHongXiaoYi%E2%80%9D/" title="é¸¿å°æ˜“é¡¹ç›®å¼€å‘ç¬”è®°"><img class="cover" src="/imgs/ArticleTopImgs/hxyTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-31</div><div class="info-item-2">é¸¿å°æ˜“é¡¹ç›®å¼€å‘ç¬”è®°</div></div><div class="info-2"><div class="info-item-1">é¸¿å°æ˜“ï¼Œä½ çš„é¸¿è’™å¼€å‘å¥½å¸®æ‰‹ã€‚</div></div></div></a><a class="pagination-related" href="/2025/03/11/MianShiTong2/" title="é¢è¯•é€šé¡¹ç›®å¼€å‘ç¬”è®°2"><img class="cover" src="/imgs/ArticleTopImgs/MSTTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-11</div><div class="info-item-2">é¢è¯•é€šé¡¹ç›®å¼€å‘ç¬”è®°2</div></div><div class="info-2"><div class="info-item-1">é¢è¯•é€šé¡¹ç›®å¼€å‘ç¬”è®°2ï¼ˆæš‚æ—¶åœæ›´ï¼‰</div></div></div></a><a class="pagination-related" href="/2025/02/27/MianShiTong/" title="é¢è¯•é€šé¡¹ç›®å¼€å‘ç¬”è®°"><img class="cover" src="/imgs/ArticleTopImgs/MSTTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-27</div><div class="info-item-2">é¢è¯•é€šé¡¹ç›®å¼€å‘ç¬”è®°</div></div><div class="info-2"><div class="info-item-1">é¢è¯•é€šé¡¹ç›®å¼€å‘ç¬”è®°</div></div></div></a><a class="pagination-related" href="/2025/02/08/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="æˆ‘çš„ä¹¦æ¶é¡¹ç›®ç¬”è®°"><img class="cover" src="/imgs/ArticleTopImgs/BookShelfTopImg.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-08</div><div class="info-item-2">æˆ‘çš„ä¹¦æ¶é¡¹ç›®ç¬”è®°</div></div><div class="info-2"><div class="info-item-1">ä¸€ä¸ªå¯¹åˆ©ç”¨NetWork Kitå‘é€HTTPè¯·æ±‚çš„å®æˆ˜ç»ƒä¹ é¡¹ç›®</div></div></div></a><a class="pagination-related" href="/2025/06/29/OpenSourceSummer2025/" title="å¼€æºä¹‹å¤NowInOpenHarmony"><img class="cover" src="/imgs/ArticleTopImgs/OpenSourceSummerTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-29</div><div class="info-item-2">å¼€æºä¹‹å¤NowInOpenHarmony</div></div><div class="info-2"><div class="info-item-1">å¼€æºä¹‹å¤2025é¡¹ç›®å¼€å‘ç¬”è®°</div></div></div></a><a class="pagination-related" href="/2025/10/20/NowInOpenHarmonyPutAway3/" title="NowInOpenHarmonyä¸Šæ¶ç¬”è®°ä¹‹åç«¯éƒ¨ç½²ä¼˜åŒ–"><img class="cover" src="/imgs/ArticleTopImgs/NowInOpenHarmonyPutawayTopImg.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-20</div><div class="info-item-2">NowInOpenHarmonyä¸Šæ¶ç¬”è®°ä¹‹åç«¯éƒ¨ç½²ä¼˜åŒ–</div></div><div class="info-2"><div class="info-item-1">NowInOpenHarmonyä¸Šæ¶ç¬”è®°2ï¼Œè®°å½•åœ¨åç«¯åˆæ¬¡éƒ¨ç½²ååå¤å‡ºç°</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">XBXyftx</div><div class="author-info-description">åšå®‰åƒå¤æƒ…å¦‚æ­¤<br/>ç’‡ç‰å¦‚åè‡ªé†‰ä»</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/XBXyftx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/XBXyftx" target="_blank" title="Github"><i class="fab fa-github" style="color: #c3ffff;"></i></a><a class="social-icon" href="mailto:shuaixbx02@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="/img/wechat.png" target="_blank" title="WeChat"><i class="fa-brands fa-weixin" style="color: #7bb342;"></i></a></div></div><div class="card-widget card-info visitor-info"><div class="card-content"><div class="visitor-welcome"><i class="fas fa-heart"></i><span id="visitor-text">æ¬¢è¿æ¥è®¿ï¼</span></div><div class="visitor-details"><div class="visitor-location"><i class="fas fa-map-marker-alt"></i><span id="visitor-location-text">æ­£åœ¨è·å–ä½ç½®ä¿¡æ¯...</span></div><div class="visitor-ip"><i class="fas fa-globe"></i><span>IPåœ°å€: </span><span id="visitor-ip-text">è·å–ä¸­...</span></div><div class="visitor-distance"><i class="fas fa-route"></i><span id="visitor-distance-text">è·ç¦»åšä¸» åŠ è½½ä¸­...</span></div><div class="visitor-tip"><i class="fas fa-moon"></i><span id="visitor-tip-text">æ™šä¸Šå¥½ï¼Œå¤œç”Ÿæ´»å—¨èµ·æ¥ï¼</span></div></div></div><script>// è®¿é—®è€…ä¿¡æ¯è·å–
(function() {
  // IPåœ°å€è·å–APIåˆ—è¡¨ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
  const ipApis = [
    'https://api.ip.sb/geoip',
    'https://ipapi.co/json/',
    'https://freegeoip.app/json/',
    'https://ipinfo.io/json'
  ];
  
  let currentApiIndex = 0;
  
  function tryGetLocation() {
    if (currentApiIndex >= ipApis.length) {
      // æ‰€æœ‰APIéƒ½å¤±è´¥äº†ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
      handleError('æ‰€æœ‰IPæœåŠ¡éƒ½æ— æ³•è®¿é—®');
      return;
    }
    
    const currentApi = ipApis[currentApiIndex];
    
    fetch(currentApi)
      .then(response => {
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return response.json();
      })
      .then(data => {
        processLocationData(data, currentApi);
      })
      .catch(error => {
        console.warn(`API ${currentApi} å¤±è´¥:`, error);
        currentApiIndex++;
        setTimeout(tryGetLocation, 1000); // 1ç§’åå°è¯•ä¸‹ä¸€ä¸ªAPI
      });
  }
  
  function processLocationData(data, apiUrl) {
    let country, region, city, ip, latitude, longitude;
    
    // æ ¹æ®ä¸åŒAPIæ ¼å¼å¤„ç†æ•°æ®
    if (apiUrl.includes('ip.sb')) {
      country = data.country || 'æœªçŸ¥';
      region = data.region || 'æœªçŸ¥';
      city = data.city || 'æœªçŸ¥';
      ip = data.ip || 'æœªçŸ¥';
      latitude = data.latitude;
      longitude = data.longitude;
    } else if (apiUrl.includes('ipapi.co')) {
      country = data.country_name || 'æœªçŸ¥';
      region = data.region || 'æœªçŸ¥';
      city = data.city || 'æœªçŸ¥';
      ip = data.ip || 'æœªçŸ¥';
      latitude = data.latitude;
      longitude = data.longitude;
    } else if (apiUrl.includes('freegeoip.app')) {
      country = data.country_name || 'æœªçŸ¥';
      region = data.region_name || 'æœªçŸ¥';
      city = data.city || 'æœªçŸ¥';
      ip = data.ip || 'æœªçŸ¥';
      latitude = data.latitude;
      longitude = data.longitude;
    } else if (apiUrl.includes('ipinfo.io')) {
      country = data.country || 'æœªçŸ¥';
      const loc = data.region || 'æœªçŸ¥';
      region = loc;
      city = data.city || 'æœªçŸ¥';
      ip = data.ip || 'æœªçŸ¥';
      if (data.loc) {
        const coords = data.loc.split(',');
        latitude = parseFloat(coords[0]);
        longitude = parseFloat(coords[1]);
      }
    }
    
    // æ›´æ–°IPåœ°å€
    document.getElementById('visitor-ip-text').textContent = ip;
    
    // æ›´æ–°ä½ç½®ä¿¡æ¯å’Œæ¬¢è¿æ–‡å­—
    let locationText = '';
    if (country === 'ä¸­å›½' || country === 'China' || country === 'CN') {
      locationText = `${region} ${city}`;
                    document.getElementById('visitor-text').innerHTML = `æ¬¢è¿æ¥è‡ª ${region} ${city} çš„æœ‹å‹â™¥ï¸`;
    } else {
      locationText = `${country} ${region}`;
      document.getElementById('visitor-text').innerHTML = `æ¬¢è¿æ¥è‡ª ${country} çš„æœ‹å‹â™¥ï¸`;
    }
    document.getElementById('visitor-location-text').textContent = locationText;
    
    // è®¡ç®—è·ç¦»ï¼ˆå¯é…ç½®åšä¸»ä½ç½®ï¼‰
    if (latitude && longitude && !isNaN(latitude) && !isNaN(longitude)) {
      const bloggerLat = 39.9042; // åŒ—äº¬çº¬åº¦
      const bloggerLng = 116.4074; // åŒ—äº¬ç»åº¦
      const distance = calculateDistance(latitude, longitude, bloggerLat, bloggerLng);
      
      if (distance < 1) {
        document.getElementById('visitor-distance-text').textContent = `è·ç¦»åšä¸» ${(distance * 1000).toFixed(0)} ç±³ï¼`;
      } else if (distance < 100) {
        document.getElementById('visitor-distance-text').textContent = `è·ç¦»åšä¸» ${distance.toFixed(1)} å…¬é‡Œï¼`;
      } else {
        document.getElementById('visitor-distance-text').textContent = `è·ç¦»åšä¸» ${distance.toFixed(0)} å…¬é‡Œï¼`;
      }
    } else {
      document.getElementById('visitor-distance-text').textContent = 'è·ç¦»è®¡ç®—ä¸­...';
    }
    
    // æ ¹æ®æ—¶é—´è®¾ç½®é—®å€™è¯­
    updateGreeting();
  }
  
  function updateGreeting() {
    const now = new Date();
    const hour = now.getHours();
    let greeting = '';
    let icon = 'fas fa-sun';
    
    if (hour >= 6 && hour < 12) {
      greeting = 'ä¸Šåˆå¥½ï¼Œæ–°çš„ä¸€å¤©å¼€å§‹äº†ï¼';
      icon = 'fas fa-sun';
    } else if (hour >= 12 && hour < 14) {
      greeting = 'ä¸­åˆå¥½ï¼Œè®°å¾—åƒåˆé¥­å“¦ï¼';
      icon = 'fas fa-sun';
    } else if (hour >= 14 && hour < 18) {
      greeting = 'ä¸‹åˆå¥½ï¼Œåˆåæ—¶å…‰çœŸç¾å¥½ï¼';
      icon = 'fas fa-cloud-sun';
    } else if (hour >= 18 && hour < 22) {
      greeting = 'æ™šä¸Šå¥½ï¼Œå¤œç”Ÿæ´»å—¨èµ·æ¥ï¼';
      icon = 'fas fa-moon';
    } else {
      greeting = 'æ·±å¤œäº†ï¼Œæ³¨æ„ä¼‘æ¯å“¦ï¼';
      icon = 'fas fa-moon';
    }
    
    const tipElement = document.getElementById('visitor-tip-text');
    const tipIcon = tipElement.parentElement.querySelector('i');
    tipElement.textContent = greeting;
    if (tipIcon) {
      tipIcon.className = icon;
    }
  }
  
  function handleError(message) {
    document.getElementById('visitor-ip-text').textContent = 'è·å–å¤±è´¥';
    document.getElementById('visitor-location-text').textContent = 'è·å–å¤±è´¥';
    document.getElementById('visitor-distance-text').textContent = 'è·ç¦»æœªçŸ¥';
    document.getElementById('visitor-text').innerHTML = 'æ¬¢è¿æ¥è®¿ï¼';
    console.error('è·å–è®¿é—®è€…ä¿¡æ¯å¤±è´¥:', message);
  }
  
  // è®¡ç®—ä¸¤ç‚¹é—´è·ç¦»çš„å‡½æ•°ï¼ˆä½¿ç”¨Haversineå…¬å¼ï¼‰
  function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // åœ°çƒåŠå¾„ï¼Œå•ä½ï¼šåƒç±³
    const dLat = deg2rad(lat2 - lat1);
    const dLon = deg2rad(lon2 - lon1);
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
              Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  }
  
  function deg2rad(deg) {
    return deg * (Math.PI/180);
  }
  
  // å¯åŠ¨è·å–ä½ç½®ä¿¡æ¯
  tryGetLocation();
  
  // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡é—®å€™è¯­
  setInterval(updateGreeting, 60000);
})(); </script></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">welcomeï¼<br/><img src="/imgs/ClaudeCode.png" title="1748944170064.jpg" class="announcementImg"/></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">é€‰é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-number">2.1.</span> <span class="toc-text">æ ¸å¿ƒåŠŸèƒ½</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="toc-number">3.</span> <span class="toc-text">æ ¸å¿ƒé—®é¢˜è®°å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AppInit"><span class="toc-number">3.1.</span> <span class="toc-text">AppInit</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%AE%B5%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">3.1.1.</span> <span class="toc-text">åˆ†æ®µåˆå§‹åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E7%AE%A1%E7%90%86"><span class="toc-number">3.1.2.</span> <span class="toc-text">å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œé¡ºåºç®¡ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E7%9A%84%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.3.</span> <span class="toc-text">å¼‚æ­¥ä»»åŠ¡ç®¡ç†çš„å…³é”®å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#async-await%E4%B8%8EPromise"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">async&#x2F;awaitä¸Promise</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B1%82%E5%B1%82%E5%B0%81%E8%A3%85%E7%9A%84%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90"><span class="toc-number">3.1.3.2.</span> <span class="toc-text">å±‚å±‚å°è£…çš„ç»“æ„åˆ†æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B1%82%E5%B1%82%E5%B0%81%E8%A3%85%E5%AF%B9%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-number">3.1.3.3.</span> <span class="toc-text">å±‚å±‚å°è£…å¯¹åº”ç”¨æ¶æ„çš„å½±å“</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%AD%A3%E9%9D%A2%E5%BD%B1%E5%93%8D"><span class="toc-number">3.1.3.3.1.</span> <span class="toc-text">æ­£é¢å½±å“</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B4%9F%E9%9D%A2%E5%BD%B1%E5%93%8D"><span class="toc-number">3.1.3.3.2.</span> <span class="toc-text">è´Ÿé¢å½±å“</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B1%82%E5%B1%82%E5%B0%81%E8%A3%85%E5%AF%B9%E5%BC%82%E6%AD%A5%E7%AE%A1%E7%90%86%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-number">3.1.3.4.</span> <span class="toc-text">å±‚å±‚å°è£…å¯¹å¼‚æ­¥ç®¡ç†çš„å½±å“</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C%E7%9A%84%E4%B8%B2%E8%A1%8C%E5%8C%96"><span class="toc-number">3.1.3.4.1.</span> <span class="toc-text">1. å¼‚æ­¥æ“ä½œçš„ä¸²è¡ŒåŒ–</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C%E7%9A%84%E5%B9%B6%E8%A1%8C%E4%BC%98%E5%8C%96"><span class="toc-number">3.1.3.4.2.</span> <span class="toc-text">2. å¼‚æ­¥æ“ä½œçš„å¹¶è¡Œä¼˜åŒ–</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-%E5%BC%82%E6%AD%A5%E7%8A%B6%E6%80%81%E7%9A%84%E7%AE%A1%E7%90%86%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="toc-number">3.1.3.4.3.</span> <span class="toc-text">3. å¼‚æ­¥çŠ¶æ€çš„ç®¡ç†å¤æ‚åº¦</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-%E5%BC%82%E6%AD%A5%E9%93%BE%E6%9D%A1%E4%B8%AD%E7%9A%84%E9%94%99%E8%AF%AF%E4%BC%A0%E6%92%AD"><span class="toc-number">3.1.3.4.4.</span> <span class="toc-text">4. å¼‚æ­¥é“¾æ¡ä¸­çš„é”™è¯¯ä¼ æ’­</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93"><span class="toc-number">3.1.4.</span> <span class="toc-text">å®è·µç»éªŒæ€»ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8EAI%E8%BE%85%E5%8A%A9%E5%BC%80%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">å¯¹äºAIè¾…åŠ©å¼€å‘çš„æ€è€ƒ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E6%94%B9%E9%80%A0"><span class="toc-number">3.2.</span> <span class="toc-text">å¯¹äºåŠ è½½æ•°æ®æµçš„æ”¹é€ </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="toc-number">3.2.1.</span> <span class="toc-text">é—®é¢˜æè¿°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%87%BD%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="toc-number">3.2.2.</span> <span class="toc-text">æ ¸å¿ƒå‡½æ•°è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%B1%82%E9%9D%A2"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">æ•°æ®ç»“æ„å±‚é¢</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/11/28/EverydayAlgorithm/" title="æ¯æ—¥ç®—æ³•"><img src="/imgs/ArticleTopImgs/EverydayAlgorithmTopImg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æ¯æ—¥ç®—æ³•"/></a><div class="content"><a class="title" href="/2025/11/28/EverydayAlgorithm/" title="æ¯æ—¥ç®—æ³•">æ¯æ—¥ç®—æ³•</a><time datetime="2025-11-28T09:09:19.000Z" title="å‘è¡¨äº 2025-11-28 17:09:19">2025-11-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/18/HongYiXun/" title="é¸¿æ˜“è®¯"><img src="/imgs/ArticleTopImgs/HongYiXunTopImg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="é¸¿æ˜“è®¯"/></a><div class="content"><a class="title" href="/2025/11/18/HongYiXun/" title="é¸¿æ˜“è®¯">é¸¿æ˜“è®¯</a><time datetime="2025-11-18T07:19:14.000Z" title="å‘è¡¨äº 2025-11-18 15:19:14">2025-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/01/ThoughtsOnVibeCoding/" title="åœ¨è™šæ„ä¸ç°å®ä¹‹é—´ï¼Œå®ˆä½é‚£æŸçµæ„Ÿä¹‹å…‰"><img src="/imgs/ArticleTopImgs/ThoughtsOnVibeCodingTopImg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åœ¨è™šæ„ä¸ç°å®ä¹‹é—´ï¼Œå®ˆä½é‚£æŸçµæ„Ÿä¹‹å…‰"/></a><div class="content"><a class="title" href="/2025/11/01/ThoughtsOnVibeCoding/" title="åœ¨è™šæ„ä¸ç°å®ä¹‹é—´ï¼Œå®ˆä½é‚£æŸçµæ„Ÿä¹‹å…‰">åœ¨è™šæ„ä¸ç°å®ä¹‹é—´ï¼Œå®ˆä½é‚£æŸçµæ„Ÿä¹‹å…‰</a><time datetime="2025-11-01T08:53:54.000Z" title="å‘è¡¨äº 2025-11-01 16:53:54">2025-11-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/20/NowInOpenHarmonyPutAway3/" title="NowInOpenHarmonyä¸Šæ¶ç¬”è®°ä¹‹åç«¯éƒ¨ç½²ä¼˜åŒ–"><img src="/imgs/ArticleTopImgs/NowInOpenHarmonyPutawayTopImg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NowInOpenHarmonyä¸Šæ¶ç¬”è®°ä¹‹åç«¯éƒ¨ç½²ä¼˜åŒ–"/></a><div class="content"><a class="title" href="/2025/10/20/NowInOpenHarmonyPutAway3/" title="NowInOpenHarmonyä¸Šæ¶ç¬”è®°ä¹‹åç«¯éƒ¨ç½²ä¼˜åŒ–">NowInOpenHarmonyä¸Šæ¶ç¬”è®°ä¹‹åç«¯éƒ¨ç½²ä¼˜åŒ–</a><time datetime="2025-10-20T06:17:05.000Z" title="å‘è¡¨äº 2025-10-20 14:17:05">2025-10-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/12/NowInOpenHarmonyPutaway2/" title="NowInOpenHarmonyä¸Šæ¶ç¬”è®°ä¹‹å†èµ·æ–°å¾ç¨‹"><img src="/imgs/ArticleTopImgs/NowInOpenHarmonyPutawayTopImg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NowInOpenHarmonyä¸Šæ¶ç¬”è®°ä¹‹å†èµ·æ–°å¾ç¨‹"/></a><div class="content"><a class="title" href="/2025/10/12/NowInOpenHarmonyPutaway2/" title="NowInOpenHarmonyä¸Šæ¶ç¬”è®°ä¹‹å†èµ·æ–°å¾ç¨‹">NowInOpenHarmonyä¸Šæ¶ç¬”è®°ä¹‹å†èµ·æ–°å¾ç¨‹</a><time datetime="2025-10-12T06:17:05.000Z" title="å‘è¡¨äº 2025-10-12 14:17:05">2025-10-12</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/footerBg.png);"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By XBXyftx</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><span>å¤‡æ¡ˆå·ï¼šäº¬ICPå¤‡2025126467å·</span></a></div><div></div><span id="timeDate">è½½å…¥å¤©æ•°...</span><span id="times">è½½å…¥æ—¶åˆ†ç§’...</span><script>var now = new Date(); 
function createtime() { 
var grt = new Date("4/25/2024 18:30"); // åœ¨æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´
now.setTime(now.getTime() + 250); 
days = (now - grt) / 1000 / 60 / 60 / 24; 
dnum = Math.floor(days); 
hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum); 
hnum = Math.floor(hours); 
if (String(hnum).length == 1) { hnum = "0" + hnum; } 
minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum); 
mnum = Math.floor(minutes); 
if (String(mnum).length == 1) { mnum = "0" + mnum; } 
seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
snum = Math.round(seconds); 
if (String(snum).length == 1) { snum = "0" + snum; } 
document.getElementById("timeDate").innerHTML = "æœ¬ç½‘ç«™å·²è¿è¡Œ " + dnum + " å¤© "; 
document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’"; 
} 
setInterval(createtime, 250);</script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa-solid fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa-solid fa-arrow-rotate-right"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa-solid fa-arrow-right"></i></a><a class="rightMenu-item" id="menu-radompage" href="javascript:window.location.href = window.location.origin;"><i class="fa-solid fa-house"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa-solid fa-copy"></i><span>å¤åˆ¶</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:rmf.switchReadMode();"><i class="fa-solid fa-book"></i><span>é˜…è¯»æ¨¡å¼</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.js"></script><!-- ç€‘å¸ƒæµJavaScript - åªåœ¨é¦–é¡µåŠ è½½--><!-- æ–‡ç« æ‰“å­—æœºæ•ˆæœ - åªåœ¨æ–‡ç« é¡µé¢åŠ è½½--><script src="/js/typewriter-effect.js"></script><!-- ç½‘ç»œç›‘æ§å™¨ - å¸®åŠ©å®šä½503é—®é¢˜--><script src="/js/network-monitor.js"></script><script src="/js/topimg-monitor.js"></script><!-- å…¥åœºå¼¹çª—åŠŸèƒ½--><script src="/js/entrance-popup-config.js"></script><script src="/js/entrance-popup.js"></script><!-- åŸºç¡€æ‡’åŠ è½½åŠŸèƒ½--><script src="/js/lazy-loading.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikooxbx.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikooxbx.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('/js/twikoo.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script>localStorage.setItem('theme','dark')</script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script> // å¼ºåˆ¶é”å®šä¸ºæš—é»‘æ¨¡å¼ localStorage.setItem('theme', 'dark'); // é˜²æ­¢å…¶ä»–è„šæœ¬è¦†ç›–æ¨¡å¼ document.documentElement.setAttribute('data-theme', 'dark'); </script><link rel="stylesheet" href="/css/styles.css"><script> document.querySelectorAll('#post-comment).forEach(el => { el.style.backgroundColor = 'rgba(255, 255, 255, 0.6)'; }); </script><script src="/js/jquery-3.6.0.min.js"></script><script src="/js/rightmenu.js"></script><link rel="twikoo" href="/css/twikoo.css"><script src="/js/happy-title.js" async></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="/%5Bobject%20Object%5D"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="99" count="99" mobile="true" src="/%5Bobject%20Object%5D"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementsByClassName('recent-posts')[0];
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/06/24/typewriter/" alt=""><img width="48" height="48" src="/imgs/ArticleTopImgs/TypeWriteTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-06-24</span><a class="blog-slider__title" href="2025/06/24/typewriter/" alt="">Butterflyä¸»é¢˜å®ç°ç®€ä»‹æ‰“å­—æœº</a><div class="blog-slider__text">è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Hexoçš„Butterflyä¸»é¢˜ä¸­æ·»åŠ ç‚«é…·çš„æ‰“å­—æœºæ•ˆæœï¼ŒåŒ…å«å®Œæ•´çš„å®ç°ä»£ç å’Œé…ç½®æ–¹æ³•ã€‚</div><a class="blog-slider__button" href="2025/06/24/typewriter/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/04/30/ToTheApril2025/" alt=""><img width="48" height="48" src="/imgs/ArticleTopImgs/AprilTopImg.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-30</span><a class="blog-slider__title" href="2025/04/30/ToTheApril2025/" alt="">è‡´2025é‚£ä¸ªç¹å¿™çš„4æœˆ</a><div class="blog-slider__text">äººä»¬æ€»æ˜¯åŒ†åŒ†å‘å‰ï¼Œæ®Šä¸çŸ¥æ—¶å…‰æ˜“é€å•Šâ€¦â€¦ï¼ˆæœ¬æ–‡å›¾é‡è¾ƒå¤§åŠ è½½è¾ƒæ…¢æŒç»­æ›´æ–°ä¸­ï¼ï¼ï¼ï¼‰</div><a class="blog-slider__button" href="2025/04/30/ToTheApril2025/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/03/16/yiDuo/" alt=""><img width="48" height="48" src="/imgs/ArticleTopImgs/yiduoTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-03-16</span><a class="blog-slider__title" href="2025/03/16/yiDuo/" alt="">å…³äºé¸¿è’™çš„ä¸€å¤šèƒ½åŠ›</a><div class="blog-slider__text">ä¸€å¤šèƒ½åŠ›çš„å­¦ä¹ ç¬”è®°</div><a class="blog-slider__button" href="2025/03/16/yiDuo/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/02/04/V2/" alt=""><img width="48" height="48" src="/imgs/ArticleTopImgs/V2TopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-02-04</span><a class="blog-slider__title" href="2025/02/04/V2/" alt="">æµ…è°ˆé¸¿è’™çŠ¶æ€ç®¡ç†V1â€”â€”&gt;V2</a><div class="blog-slider__text">ç”¨å®é™…ä»£ç æµ‹è¯•ä¸æˆ‘çš„å¼€å‘ç»éªŒï¼Œè§£æé¸¿è’™çŠ¶æ€ç®¡ç†V2ä¸­éš¾ä»¥ç†è§£çš„å†…å®¹ï¼Œå¸®åŠ©å¼€å‘è€…ä»¬æ›´å¥½çš„ç†è§£å’Œä½¿ç”¨çŠ¶æ€ç®¡ç†V2ç‰ˆæœ¬ã€‚</div><a class="blog-slider__button" href="2025/02/04/V2/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/04/20/RemoteCommunication/" alt=""><img width="48" height="48" src="/imgs/ArticleTopImgs/RCPTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-20</span><a class="blog-slider__title" href="2025/04/20/RemoteCommunication/" alt="">è¿œåœºé€šä¿¡æœåŠ¡</a><div class="blog-slider__text">æœ¬æ–‡å°†ä»‹ç»é¸¿è’™è¿œåœºé€šä¿¡æœåŠ¡</div><a class="blog-slider__button" href="2025/04/20/RemoteCommunication/" alt="">è¯¦æƒ…   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>