<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>面试通项目开发笔记 | XBXyftx</title><meta name="author" content="XBXyftx"><meta name="copyright" content="XBXyftx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言面试通这个项目是我的第一个完整的鸿蒙项目。将会从零开始搭建项目结构，组织UI框架，编写业务逻辑，最终实现一个完整的项目。 项目简介面试通项目是一个基于 HarmonyOS NEXT 开发的鸿蒙应用，主要包含鸿蒙和前端的企业面试题以及真实的面试经验，还有一些面试辅助类的工具如常用开发单词和面试录音。  以上是该项目的概念设计图，接下来我将会记录整个项目的开发过程。 准备阶段新建项目与项目结构搭建">
<meta property="og:type" content="article">
<meta property="og:title" content="面试通项目开发笔记">
<meta property="og:url" content="http://example.com/2025/02/27/MianShiTong/index.html">
<meta property="og:site_name" content="XBXyftx">
<meta property="og:description" content="前言面试通这个项目是我的第一个完整的鸿蒙项目。将会从零开始搭建项目结构，组织UI框架，编写业务逻辑，最终实现一个完整的项目。 项目简介面试通项目是一个基于 HarmonyOS NEXT 开发的鸿蒙应用，主要包含鸿蒙和前端的企业面试题以及真实的面试经验，还有一些面试辅助类的工具如常用开发单词和面试录音。  以上是该项目的概念设计图，接下来我将会记录整个项目的开发过程。 准备阶段新建项目与项目结构搭建">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/XBXyftx/hexoImgs4/main/202503020220794.jpg">
<meta property="article:published_time" content="2025-02-27T15:03:16.000Z">
<meta property="article:modified_time" content="2025-03-05T12:46:58.019Z">
<meta property="article:author" content="XBXyftx">
<meta property="article:tag" content="鸿蒙">
<meta property="article:tag" content="技术向">
<meta property="article:tag" content="项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/XBXyftx/hexoImgs4/main/202503020220794.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "面试通项目开发笔记",
  "url": "http://example.com/2025/02/27/MianShiTong/",
  "image": "https://raw.githubusercontent.com/XBXyftx/hexoImgs4/main/202503020220794.jpg",
  "datePublished": "2025-02-27T15:03:16.000Z",
  "dateModified": "2025-03-05T12:46:58.019Z",
  "author": [
    {
      "@type": "Person",
      "name": "XBXyftx",
      "url": "https://github.com/XBXyftx"
    }
  ]
}</script><link rel="shortcut icon" href="https://github.com/XBXyftx/HexoImg/blob/main/Settings/48431edade01f1fbd58a48265a0df32.jpg?raw=true"><link rel="canonical" href="http://example.com/2025/02/27/MianShiTong/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 18
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '面试通项目开发笔记',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/bg.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://raw.githubusercontent.com/XBXyftx/hexoImgs4/main/202503020220794.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://raw.githubusercontent.com/XBXyftx/hexoimgs/main/48431edade01f1fbd58a48265a0df32.jpg" alt="Logo"><span class="site-name">XBXyftx</span></a><a class="nav-page-title" href="/"><span class="site-name">面试通项目开发笔记</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">面试通项目开发笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-27T15:03:16.000Z" title="发表于 2025-02-27 23:03:16">2025-02-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-03-05T12:46:58.019Z" title="更新于 2025-03-05 20:46:58">2025-03-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">11.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>45分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>面试通这个项目是我的第一个完整的鸿蒙项目。将会从零开始搭建项目结构，组织UI框架，编写业务逻辑，最终实现一个完整的项目。</p>
<h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p>面试通项目是一个基于 HarmonyOS NEXT 开发的鸿蒙应用，主要包含鸿蒙和前端的企业面试题以及真实的面试经验，还有一些面试辅助类的工具如常用开发单词和面试录音。</p>
<p><img src="/2025/02/27/MianShiTong/1.png" alt="1"></p>
<p>以上是该项目的概念设计图，接下来我将会记录整个项目的开发过程。</p>
<h2 id="准备阶段"><a href="#准备阶段" class="headerlink" title="准备阶段"></a>准备阶段</h2><h3 id="新建项目与项目结构搭建"><a href="#新建项目与项目结构搭建" class="headerlink" title="新建项目与项目结构搭建"></a>新建项目与项目结构搭建</h3><h4 id="项目结构搭建"><a href="#项目结构搭建" class="headerlink" title="项目结构搭建"></a>项目结构搭建</h4><p>本次我们采用<code>API14</code>来进行开发，<code>API14</code>是当前的最新版本，对于各项性能的调教也是当下最好的选择。</p>
<p>本项目的项目结构如下所示：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ets</span><br><span class="line">├── commons</span><br><span class="line">│   ├── components              // - 通用组件</span><br><span class="line">│   ├── constants               // - 全局常量数据</span><br><span class="line">│   └── utils                   // - 通用工具类</span><br><span class="line">├── entryability</span><br><span class="line">│   └── EntryAbility.ts</span><br><span class="line">├── models                      // - 数据模型</span><br><span class="line">├── pages</span><br><span class="line">│   ├── QuestionPage.ets        // - 页面组件</span><br><span class="line">│   └── Index.ets</span><br><span class="line">└── views</span><br><span class="line"><span class="code">    └── Question                // - 页面对应自定义组件</span></span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/2.png" alt="2"></p>
<h4 id="项目资源配置"><a href="#项目资源配置" class="headerlink" title="项目资源配置"></a>项目资源配置</h4><h5 id="颜色配置"><a href="#颜色配置" class="headerlink" title="颜色配置"></a>颜色配置</h5><p>将所需的颜色字段配置到<code>resources/base/element/color.json</code>中。</p>
<p><img src="/2025/02/27/MianShiTong/3.png" alt="3"></p>
<p>对主色系的统一管理队后续的开发、维护都有着极大的好处。<br>不能将所有的数据都内嵌在代码中，用一次复制一次，这样不仅对开发效率有影响，而且不利于后期的维护。</p>
<h5 id="图片资源"><a href="#图片资源" class="headerlink" title="图片资源"></a>图片资源</h5><p>将设计稿中的图片统一放入<code>resources/base/media</code>目录下。</p>
<h5 id="应用图标"><a href="#应用图标" class="headerlink" title="应用图标"></a>应用图标</h5><p>在<code>module.json5</code>中配置应用的图标。</p>
<p><img src="/2025/02/27/MianShiTong/4.png" alt="4"></p>
<h5 id="应用名称"><a href="#应用名称" class="headerlink" title="应用名称"></a>应用名称</h5><p>首先创建中文软件配置文件，详细步骤可以参考我的这篇博客：<a target="_blank" rel="noopener" href="https://xbxyftx.github.io/2025/01/30/%E9%B8%BF%E8%92%99%E4%B8%AD%E6%96%87%E5%8C%85/">手动新建鸿蒙中文包</a></p>
<p>修改应用名称的<code>&quot;EntryAbility_label&quot;</code>字段的值</p>
<h5 id="设置应用与元服务的图标和名称"><a href="#设置应用与元服务的图标和名称" class="headerlink" title="设置应用与元服务的图标和名称"></a>设置应用与元服务的图标和名称</h5><p>修改<code>AppScope/resources/base/element/string.json</code>中的<code>&quot;app_name&quot;</code>字段的值<br>然后在<code>AppScope/resources/base/media/app_icon.png</code>中替换应用的图标</p>
<p>可以直接同名图片文件替换，也可在<code>AppScope/resources/base/media</code>目录下放置不同名文件。<br>然后修改<code>AppScope/app.json5</code>中的<code>&quot;icon&quot;</code>字段的值。</p>
<p><img src="/2025/02/27/MianShiTong/5.png" alt="5"></p>
<h3 id="创建git和本地以及远程仓库"><a href="#创建git和本地以及远程仓库" class="headerlink" title="创建git和本地以及远程仓库"></a>创建git和本地以及远程仓库</h3><p>直接利用IDE内置的git工具即可，这里就不赘述了。<br>不过有一点要注意，<strong>git并不会帮你托管空文件夹</strong>，而当前构建的项目结构中包含了大量的空文件夹，这些文件夹还<strong>暂时</strong>没有创建任何文件，所以我们为了保证在远程仓库中的<strong>项目结构</strong>依旧<strong>保持完整</strong>我们需要创建一些<strong>占位文件</strong>，来让git为我们托管全部文件夹。</p>
<p><img src="/2025/02/27/MianShiTong/6.png" alt="6"></p>
<p>这是在创建占位文件前的远程仓库目录结构。</p>
<p><img src="/2025/02/27/MianShiTong/7.png" alt="7"></p>
<p>创建<code>.gitkeep</code>文件后，远程仓库的目录结构如下所示。</p>
<p><img src="/2025/02/27/MianShiTong/8.png" alt="8"></p>
<h3 id="hilog日志"><a href="#hilog日志" class="headerlink" title="hilog日志"></a>hilog日志</h3><p>在过去我们用的都是<code>console.log()</code>来进行日志的输出，<code>console</code>中虽然为我们封装了很多js中常用的输出方式，诸如：<code>log</code>、<code>warn</code>、<code>error</code>等，但是其弊端也很明显。</p>
<ol>
<li>无法进行日志的分类，导致日志混杂在一起，难以定位问题。</li>
<li>无法进行日志的过滤，导致日志过多，难以定位问题。</li>
<li>无法进行日志的格式化，导致日志输出不美观。</li>
</ol>
<p>hilog为我们提供了上述问题的解决方案，hilog为我们提供了日志的分类、过滤和格式化等功能。<br>hilog通过鸿蒙底层的重构之后，为我们提供了更加高效的日志输出方式。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debug</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">info</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">warn</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">error</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fatal</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isLoggable</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">level</span>: <span class="title class_">LogLevel</span></span>): <span class="built_in">boolean</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>参数 domain：用于指定输出日志所对应的业务领域，取值范围为 0x0000~0xFFFF，开发者可以根据需要进行自定义。</li>
<li>参数 tag：用于指定日志标识，可以为任意字符串，建议标识调用所在的类或者业务行为。</li>
<li>参数 format：格式字符串，用于日志的格式化输出。%{public}s 字符串 %{public}d 数字</li>
<li>参数 args：可以为 0 个或多个参数，可以为 0 个或多个参数，是格式字符串中参数类型对应的参数列表。</li>
</ul>
<p>我们通过下面这个实例来演示一下hilog的用法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hilog &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.PerformanceAnalysisKit&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.info测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          hilog.<span class="title function_">info</span>(<span class="number">0x0000</span>,<span class="string">&#x27;myHilog&#x27;</span>,<span class="string">&#x27;%&#123;public&#125;s&#x27;</span>,<span class="string">&#x27;第一个参数&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.warn测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          hilog.<span class="title function_">warn</span>(<span class="number">0x0000</span>,<span class="string">&#x27;myHilog&#x27;</span>,<span class="string">&#x27;%&#123;public&#125;s&#x27;</span>,<span class="string">&#x27;第一个参数&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.error测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          hilog.<span class="title function_">error</span>(<span class="number">0x0000</span>,<span class="string">&#x27;myHilog&#x27;</span>,<span class="string">&#x27;%&#123;public&#125;s&#x27;</span>,<span class="string">&#x27;第一个参数&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.debug测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          hilog.<span class="title function_">debug</span>(<span class="number">0x0000</span>,<span class="string">&#x27;myHilog&#x27;</span>,<span class="string">&#x27;%&#123;public&#125;s&#x27;</span>,<span class="string">&#x27;第一个参数&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/9.png" alt="9"></p>
<p>从输出的结果我们可以看到，首先在前面的日志分类信息中会先显示我们设置的日志业务分区信息，然后是日志的<strong>标识信息</strong>，最后是日志的<strong>内容</strong>。<br>而日志的内容格式是通过第三个参数来进行格式化输出的。<br>这里我们用的都是<code>%&#123;public&#125;s</code>，这是因为我们在第三个参数中传入的是一个字符串类型的值。</p>
<p>当然我们也可以传入多个参数，来进行格式化输出。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;hilog.info测试&#x27;</span>)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="number">0x0000</span>,<span class="string">&#x27;myHilog&#x27;</span>,<span class="string">&#x27;%&#123;public&#125;s __ %&#123;public&#125;d&#x27;</span>,<span class="string">&#x27;第一个参数&#x27;</span>,<span class="number">2025</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/10.png" alt="10"></p>
<p><code>%&#123;public&#125;s</code>表示字符串类型，<code>%&#123;public&#125;d</code>表示数字类型。两者之间连接的字符就是靠第三个参数中的字符串来进行定义的。<br>这个输出格式倒是和C语言中的<code>printf()</code>函数类似。（唤起了远古的回忆……）</p>
<p><strong>console 是基于 hilog 封装的！！！</strong>默认的 domain/tag 是 A03D00/JSAPP</p>
<h3 id="封装Logger"><a href="#封装Logger" class="headerlink" title="封装Logger"></a>封装Logger</h3><h4 id="封装-commons-utils-Logger-ets"><a href="#封装-commons-utils-Logger-ets" class="headerlink" title="封装 commons/utils/Logger.ets"></a>封装 commons/utils/Logger.ets</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hilog &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.PerformanceAnalysisKit&#x27;</span></span><br><span class="line"><span class="keyword">const</span> tag = <span class="string">&#x27;XBXLogger&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">domain</span>:<span class="built_in">number</span> <span class="comment">// 十六进制输出业务格式</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">tag</span>:<span class="built_in">string</span> <span class="comment">// 制定的自己的标识</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">format</span>:<span class="built_in">string</span> = <span class="string">&#x27;%&#123;public&#125;s&#x27;</span> <span class="comment">//格式化方式</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span> = <span class="number">0x0000</span>, <span class="attr">tag</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">domain</span> = domain</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tag</span> = tag</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">debug</span>(<span class="attr">args</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">debug</span>(<span class="variable language_">this</span>.<span class="property">domain</span>, <span class="variable language_">this</span>.<span class="property">tag</span>, <span class="variable language_">this</span>.<span class="property">format</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">info</span>(<span class="attr">args</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable language_">this</span>.<span class="property">domain</span>, <span class="variable language_">this</span>.<span class="property">tag</span>, <span class="variable language_">this</span>.<span class="property">format</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">warn</span>(<span class="attr">args</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">warn</span>(<span class="variable language_">this</span>.<span class="property">domain</span>, <span class="variable language_">this</span>.<span class="property">tag</span>, <span class="variable language_">this</span>.<span class="property">format</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">error</span>(<span class="attr">args</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">error</span>(<span class="variable language_">this</span>.<span class="property">domain</span>, <span class="variable language_">this</span>.<span class="property">tag</span>, <span class="variable language_">this</span>.<span class="property">format</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">logger</span>:<span class="title class_">Logger</span> = <span class="keyword">new</span> <span class="title class_">Logger</span>(<span class="number">0x1234</span>,tag)</span><br></pre></td></tr></table></figure>
<p>hilog中有固定要传的三个参数，分别是：domain、tag、format。<br>而我们在封装Logger的时候，将这三个参数封装到了一个类中，这样我们在使用的时候就可以直接调用Logger类中的方法，而不需要每次都传入这三个参数。<br>这上述包装函数都是实例函数，并不是静态函数，所以我们并不能直接导出一个Logger类，而是导出一个Logger类的实例。<br>由于在开发中每个人所负责的业务领域和标识变动次数较少，尤其是对于这个单人开发项目来说，业务领域和标识可以直接写死，所以这里直接导出一个已经写好的Logger实例即可。</p>
<p><strong>改造并封装现有能力</strong>使其能够更加契合当前项目是很重要的一点，就像是在鸿蒙系统原有网络请求模块的基础上进一步封装成第三方库axios一样。<br>让原有能力更加的方便好用。</p>
<h4 id="导出与使用Logger"><a href="#导出与使用Logger" class="headerlink" title="导出与使用Logger"></a>导出与使用Logger</h4><p>在未来的开发中需要导出的工具类和函数会越来越多，来源的文件也会越来越多，如果都分别从各个文件中导出，会非常的麻烦。<br>所以我们就可以编辑一个中转站来进行统一的导出和管理。</p>
<p>创建<code>CommonsExportCentre.ets</code>文件，在该文件中统一导出所有需要导出的工具类和函数。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./utils/Logger&#x27;</span></span><br></pre></td></tr></table></figure>
<p>这样在需要使用commons中的工具类和函数的时候，只需要导入<code>CommonsExportCentre.ets</code>文件即可。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hilog &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.PerformanceAnalysisKit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&#x27;../commons/CommonsExportCentre&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.info测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          logger.<span class="title function_">info</span>(<span class="string">&#x27;测试测试&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.warn测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          logger.<span class="title function_">warn</span>(<span class="string">&#x27;测试测试&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.error测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          logger.<span class="title function_">error</span>(<span class="string">&#x27;测试测试&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.debug测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          logger.<span class="title function_">debug</span>(<span class="string">&#x27;测试测试&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们就可以看到我们可以用更加简便的方式做到与hilog一致的效果了。</p>
<p><img src="/2025/02/27/MianShiTong/11.png" alt="11"></p>
<h3 id="封装沉浸式工具"><a href="#封装沉浸式工具" class="headerlink" title="封装沉浸式工具"></a>封装沉浸式工具</h3><p>接下来我们将封装一个工具类来控制是否开启沉浸式模式。</p>
<h4 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h4><p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/js-apis-window-V14?catalogVersion=V14">window.getLastWindow 获取当前窗口对象</a><br><img src="/2025/02/27/MianShiTong/12.png" alt="12"></p>
<p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/js-apis-window-V14#getwindowavoidarea9">getWindowAvoidArea 使用窗口对象获取某一个区域的尺寸</a><br><img src="/2025/02/27/MianShiTong/13.png" alt="13"></p>
<h4 id="开启沉浸模式"><a href="#开启沉浸模式" class="headerlink" title="开启沉浸模式"></a>开启沉浸模式</h4><h5 id="应用上下文对象"><a href="#应用上下文对象" class="headerlink" title="应用上下文对象"></a>应用上下文对象</h5><p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/js-apis-inner-application-context-V14?catalogVersion=V14">上下文对象文档</a></p>
<p>上下文对象是一个包含了应用信息，以及一些应用功能的对象，获取它有两种方式：</p>
<ol>
<li>在组价中调用<code>getContext(this)</code>方法获取</li>
<li>在UIAbility中调用<code>this.context</code>获取</li>
</ol>
<p>对于工具类来说我们只能通过第二种方式获取，我们可以在<code>onCreate</code>生命周期中获取上下文对象，并将其保存到<code>AppStorage</code>中。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onCreate</span>(<span class="attr">want</span>: <span class="title class_">Want</span>, <span class="attr">launchParam</span>: <span class="title class_">AbilityConstant</span>.<span class="property">LaunchParam</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">getApplicationContext</span>().<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_NOT_SET</span>);</span><br><span class="line">  hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onCreate&#x27;</span>);</span><br><span class="line">  <span class="title class_">AppStorage</span>.<span class="title function_">setOrCreate</span>(<span class="string">&#x27;context&#x27;</span>,<span class="variable language_">this</span>.<span class="property">context</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于<code>AppStorageV2</code>如何存储上下文对象我暂时还没有解决第一个类型参数的问题。</p>
<p>(1h后……)</p>
<p>我想到了当初在学习如何从V1向V2转换时，我直接持久化一个对象数组并不成功的原因是其类型只能是一个对象，而不是一个数组或是联合类型。<br>当时我将对象数组包装在一个对象中，作为对象的一个属性连同那个对象一起持久化就成功了，所以我单独设计了一个对象来包裹上下文对象就成功了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Context</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GetContext</span>&#123;</span><br><span class="line">  <span class="attr">context</span>:<span class="title class_">Context</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">context</span>: <span class="title class_">Context</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span> = context</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启全屏</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">enable</span>(<span class="params"></span>)&#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="string">&#x27;进入enable&#x27;</span>)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="title class_">AppStorageV2</span>.<span class="property">connect</span>&lt;<span class="title class_">GetContext</span>&gt;(<span class="title class_">GetContext</span>,<span class="string">&#x27;context&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (context) &#123;</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="string">&#x27;找到Context&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> win = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(context.<span class="property">context</span>)</span><br><span class="line">      win.<span class="title function_">setWindowLayoutFullScreen</span>(<span class="literal">true</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          logger.<span class="title function_">debug</span>(<span class="string">&#x27;进入setWindowLayoutFullScreen的then&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">&#x27;未找到Context&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;<span class="keyword">catch</span> (err)&#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(err)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:err&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onCreate</span>(<span class="attr">want</span>: <span class="title class_">Want</span>, <span class="attr">launchParam</span>: <span class="title class_">AbilityConstant</span>.<span class="property">LaunchParam</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">getApplicationContext</span>().<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_NOT_SET</span>);</span><br><span class="line">  hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onCreate&#x27;</span>);</span><br><span class="line">  <span class="title class_">AppStorageV2</span>.<span class="property">connect</span>&lt;<span class="title class_">GetContext</span>&gt;(<span class="title class_">GetContext</span>,<span class="string">&#x27;context&#x27;</span>,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">GetContext</span>(<span class="variable language_">this</span>.<span class="property">context</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后在<code>onWindowStageCreate</code>生命周期函数中调用<code>enable()</code>方法开启全屏。</p>
<p><img src="/2025/02/27/MianShiTong/14.png" alt="14"></p>
<p>也是顺利的实现了沉浸式效果。</p>
<h4 id="获取屏幕尺寸"><a href="#获取屏幕尺寸" class="headerlink" title="获取屏幕尺寸"></a>获取屏幕尺寸</h4><p>在上面的沉浸式页面效果图我们可以看到其实如果上下的内容都顶到头的话会导致内容<strong>被导航栏和状态栏遮挡</strong>。<br>所以我们的沉浸式布局仅仅需要将我们的<strong>背景图或背景色延伸</strong>到导航栏和状态栏的下方即可，而真正的<strong>内容不需要向上下延伸</strong>，因此我们还需要获取到导航栏和状态栏的<strong>高度</strong>。</p>
<p>为了实现这个效果，我们需要用到<code>getWindowAvoidArea()</code>方法。</p>
<p><img src="/2025/02/27/MianShiTong/15.png" alt="15"></p>
<p><img src="/2025/02/27/MianShiTong/16.png" alt="16"></p>
<p>根据文档我们就可以获取我们所需的规避区域的尺寸，并将其应用到我们的布局中。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">enable</span>(<span class="params"></span>)&#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="string">&#x27;FullScreen: 进入enable&#x27;</span>)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="title class_">AppStorageV2</span>.<span class="property">connect</span>&lt;<span class="title class_">GetContext</span>&gt;(<span class="title class_">GetContext</span>,<span class="string">&#x27;context&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (context) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen: 找到Context&#x27;</span>)</span><br><span class="line">      <span class="comment">//获取当前窗口</span></span><br><span class="line">      <span class="keyword">const</span> win = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(context.<span class="property">context</span>)</span><br><span class="line">      <span class="comment">//设置当前窗口为沉浸式模式</span></span><br><span class="line">      <span class="keyword">await</span> win.<span class="title function_">setWindowLayoutFullScreen</span>(<span class="literal">true</span>)</span><br><span class="line">      <span class="comment">//获取顶部区域</span></span><br><span class="line">      <span class="keyword">const</span> topArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_SYSTEM</span>).<span class="property">topRect</span></span><br><span class="line">      <span class="comment">//将顶部高度存储到AppStorage</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen: topAreaHeight: &#x27;</span>+<span class="title function_">px2vp</span>(topArea.<span class="property">height</span>))</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,topAreaHeight,<span class="function">()=&gt;</span><span class="title function_">px2vp</span>(topArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line">      <span class="comment">//获取底部区域和底部区域高度</span></span><br><span class="line">      <span class="keyword">const</span> bottomArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_NAVIGATION_INDICATOR</span>).<span class="property">bottomRect</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen: bottomAreaHeight: &#x27;</span>+<span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>))</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,bottomAreaHeight,<span class="function">()=&gt;</span><span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">&#x27;FullScreen: 未找到Context&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;<span class="keyword">catch</span> (err)&#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(err)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:err&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于<code>bottomArea.height</code>和<code>topArea.height</code>都是<code>px</code>单位，而我们的布局中使用的是<code>vp</code>单位，所以我们需要将<code>px</code>单位转换为<code>vp</code>单位。</p>
<hr>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hilog &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.PerformanceAnalysisKit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; bottomAreaHeight, logger, topAreaHeight &#125; <span class="keyword">from</span> <span class="string">&#x27;../commons/CommonsExportCentre&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logTag = <span class="string">&#x27;indexPage: &#x27;</span></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">topAvoidSize</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">bottomAvoidSize</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,topAreaHeight)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">topAvoidSize</span> = <span class="built_in">parseInt</span>(<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,topAreaHeight)!.<span class="title function_">toString</span>())</span><br><span class="line">        logger.<span class="title function_">info</span>(logTag+<span class="string">&#x27;topAvoidSize: &#x27;</span>+<span class="variable language_">this</span>.<span class="property">topAvoidSize</span>)</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(logTag+<span class="string">&#x27;未找到topAreaHeight&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,bottomAreaHeight)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">bottomAvoidSize</span> = <span class="built_in">parseInt</span>(<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,bottomAreaHeight)!.<span class="title function_">toString</span>())</span><br><span class="line">        logger.<span class="title function_">info</span>(logTag+<span class="string">&#x27;bottomAvoidSize: &#x27;</span>+<span class="variable language_">this</span>.<span class="property">bottomAvoidSize</span>)</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(logTag+<span class="string">&#x27;未找到bottomAreaHeight&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (err)&#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(logTag+err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;top&#x27;</span>)</span><br><span class="line">      <span class="title class_">Blank</span>()</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">padding</span>(&#123;</span><br><span class="line">      <span class="attr">top</span>:<span class="variable language_">this</span>.<span class="property">topAvoidSize</span>,</span><br><span class="line">      <span class="attr">bottom</span>:<span class="variable language_">this</span>.<span class="property">bottomAvoidSize</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Blue</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在编写完以上代码之后，上下区域的规避并没有实现。<br>此时就体现出了打印日志打重要性。</p>
<p><img src="/2025/02/27/MianShiTong/17.png" alt="17"></p>
<p>通过日志我们可知问题出现在获取获取规避区域的高度时，AppStorageV2中并没有存储我们所需的数据。<br>而FullScreen文件获取避障区域高度的日志是在这之后打印的说明我们获取避障区域的代码执行晚了。</p>
<h5 id="AppStorageV2数据存储问题"><a href="#AppStorageV2数据存储问题" class="headerlink" title="AppStorageV2数据存储问题"></a>AppStorageV2数据存储问题</h5><p>在寻找了一段时间执行时间的问题之后，暂时还没有解决，但我发现了另外一个问题，AppStorageV2在存储顶部区域数据时会卡死，后续的代码都不会执行。</p>
<p><img src="/2025/02/27/MianShiTong/18.png" alt="18"></p>
<p>我不知道是因为底部区域的高度数值获取错误导致的后续代码没有执行，还是代码就卡死在了存储顶部区域高度的这一步。</p>
<p>所以我新增了两行日志</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen: topAreaHeight: &#x27;</span>+<span class="title function_">px2vp</span>(topArea.<span class="property">height</span>))</span><br><span class="line"><span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,topAreaHeight,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">Number</span>(<span class="title function_">px2vp</span>(topArea.<span class="property">height</span>)))</span><br><span class="line"><span class="comment">// AppStorage.setOrCreate(topAreaHeight,px2vp(topArea.height))</span></span><br><span class="line">logger.<span class="title function_">debug</span>(<span class="string">&#x27;FullScreen: topAreaHeight存储完毕&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取底部区域和底部区域高度</span></span><br><span class="line"><span class="keyword">const</span> bottomArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_NAVIGATION_INDICATOR</span>).<span class="property">bottomRect</span></span><br><span class="line">logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen: bottomAreaHeight: &#x27;</span>+<span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>))</span><br><span class="line"><span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,bottomAreaHeight,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">Number</span>(<span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>)))</span><br><span class="line">logger.<span class="title function_">debug</span>(<span class="string">&#x27;FullScreen: bottomAreaHeight存储完毕&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>很显然，结果是一样的。<br>至此我们可以分析出问题出现在<code>AppStorageV2.connect()</code>方法上。<br>我尝试了<code>AppStorage.setOrCreate()</code>方法，结果代码就可以执行过去。</p>
<p>这也说明就是我初始化数据时有问题。</p>
<p>在求助了子安学长后我意识到了问题所在：<br><code>AppStorageV2.connect()</code>函数的第三个函数需要的是一个构造器，也就是需要有<code>new</code>关键字，并不一定要在第三个参数中，但一定要包含有new。<br>而我当前的写法<code>AppStorageV2.connect(Number,topAreaHeight,()=&gt;px2vp(topArea.height))</code>对于<code>Number</code>来说是错误的，因为我没有使用new关键字。</p>
<p>将原本的数据利用<code>new Number()</code>包裹之后再传入即可。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,topAreaHeight,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">Number</span>(<span class="title function_">px2vp</span>(topArea.<span class="property">height</span>)))</span><br><span class="line"><span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,bottomAreaHeight,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">Number</span>(<span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>)))</span><br></pre></td></tr></table></figure>
<p>至此初始化问题解决。</p>
<h5 id="初始化时间问题"><a href="#初始化时间问题" class="headerlink" title="初始化时间问题"></a>初始化时间问题</h5><p>在解决了初始化问题后，我发现规避区域的高度并没有生效。<br>根据日志我们可以看到</p>
<p><img src="/2025/02/27/MianShiTong/19.png" alt="19"></p>
<p>Index页面获取数据的时机依旧是在<code>AppStorageV2.connect()</code>方法之前，也就是说规避区域的高度并没有在Index页面初始化时获取到。<br>这个问题暂时我还没有解决办法，所以我决定先利用V1版本所提供的单项绑定能力来规避时间差问题。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@StorageProp</span>(topAreaHeight) <span class="attr">topAvoidSize</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"><span class="meta">@StorageProp</span>(bottomAreaHeight) <span class="attr">bottomAvoidSize</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/20.png" alt="20"></p>
<hr>
<p><img src="/2025/02/27/MianShiTong/21.png" alt="21"></p>
<p>由此我们可看出，虽然在UI渲染完成时规避区域的高度数据依旧没有完成初始化，数据仍未默认的0，而由于V1的单项绑定能力，规避区域的高度依旧可以通过数据的改变而生效。</p>
<h5 id="初始化时间问题解决方案"><a href="#初始化时间问题解决方案" class="headerlink" title="初始化时间问题解决方案"></a>初始化时间问题解决方案</h5><p>在第二天我再次求助了子安学长后我们找到了解决方案。</p>
<p><strong>解决过程复现：</strong></p>
<ul>
<li><p>确认代码执行顺序:<br>首先我们考虑的是再次用V1和V2两种<code>AppStorage</code>分别创建全局变量，并通过打印日志的方式来观察全局变量的初始化时机。<br>解雇与昨天的结果一样，两者的初始化时机都是在<strong>Index页面已经构建完成后</strong>才完成的初始化。</p>
<p><img src="/2025/02/27/MianShiTong/22.png" alt="22"></p>
<p>现在我们可以确定目前代码的执行顺序如上图所示。</p>
</li>
<li><p>分析V1版本成功原因:<br>在昨晚最后的尝试中，我回归V1版本，并调用它提供的<strong>单项绑定能力</strong>，<strong>规避了初始化时间差的问题</strong>。<br>哪怕在页面构建时数据并没有成功初始化，也可以通过<strong>后续数据的更新</strong>来在极短的时间内获取到数据修改UI</p>
</li>
<li><p>V2无法复刻的原因:<br>由于在V2中获取与初始化都是同一个接口<code>AppStorageV2.connect()</code>，所以无法通过单项绑定能力来规避初始化时间差的问题。<br>因为在V2中在初始化时<strong>必须要传入一个默认构造器</strong>，而后才能用两个参数来获取数据，这一点在我V2版本的解析博客中也有提到。<br>这就导致我们需要在搞清楚代码执行顺序后，在<strong>最先用到这个数据的地方</strong>进行构造器的传入才能完成初始化。<br>而<code>enable</code>函数却不是最先用到这个数据的地方，而是在<code>Index</code>页面构建后才用到的。</p>
<p><img src="/2025/02/27/MianShiTong/23.png" alt="23"></p>
</li>
<li><p>查找文档:<br><img src="/2025/02/27/MianShiTong/24.png" alt="24"></p>
<hr>
<p><img src="/2025/02/27/MianShiTong/25.png" alt="25"></p>
<p>文档中并没有提供双向绑定或是单项绑定的方法，而我发现V2版本的全局变量思想与V1版本稍有不同。<br>V1版本中在UI组件中要用<strong>专属修饰器</strong>来与全局变量进行单向或双向绑定，在逻辑函数中则要分别用<strong>创建，获取，修改等API接口</strong>来进行读写操作。<br>而对于V2版本则是相当于获取了全局变量的读写权限或者说是说获取了那个全局变量的<strong>引用</strong>。<br>我们只需要像正常变量的读写一样用等号去进行数值的修改即可。</p>
</li>
<li><p>修改初始化位置:<br>在更深入的了解了V2版本的全局变量机制之后，我从新梳理了代码的执行顺序，并将初始化移动到了Index页面的构建过程中。<br>经过测试，虽然没有了原本的初始化报错，但数值也仅仅采用了默认的0值。<br>我将原本<code>enable</code>函数中的初始化修改为了<strong>修改数值</strong>，试图采用这种方式来复刻V1的规避初始化时间差的方式。<br>但又出现了新的问题就是虽然修改成功了，但是<code>Index</code>页面的状态变量依旧没有修改数值。</p>
</li>
<li><p>最终解决方案:<br>在我回顾前几次遇到的V2全局变量存储问题都是依靠包装为一个新的对象来解决的。<br><code>Number</code>类型在初始化存储时虽然使用了<code>new</code>关键字，但很有可能并没有被系统追踪数值的变化。<br>所以我们需要将数据包装为一个新的对象，并用<code>@Trace</code>来追踪数值的变化。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ObservedV2</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AvoidArea</span> &#123;</span><br><span class="line">  <span class="meta">@Trace</span> <span class="attr">top</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="meta">@Trace</span> <span class="attr">bottom</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取顶部区域</span></span><br><span class="line"><span class="keyword">const</span> topArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_SYSTEM</span>).<span class="property">topRect</span></span><br><span class="line"><span class="comment">//将顶部高度存储到AppStorage</span></span><br><span class="line">logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen:  topAreaHeight: &#x27;</span> + <span class="title function_">px2vp</span>(topArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取底部区域和底部区域高度</span></span><br><span class="line"><span class="keyword">const</span> bottomArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_NAVIGATION_INDICATOR</span>).<span class="property">bottomRect</span></span><br><span class="line">logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen:  bottomAreaHeight: &#x27;</span> + <span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">avoid_area.<span class="property">top</span> = <span class="title function_">px2vp</span>(topArea.<span class="property">height</span>);</span><br><span class="line">avoid_area.<span class="property">bottom</span> = <span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>)</span><br><span class="line">logger.<span class="title function_">debug</span>(<span class="string">&#x27;FullScreen:  avoid_area数据更新完成&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>经过测试，功能终于实现。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Local</span> <span class="attr">avoidAreaSizes</span>: <span class="title class_">AvoidAreaSizes</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">AvoidAreaSizes</span>, <span class="variable constant_">AVOID_AREA</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">AvoidAreaSizes</span>())!</span><br><span class="line"></span><br><span class="line"><span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="variable constant_">INDEX_LOG_TAG</span> + <span class="string">&#x27;aboutToAppear函数: top: &#x27;</span> + <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">top</span> + <span class="string">&#x27; bottom: &#x27;</span> +</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">bottom</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Monitor</span>(<span class="string">&#x27;avoidAreaSizes.top&#x27;</span>,<span class="string">&#x27;avoidAreaSizes.bottom&#x27;</span>)</span><br><span class="line"><span class="title function_">onChange</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="variable constant_">INDEX_LOG_TAG</span> + <span class="string">&#x27;监测voidAreaSizes数值改变: &#x27;</span> + <span class="string">&#x27;topAvoidSize: &#x27;</span> + <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">top</span> + <span class="string">&#x27; bottomAvoidSize: &#x27;</span> +</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">bottom</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/26.png" alt="26"></p>
<p>通过生命周期函数和变量监听器的日志我们可以看到代码的<strong>执行顺序没有变</strong>，与之前的推测一致。<br>通过包装对象的方式我们顺利的让系统<strong>监听到了数值的变化</strong>，实现的UI状态变量的数值更新。</p>
</li>
</ul>
<p>至此问题解决。</p>
<h4 id="关闭沉浸式函数"><a href="#关闭沉浸式函数" class="headerlink" title="关闭沉浸式函数"></a>关闭沉浸式函数</h4><p>关闭沉浸式函数的逻辑大体与开启沉浸式函数的逻辑一致，只是在获取规避区域的高度时略有不同。<br>所以我们先将开启沉浸式函数的代码复制过来，然后进行修改。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//关闭全屏</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">disable</span>(<span class="params"></span>)&#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;进入FullScreen.disable&#x27;</span>)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="title class_">AppStorageV2</span>.<span class="property">connect</span>&lt;<span class="title class_">GetContext</span>&gt;(<span class="title class_">GetContext</span>, <span class="string">&#x27;context&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (context) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;找到Context&#x27;</span>)</span><br><span class="line">      <span class="comment">//获取当前窗口</span></span><br><span class="line">      <span class="keyword">const</span> win = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(context.<span class="property">context</span>)</span><br><span class="line">      <span class="comment">//设置当前窗口为沉浸式模式</span></span><br><span class="line">      <span class="keyword">await</span> win.<span class="title function_">setWindowLayoutFullScreen</span>(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//获取顶部区域</span></span><br><span class="line">      <span class="keyword">const</span> topArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_SYSTEM</span>).<span class="property">topRect</span></span><br><span class="line">      <span class="comment">//将顶部高度存储到AppStorage</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;topAreaHeight: &#x27;</span> + <span class="title function_">px2vp</span>(topArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//获取底部区域和底部区域高度</span></span><br><span class="line">      <span class="keyword">const</span> bottomArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_NAVIGATION_INDICATOR</span>).<span class="property">bottomRect</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;bottomAreaHeight: &#x27;</span> + <span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      avoid_area.<span class="property">top</span> = <span class="title function_">px2vp</span>(topArea.<span class="property">height</span>);</span><br><span class="line">      avoid_area.<span class="property">bottom</span> = <span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>)</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;avoid_area数据更新完成&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;未找到Context&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(err)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: err &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们将代码中的<code>setWindowLayoutFullScreen(true)</code>改为<code>setWindowLayoutFullScreen(false)</code>。<br>接着我们回到<code>EntryAbility</code>中，将<code>onWindowStageCreate</code>生命周期函数中的<code>enable()</code>函数后面加上一个5秒钟的定时器，沉浸式5秒后关闭沉浸式，用以测试功能。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onWindowStageCreate</span>(<span class="attr">windowStage</span>: <span class="variable language_">window</span>.<span class="property">WindowStage</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Main window is created, set main page for this ability</span></span><br><span class="line">  hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onWindowStageCreate&#x27;</span>);</span><br><span class="line">  fullScreen.<span class="title function_">enable</span>()</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    fullScreen.<span class="title function_">disable</span>()</span><br><span class="line">  &#125;,<span class="number">8000</span>)</span><br><span class="line">  windowStage.<span class="title function_">loadContent</span>(<span class="string">&#x27;pages/Index&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err.<span class="property">code</span>) &#123;</span><br><span class="line">      hilog.<span class="title function_">error</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Failed to load the content. Cause: %&#123;public&#125;s&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Succeeded in loading the content.&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="27.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>功能实现，但上下区域已经避开了导航栏和状态栏，根组件的上下内边距却依旧在生效这很显然是不合理的，所以我们要继续对代码进行修改。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//关闭全屏</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">disable</span>(<span class="params"></span>)&#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;进入FullScreen.disable&#x27;</span>)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="title class_">AppStorageV2</span>.<span class="property">connect</span>&lt;<span class="title class_">GetContext</span>&gt;(<span class="title class_">GetContext</span>, <span class="string">&#x27;context&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (context) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;找到Context&#x27;</span>)</span><br><span class="line">      <span class="comment">//获取当前窗口</span></span><br><span class="line">      <span class="keyword">const</span> win = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(context.<span class="property">context</span>)</span><br><span class="line">      <span class="comment">//设置当前窗口为沉浸式模式</span></span><br><span class="line">      <span class="keyword">await</span> win.<span class="title function_">setWindowLayoutFullScreen</span>(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">      avoid_area.<span class="property">top</span> = <span class="number">0</span></span><br><span class="line">      avoid_area.<span class="property">bottom</span> = <span class="number">0</span></span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;avoid_area数据更新完成&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;未找到Context&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(err)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: err &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/28.png" alt="28"></p>
<hr>
<p><img src="/2025/02/27/MianShiTong/29.png" alt="29"></p>
<p>至此沉浸式功能实现。</p>
<h3 id="封装状态栏工具"><a href="#封装状态栏工具" class="headerlink" title="封装状态栏工具"></a>封装状态栏工具</h3><p>由于手机有深色和浅色模式，我们需要去进行对不同模式下的状态栏颜色进行适配。<br><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/js-apis-window-V14#setwindowsystembarproperties9">功能文档</a></p>
<h4 id="设置状态栏函数"><a href="#设置状态栏函数" class="headerlink" title="设置状态栏函数"></a>设置状态栏函数</h4><p>对于<code>setWindowSystemBarProperties</code>函数我们通过官方文档可以看到我们需要传入一个<code>window.SystemBarProperties</code>类型的对象，其中包裹了全部需要设置的配置项。<br>所以我们可以仿照封装沉浸式工具的方式来获取当前应用的<strong>上下文对象</strong>，然后通过上下文对象获取到<strong>当前窗口</strong>。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置状态栏</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">setBar</span>(<span class="params"><span class="attr">config</span>:<span class="variable language_">window</span>.<span class="title class_">SystemBarProperties</span></span>)&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="variable constant_">STATE_BAR_LOG_TAG</span>+<span class="string">&#x27;进入StateBar.setBar&#x27;</span>)</span><br><span class="line">    <span class="comment">//尝试获取上下文对象</span></span><br><span class="line">    <span class="keyword">const</span> context = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">GetContext</span>,<span class="variable constant_">CONTEXT</span>)!.<span class="property">context</span></span><br><span class="line">    <span class="keyword">if</span> (context) &#123;</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">STATE_BAR_LOG_TAG</span>+<span class="string">&#x27;找到context&#x27;</span>)</span><br><span class="line">      <span class="comment">//获取当前窗口</span></span><br><span class="line">      <span class="keyword">const</span> win = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(context)</span><br><span class="line">      <span class="comment">//设置状态栏状态</span></span><br><span class="line">      win.<span class="title function_">setWindowSystemBarProperties</span>(config)</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">STATE_BAR_LOG_TAG</span>+<span class="string">&#x27;设置完成&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">catch</span> (err)&#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="variable constant_">STATE_BAR_LOG_TAG</span>+<span class="string">&#x27;StateBar.setBar:  &#x27;</span>+err)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:<span class="variable constant_">STATE_BAR_LOG_TAG</span>+<span class="string">&#x27;StateBar.setBar:  &#x27;</span>+err&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>依旧是要在各个关键节点进行日志的打印，用以调试。</p>
<p>我们正常使用时只有深色浅色两种模式，如果每次都单独传入一个对象用于配置，是很麻烦的，所以我们需要再封装两个函数，自动传入配置参数。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置深色模式配置项</span></span><br><span class="line"><span class="title function_">setDarkBar</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setBar</span>(&#123;</span><br><span class="line">    <span class="attr">statusBarContentColor</span>:<span class="string">&#x27;#000000&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setLightBar</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setBar</span>(&#123;</span><br><span class="line">    <span class="attr">statusBarContentColor</span>:<span class="string">&#x27;#FFFFFF&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试功能"><a href="#测试功能" class="headerlink" title="测试功能"></a>测试功能</h5><p>而对于这个功能的测试我们可以直接使用两个按钮来进行切换测试</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Column</span>() &#123;</span><br><span class="line">    <span class="title class_">Text</span>(<span class="string">&#x27;top&#x27;</span>)</span><br><span class="line">    <span class="title class_">Blank</span>()</span><br><span class="line">    <span class="title class_">Button</span>(<span class="string">&#x27;浅色文字&#x27;</span>)</span><br><span class="line">      .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        stateBar.<span class="title function_">setLightBar</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="title class_">Button</span>(<span class="string">&#x27;深色文字&#x27;</span>)</span><br><span class="line">      .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        stateBar.<span class="title function_">setDarkBar</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="title class_">Text</span>(<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="title function_">padding</span>(&#123;</span><br><span class="line">    <span class="attr">top</span>: <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">top</span>,</span><br><span class="line">    <span class="attr">bottom</span>: <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">bottom</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Blue</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="30.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>至此状态栏功能实现。</p>
<h2 id="正式内容阶段"><a href="#正式内容阶段" class="headerlink" title="正式内容阶段"></a>正式内容阶段</h2><h3 id="首页模块"><a href="#首页模块" class="headerlink" title="首页模块"></a>首页模块</h3><p>对于UI布局我就不再过多赘述，都是比较基础的点，我只会挑重要的去讲，以及逻辑功能函数的实现。</p>
<h4 id="首页布局"><a href="#首页布局" class="headerlink" title="首页布局"></a>首页布局</h4><p><img src="/2025/02/27/MianShiTong/31.png" alt="31"></p>
<p>首先通过设计图我们可以分析出整体采用tabs来进行布局。<br>最上方一个置顶栏位，中上部一个轮播图，中下部用一个List，底部用自定义<code>Builder</code>传入<code>tabBar</code>。</p>
<p>为了限制<code>tabBar</code>的长宽比，我们需要用<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/ts-universal-attributes-layout-constraints-V14#aspectratio">aspectRatio</a>属性来进行限制。</p>
<h4 id="tabs"><a href="#tabs" class="headerlink" title="tabs"></a>tabs</h4><p>定义接口用于包装<code>tabBar</code>渲染数据</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">TabItem</span> &#123;</span><br><span class="line">  <span class="attr">icon</span>: <span class="title class_">Resource</span>;</span><br><span class="line">  <span class="attr">activeIcon</span>: <span class="title class_">Resource</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>列出待渲染字典</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// struct Index 数据</span></span><br><span class="line"><span class="attr">tabList</span>: <span class="title class_">TabItem</span>[] = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">icon</span>: $r(<span class="string">&#x27;app.media.tabbar_home&#x27;</span>),</span><br><span class="line">    <span class="attr">activeIcon</span>: $r(<span class="string">&#x27;app.media.tabbar_home_fill&#x27;</span>),</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;首页&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">icon</span>: $r(<span class="string">&#x27;app.media.tabbar_project&#x27;</span>),</span><br><span class="line">    <span class="attr">activeIcon</span>: $r(<span class="string">&#x27;app.media.tabbar_project_fill&#x27;</span>),</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;项目&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">icon</span>: $r(<span class="string">&#x27;app.media.tabbar_interview&#x27;</span>),</span><br><span class="line">    <span class="attr">activeIcon</span>: $r(<span class="string">&#x27;app.media.tabbar_interview_fill&#x27;</span>),</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;面经&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">icon</span>: $r(<span class="string">&#x27;app.media.tabbar_mine&#x27;</span>),</span><br><span class="line">    <span class="attr">activeIcon</span>: $r(<span class="string">&#x27;app.media.tabbar_mine_fill&#x27;</span>),</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;我的&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>每个页面由于需要有不同的状态变量以及不同的逻辑函数，且其逻辑与生命周期相绑定，我们就不能采用轻量化的<code>@Builder</code>来进行渲染，而要采用<code>@ComponentV2</code>来进行渲染。<br>每个页面都封装为一个独立的组件，由于其都属于页面，只不过没有<code>@Entry</code>所以不算是Page。我们只需要在<code>Pages</code>文件夹下去新建四个<code>ArkTS File</code>即可。</p>
<p><img src="/2025/02/27/MianShiTong/32.png" alt="32"></p>
<p>然后根据不同的下标来渲染不同的页面组件。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tabs</span>()&#123;</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">tabList</span>,<span class="function">(<span class="params"><span class="attr">item</span>:<span class="title class_">TabItem</span>,i</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title class_">TabContent</span>()&#123;</span><br><span class="line">      <span class="keyword">if</span> (i === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title class_">HomePage</span>()</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="title class_">ProjectPage</span>()</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="title class_">InterviewPage</span>()</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title class_">MinePage</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">tabBar</span>(<span class="variable language_">this</span>.<span class="title class_">TabBarBuilder</span>(item,i))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">onChange</span>(<span class="function">(<span class="params"><span class="attr">index</span>:<span class="built_in">number</span></span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">activeIndex</span> = index</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">scrollable</span>(<span class="literal">false</span>)</span><br><span class="line">.<span class="title function_">barPosition</span>(<span class="title class_">BarPosition</span>.<span class="property">End</span>)</span><br></pre></td></tr></table></figure>
<h4 id="搜索栏组件封装"><a href="#搜索栏组件封装" class="headerlink" title="搜索栏组件封装"></a>搜索栏组件封装</h4><p>首页的搜索栏仅仅作为一个占位作用，实际搜索要跳转到另一个专门的搜索页面。所以我们将搜索框封装为一个通用组件。<br>同时我们要考虑到一个问题就是，搜索框作为一个通用自定义组件，在不同的页面中会有不同的布局需求，所以我们需要提前留出各个尺寸数据的接口。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">HcSearchBox</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">boxWidth</span>: <span class="title class_">Length</span> = <span class="number">100</span> <span class="comment">// 宽高</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">boxHeight</span>: <span class="built_in">number</span> = <span class="number">32</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">ph</span>: <span class="title class_">ResourceStr</span> = <span class="string">&#x27;搜索题目&#x27;</span> <span class="comment">// 搜索的占位文本</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">phColor</span>: <span class="title class_">ResourceColor</span> = $r(<span class="string">&#x27;app.color.common_gray_02&#x27;</span>) <span class="comment">// 搜索的字体颜色</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">bgColor</span>: <span class="title class_">ResourceColor</span> = $r(<span class="string">&#x27;app.color.common_gray_border&#x27;</span>) <span class="comment">// 搜索框的背景颜色</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">layoutWeightValue</span>: <span class="built_in">number</span> = <span class="number">0</span> <span class="comment">// 占位比例</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">4</span> &#125;)&#123;</span><br><span class="line">      <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.ic_common_search&#x27;</span>))</span><br><span class="line">        .<span class="title function_">width</span>(<span class="number">14</span>)</span><br><span class="line">        .<span class="title function_">aspectRatio</span>(<span class="number">1</span>)</span><br><span class="line">        .<span class="title function_">fillColor</span>(<span class="variable language_">this</span>.<span class="property">phColor</span>)</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">ph</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">14</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">phColor</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">boxWidth</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="variable language_">this</span>.<span class="property">boxHeight</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">bgColor</span>)</span><br><span class="line">    .<span class="title function_">borderRadius</span>(<span class="variable language_">this</span>.<span class="property">boxHeight</span> / <span class="number">2</span>)</span><br><span class="line">    .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">    .<span class="title function_">layoutWeight</span>(<span class="variable language_">this</span>.<span class="property">layoutWeightValue</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是很重要的封装思想，考虑清楚需要暴露的可修改设置以及默认值的设置。</p>
<h4 id="打卡组件封装"><a href="#打卡组件封装" class="headerlink" title="打卡组件封装"></a>打卡组件封装</h4><p>打卡组件有两种状态，一种是连续打卡状态，一种是未连续打卡状态。<br>而这两种状态通过传入已经打卡的天数来实现，所以我们需要传入一个天数接口。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 大于表示已打卡</span></span><br><span class="line"><span class="meta">@Param</span> <span class="attr">clockInCount</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/33.png" alt="33"></p>
<p><img src="/2025/02/27/MianShiTong/34.png" alt="34"></p>
<h4 id="轮播图组件封装"><a href="#轮播图组件封装" class="headerlink" title="轮播图组件封装"></a>轮播图组件封装</h4><p>轮播图组件并无单独额外的逻辑需求，或是重复利用的接口预留等问题，仅仅是在首页的中上部使用一次，所以我们直接使用性能更好，更加轻量化的<code>@Builder</code>来进行封装即可。<br>所以这里我们直接将需要展示的图片资源列成资源数组，然后进行循环渲染即可。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swiperImgList</span>:<span class="title class_">Resource</span>[] = [</span><br><span class="line">  $rawfile(<span class="string">&#x27;banner_qa.png&#x27;</span>),</span><br><span class="line">  $rawfile(<span class="string">&#x27;banner_ai.png&#x27;</span>),</span><br><span class="line">  $rawfile(<span class="string">&#x27;banner_pj.png&#x27;</span>)</span><br><span class="line">]</span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line"><span class="title class_">SwiperImgBuilder</span>(<span class="attr">img</span>: <span class="title class_">Resource</span>) &#123;</span><br><span class="line">  <span class="title class_">Row</span>() &#123;</span><br><span class="line">    <span class="title class_">Image</span>(img)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">padding</span>(&#123;</span><br><span class="line">    <span class="attr">left</span>: <span class="number">16</span>,</span><br><span class="line">    <span class="attr">right</span>: <span class="number">16</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="35.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<h4 id="试题分组组件封装"><a href="#试题分组组件封装" class="headerlink" title="试题分组组件封装"></a>试题分组组件封装</h4><p><img src="/2025/02/27/MianShiTong/36.png" alt="36"></p>
<p>我们可以看到，在中上部轮播图的下方便是试题分组组件，其大致分为两部分：</p>
<ol>
<li>试题分组标题</li>
<li>试题分组列表</li>
</ol>
<p>这个效果我们可以用两种手段来实现：</p>
<ul>
<li>一种是用一个<strong>横向</strong>的<code>List</code>配合<strong>纵向</strong>的<code>List</code>，在<strong>点击横向</strong>的<code>List</code>时更新纵向<code>List</code>的数据。</li>
<li>另一种是通过<code>Tabs</code>组件配合多个<code>List</code>来实现。</li>
</ul>
<p>为了整个结构更加清晰同时减少反复的数据更新计算导致的性能负担，我们采用第二种方案。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QuestionType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../ExportCentre&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">HomeCategory</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">mockData</span>: <span class="title class_">QuestionType</span>[] = [ <span class="comment">//测试数据，后期通过网络请求获取后端数据</span></span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;ArkTS&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;ArkUI&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&#x27;Hap&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&#x27;Hsp&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;Har&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">6</span>, <span class="attr">name</span>: <span class="string">&#x27;Ability&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">7</span>, <span class="attr">name</span>: <span class="string">&#x27;Stage&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">8</span>, <span class="attr">name</span>: <span class="string">&#x27;Kit&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">  <span class="title function_">build</span> () &#123;</span><br><span class="line">    <span class="title class_">Tabs</span>()&#123;</span><br><span class="line">      <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">mockData</span>,<span class="function">(<span class="params"><span class="attr">item</span>:<span class="title class_">QuestionType</span>,i</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="title class_">TabContent</span>()</span><br><span class="line">          .<span class="title function_">tabBar</span>(item.<span class="property">name</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">scrollable</span>(<span class="literal">false</span>)</span><br><span class="line">    .<span class="title function_">barMode</span>(<span class="title class_">BarMode</span>.<span class="property">Scrollable</span>)</span><br><span class="line">    .<span class="title function_">barHeight</span>(<span class="number">44</span>)</span><br><span class="line">    .<span class="title function_">divider</span>(&#123;</span><br><span class="line">      <span class="attr">strokeWidth</span>:<span class="number">0.5</span>,</span><br><span class="line">      <span class="attr">color</span>:$r(<span class="string">&#x27;app.color.common_gray_border&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处由于我们还没有封装网络请求组件，所以暂时采用本地测试数据。</p>
<p>对于<code>TabBar</code>中的动画效果的选中提示下划线我们可以利用层叠布局，在最下方覆盖一层组件，设置其宽高，并附以动画效果即可实现。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Stack</span>(&#123; <span class="attr">alignContent</span>: <span class="title class_">Alignment</span>.<span class="property">Bottom</span> &#125;) &#123;</span><br><span class="line">  <span class="title class_">Text</span>(item.<span class="property">name</span>)</span><br><span class="line">    .<span class="title function_">fontSize</span>(<span class="number">15</span>)</span><br><span class="line">    .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">activeIndex</span> === i ? $r(<span class="string">&#x27;app.color.black&#x27;</span>) : $r(<span class="string">&#x27;app.color.common_gray_01&#x27;</span>))</span><br><span class="line">    .<span class="title function_">height</span>(<span class="number">45</span>)</span><br><span class="line">  <span class="title class_">Text</span>()</span><br><span class="line">    .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">activeIndex</span> === i ? <span class="number">20</span> : <span class="number">0</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="number">2</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.black&#x27;</span>))</span><br><span class="line">    .<span class="title function_">animation</span>(&#123; <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">activeIndex</span> === i ? <span class="number">300</span> : <span class="number">0</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="37.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>这样就实现了动画选中提示效果。</p>
<h4 id="试题标签组件封装"><a href="#试题标签组件封装" class="headerlink" title="试题标签组件封装"></a>试题标签组件封装</h4><p>在试题列表中不同的试题有着不同的难度，不同的难度对应着不同的标签。<br>总共氛围三种标签：难度1、2对应着简单，3-4 是一般，5 是困难。</p>
<p>这个组件的封装难点在于数据接口的定义，而非UI布局。</p>
<h5 id="数据接口定义"><a href="#数据接口定义" class="headerlink" title="数据接口定义"></a>数据接口定义</h5><p>所以我们先来看一下我们需求的数据样式：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="number">1</span>:&#123;<span class="attr">text</span>:<span class="string">&#x27;简单&#x27;</span>,<span class="attr">color</span>:<span class="title class_">Color</span>.<span class="property">Green</span>&#125;,</span><br><span class="line">  <span class="number">2</span>:&#123;<span class="attr">text</span>:<span class="string">&#x27;简单&#x27;</span>,<span class="attr">color</span>:<span class="title class_">Color</span>.<span class="property">Green</span>&#125;,</span><br><span class="line">  <span class="number">3</span>:&#123;<span class="attr">text</span>:<span class="string">&#x27;一般&#x27;</span>,<span class="attr">color</span>:<span class="title class_">Color</span>.<span class="property">Yellow</span>&#125;,</span><br><span class="line">  <span class="number">4</span>:&#123;<span class="attr">text</span>:<span class="string">&#x27;一般&#x27;</span>,<span class="attr">color</span>:<span class="title class_">Color</span>.<span class="property">Yellow</span>&#125;,</span><br><span class="line">  <span class="number">5</span>:&#123;<span class="attr">text</span>:<span class="string">&#x27;困难&#x27;</span>,<span class="attr">color</span>:<span class="title class_">Color</span>.<span class="property">Red</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到最外层的键值对的<strong>键</strong>是难度值是<code>number</code>类型，而其对应的<strong>值又是一个对象</strong>。<br>这个对象这种包含了两个键值对，一个是显示的文本<code>text</code>，另一个是对应的颜色值<code>color</code>。</p>
<p>我们可以利用<code>ArkTS</code>的内置函数<code>Record</code>来进行数据的定义。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">HcTagInfo</span> &#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">color</span>: <span class="title class_">ResourceColor</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">infoMap</span>: <span class="title class_">Record</span>&lt;<span class="built_in">number</span>, <span class="title class_">HcTagInfo</span>&gt; = &#123;</span><br><span class="line">  <span class="number">1</span>: &#123; <span class="attr">text</span>: <span class="string">&quot;简单&quot;</span>, <span class="attr">color</span>: $r(<span class="string">&quot;app.color.common_green&quot;</span>) &#125;,</span><br><span class="line">  <span class="number">2</span>: &#123; <span class="attr">text</span>: <span class="string">&quot;简单&quot;</span>, <span class="attr">color</span>: $r(<span class="string">&quot;app.color.common_green&quot;</span>) &#125;,</span><br><span class="line">  <span class="number">3</span>: &#123; <span class="attr">text</span>: <span class="string">&quot;一般&quot;</span>, <span class="attr">color</span>: $r(<span class="string">&quot;app.color.common_blue&quot;</span>) &#125;,</span><br><span class="line">  <span class="number">4</span>: &#123; <span class="attr">text</span>: <span class="string">&quot;一般&quot;</span>, <span class="attr">color</span>: $r(<span class="string">&quot;app.color.common_blue&quot;</span>) &#125;,</span><br><span class="line">  <span class="number">5</span>: &#123; <span class="attr">text</span>: <span class="string">&quot;困难&quot;</span>, <span class="attr">color</span>: $r(<span class="string">&quot;app.color.common_main_color&quot;</span>) &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Record</code>内置函数可以自动生成一个键值对类型，会将<strong>第一个</strong>泛型参数作为<strong>键</strong>的类型，<strong>第二个</strong>泛型参数作为<strong>值</strong>的类型。<br><code>Record&lt;number, HcTagInfo&gt;</code>就表示键是<code>number</code>类型，值是<code>HcTagInfo</code>类型。</p>
<p>当然我们也有另一种方法就是再定义一个接口来进行数据的定义。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> info&#123;</span><br><span class="line">  <span class="string">&#x27;1&#x27;</span>:<span class="title class_">HcTagInfo</span></span><br><span class="line">  <span class="string">&#x27;2&#x27;</span>:<span class="title class_">HcTagInfo</span></span><br><span class="line">  <span class="string">&#x27;3&#x27;</span>:<span class="title class_">HcTagInfo</span></span><br><span class="line">  <span class="string">&#x27;4&#x27;</span>:<span class="title class_">HcTagInfo</span></span><br><span class="line">  <span class="string">&#x27;5&#x27;</span>:<span class="title class_">HcTagInfo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但很显然这种方法就无法做到使难度类型键为<code>number</code>类型了，所以我们采用第一种方法。</p>
<p><strong>注意：</strong>用这种方法定义的接口，在使用时需要使用<code>infoMap[1].text</code>的方式来获取数据，而不能使用<code>infoMap.1.text</code>的方式来获取数据。</p>
<h5 id="UI封装"><a href="#UI封装" class="headerlink" title="UI封装"></a>UI封装</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">HcTag</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">difficulty</span>: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">text</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">fontcolor</span>: <span class="title class_">ResourceColor</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">text</span> || <span class="title class_">HcTagInfoMap</span>[<span class="variable language_">this</span>.<span class="property">difficulty</span>].<span class="property">text</span>)</span><br><span class="line">      .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontcolor</span> || <span class="title class_">HcTagInfoMap</span>[<span class="variable language_">this</span>.<span class="property">difficulty</span>].<span class="property">color</span>)</span><br><span class="line">      .<span class="title function_">fontSize</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">6</span>, <span class="attr">right</span>: <span class="number">6</span> &#125;)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">18</span>)</span><br><span class="line">      .<span class="title function_">constraintSize</span>(&#123; <span class="attr">minWidth</span>: <span class="number">34</span> &#125;)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">2</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.common_gray_bg&#x27;</span>))</span><br><span class="line">      .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在使用<code>||</code>运算符时会从左向右注意判断是否为空，这样就可以做到<strong>优先使用传入的值</strong>，在没有传入值时使用默认值。</p>
<h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tabs</span>() &#123;</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">questionList</span>, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">QuestionType</span>, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">TabContent</span>()&#123;</span><br><span class="line">      <span class="title class_">Column</span>()&#123;</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123;<span class="attr">difficulty</span>:<span class="number">1</span>&#125;)</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123;<span class="attr">difficulty</span>:<span class="number">2</span>&#125;)</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123;<span class="attr">difficulty</span>:<span class="number">3</span>&#125;)</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123;<span class="attr">difficulty</span>:<span class="number">4</span>&#125;)</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123;<span class="attr">difficulty</span>:<span class="number">5</span>&#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">      .<span class="title function_">tabBar</span>(<span class="variable language_">this</span>.<span class="title class_">TabBarBuilder</span>(item, i))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">onChange</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">activeIndex</span> = i</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">barMode</span>(<span class="title class_">BarMode</span>.<span class="property">Scrollable</span>)</span><br><span class="line">.<span class="title function_">barHeight</span>(<span class="number">44</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/38.png" alt="38"><br>这样我们就实现了标签组件的封装。</p>
<h4 id="试题列表Item组件封装"><a href="#试题列表Item组件封装" class="headerlink" title="试题列表Item组件封装"></a>试题列表Item组件封装</h4><p><img src="/2025/02/27/MianShiTong/39.png" alt="39"></p>
<p>首先我们通过对效果图的布局进行分析，可以看到整体布局还是较为简洁的，大致可以分为上下两个部分：</p>
<ol>
<li>上半部分由刚才封装的试题难度标签以及试题标题组成</li>
<li>下半部分由点赞量，浏览量，阅读状态组成</li>
</ol>
<p>这里重点解系一下下半部分的UI布局，因为要用到一个新的组件<code>RowSplite</code></p>
<p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/ts-container-rowsplit-V14">RowSplite文档传送门</a></p>
<p>这个组件的特点在于会将每个子组件之间加上一个分割线，这样一来就不需要自己在封装组件来去处理分割线问题了。</p>
<p>这个组件可以配合<code>@Extends</code>关键字来使用，这样就可以为组件内的多块信息一次性设定相同的样式了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HcTag</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../ExportCentre&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">QuestionItemComp</span> &#123;</span><br><span class="line">  <span class="comment">// @Param</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123;<span class="attr">space</span>:<span class="number">10</span>&#125;) &#123;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123; <span class="attr">difficulty</span>: <span class="number">1</span> &#125;)</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">15</span>)</span><br><span class="line">          .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">          .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">          .<span class="title function_">textOverflow</span>(&#123; <span class="attr">overflow</span>: <span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">RowSplit</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`点赞 6`</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>(<span class="literal">true</span>)</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`浏览 1000`</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>()</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;已看过&#x27;</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(&#123;<span class="attr">left</span>:<span class="number">16</span>,<span class="attr">right</span>:<span class="number">16</span>&#125;)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.common_blue_bg&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Extend</span>(<span class="title class_">Text</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">grayText</span>(<span class="params"><span class="attr">isStart</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span>) &#123;</span><br><span class="line">  .<span class="title function_">lineHeight</span>(<span class="number">13</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">13</span>)</span><br><span class="line">  .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.common_gray_01&#x27;</span>))</span><br><span class="line">  .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: isStart ? <span class="number">0</span> : <span class="number">12</span>, <span class="attr">right</span>: <span class="number">12</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/40.png" alt="40"></p>
<h4 id="完成试题列表渲染"><a href="#完成试题列表渲染" class="headerlink" title="完成试题列表渲染"></a>完成试题列表渲染</h4><p>刚才完成了试题列表的单个Item组件封装，接下来我们就可以在试题列表页面中使用这个组件了。<br>在使用之前我们要先进行数据接口的定义与状态变量的接口暴露，然后再进行数据的传入与渲染。</p>
<h5 id="试题列表信息数据接口定义"><a href="#试题列表信息数据接口定义" class="headerlink" title="试题列表信息数据接口定义"></a>试题列表信息数据接口定义</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">QuestionListItem</span>&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/* 题干 */</span></span><br><span class="line">  <span class="attr">stem</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/* 难度 */</span></span><br><span class="line">  <span class="attr">difficulty</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/* 点赞数 */</span></span><br><span class="line">  <span class="attr">likeCount</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/* 浏览数 */</span></span><br><span class="line">  <span class="attr">views</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/* 是否已看 */</span></span><br><span class="line">  <span class="attr">readFlag</span>: <span class="number">0</span> | <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="适配数据接口"><a href="#适配数据接口" class="headerlink" title="适配数据接口"></a>适配数据接口</h5><p>由于这个数据是必须传入的并没有默认值选项，所以我们在使用<code>@Param</code>装饰器后还需配合<code>@Require</code>装饰器后才能使组件正常工作。<br>随后将组件原本写死的测试用例替换为接口数据即可。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 面试问题列表Item组件</span></span><br><span class="line"><span class="comment"> * 必须传入一个QuestionListItem对象</span></span><br><span class="line"><span class="comment"> * 包含问题的id，题目，点赞数，阅读量，是否看过等信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Preview</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">QuestionItemComp</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="meta">@Require</span> <span class="attr">questionItem</span>: <span class="title class_">QuestionListItem</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123; <span class="attr">difficulty</span>: <span class="variable language_">this</span>.<span class="property">questionItem</span>.<span class="property">difficulty</span> &#125;)</span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">questionItem</span>.<span class="property">stem</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">15</span>)</span><br><span class="line">          .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">          .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">          .<span class="title function_">textOverflow</span>(&#123; <span class="attr">overflow</span>: <span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">RowSplit</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`点赞 <span class="subst">$&#123;<span class="variable language_">this</span>.questionItem.likeCount&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>(<span class="literal">true</span>)</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`浏览 <span class="subst">$&#123;<span class="variable language_">this</span>.questionItem.views&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>()</span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">questionItem</span>.<span class="property">readFlag</span> === <span class="number">1</span> ? <span class="string">&#x27;已看过&#x27;</span> : <span class="string">&#x27;待阅读&#x27;</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">16</span>, <span class="attr">right</span>: <span class="number">16</span> &#125;)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.common_blue_bg&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Extend</span>(<span class="title class_">Text</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">grayText</span>(<span class="params"><span class="attr">isStart</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span>) &#123;</span><br><span class="line">  .<span class="title function_">lineHeight</span>(<span class="number">13</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">13</span>)</span><br><span class="line">  .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.common_gray_01&#x27;</span>))</span><br><span class="line">  .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: isStart ? <span class="number">0</span> : <span class="number">12</span>, <span class="attr">right</span>: <span class="number">12</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试UI显示"><a href="#测试UI显示" class="headerlink" title="测试UI显示"></a>测试UI显示</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tabs</span>() &#123;</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">questionList</span>, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">QuestionTabBarType</span>, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">TabContent</span>() &#123;</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">10</span>).<span class="title function_">fill</span>(&#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">          <span class="attr">stem</span>: <span class="string">&#x27;测试标题&#x27;</span>,</span><br><span class="line">          <span class="attr">difficulty</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">likeCount</span>: <span class="number">3000</span>,</span><br><span class="line">          <span class="attr">views</span>: <span class="number">9999</span>,</span><br><span class="line">          <span class="attr">readFlag</span>: <span class="number">0</span></span><br><span class="line">        &#125;), <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">QuestionListItem</span>, i</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">              <span class="title class_">QuestionItemComp</span>(&#123;</span><br><span class="line">                <span class="attr">questionListItem</span>: item</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="title class_">Divider</span>()</span><br><span class="line">                .<span class="title function_">strokeWidth</span>(<span class="number">1</span>)</span><br><span class="line">                .<span class="title function_">color</span>($r(<span class="string">&#x27;app.color.common_gray_02&#x27;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: i === <span class="number">0</span> ? <span class="number">10</span> : <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">tabBar</span>(<span class="variable language_">this</span>.<span class="title class_">TabBarBuilder</span>(item, i))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">divider</span>(&#123; <span class="attr">strokeWidth</span>: <span class="number">1</span>, <span class="attr">color</span>: $r(<span class="string">&#x27;app.color.common_gray_02&#x27;</span>) &#125;)</span><br><span class="line">.<span class="title function_">onChange</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">activeIndex</span> = i</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">barMode</span>(<span class="title class_">BarMode</span>.<span class="property">Scrollable</span>)</span><br><span class="line">.<span class="title function_">barHeight</span>(<span class="number">44</span>)</span><br></pre></td></tr></table></figure>
<p>在测试中我们发现直接的硬拼接各个组件还是有点难看的，所以就新进行了一些微调，像是增加了分割线与文本的距离，以及增加<code>tabBar</code>的下边界分界线与选中高亮提示下划线间的距离等。<br>这些东西其实也无伤大雅，但还是在细节上提升了些许美观度。</p>
<video width="100%" controls>
  <source src="41.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>虽然单个Item已经封装完成，但是整个列表还需要根据不同的问题类型去分类渲染，同时包括触底加载和下拉刷新等操作，所以我们接下来还需要继续去进行问题列表组件的封装。</p>
<h4 id="问题列表组件封装"><a href="#问题列表组件封装" class="headerlink" title="问题列表组件封装"></a>问题列表组件封装</h4><p>问题列表组件会包括N个问题列表Item组件，同时还需要封装下拉刷新和触底加载的功能。<br>这部分功能我在<a target="_blank" rel="noopener" href="https://xbxyftx.github.io/2025/01/30/%E5%BC%80%E5%BF%83%E4%B8%80%E7%AC%91%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/">开心一笑</a>项目中有较详细的使用教程和思路，这里不再过多赘述。</p>
<p>封装目标：</p>
<ol>
<li>使用 <code>Refresh</code> <code>List</code> 和 <code>QuestionItemComp</code> 组件搭建基础结构和样式</li>
<li>完成 <strong>下拉刷新</strong> 效果，不含数据刷新</li>
<li>完成 <strong>上拉加载</strong> Builder</li>
<li>完成 <strong>上拉加载</strong> 完整效果</li>
<li>完成 <strong>下拉刷新</strong> 完整效果</li>
</ol>
<h5 id="下拉刷新功能测试"><a href="#下拉刷新功能测试" class="headerlink" title="下拉刷新功能测试"></a>下拉刷新功能测试</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QuestionItemComp</span>, <span class="title class_">QuestionListItem</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../ExportCentre&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">QuestionListComp</span>&#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isLoading</span>:<span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="title function_">onRefresh</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span></span><br><span class="line">    &#125;,<span class="number">3000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Refresh</span>(&#123;<span class="attr">refreshing</span>:$$this.<span class="property">isLoading</span>&#125;)&#123;</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">10</span>).<span class="title function_">fill</span>(&#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">          <span class="attr">stem</span>: <span class="string">&#x27;测试标题&#x27;</span>,</span><br><span class="line">          <span class="attr">difficulty</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">likeCount</span>: <span class="number">3000</span>,</span><br><span class="line">          <span class="attr">views</span>: <span class="number">9999</span>,</span><br><span class="line">          <span class="attr">readFlag</span>: <span class="number">0</span></span><br><span class="line">        &#125;), <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">QuestionListItem</span>, i</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">              <span class="title class_">QuestionItemComp</span>(&#123;</span><br><span class="line">                <span class="attr">questionListItem</span>: item</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: i === <span class="number">0</span> ? <span class="number">10</span> : <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">divider</span>(&#123;</span><br><span class="line">        <span class="attr">strokeWidth</span>:<span class="number">1</span>,</span><br><span class="line">        <span class="attr">color</span>:$r(<span class="string">&#x27;app.color.common_gray_border&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>)</span><br><span class="line">      .<span class="title function_">edgeEffect</span>(<span class="title class_">EdgeEffect</span>.<span class="property">None</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">onRefreshing</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onRefresh</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于当前还没有封装网络请求模块所以暂时先试用定时器来默契网络请求成功的情况。</p>
<video width="100%" controls>
  <source src="42.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<h5 id="上拉加载Builder封装与功能测试"><a href="#上拉加载Builder封装与功能测试" class="headerlink" title="上拉加载Builder封装与功能测试"></a>上拉加载<code>Builder</code>封装与功能测试</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QuestionItemComp</span>, <span class="title class_">IQuestionListItem</span>, <span class="title class_">QuestionListCompTestData</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../ExportCentre&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页问题分类区域，单个问题分类分页的问题列表组件</span></span><br><span class="line"><span class="comment"> * 拥有触底加载以及下拉刷新功能</span></span><br><span class="line"><span class="comment"> * isRefreshing     加载函数触发标识符</span></span><br><span class="line"><span class="comment"> * isLoading        正是否加载达到上限标识符</span></span><br><span class="line"><span class="comment"> * isFinish         是否加载完成标识符</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">QuestionListComp</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isRefreshing</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isLoading</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isFinish</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title function_">isLoadingMore</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isFinish</span>) &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;没有更多了&#x27;</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">15</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.common_gray_03&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isLoading</span>) &#123;</span><br><span class="line">        <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">5</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">LoadingProgress</span>()</span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">20</span>)</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;正在加载中&#x27;</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">15</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.common_gray_03&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">false</span></span><br><span class="line">    &#125;, <span class="number">3000</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Refresh</span>(&#123; <span class="attr">refreshing</span>: $$this.<span class="property">isRefreshing</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">10</span>).<span class="title function_">fill</span>(<span class="title class_">QuestionListCompTestData</span>), <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">IQuestionListItem</span>, i</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">              <span class="title class_">QuestionItemComp</span>(&#123;</span><br><span class="line">                <span class="attr">questionListItem</span>: item</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: i === <span class="number">0</span> ? <span class="number">10</span> : <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">isLoadingMore</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">divider</span>(&#123;</span><br><span class="line">        <span class="attr">strokeWidth</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">color</span>: $r(<span class="string">&#x27;app.color.common_gray_border&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>)</span><br><span class="line">      .<span class="title function_">edgeEffect</span>(<span class="title class_">EdgeEffect</span>.<span class="property">None</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">onRefreshing</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onRefresh</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于题库的题目数量是有限的不能一直无限制的向下获取新的题目所以需要去在<strong>开心一笑</strong>项目的基础上新增一个是否加载完成的标识符，用来标志是否成功获取新的题目。</p>
<p>然后通过修改状态变量的初始默认值来测试效果</p>
<p><img src="/2025/02/27/MianShiTong/43.png" alt="43"></p>
<p>随后我们依旧使用定时器来模拟网络请求的成功情况。<br>这里我们将获取的问题条数<strong>上限设为40条</strong>以免过多的加载数据导致页面卡顿。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isFinish</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="title function_">push</span>(<span class="title class_">QuestionListCompTestData</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="property">length</span> === <span class="number">40</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isFinish</span> = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">2000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>enm经过测试发现由于<code>onReachEnd</code>事件的机制，<strong>在触底时触发一次，在回弹时再触发一次</strong>，这里忘记做<strong>防过加载</strong>处理了，所以导致一次会加载20条，而且最后会因为多加载一次而<strong>使总数达到50条</strong>。所以我们还需要对代码进行微调。</p>
<p>首先就是修改<code>onReachEnd</code>事件中的代码，判断一下是否正在下拉刷新、加载中、加载达到上限等状态，只有在这些状态都不满足时才会去进行数据的加载。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">onReachEnd</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isRefreshing</span> || <span class="variable language_">this</span>.<span class="property">isLoading</span> || <span class="variable language_">this</span>.<span class="property">isFinish</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onLoad</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>随后修改<code>onLoad</code>方法，在加载后打印当前问题列表数组长度，用于Debug。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="title function_">push</span>(<span class="title class_">QuestionListCompTestData</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="property">length</span> === <span class="variable constant_">QUESTION_LIST_MAX_LENGTH</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isFinish</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;当前问题列表长度&#x27;</span> + <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="property">length</span>)</span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="44.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p><img src="/2025/02/27/MianShiTong/45.png" alt="45"></p>
<p>至此本功能组件封装测试完毕。</p>
<h5 id="下拉刷新的数组数据重置"><a href="#下拉刷新的数组数据重置" class="headerlink" title="下拉刷新的数组数据重置"></a>下拉刷新的数组数据重置</h5><p>刷新的逻辑与加载不同，刷新是先将原有数组清空，然后再重新加载数据。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;进入onRefresh&#x27;</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">QuestionList</span> = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="title function_">push</span>(<span class="title class_">QuestionListCompTestData</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;onRefresh:  当前问题列表长度&#x27;</span> + <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="property">length</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">false</span></span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/46.png" alt="46"></p>
<p>通过日志我们可以明确的看到，在下拉刷新时，数组数据会被清空，然后再重新加载数据。</p>
<p>不过这里我们在测试时又发现了新的问题，在触发一次下拉刷新之后，无法再次触发触底加载。</p>
<p>经过简单的推理，其实这个问题也不难排查。问题就出在下拉刷新后我们没有将加载问题数上限标志符<code>isFinish</code>重置为<code>false</code>。<br>所以我们需要在下拉刷新后将<code>isFinish</code>重置为<code>false</code>，这样一来就可以再次触发触底加载了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下拉刷新函数</span></span><br><span class="line"><span class="comment"> * 将原数组设为空随后从新获取数据</span></span><br><span class="line"><span class="comment"> * 并将试题列表获取上限标识刷新</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">onRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;进入onRefresh&#x27;</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">QuestionList</span> = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="title function_">push</span>(<span class="title class_">QuestionListCompTestData</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;onRefresh:  当前问题列表长度&#x27;</span> + <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="property">length</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isFinish</span> = <span class="literal">false</span></span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/47.png" alt="47"></p>
<p>至此本功能组件封装测试完毕。</p>
<h3 id="首页网络交互"><a href="#首页网络交互" class="headerlink" title="首页网络交互"></a>首页网络交互</h3><p>这个项目的网络请求我们统一使用axios第三方库来进行发送和管理，axios相比鸿蒙自带的网络请求模块更加便捷，详情可以参考<a target="_blank" rel="noopener" href="https://xbxyftx.github.io/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">鸿蒙网络请求学习笔记</a>这篇博客的内容。</p>
<h4 id="下载axios"><a href="#下载axios" class="headerlink" title="下载axios"></a>下载axios</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ohpm i @ohos/axios</span><br></pre></td></tr></table></figure>
<p>随后开启网络权限：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;requestPermissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ohos.permission.INTERNET&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<h4 id="封装Axios请求实例"><a href="#封装Axios请求实例" class="headerlink" title="封装Axios请求实例"></a>封装Axios请求实例</h4><p>首先在<code>utils</code>文件夹下创建一个<code>AxiosHttp.ets</code>文件，用于封装Axios请求实例以及拦截器。</p>
<p>配置基地址是很重要的，一旦公司后端的基地址发生了改变，如果没有统一的配置基地址，那么我们就需要在每个网络请求中都去修改基地址，这样一来就会很麻烦。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * axios请求实例</span></span><br><span class="line"><span class="comment"> * 配置基地址和请求超时时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> axiosInstance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>:<span class="string">&#x27;https://api-harmony-teach.itheima.net&#x27;</span>,</span><br><span class="line">  <span class="attr">timeout</span>:<span class="number">10000</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="封装Axios相应拦截器"><a href="#封装Axios相应拦截器" class="headerlink" title="封装Axios相应拦截器"></a>封装Axios相应拦截器</h4><p><code>axios</code>第三方库虽然在鸿蒙原有的网络模块的基础上优化了许多，但也依旧存在以下痛点问题：</p>
<ol>
<li>泛型参数的填写较为繁琐，在<code>get</code>请求时<strong>第一个参数无关紧要可以为<code>null</code></strong>，第二个参数是结果的类型，第三个参数由于没有需要传递的请求体参数，就可以不用填写，或者为<code>null</code>。在<code>post</code>请求时，<strong>第一个参数依旧无关紧要可以为<code>null</code></strong>，第二个参数是响应结果的类型，第三个参数是请求体类型<strong>不可省略</strong>。</li>
<li>从数据接口获取所需数据的路径过长，像是想要获取下图所示结构中的<code>account</code>字段的值，我们需要写成<code>res.data.data.account</code>，这样一来就会很麻烦。</li>
</ol>
<p><img src="/2025/02/27/MianShiTong/48.png" alt="48"></p>
<p>而且在相应信息中并非所有信息都是我们所需要的，所以我们可以针对axios的响应结果进行拦截，将我们不需要的数据剔除掉。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/XBXyftx">XBXyftx</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://XBXyftx.github.io">https://XBXyftx.github.io</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">此文章版权归XBXyftx所有，如有转载，请註明来自原作者</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%B8%BF%E8%92%99/">鸿蒙</a><a class="post-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF%E5%90%91/">技术向</a><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE/">项目</a></div><div class="post-share"><div class="social-share" data-image="https://raw.githubusercontent.com/XBXyftx/hexoImgs4/main/202503020220794.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/02/19/%E9%B8%BF%E8%92%99%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/" title="鸿蒙图片上传下载"><img class="cover" src="https://raw.githubusercontent.com/XBXyftx/hexoImgs3/main/20250220015806.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">鸿蒙图片上传下载</div></div><div class="info-2"><div class="info-item-1">下载沙箱图片123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778import &#123; fileIo &#125; from &#x27;@kit.CoreFileKit&#x27;import &#123; photoAccessHelper &#125; from &#x27;@kit.MediaLibraryKit&#x27;;import &#123; promptAction &#125; from &#x27;@kit.ArkUI&#x27;;@Entry@ComponentV2struct FileCopy &#123;  @Local  list: Resource[] = [    $r(&quot;app.media.001&quot;),    $r(&quot;app.media.002&quot;),   ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/02/08/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="我的书架项目笔记"><img class="cover" src="https://raw.githubusercontent.com/XBXyftx/hexoImgs3/main/20250208160923.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-08</div><div class="info-item-2">我的书架项目笔记</div></div><div class="info-2"><div class="info-item-1">项目简介我的书架是一个基于鸿蒙开发的图书管理应用，用户可以通过该应用实现图书的添加、删除、借阅、归还等功能。开源地址：我的书架 本项目旨在练习鸿蒙开发中的网络请求模块，实现对后端数据的增删改查，同时熟悉V2版本的状态管理。 功能实现本项目主要实现的功能有以下几项：  获取图书 新增图书 删除图书 全部删除 修改图书  获取图书开启网络权限在module.json5中开启网络请求权限 12345&quot;requestPermissions&quot;: [  &#123;    &quot;name&quot;: &quot;ohos.permission.INTERNET&quot;  &#125;], 随后创建网络请求对象 1req: http.HttpRequest =...</div></div></div></a><a class="pagination-related" href="/2025/01/30/%E5%BC%80%E5%BF%83%E4%B8%80%E7%AC%91%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="开心一笑项目笔记"><img class="cover" src="https://raw.githubusercontent.com/XBXyftx/hexoImgs3/main/01d66fb92d12560cab59744fa04090f.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-30</div><div class="info-item-2">开心一笑项目笔记</div></div><div class="info-2"><div class="info-item-1">项目概述UI骨架1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495/** * 1. 默认加载 * 2. 下拉刷新 * 3. 触底加载更多 * 4. 点击返回顶部 * */@Entry@Componentstruct Day01_07_Jokes &#123;  @State jokes: string [] = [&#x27;笑话 1&#x27;]  jokeNum: number = 5  @State refreshing: boolean = false  listScroller: Scroller = new Scroller()  build() &#123;    Refresh(&#123; refreshing: $$this.refreshing...</div></div></div></a><a class="pagination-related" href="/2025/01/25/%E9%B8%BF%E8%92%99%E8%AE%B0%E8%B4%A6%E6%9C%AC%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="鸿蒙记账本项目笔记"><img class="cover" src="https://raw.githubusercontent.com/XBXyftx/hexoimgs/main/20250125212746.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-25</div><div class="info-item-2">鸿蒙记账本项目笔记</div></div><div class="info-2"><div class="info-item-1">记账本项目简介项目名称：BH_NoteBook(记账本) 项目作者：薛博璇 项目开源地址：https://github.com/XBXyftx/BH\_NoteBook 项目简介：一款界面清新可爱的记账本软件，支持分事件类型的支出收入记账。 开发笔记基本结构：整体分为两个页面，首页和记账页。 工程结构在原有stagestage模型上新增components和data文件夹。  components该文件夹存储的是各个核心页面组件，利于进行数据解耦。 data该文件夹中存储的是工具接口和数据。在BillData文件中定义了每个账单事件的工具接口BillItem，其中包括了四个属性。 1234567891011121314151617181920// 订单export interface BillItem &#123;  id: number  type: BillType  money: number  useFor: UseForItem&#125;// 账单项export interface UseForItem &#123;  id: number  icon:...</div></div></div></a><a class="pagination-related" href="/2025/01/25/%E9%B8%BF%E8%92%99%E8%AE%B0%E4%BA%8B%E6%9C%AC%E9%A1%B9%E7%9B%AE/" title="鸿蒙记事本项目"><img class="cover" src="https://raw.githubusercontent.com/XBXyftx/hexoimgs/main/900247ffdbd5983232e2694bd6f5f1f.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-25</div><div class="info-item-2">鸿蒙记事本项目</div></div><div class="info-2"><div class="info-item-1">备忘录作品简介项目名称：Memorandum_XBXyftx（备忘录） 项目作者：薛博璇 项目开源地址：https://github.com/XBXyftx/Memorandum_XBXyftx.git 项目简介Memorandum_XBXyftx是一款基于HarmonyOS（鸿蒙操作系统）开发的应用程序，旨在为用户提供一个便捷、高效的日常任务管理和提醒工具。通过简洁直观的用户界面和强大的功能，备忘录帮助用户记录、跟踪和完成日常生活中的各种任务和事件。 主要功能事件记录与管理：用户可以创建、编辑和删除事件，包括作业、会议、提醒等。支持为每个事件添加详细的描述和指定时间戳，如图一所示。  图 1 事件详情页 任务完成状态跟踪：用户可以标记事件为完成或未完成，方便跟踪任务进度，如图2所示。应用提供快速切换任务完成状态的功能，如图三所示。  图 2 事件管理页面  图 3 事件快速切换状态功能 时间管理：内置日期选择器，允许用户为事件指定具体的时间，如图4所示。支持将选择的时间转换为时间戳字符串，便于持久化存储和排序。  图 4...</div></div></div></a><a class="pagination-related" href="/2025/02/04/V2/" title="浅谈鸿蒙状态管理V1——&gt;V2"><img class="cover" src="https://raw.githubusercontent.com/XBXyftx/hexoImgs3/main/20250204011404.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-04</div><div class="info-item-2">浅谈鸿蒙状态管理V1——&gt;V2</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="鸿蒙网络请求学习笔记"><img class="cover" src="https://raw.githubusercontent.com/XBXyftx/hexoimgs/main/20250127014253.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-27</div><div class="info-item-2">鸿蒙网络请求学习笔记</div></div><div class="info-2"><div class="info-item-1">核心概念服务器在网络上提供服务器的一台电脑，比如提供数据服务 http模块鸿蒙内置的模块，专门用于处理http网络请求，用http协议与服务器进行交流 可以用 import http from &#39;@ohos.net.http&#39;来进行调用。 由于需要进行网络请求，所以我们还需要在配置文件 module.json5下添加如下代码 12345&quot;requestPermissions&quot;: [   &#123;      &quot;name&quot;: &quot;ohos.permission.INTERNET&quot;    &#125; ], 完整代码如下 12345678910111213141516171819202122232425262728293031323334353637383940414243&#123;  &quot;module&quot;: &#123;    &quot;name&quot;: &quot;entry&quot;,    &quot;type&quot;: &quot;entry&quot;,   ...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">XBXyftx</div><div class="author-info-description">博安千古情如此，璇玉如华自醉从</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/XBXyftx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/XBXyftx" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:shuaixbx02@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">项目简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E9%98%B6%E6%AE%B5"><span class="toc-number">3.</span> <span class="toc-text">准备阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE%E4%B8%8E%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E6%90%AD%E5%BB%BA"><span class="toc-number">3.1.</span> <span class="toc-text">新建项目与项目结构搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E6%90%AD%E5%BB%BA"><span class="toc-number">3.1.1.</span> <span class="toc-text">项目结构搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.2.</span> <span class="toc-text">项目资源配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A2%9C%E8%89%B2%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">颜色配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">图片资源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9B%BE%E6%A0%87"><span class="toc-number">3.1.2.3.</span> <span class="toc-text">应用图标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%90%8D%E7%A7%B0"><span class="toc-number">3.1.2.4.</span> <span class="toc-text">应用名称</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BA%94%E7%94%A8%E4%B8%8E%E5%85%83%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%9B%BE%E6%A0%87%E5%92%8C%E5%90%8D%E7%A7%B0"><span class="toc-number">3.1.2.5.</span> <span class="toc-text">设置应用与元服务的图标和名称</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAgit%E5%92%8C%E6%9C%AC%E5%9C%B0%E4%BB%A5%E5%8F%8A%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93"><span class="toc-number">3.2.</span> <span class="toc-text">创建git和本地以及远程仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hilog%E6%97%A5%E5%BF%97"><span class="toc-number">3.3.</span> <span class="toc-text">hilog日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85Logger"><span class="toc-number">3.4.</span> <span class="toc-text">封装Logger</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85-commons-utils-Logger-ets"><span class="toc-number">3.4.1.</span> <span class="toc-text">封装 commons&#x2F;utils&#x2F;Logger.ets</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E4%B8%8E%E4%BD%BF%E7%94%A8Logger"><span class="toc-number">3.4.2.</span> <span class="toc-text">导出与使用Logger</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E6%B2%89%E6%B5%B8%E5%BC%8F%E5%B7%A5%E5%85%B7"><span class="toc-number">3.5.</span> <span class="toc-text">封装沉浸式工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">3.5.1.</span> <span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%B2%89%E6%B5%B8%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.5.2.</span> <span class="toc-text">开启沉浸模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.5.2.1.</span> <span class="toc-text">应用上下文对象</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B1%8F%E5%B9%95%E5%B0%BA%E5%AF%B8"><span class="toc-number">3.5.3.</span> <span class="toc-text">获取屏幕尺寸</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AppStorageV2%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E9%97%AE%E9%A2%98"><span class="toc-number">3.5.3.1.</span> <span class="toc-text">AppStorageV2数据存储问题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E9%97%B4%E9%97%AE%E9%A2%98"><span class="toc-number">3.5.3.2.</span> <span class="toc-text">初始化时间问题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E9%97%B4%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">3.5.3.3.</span> <span class="toc-text">初始化时间问题解决方案</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E6%B2%89%E6%B5%B8%E5%BC%8F%E5%87%BD%E6%95%B0"><span class="toc-number">3.5.4.</span> <span class="toc-text">关闭沉浸式函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E7%8A%B6%E6%80%81%E6%A0%8F%E5%B7%A5%E5%85%B7"><span class="toc-number">3.6.</span> <span class="toc-text">封装状态栏工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%8A%B6%E6%80%81%E6%A0%8F%E5%87%BD%E6%95%B0"><span class="toc-number">3.6.1.</span> <span class="toc-text">设置状态栏函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%8A%9F%E8%83%BD"><span class="toc-number">3.6.1.1.</span> <span class="toc-text">测试功能</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%BC%8F%E5%86%85%E5%AE%B9%E9%98%B6%E6%AE%B5"><span class="toc-number">4.</span> <span class="toc-text">正式内容阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E6%A8%A1%E5%9D%97"><span class="toc-number">4.1.</span> <span class="toc-text">首页模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E5%B8%83%E5%B1%80"><span class="toc-number">4.1.1.</span> <span class="toc-text">首页布局</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tabs"><span class="toc-number">4.1.2.</span> <span class="toc-text">tabs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E6%A0%8F%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.3.</span> <span class="toc-text">搜索栏组件封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8D%A1%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.4.</span> <span class="toc-text">打卡组件封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AE%E6%92%AD%E5%9B%BE%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.5.</span> <span class="toc-text">轮播图组件封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E9%A2%98%E5%88%86%E7%BB%84%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.6.</span> <span class="toc-text">试题分组组件封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E9%A2%98%E6%A0%87%E7%AD%BE%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.7.</span> <span class="toc-text">试题标签组件封装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">4.1.7.1.</span> <span class="toc-text">数据接口定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UI%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.7.2.</span> <span class="toc-text">UI封装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">4.1.7.3.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E9%A2%98%E5%88%97%E8%A1%A8Item%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.8.</span> <span class="toc-text">试题列表Item组件封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E8%AF%95%E9%A2%98%E5%88%97%E8%A1%A8%E6%B8%B2%E6%9F%93"><span class="toc-number">4.1.9.</span> <span class="toc-text">完成试题列表渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%95%E9%A2%98%E5%88%97%E8%A1%A8%E4%BF%A1%E6%81%AF%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">4.1.9.1.</span> <span class="toc-text">试题列表信息数据接口定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.1.9.2.</span> <span class="toc-text">适配数据接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95UI%E6%98%BE%E7%A4%BA"><span class="toc-number">4.1.9.3.</span> <span class="toc-text">测试UI显示</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.10.</span> <span class="toc-text">问题列表组件封装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-number">4.1.10.1.</span> <span class="toc-text">下拉刷新功能测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8A%E6%8B%89%E5%8A%A0%E8%BD%BDBuilder%E5%B0%81%E8%A3%85%E4%B8%8E%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-number">4.1.10.2.</span> <span class="toc-text">上拉加载Builder封装与功能测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0%E7%9A%84%E6%95%B0%E7%BB%84%E6%95%B0%E6%8D%AE%E9%87%8D%E7%BD%AE"><span class="toc-number">4.1.10.3.</span> <span class="toc-text">下拉刷新的数组数据重置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E7%BD%91%E7%BB%9C%E4%BA%A4%E4%BA%92"><span class="toc-number">4.2.</span> <span class="toc-text">首页网络交互</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BDaxios"><span class="toc-number">4.2.1.</span> <span class="toc-text">下载axios</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85Axios%E8%AF%B7%E6%B1%82%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.2.2.</span> <span class="toc-text">封装Axios请求实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85Axios%E7%9B%B8%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">4.2.3.</span> <span class="toc-text">封装Axios相应拦截器</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/02/27/MianShiTong/" title="面试通项目开发笔记"><img src="https://raw.githubusercontent.com/XBXyftx/hexoImgs4/main/202503020220794.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="面试通项目开发笔记"/></a><div class="content"><a class="title" href="/2025/02/27/MianShiTong/" title="面试通项目开发笔记">面试通项目开发笔记</a><time datetime="2025-02-27T15:03:16.000Z" title="发表于 2025-02-27 23:03:16">2025-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/19/%E9%B8%BF%E8%92%99%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/" title="鸿蒙图片上传下载"><img src="https://raw.githubusercontent.com/XBXyftx/hexoImgs3/main/20250220015806.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="鸿蒙图片上传下载"/></a><div class="content"><a class="title" href="/2025/02/19/%E9%B8%BF%E8%92%99%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/" title="鸿蒙图片上传下载">鸿蒙图片上传下载</a><time datetime="2025-02-19T05:42:14.000Z" title="发表于 2025-02-19 13:42:14">2025-02-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/16/%E8%BF%9E%E8%BF%9E%E7%9C%8B/" title="连连看"><img src="https://raw.githubusercontent.com/XBXyftx/hexoImgs3/main/20250216160843.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="连连看"/></a><div class="content"><a class="title" href="/2025/02/16/%E8%BF%9E%E8%BF%9E%E7%9C%8B/" title="连连看">连连看</a><time datetime="2025-02-16T08:06:18.000Z" title="发表于 2025-02-16 16:06:18">2025-02-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/08/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="我的书架项目笔记"><img src="https://raw.githubusercontent.com/XBXyftx/hexoImgs3/main/20250208160923.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="我的书架项目笔记"/></a><div class="content"><a class="title" href="/2025/02/08/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="我的书架项目笔记">我的书架项目笔记</a><time datetime="2025-02-08T08:04:54.000Z" title="发表于 2025-02-08 16:04:54">2025-02-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/04/V2/" title="浅谈鸿蒙状态管理V1——&gt;V2"><img src="https://raw.githubusercontent.com/XBXyftx/hexoImgs3/main/20250204011404.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="浅谈鸿蒙状态管理V1——&gt;V2"/></a><div class="content"><a class="title" href="/2025/02/04/V2/" title="浅谈鸿蒙状态管理V1——&gt;V2">浅谈鸿蒙状态管理V1——&gt;V2</a><time datetime="2025-02-03T17:02:36.000Z" title="发表于 2025-02-04 01:02:36">2025-02-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://raw.githubusercontent.com/XBXyftx/hexoimgs/main/20250125232339.png);"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By XBXyftx</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div></div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now = new Date(); 
function createtime() { 
var grt = new Date("1/24/2025 02:23"); // 在此处修改你的建站时间
now.setTime(now.getTime() + 250); 
days = (now - grt) / 1000 / 60 / 60 / 24; 
dnum = Math.floor(days); 
hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum); 
hnum = Math.floor(hours); 
if (String(hnum).length == 1) { hnum = "0" + hnum; } 
minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum); 
mnum = Math.floor(minutes); 
if (String(mnum).length == 1) { mnum = "0" + mnum; } 
seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
snum = Math.round(seconds); 
if (String(snum).length == 1) { snum = "0" + snum; } 
document.getElementById("timeDate").innerHTML = "本网站已运行 " + dnum + " 天 "; 
document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
} 
setInterval(createtime, 250);</script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="/%5Bobject%20Object%5D"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="99" count="99" mobile="true" src="/%5Bobject%20Object%5D"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>