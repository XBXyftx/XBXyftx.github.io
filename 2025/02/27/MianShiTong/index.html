<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>面试通项目开发笔记 | XBXyftx</title><meta name="author" content="XBXyftx"><meta name="copyright" content="XBXyftx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="面试通项目开发笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="面试通项目开发笔记">
<meta property="og:url" content="https://xbxyftx.top/2025/02/27/MianShiTong/index.html">
<meta property="og:site_name" content="XBXyftx">
<meta property="og:description" content="面试通项目开发笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xbxyftx.top/img/ArticleTopImgs/MSTTopImg.png">
<meta property="article:published_time" content="2025-02-27T15:03:16.000Z">
<meta property="article:modified_time" content="2025-05-16T02:39:57.322Z">
<meta property="article:author" content="XBXyftx">
<meta property="article:tag" content="鸿蒙">
<meta property="article:tag" content="技术向">
<meta property="article:tag" content="V2">
<meta property="article:tag" content="项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xbxyftx.top/img/ArticleTopImgs/MSTTopImg.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "面试通项目开发笔记",
  "url": "https://xbxyftx.top/2025/02/27/MianShiTong/",
  "image": "https://xbxyftx.top/img/ArticleTopImgs/MSTTopImg.png",
  "datePublished": "2025-02-27T15:03:16.000Z",
  "dateModified": "2025-05-16T02:39:57.322Z",
  "author": [
    {
      "@type": "Person",
      "name": "XBXyftx",
      "url": "https://github.com/XBXyftx"
    }
  ]
}</script><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://xbxyftx.top/2025/02/27/MianShiTong/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":2000,"languages":{"author":"作者: XBXyftx","link":"链接: ","source":"来源: XBXyftx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '面试通项目开发笔记',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><script src="/js/nyan.js"></script><script>localStorage.setItem('theme','dark')</script><script>document.documentElement.setAttribute('data-theme', 'dark');</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/transpancy.css"><script> // 强制锁定为暗黑模式 localStorage.setItem('theme', 'dark'); // 防止其他脚本覆盖模式 document.documentElement.setAttribute('data-theme', 'dark'); </script><link rel="stylesheet" href="/css/styles.css"><script> document.querySelectorAll('#post-comment').forEach(el => { el.style.backgroundColor = 'rgba(255, 255, 255, 0.6)'; }); </script><link rel="twikoo" href="/css/twikoo.css"><link rel="stylesheet" href="/css/rightmenu.css"><script src="/js/cache-manager.js"></script><script src="/js/nyan.js"></script><script src="/js/header-universe.js"></script><!-- 新增缓存管理脚本--><script src="/js/cache-manager.js"></script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="cat__scene"><div class="cat__main"><div class="cat__body"></div><div class="cat__body"></div><div class="cat__tail"></div><div class="cat__head"></div></div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
      setTimeout(() => {
        $loadingBox.style.display = 'none'
      }, 800)
    },
    initLoading: () => {
      $loadingBox.style.display = 'flex'
      $loadingBox.classList.remove('loaded')
      $body.style.overflow = 'hidden'
    }
  }

  preloader.initLoading()
  
  // 设置10秒超时
  const loadingTimeout = setTimeout(() => {
    preloader.endLoading()
  }, 10000)
  
  window.addEventListener('load', () => {
    clearTimeout(loadingTimeout)
    preloader.endLoading()
  })

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/bg.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-solid fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/swiper/"><i class="fa-fw fa-solid fa-star-of-david"></i><span> 图图图图图</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/ArticleTopImgs/MSTTopImg.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.png" alt="Logo"><span class="site-name">XBXyftx</span></a><a class="nav-page-title" href="/"><span class="site-name">面试通项目开发笔记</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-solid fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/swiper/"><i class="fa-fw fa-solid fa-star-of-david"></i><span> 图图图图图</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">面试通项目开发笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-27T15:03:16.000Z" title="发表于 2025-02-27 23:03:16">2025-02-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-16T02:39:57.322Z" title="更新于 2025-05-16 10:39:57">2025-05-16</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">17.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>67分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>面试通这个项目是我的第一个完整的鸿蒙项目。将会从零开始搭建项目结构，组织UI框架，编写业务逻辑，最终实现一个完整的项目。</p>
<h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p>面试通项目是一个基于 HarmonyOS NEXT 开发的鸿蒙应用，主要包含鸿蒙和前端的企业面试题以及真实的面试经验，还有一些面试辅助类的工具如常用开发单词和面试录音。</p>
<p><img src="/2025/02/27/MianShiTong/1.png" alt="1"></p>
<p>以上是该项目的概念设计图，接下来我将会记录整个项目的开发过程。</p>
<h2 id="准备阶段"><a href="#准备阶段" class="headerlink" title="准备阶段"></a>准备阶段</h2><div class="note danger flat"><p>本项目是在开发的同时进行编写，其中的代码并非最终版本</p>
</div>
<h3 id="新建项目与项目结构搭建"><a href="#新建项目与项目结构搭建" class="headerlink" title="新建项目与项目结构搭建"></a>新建项目与项目结构搭建</h3><h4 id="项目结构搭建"><a href="#项目结构搭建" class="headerlink" title="项目结构搭建"></a>项目结构搭建</h4><p>本次我们采用<code>API14</code>来进行开发，<code>API14</code>是当前的最新版本，对于各项性能的调教也是当下最好的选择。</p>
<div class="note warning flat"><p>API的迭代很快，大家要及时更新版本，现在API15正式版也已经发布，还是尽快向新的转移的好。</p>
</div>
<p>本项目的项目结构如下所示：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ets</span><br><span class="line">├── commons</span><br><span class="line">│   ├── components              // - 通用组件</span><br><span class="line">│   ├── constants               // - 全局常量数据</span><br><span class="line">│   └── utils                   // - 通用工具类</span><br><span class="line">├── entryability</span><br><span class="line">│   └── EntryAbility.ts</span><br><span class="line">├── models                      // - 数据模型</span><br><span class="line">├── pages</span><br><span class="line">│   ├── QuestionPage.ets        // - 页面组件</span><br><span class="line">│   └── Index.ets</span><br><span class="line">└── views</span><br><span class="line"><span class="code">    └── Question                // - 页面对应自定义组件</span></span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/2.png" alt="2"></p>
<h4 id="项目资源配置"><a href="#项目资源配置" class="headerlink" title="项目资源配置"></a>项目资源配置</h4><h5 id="颜色配置"><a href="#颜色配置" class="headerlink" title="颜色配置"></a>颜色配置</h5><p>将所需的颜色字段配置到<code>resources/base/element/color.json</code>中。</p>
<p><img src="/2025/02/27/MianShiTong/3.png" alt="3"></p>
<p>对主色系的统一管理队后续的开发、维护都有着极大的好处。<br>不能将所有的数据都内嵌在代码中，用一次复制一次，这样不仅对开发效率有影响，而且不利于后期的维护。</p>
<h5 id="图片资源"><a href="#图片资源" class="headerlink" title="图片资源"></a>图片资源</h5><p>将设计稿中的图片统一放入<code>resources/base/media</code>目录下。</p>
<h5 id="应用图标"><a href="#应用图标" class="headerlink" title="应用图标"></a>应用图标</h5><p>在<code>module.json5</code>中配置应用的图标。</p>
<p><img src="/2025/02/27/MianShiTong/4.png" alt="4"></p>
<h5 id="应用名称"><a href="#应用名称" class="headerlink" title="应用名称"></a>应用名称</h5><p>首先创建中文软件配置文件，详细步骤可以参考我的这篇博客：<a target="_blank" rel="noopener" href="https://xbxyftx.github.io/2025/01/30/%E9%B8%BF%E8%92%99%E4%B8%AD%E6%96%87%E5%8C%85/">手动新建鸿蒙中文包</a></p>
<p>修改应用名称的<code>&quot;EntryAbility_label&quot;</code>字段的值</p>
<h5 id="设置应用与元服务的图标和名称"><a href="#设置应用与元服务的图标和名称" class="headerlink" title="设置应用与元服务的图标和名称"></a>设置应用与元服务的图标和名称</h5><p>修改<code>AppScope/resources/base/element/string.json</code>中的<code>&quot;app_name&quot;</code>字段的值<br>然后在<code>AppScope/resources/base/media/app_icon.png</code>中替换应用的图标</p>
<p>可以直接同名图片文件替换，也可在<code>AppScope/resources/base/media</code>目录下放置不同名文件。<br>然后修改<code>AppScope/app.json5</code>中的<code>&quot;icon&quot;</code>字段的值。</p>
<p><img src="/2025/02/27/MianShiTong/5.png" alt="5"></p>
<h3 id="创建git和本地以及远程仓库"><a href="#创建git和本地以及远程仓库" class="headerlink" title="创建git和本地以及远程仓库"></a>创建git和本地以及远程仓库</h3><p>直接利用IDE内置的git工具即可，这里就不赘述了。<br>不过有一点要注意，<strong>git并不会帮你托管空文件夹</strong>，而当前构建的项目结构中包含了大量的空文件夹，这些文件夹还<strong>暂时</strong>没有创建任何文件，所以我们为了保证在远程仓库中的<strong>项目结构</strong>依旧<strong>保持完整</strong>我们需要创建一些<strong>占位文件</strong>，来让git为我们托管全部文件夹。</p>
<p><img src="/2025/02/27/MianShiTong/6.png" alt="6"></p>
<p>这是在创建占位文件前的远程仓库目录结构。</p>
<p><img src="/2025/02/27/MianShiTong/7.png" alt="7"></p>
<p>创建<code>.gitkeep</code>文件后，远程仓库的目录结构如下所示。</p>
<p><img src="/2025/02/27/MianShiTong/8.png" alt="8"></p>
<div class="note info flat"><p>占位文件在后续开发中删除即可，无需保留，没有实际用途。</p>
</div>
<h3 id="hilog日志"><a href="#hilog日志" class="headerlink" title="hilog日志"></a>hilog日志</h3><p>在过去我们用的都是<code>console.log()</code>来进行日志的输出，<code>console</code>中虽然为我们封装了很多js中常用的输出方式，诸如：<code>log</code>、<code>warn</code>、<code>error</code>等，但是其弊端也很明显。</p>
<ol>
<li>无法进行日志的分类，导致日志混杂在一起，难以定位问题。</li>
<li>无法进行日志的过滤，导致日志过多，难以定位问题。</li>
<li>无法进行日志的格式化，导致日志输出不美观。</li>
</ol>
<p>hilog为我们提供了上述问题的解决方案，hilog为我们提供了日志的分类、过滤和格式化等功能。<br>hilog通过鸿蒙底层的重构之后，为我们提供了更加高效的日志输出方式。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debug</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">info</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">warn</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">error</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fatal</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isLoggable</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span>, <span class="attr">tag</span>: <span class="built_in">string</span>, <span class="attr">level</span>: <span class="title class_">LogLevel</span></span>): <span class="built_in">boolean</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>参数 domain：用于指定输出日志所对应的业务领域，取值范围为 0x0000~0xFFFF，开发者可以根据需要进行自定义。</li>
<li>参数 tag：用于指定日志标识，可以为任意字符串，建议标识调用所在的类或者业务行为。</li>
<li>参数 format：格式字符串，用于日志的格式化输出。%{public}s 字符串 %{public}d 数字</li>
<li>参数 args：可以为 0 个或多个参数，可以为 0 个或多个参数，是格式字符串中参数类型对应的参数列表。</li>
</ul>
<p>我们通过下面这个实例来演示一下hilog的用法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hilog &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.PerformanceAnalysisKit&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.info测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          hilog.<span class="title function_">info</span>(<span class="number">0x0000</span>,<span class="string">&#x27;myHilog&#x27;</span>,<span class="string">&#x27;%&#123;public&#125;s&#x27;</span>,<span class="string">&#x27;第一个参数&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.warn测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          hilog.<span class="title function_">warn</span>(<span class="number">0x0000</span>,<span class="string">&#x27;myHilog&#x27;</span>,<span class="string">&#x27;%&#123;public&#125;s&#x27;</span>,<span class="string">&#x27;第一个参数&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.error测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          hilog.<span class="title function_">error</span>(<span class="number">0x0000</span>,<span class="string">&#x27;myHilog&#x27;</span>,<span class="string">&#x27;%&#123;public&#125;s&#x27;</span>,<span class="string">&#x27;第一个参数&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.debug测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          hilog.<span class="title function_">debug</span>(<span class="number">0x0000</span>,<span class="string">&#x27;myHilog&#x27;</span>,<span class="string">&#x27;%&#123;public&#125;s&#x27;</span>,<span class="string">&#x27;第一个参数&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/9.png" alt="9"></p>
<p>从输出的结果我们可以看到，首先在前面的日志分类信息中会先显示我们设置的日志业务分区信息，然后是日志的<strong>标识信息</strong>，最后是日志的<strong>内容</strong>。<br>而日志的内容格式是通过第三个参数来进行格式化输出的。<br>这里我们用的都是<code>%&#123;public&#125;s</code>，这是因为我们在第三个参数中传入的是一个字符串类型的值。</p>
<p>当然我们也可以传入多个参数，来进行格式化输出。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;hilog.info测试&#x27;</span>)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="number">0x0000</span>,<span class="string">&#x27;myHilog&#x27;</span>,<span class="string">&#x27;%&#123;public&#125;s __ %&#123;public&#125;d&#x27;</span>,<span class="string">&#x27;第一个参数&#x27;</span>,<span class="number">2025</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/10.png" alt="10"></p>
<p><code>%&#123;public&#125;s</code>表示字符串类型，<code>%&#123;public&#125;d</code>表示数字类型。两者之间连接的字符就是靠第三个参数中的字符串来进行定义的。<br>这个输出格式倒是和C语言中的<code>printf()</code>函数类似。（唤起了远古的回忆……）</p>
<p><strong>console 是基于 hilog 封装的！！！</strong>默认的 domain/tag 是 A03D00/JSAPP</p>
<h3 id="封装Logger"><a href="#封装Logger" class="headerlink" title="封装Logger"></a>封装Logger</h3><h4 id="封装-commons-utils-Logger-ets"><a href="#封装-commons-utils-Logger-ets" class="headerlink" title="封装 commons/utils/Logger.ets"></a>封装 commons/utils/Logger.ets</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hilog &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.PerformanceAnalysisKit&#x27;</span></span><br><span class="line"><span class="keyword">const</span> tag = <span class="string">&#x27;XBXLogger&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">domain</span>:<span class="built_in">number</span> <span class="comment">// 十六进制输出业务格式</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">tag</span>:<span class="built_in">string</span> <span class="comment">// 制定的自己的标识</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">format</span>:<span class="built_in">string</span> = <span class="string">&#x27;%&#123;public&#125;s&#x27;</span> <span class="comment">//格式化方式</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">domain</span>: <span class="built_in">number</span> = <span class="number">0x0000</span>, <span class="attr">tag</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">domain</span> = domain</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tag</span> = tag</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">debug</span>(<span class="attr">args</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">debug</span>(<span class="variable language_">this</span>.<span class="property">domain</span>, <span class="variable language_">this</span>.<span class="property">tag</span>, <span class="variable language_">this</span>.<span class="property">format</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">info</span>(<span class="attr">args</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable language_">this</span>.<span class="property">domain</span>, <span class="variable language_">this</span>.<span class="property">tag</span>, <span class="variable language_">this</span>.<span class="property">format</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">warn</span>(<span class="attr">args</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">warn</span>(<span class="variable language_">this</span>.<span class="property">domain</span>, <span class="variable language_">this</span>.<span class="property">tag</span>, <span class="variable language_">this</span>.<span class="property">format</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">error</span>(<span class="attr">args</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    hilog.<span class="title function_">error</span>(<span class="variable language_">this</span>.<span class="property">domain</span>, <span class="variable language_">this</span>.<span class="property">tag</span>, <span class="variable language_">this</span>.<span class="property">format</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">logger</span>:<span class="title class_">Logger</span> = <span class="keyword">new</span> <span class="title class_">Logger</span>(<span class="number">0x1234</span>,tag)</span><br></pre></td></tr></table></figure>
<p>hilog中有固定要传的三个参数，分别是：domain、tag、format。<br>而我们在封装Logger的时候，将这三个参数封装到了一个类中，这样我们在使用的时候就可以直接调用Logger类中的方法，而不需要每次都传入这三个参数。<br>这上述包装函数都是实例函数，并不是静态函数，所以我们并不能直接导出一个Logger类，而是导出一个Logger类的实例。<br>由于在开发中每个人所负责的业务领域和标识变动次数较少，尤其是对于这个单人开发项目来说，业务领域和标识可以直接写死，所以这里直接导出一个已经写好的Logger实例即可。</p>
<p><strong>改造并封装现有能力</strong>使其能够更加契合当前项目是很重要的一点，就像是在鸿蒙系统原有网络请求模块的基础上进一步封装成第三方库axios一样。<br>让原有能力更加的方便好用。</p>
<h4 id="导出与使用Logger"><a href="#导出与使用Logger" class="headerlink" title="导出与使用Logger"></a>导出与使用Logger</h4><div class="note success flat"><p>在未来的开发中需要导出的工具类和函数会越来越多，来源的文件也会越来越多，如果都分别从各个文件中导出，会非常的麻烦。<br>所以我们就可以编辑一个中转站来进行统一的导出和管理。</p>
</div>
<p>创建<code>CommonsExportCentre.ets</code>文件，在该文件中统一导出所有需要导出的工具类和函数。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./utils/Logger&#x27;</span></span><br></pre></td></tr></table></figure>
<p>这样在需要使用commons中的工具类和函数的时候，只需要导入<code>CommonsExportCentre.ets</code>文件即可。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hilog &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.PerformanceAnalysisKit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&#x27;../commons/CommonsExportCentre&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.info测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          logger.<span class="title function_">info</span>(<span class="string">&#x27;测试测试&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.warn测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          logger.<span class="title function_">warn</span>(<span class="string">&#x27;测试测试&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.error测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          logger.<span class="title function_">error</span>(<span class="string">&#x27;测试测试&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;hilog.debug测试&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          logger.<span class="title function_">debug</span>(<span class="string">&#x27;测试测试&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们就可以看到我们可以用更加简便的方式做到与hilog一致的效果了。</p>
<p><img src="/2025/02/27/MianShiTong/11.png" alt="11"></p>
<h3 id="封装沉浸式工具"><a href="#封装沉浸式工具" class="headerlink" title="封装沉浸式工具"></a>封装沉浸式工具</h3><p>接下来我们将封装一个工具类来控制是否开启沉浸式模式。</p>
<h4 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h4><p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/js-apis-window-V14?catalogVersion=V14">window.getLastWindow 获取当前窗口对象</a><br><img src="/2025/02/27/MianShiTong/12.png" alt="12"></p>
<p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/js-apis-window-V14#getwindowavoidarea9">getWindowAvoidArea 使用窗口对象获取某一个区域的尺寸</a><br><img src="/2025/02/27/MianShiTong/13.png" alt="13"></p>
<h4 id="开启沉浸模式"><a href="#开启沉浸模式" class="headerlink" title="开启沉浸模式"></a>开启沉浸模式</h4><h5 id="应用上下文对象"><a href="#应用上下文对象" class="headerlink" title="应用上下文对象"></a>应用上下文对象</h5><p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/js-apis-inner-application-context-V14?catalogVersion=V14">上下文对象文档</a></p>
<p>上下文对象是一个包含了应用信息，以及一些应用功能的对象，获取它有两种方式：</p>
<ol>
<li>在组价中调用<code>getContext(this)</code>方法获取</li>
<li>在UIAbility中调用<code>this.context</code>获取</li>
</ol>
<p>对于工具类来说我们只能通过第二种方式获取，我们可以在<code>onCreate</code>生命周期中获取上下文对象，并将其保存到<code>AppStorage</code>中。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onCreate</span>(<span class="attr">want</span>: <span class="title class_">Want</span>, <span class="attr">launchParam</span>: <span class="title class_">AbilityConstant</span>.<span class="property">LaunchParam</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">getApplicationContext</span>().<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_NOT_SET</span>);</span><br><span class="line">  hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onCreate&#x27;</span>);</span><br><span class="line">  <span class="title class_">AppStorage</span>.<span class="title function_">setOrCreate</span>(<span class="string">&#x27;context&#x27;</span>,<span class="variable language_">this</span>.<span class="property">context</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于<code>AppStorageV2</code>如何存储上下文对象我暂时还没有解决第一个类型参数的问题。</p>
<p>(1h后……)</p>
<p>我想到了当初在学习如何从V1向V2转换时，我直接持久化一个对象数组并不成功的原因是其类型只能是一个对象，而不是一个数组或是联合类型。<br>当时我将对象数组包装在一个对象中，作为对象的一个属性连同那个对象一起持久化就成功了，所以我单独设计了一个对象来包裹上下文对象就成功了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Context</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GetContext</span>&#123;</span><br><span class="line">  <span class="attr">context</span>:<span class="title class_">Context</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">context</span>: <span class="title class_">Context</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span> = context</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启全屏</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">enable</span>(<span class="params"></span>)&#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="string">&#x27;进入enable&#x27;</span>)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="title class_">AppStorageV2</span>.<span class="property">connect</span>&lt;<span class="title class_">GetContext</span>&gt;(<span class="title class_">GetContext</span>,<span class="string">&#x27;context&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (context) &#123;</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="string">&#x27;找到Context&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> win = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(context.<span class="property">context</span>)</span><br><span class="line">      win.<span class="title function_">setWindowLayoutFullScreen</span>(<span class="literal">true</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          logger.<span class="title function_">debug</span>(<span class="string">&#x27;进入setWindowLayoutFullScreen的then&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">&#x27;未找到Context&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;<span class="keyword">catch</span> (err)&#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(err)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:err&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onCreate</span>(<span class="attr">want</span>: <span class="title class_">Want</span>, <span class="attr">launchParam</span>: <span class="title class_">AbilityConstant</span>.<span class="property">LaunchParam</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">getApplicationContext</span>().<span class="title function_">setColorMode</span>(<span class="title class_">ConfigurationConstant</span>.<span class="property">ColorMode</span>.<span class="property">COLOR_MODE_NOT_SET</span>);</span><br><span class="line">  hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onCreate&#x27;</span>);</span><br><span class="line">  <span class="title class_">AppStorageV2</span>.<span class="property">connect</span>&lt;<span class="title class_">GetContext</span>&gt;(<span class="title class_">GetContext</span>,<span class="string">&#x27;context&#x27;</span>,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">GetContext</span>(<span class="variable language_">this</span>.<span class="property">context</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后在<code>onWindowStageCreate</code>生命周期函数中调用<code>enable()</code>方法开启全屏。</p>
<p><img src="/2025/02/27/MianShiTong/14.png" alt="14"></p>
<p>也是顺利的实现了沉浸式效果。</p>
<h4 id="获取屏幕尺寸"><a href="#获取屏幕尺寸" class="headerlink" title="获取屏幕尺寸"></a>获取屏幕尺寸</h4><p>在上面的沉浸式页面效果图我们可以看到其实如果上下的内容都顶到头的话会导致内容<strong>被导航栏和状态栏遮挡</strong>。<br>所以我们的沉浸式布局仅仅需要将我们的<strong>背景图或背景色延伸</strong>到导航栏和状态栏的下方即可，而真正的<strong>内容不需要向上下延伸</strong>，因此我们还需要获取到导航栏和状态栏的<strong>高度</strong>。</p>
<p>为了实现这个效果，我们需要用到<code>getWindowAvoidArea()</code>方法。</p>
<p><img src="/2025/02/27/MianShiTong/15.png" alt="15"></p>
<p><img src="/2025/02/27/MianShiTong/16.png" alt="16"></p>
<p>根据文档我们就可以获取我们所需的规避区域的尺寸，并将其应用到我们的布局中。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">enable</span>(<span class="params"></span>)&#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="string">&#x27;FullScreen: 进入enable&#x27;</span>)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="title class_">AppStorageV2</span>.<span class="property">connect</span>&lt;<span class="title class_">GetContext</span>&gt;(<span class="title class_">GetContext</span>,<span class="string">&#x27;context&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (context) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen: 找到Context&#x27;</span>)</span><br><span class="line">      <span class="comment">//获取当前窗口</span></span><br><span class="line">      <span class="keyword">const</span> win = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(context.<span class="property">context</span>)</span><br><span class="line">      <span class="comment">//设置当前窗口为沉浸式模式</span></span><br><span class="line">      <span class="keyword">await</span> win.<span class="title function_">setWindowLayoutFullScreen</span>(<span class="literal">true</span>)</span><br><span class="line">      <span class="comment">//获取顶部区域</span></span><br><span class="line">      <span class="keyword">const</span> topArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_SYSTEM</span>).<span class="property">topRect</span></span><br><span class="line">      <span class="comment">//将顶部高度存储到AppStorage</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen: topAreaHeight: &#x27;</span>+<span class="title function_">px2vp</span>(topArea.<span class="property">height</span>))</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,topAreaHeight,<span class="function">()=&gt;</span><span class="title function_">px2vp</span>(topArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line">      <span class="comment">//获取底部区域和底部区域高度</span></span><br><span class="line">      <span class="keyword">const</span> bottomArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_NAVIGATION_INDICATOR</span>).<span class="property">bottomRect</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen: bottomAreaHeight: &#x27;</span>+<span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>))</span><br><span class="line">      <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,bottomAreaHeight,<span class="function">()=&gt;</span><span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">&#x27;FullScreen: 未找到Context&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;<span class="keyword">catch</span> (err)&#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(err)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:err&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于<code>bottomArea.height</code>和<code>topArea.height</code>都是<code>px</code>单位，而我们的布局中使用的是<code>vp</code>单位，所以我们需要将<code>px</code>单位转换为<code>vp</code>单位。</p>
<hr>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hilog &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.PerformanceAnalysisKit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; bottomAreaHeight, logger, topAreaHeight &#125; <span class="keyword">from</span> <span class="string">&#x27;../commons/CommonsExportCentre&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppStorageV2</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logTag = <span class="string">&#x27;indexPage: &#x27;</span></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">topAvoidSize</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">bottomAvoidSize</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,topAreaHeight)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">topAvoidSize</span> = <span class="built_in">parseInt</span>(<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,topAreaHeight)!.<span class="title function_">toString</span>())</span><br><span class="line">        logger.<span class="title function_">info</span>(logTag+<span class="string">&#x27;topAvoidSize: &#x27;</span>+<span class="variable language_">this</span>.<span class="property">topAvoidSize</span>)</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(logTag+<span class="string">&#x27;未找到topAreaHeight&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,bottomAreaHeight)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">bottomAvoidSize</span> = <span class="built_in">parseInt</span>(<span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,bottomAreaHeight)!.<span class="title function_">toString</span>())</span><br><span class="line">        logger.<span class="title function_">info</span>(logTag+<span class="string">&#x27;bottomAvoidSize: &#x27;</span>+<span class="variable language_">this</span>.<span class="property">bottomAvoidSize</span>)</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(logTag+<span class="string">&#x27;未找到bottomAreaHeight&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (err)&#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(logTag+err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;top&#x27;</span>)</span><br><span class="line">      <span class="title class_">Blank</span>()</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">padding</span>(&#123;</span><br><span class="line">      <span class="attr">top</span>:<span class="variable language_">this</span>.<span class="property">topAvoidSize</span>,</span><br><span class="line">      <span class="attr">bottom</span>:<span class="variable language_">this</span>.<span class="property">bottomAvoidSize</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Blue</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在编写完以上代码之后，上下区域的规避并没有实现。<br>此时就体现出了打印日志打重要性。</p>
<p><img src="/2025/02/27/MianShiTong/17.png" alt="17"></p>
<p>通过日志我们可知问题出现在获取获取规避区域的高度时，AppStorageV2中并没有存储我们所需的数据。<br>而FullScreen文件获取避障区域高度的日志是在这之后打印的说明我们获取避障区域的代码执行晚了。</p>
<h5 id="AppStorageV2数据存储问题"><a href="#AppStorageV2数据存储问题" class="headerlink" title="AppStorageV2数据存储问题"></a>AppStorageV2数据存储问题</h5><p>在寻找了一段时间执行时间的问题之后，暂时还没有解决，但我发现了另外一个问题，AppStorageV2在存储顶部区域数据时会卡死，后续的代码都不会执行。</p>
<p><img src="/2025/02/27/MianShiTong/18.png" alt="18"></p>
<p>我不知道是因为底部区域的高度数值获取错误导致的后续代码没有执行，还是代码就卡死在了存储顶部区域高度的这一步。</p>
<p>所以我新增了两行日志</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen: topAreaHeight: &#x27;</span>+<span class="title function_">px2vp</span>(topArea.<span class="property">height</span>))</span><br><span class="line"><span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,topAreaHeight,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">Number</span>(<span class="title function_">px2vp</span>(topArea.<span class="property">height</span>)))</span><br><span class="line"><span class="comment">// AppStorage.setOrCreate(topAreaHeight,px2vp(topArea.height))</span></span><br><span class="line">logger.<span class="title function_">debug</span>(<span class="string">&#x27;FullScreen: topAreaHeight存储完毕&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取底部区域和底部区域高度</span></span><br><span class="line"><span class="keyword">const</span> bottomArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_NAVIGATION_INDICATOR</span>).<span class="property">bottomRect</span></span><br><span class="line">logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen: bottomAreaHeight: &#x27;</span>+<span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>))</span><br><span class="line"><span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,bottomAreaHeight,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">Number</span>(<span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>)))</span><br><span class="line">logger.<span class="title function_">debug</span>(<span class="string">&#x27;FullScreen: bottomAreaHeight存储完毕&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>很显然，结果是一样的。<br>至此我们可以分析出问题出现在<code>AppStorageV2.connect()</code>方法上。<br>我尝试了<code>AppStorage.setOrCreate()</code>方法，结果代码就可以执行过去。</p>
<p>这也说明就是我初始化数据时有问题。</p>
<p>在求助了子安学长后我意识到了问题所在：<br><code>AppStorageV2.connect()</code>函数的第三个函数需要的是一个构造器，也就是需要有<code>new</code>关键字，并不一定要在第三个参数中，但一定要包含有new。<br>而我当前的写法<code>AppStorageV2.connect(Number,topAreaHeight,()=&gt;px2vp(topArea.height))</code>对于<code>Number</code>来说是错误的，因为我没有使用new关键字。</p>
<p>将原本的数据利用<code>new Number()</code>包裹之后再传入即可。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,topAreaHeight,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">Number</span>(<span class="title function_">px2vp</span>(topArea.<span class="property">height</span>)))</span><br><span class="line"><span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">Number</span>,bottomAreaHeight,<span class="function">()=&gt;</span><span class="keyword">new</span> <span class="title class_">Number</span>(<span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>)))</span><br></pre></td></tr></table></figure>
<p>至此初始化问题解决。</p>
<div class="note danger flat"><p>这里虽然解决了存储问题，但是依旧没有完成上下安全区的规避功能，这也引出了我对<code>[V1-&gt;V2](https://xbxyftx.top/2025/02/04/v2/#%E8%A1%A5%E5%85%85)</code>博客文章的补充部分。</p>
</div>
<h5 id="初始化时间问题"><a href="#初始化时间问题" class="headerlink" title="初始化时间问题"></a>初始化时间问题</h5><p>在解决了初始化问题后，我发现规避区域的高度并没有生效。<br>根据日志我们可以看到</p>
<p><img src="/2025/02/27/MianShiTong/19.png" alt="19"></p>
<p>Index页面获取数据的时机依旧是在<code>AppStorageV2.connect()</code>方法之前，也就是说规避区域的高度并没有在Index页面初始化时获取到。<br>这个问题暂时我还没有解决办法，所以我决定先利用V1版本所提供的单项绑定能力来规避时间差问题。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@StorageProp</span>(topAreaHeight) <span class="attr">topAvoidSize</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"><span class="meta">@StorageProp</span>(bottomAreaHeight) <span class="attr">bottomAvoidSize</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/20.png" alt="20"></p>
<hr>
<p><img src="/2025/02/27/MianShiTong/21.png" alt="21"></p>
<p>由此我们可看出，虽然在UI渲染完成时规避区域的高度数据依旧没有完成初始化，数据仍未默认的0，而由于V1的单项绑定能力，规避区域的高度依旧可以通过数据的改变而生效。</p>
<h5 id="初始化时间问题解决方案"><a href="#初始化时间问题解决方案" class="headerlink" title="初始化时间问题解决方案"></a>初始化时间问题解决方案</h5><p>在第二天我再次求助了子安学长后我们找到了解决方案。</p>
<p><strong>解决过程复现：</strong></p>
<ul>
<li><p>确认代码执行顺序:<br>首先我们考虑的是再次用V1和V2两种<code>AppStorage</code>分别创建全局变量，并通过打印日志的方式来观察全局变量的初始化时机。<br>解雇与昨天的结果一样，两者的初始化时机都是在<strong>Index页面已经构建完成后</strong>才完成的初始化。</p>
<p><img src="/2025/02/27/MianShiTong/22.png" alt="22"></p>
<p>现在我们可以确定目前代码的执行顺序如上图所示。</p>
</li>
<li><p>分析V1版本成功原因:<br>在昨晚最后的尝试中，我回归V1版本，并调用它提供的<strong>单项绑定能力</strong>，<strong>规避了初始化时间差的问题</strong>。<br>哪怕在页面构建时数据并没有成功初始化，也可以通过<strong>后续数据的更新</strong>来在极短的时间内获取到数据修改UI</p>
</li>
<li><p>V2无法复刻的原因:<br>由于在V2中获取与初始化都是同一个接口<code>AppStorageV2.connect()</code>，所以无法通过单项绑定能力来规避初始化时间差的问题。<br>因为在V2中在初始化时<strong>必须要传入一个默认构造器</strong>，而后才能用两个参数来获取数据，这一点在我V2版本的解析博客中也有提到。<br>这就导致我们需要在搞清楚代码执行顺序后，在<strong>最先用到这个数据的地方</strong>进行构造器的传入才能完成初始化。<br>而<code>enable</code>函数却不是最先用到这个数据的地方，而是在<code>Index</code>页面构建后才用到的。</p>
<p><img src="/2025/02/27/MianShiTong/23.png" alt="23"></p>
</li>
<li><p>查找文档:<br><img src="/2025/02/27/MianShiTong/24.png" alt="24"></p>
<hr>
<p><img src="/2025/02/27/MianShiTong/25.png" alt="25"></p>
<p>文档中并没有提供双向绑定或是单项绑定的方法，而我发现V2版本的全局变量思想与V1版本稍有不同。<br>V1版本中在UI组件中要用<strong>专属修饰器</strong>来与全局变量进行单向或双向绑定，在逻辑函数中则要分别用<strong>创建，获取，修改等API接口</strong>来进行读写操作。<br>而对于V2版本则是相当于获取了全局变量的读写权限或者说是说获取了那个全局变量的<strong>引用</strong>。<br>我们只需要像正常变量的读写一样用等号去进行数值的修改即可。</p>
</li>
<li><p>修改初始化位置:<br>在更深入的了解了V2版本的全局变量机制之后，我从新梳理了代码的执行顺序，并将初始化移动到了Index页面的构建过程中。<br>经过测试，虽然没有了原本的初始化报错，但数值也仅仅采用了默认的0值。<br>我将原本<code>enable</code>函数中的初始化修改为了<strong>修改数值</strong>，试图采用这种方式来复刻V1的规避初始化时间差的方式。<br>但又出现了新的问题就是虽然修改成功了，但是<code>Index</code>页面的状态变量依旧没有修改数值。</p>
</li>
<li><p>最终解决方案:<br>在我回顾前几次遇到的V2全局变量存储问题都是依靠包装为一个新的对象来解决的。<br><code>Number</code>类型在初始化存储时虽然使用了<code>new</code>关键字，但很有可能并没有被系统追踪数值的变化。<br>所以我们需要将数据包装为一个新的对象，并用<code>@Trace</code>来追踪数值的变化。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ObservedV2</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AvoidArea</span> &#123;</span><br><span class="line">  <span class="meta">@Trace</span> <span class="attr">top</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="meta">@Trace</span> <span class="attr">bottom</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取顶部区域</span></span><br><span class="line"><span class="keyword">const</span> topArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_SYSTEM</span>).<span class="property">topRect</span></span><br><span class="line"><span class="comment">//将顶部高度存储到AppStorage</span></span><br><span class="line">logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen:  topAreaHeight: &#x27;</span> + <span class="title function_">px2vp</span>(topArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取底部区域和底部区域高度</span></span><br><span class="line"><span class="keyword">const</span> bottomArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_NAVIGATION_INDICATOR</span>).<span class="property">bottomRect</span></span><br><span class="line">logger.<span class="title function_">info</span>(<span class="string">&#x27;FullScreen:  bottomAreaHeight: &#x27;</span> + <span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">avoid_area.<span class="property">top</span> = <span class="title function_">px2vp</span>(topArea.<span class="property">height</span>);</span><br><span class="line">avoid_area.<span class="property">bottom</span> = <span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>)</span><br><span class="line">logger.<span class="title function_">debug</span>(<span class="string">&#x27;FullScreen:  avoid_area数据更新完成&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>经过测试，功能终于实现。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Local</span> <span class="attr">avoidAreaSizes</span>: <span class="title class_">AvoidAreaSizes</span> = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">AvoidAreaSizes</span>, <span class="variable constant_">AVOID_AREA</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">AvoidAreaSizes</span>())!</span><br><span class="line"></span><br><span class="line"><span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="variable constant_">INDEX_LOG_TAG</span> + <span class="string">&#x27;aboutToAppear函数: top: &#x27;</span> + <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">top</span> + <span class="string">&#x27; bottom: &#x27;</span> +</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">bottom</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Monitor</span>(<span class="string">&#x27;avoidAreaSizes.top&#x27;</span>,<span class="string">&#x27;avoidAreaSizes.bottom&#x27;</span>)</span><br><span class="line"><span class="title function_">onChange</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="variable constant_">INDEX_LOG_TAG</span> + <span class="string">&#x27;监测voidAreaSizes数值改变: &#x27;</span> + <span class="string">&#x27;topAvoidSize: &#x27;</span> + <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">top</span> + <span class="string">&#x27; bottomAvoidSize: &#x27;</span> +</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">bottom</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/26.png" alt="26"></p>
<p>通过生命周期函数和变量监听器的日志我们可以看到代码的<strong>执行顺序没有变</strong>，与之前的推测一致。<br>通过包装对象的方式我们顺利的让系统<strong>监听到了数值的变化</strong>，实现的UI状态变量的数值更新。</p>
</li>
</ul>
<p>至此问题解决。</p>
<div class="note success flat"><p>总结来说，就是尽可能用自定义类来去对数据进行包裹，然后使用<code>@Trace</code>来追踪数值的变化。不要直接存储简单类型，一方面是不利于统一功能的数据管理，也可能发生上述的问题。</p>
</div>
<h4 id="关闭沉浸式函数"><a href="#关闭沉浸式函数" class="headerlink" title="关闭沉浸式函数"></a>关闭沉浸式函数</h4><p>关闭沉浸式函数的逻辑大体与开启沉浸式函数的逻辑一致，只是在获取规避区域的高度时略有不同。<br>所以我们先将开启沉浸式函数的代码复制过来，然后进行修改。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//关闭全屏</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">disable</span>(<span class="params"></span>)&#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;进入FullScreen.disable&#x27;</span>)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="title class_">AppStorageV2</span>.<span class="property">connect</span>&lt;<span class="title class_">GetContext</span>&gt;(<span class="title class_">GetContext</span>, <span class="string">&#x27;context&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (context) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;找到Context&#x27;</span>)</span><br><span class="line">      <span class="comment">//获取当前窗口</span></span><br><span class="line">      <span class="keyword">const</span> win = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(context.<span class="property">context</span>)</span><br><span class="line">      <span class="comment">//设置当前窗口为沉浸式模式</span></span><br><span class="line">      <span class="keyword">await</span> win.<span class="title function_">setWindowLayoutFullScreen</span>(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//获取顶部区域</span></span><br><span class="line">      <span class="keyword">const</span> topArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_SYSTEM</span>).<span class="property">topRect</span></span><br><span class="line">      <span class="comment">//将顶部高度存储到AppStorage</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;topAreaHeight: &#x27;</span> + <span class="title function_">px2vp</span>(topArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//获取底部区域和底部区域高度</span></span><br><span class="line">      <span class="keyword">const</span> bottomArea = win.<span class="title function_">getWindowAvoidArea</span>(<span class="variable language_">window</span>.<span class="property">AvoidAreaType</span>.<span class="property">TYPE_NAVIGATION_INDICATOR</span>).<span class="property">bottomRect</span></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;bottomAreaHeight: &#x27;</span> + <span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      avoid_area.<span class="property">top</span> = <span class="title function_">px2vp</span>(topArea.<span class="property">height</span>);</span><br><span class="line">      avoid_area.<span class="property">bottom</span> = <span class="title function_">px2vp</span>(bottomArea.<span class="property">height</span>)</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;avoid_area数据更新完成&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;未找到Context&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(err)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: err &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们将代码中的<code>setWindowLayoutFullScreen(true)</code>改为<code>setWindowLayoutFullScreen(false)</code>。<br>接着我们回到<code>EntryAbility</code>中，将<code>onWindowStageCreate</code>生命周期函数中的<code>enable()</code>函数后面加上一个5秒钟的定时器，沉浸式5秒后关闭沉浸式，用以测试功能。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onWindowStageCreate</span>(<span class="attr">windowStage</span>: <span class="variable language_">window</span>.<span class="property">WindowStage</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Main window is created, set main page for this ability</span></span><br><span class="line">  hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;%&#123;public&#125;s&#x27;</span>, <span class="string">&#x27;Ability onWindowStageCreate&#x27;</span>);</span><br><span class="line">  fullScreen.<span class="title function_">enable</span>()</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    fullScreen.<span class="title function_">disable</span>()</span><br><span class="line">  &#125;,<span class="number">8000</span>)</span><br><span class="line">  windowStage.<span class="title function_">loadContent</span>(<span class="string">&#x27;pages/Index&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err.<span class="property">code</span>) &#123;</span><br><span class="line">      hilog.<span class="title function_">error</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Failed to load the content. Cause: %&#123;public&#125;s&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    hilog.<span class="title function_">info</span>(<span class="variable constant_">DOMAIN</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;Succeeded in loading the content.&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="27.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>功能实现，但上下区域已经避开了导航栏和状态栏，根组件的上下内边距却依旧在生效这很显然是不合理的，所以我们要继续对代码进行修改。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//关闭全屏</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">disable</span>(<span class="params"></span>)&#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;进入FullScreen.disable&#x27;</span>)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="title class_">AppStorageV2</span>.<span class="property">connect</span>&lt;<span class="title class_">GetContext</span>&gt;(<span class="title class_">GetContext</span>, <span class="string">&#x27;context&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (context) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;找到Context&#x27;</span>)</span><br><span class="line">      <span class="comment">//获取当前窗口</span></span><br><span class="line">      <span class="keyword">const</span> win = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(context.<span class="property">context</span>)</span><br><span class="line">      <span class="comment">//设置当前窗口为沉浸式模式</span></span><br><span class="line">      <span class="keyword">await</span> win.<span class="title function_">setWindowLayoutFullScreen</span>(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">      avoid_area.<span class="property">top</span> = <span class="number">0</span></span><br><span class="line">      avoid_area.<span class="property">bottom</span> = <span class="number">0</span></span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;avoid_area数据更新完成&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="variable constant_">FULL_SCREEN_LOG_TAG</span>+<span class="string">&#x27;未找到Context&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(err)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: err &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/28.png" alt="28"></p>
<hr>
<p><img src="/2025/02/27/MianShiTong/29.png" alt="29"></p>
<p>至此沉浸式功能实现。</p>
<h3 id="封装状态栏工具"><a href="#封装状态栏工具" class="headerlink" title="封装状态栏工具"></a>封装状态栏工具</h3><p>由于手机有深色和浅色模式，我们需要去进行对不同模式下的状态栏颜色进行适配。<br><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/js-apis-window-V14#setwindowsystembarproperties9">功能文档</a></p>
<h4 id="设置状态栏函数"><a href="#设置状态栏函数" class="headerlink" title="设置状态栏函数"></a>设置状态栏函数</h4><p>对于<code>setWindowSystemBarProperties</code>函数我们通过官方文档可以看到我们需要传入一个<code>window.SystemBarProperties</code>类型的对象，其中包裹了全部需要设置的配置项。<br>所以我们可以仿照封装沉浸式工具的方式来获取当前应用的<strong>上下文对象</strong>，然后通过上下文对象获取到<strong>当前窗口</strong>。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置状态栏</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">setBar</span>(<span class="params"><span class="attr">config</span>:<span class="variable language_">window</span>.<span class="title class_">SystemBarProperties</span></span>)&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="variable constant_">STATE_BAR_LOG_TAG</span>+<span class="string">&#x27;进入StateBar.setBar&#x27;</span>)</span><br><span class="line">    <span class="comment">//尝试获取上下文对象</span></span><br><span class="line">    <span class="keyword">const</span> context = <span class="title class_">AppStorageV2</span>.<span class="title function_">connect</span>(<span class="title class_">GetContext</span>,<span class="variable constant_">CONTEXT</span>)!.<span class="property">context</span></span><br><span class="line">    <span class="keyword">if</span> (context) &#123;</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">STATE_BAR_LOG_TAG</span>+<span class="string">&#x27;找到context&#x27;</span>)</span><br><span class="line">      <span class="comment">//获取当前窗口</span></span><br><span class="line">      <span class="keyword">const</span> win = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(context)</span><br><span class="line">      <span class="comment">//设置状态栏状态</span></span><br><span class="line">      win.<span class="title function_">setWindowSystemBarProperties</span>(config)</span><br><span class="line">      logger.<span class="title function_">debug</span>(<span class="variable constant_">STATE_BAR_LOG_TAG</span>+<span class="string">&#x27;设置完成&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">catch</span> (err)&#123;</span><br><span class="line">    logger.<span class="title function_">error</span>(<span class="variable constant_">STATE_BAR_LOG_TAG</span>+<span class="string">&#x27;StateBar.setBar:  &#x27;</span>+err)</span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123;<span class="attr">message</span>:<span class="variable constant_">STATE_BAR_LOG_TAG</span>+<span class="string">&#x27;StateBar.setBar:  &#x27;</span>+err&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>依旧是要在各个关键节点进行日志的打印，用以调试。</p>
<p>我们正常使用时只有深色浅色两种模式，如果每次都单独传入一个对象用于配置，是很麻烦的，所以我们需要再封装两个函数，自动传入配置参数。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置深色模式配置项</span></span><br><span class="line"><span class="title function_">setDarkBar</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setBar</span>(&#123;</span><br><span class="line">    <span class="attr">statusBarContentColor</span>:<span class="string">&#x27;#000000&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setLightBar</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setBar</span>(&#123;</span><br><span class="line">    <span class="attr">statusBarContentColor</span>:<span class="string">&#x27;#FFFFFF&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试功能"><a href="#测试功能" class="headerlink" title="测试功能"></a>测试功能</h5><p>而对于这个功能的测试我们可以直接使用两个按钮来进行切换测试</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Column</span>() &#123;</span><br><span class="line">    <span class="title class_">Text</span>(<span class="string">&#x27;top&#x27;</span>)</span><br><span class="line">    <span class="title class_">Blank</span>()</span><br><span class="line">    <span class="title class_">Button</span>(<span class="string">&#x27;浅色文字&#x27;</span>)</span><br><span class="line">      .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        stateBar.<span class="title function_">setLightBar</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="title class_">Button</span>(<span class="string">&#x27;深色文字&#x27;</span>)</span><br><span class="line">      .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        stateBar.<span class="title function_">setDarkBar</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="title class_">Text</span>(<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="title function_">padding</span>(&#123;</span><br><span class="line">    <span class="attr">top</span>: <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">top</span>,</span><br><span class="line">    <span class="attr">bottom</span>: <span class="variable language_">this</span>.<span class="property">avoidAreaSizes</span>.<span class="property">bottom</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Blue</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="30.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>至此状态栏功能实现。</p>
<h2 id="正式内容阶段"><a href="#正式内容阶段" class="headerlink" title="正式内容阶段"></a>正式内容阶段</h2><h3 id="首页模块"><a href="#首页模块" class="headerlink" title="首页模块"></a>首页模块</h3><div class="note default flat"><p>对于UI布局我就不再过多赘述，都是比较基础的点，我只会挑重要的去讲，以及逻辑功能函数的实现。</p>
</div>
<h4 id="首页布局"><a href="#首页布局" class="headerlink" title="首页布局"></a>首页布局</h4><p><img src="/2025/02/27/MianShiTong/31.png" alt="31"></p>
<p>首先通过设计图我们可以分析出整体采用tabs来进行布局。<br>最上方一个置顶栏位，中上部一个轮播图，中下部用一个List，底部用自定义<code>Builder</code>传入<code>tabBar</code>。</p>
<p>为了限制<code>tabBar</code>的长宽比，我们需要用<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/ts-universal-attributes-layout-constraints-V14#aspectratio">aspectRatio</a>属性来进行限制。</p>
<h4 id="tabs"><a href="#tabs" class="headerlink" title="tabs"></a>tabs</h4><p>定义接口用于包装<code>tabBar</code>渲染数据</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">TabItem</span> &#123;</span><br><span class="line">  <span class="attr">icon</span>: <span class="title class_">Resource</span>;</span><br><span class="line">  <span class="attr">activeIcon</span>: <span class="title class_">Resource</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>列出待渲染字典</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// struct Index 数据</span></span><br><span class="line"><span class="attr">tabList</span>: <span class="title class_">TabItem</span>[] = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">icon</span>: $r(<span class="string">&#x27;app.media.tabbar_home&#x27;</span>),</span><br><span class="line">    <span class="attr">activeIcon</span>: $r(<span class="string">&#x27;app.media.tabbar_home_fill&#x27;</span>),</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;首页&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">icon</span>: $r(<span class="string">&#x27;app.media.tabbar_project&#x27;</span>),</span><br><span class="line">    <span class="attr">activeIcon</span>: $r(<span class="string">&#x27;app.media.tabbar_project_fill&#x27;</span>),</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;项目&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">icon</span>: $r(<span class="string">&#x27;app.media.tabbar_interview&#x27;</span>),</span><br><span class="line">    <span class="attr">activeIcon</span>: $r(<span class="string">&#x27;app.media.tabbar_interview_fill&#x27;</span>),</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;面经&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">icon</span>: $r(<span class="string">&#x27;app.media.tabbar_mine&#x27;</span>),</span><br><span class="line">    <span class="attr">activeIcon</span>: $r(<span class="string">&#x27;app.media.tabbar_mine_fill&#x27;</span>),</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;我的&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>每个页面由于需要有不同的状态变量以及不同的逻辑函数，且其逻辑与生命周期相绑定，我们就不能采用轻量化的<code>@Builder</code>来进行渲染，而要采用<code>@ComponentV2</code>来进行渲染。<br>每个页面都封装为一个独立的组件，由于其都属于页面，只不过没有<code>@Entry</code>所以不算是Page。我们只需要在<code>Pages</code>文件夹下去新建四个<code>ArkTS File</code>即可。</p>
<p><img src="/2025/02/27/MianShiTong/32.png" alt="32"></p>
<p>然后根据不同的下标来渲染不同的页面组件。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tabs</span>()&#123;</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">tabList</span>,<span class="function">(<span class="params"><span class="attr">item</span>:<span class="title class_">TabItem</span>,i</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title class_">TabContent</span>()&#123;</span><br><span class="line">      <span class="keyword">if</span> (i === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title class_">HomePage</span>()</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="title class_">ProjectPage</span>()</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="title class_">InterviewPage</span>()</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title class_">MinePage</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">tabBar</span>(<span class="variable language_">this</span>.<span class="title class_">TabBarBuilder</span>(item,i))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">onChange</span>(<span class="function">(<span class="params"><span class="attr">index</span>:<span class="built_in">number</span></span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">activeIndex</span> = index</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">scrollable</span>(<span class="literal">false</span>)</span><br><span class="line">.<span class="title function_">barPosition</span>(<span class="title class_">BarPosition</span>.<span class="property">End</span>)</span><br></pre></td></tr></table></figure>
<h4 id="搜索栏组件封装"><a href="#搜索栏组件封装" class="headerlink" title="搜索栏组件封装"></a>搜索栏组件封装</h4><p>首页的搜索栏仅仅作为一个占位作用，实际搜索要跳转到另一个专门的搜索页面。所以我们将搜索框封装为一个通用组件。<br>同时我们要考虑到一个问题就是，搜索框作为一个通用自定义组件，在不同的页面中会有不同的布局需求，所以我们需要提前留出各个尺寸数据的接口。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">HcSearchBox</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">boxWidth</span>: <span class="title class_">Length</span> = <span class="number">100</span> <span class="comment">// 宽高</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">boxHeight</span>: <span class="built_in">number</span> = <span class="number">32</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">ph</span>: <span class="title class_">ResourceStr</span> = <span class="string">&#x27;搜索题目&#x27;</span> <span class="comment">// 搜索的占位文本</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">phColor</span>: <span class="title class_">ResourceColor</span> = $r(<span class="string">&#x27;app.color.common_gray_02&#x27;</span>) <span class="comment">// 搜索的字体颜色</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">bgColor</span>: <span class="title class_">ResourceColor</span> = $r(<span class="string">&#x27;app.color.common_gray_border&#x27;</span>) <span class="comment">// 搜索框的背景颜色</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">layoutWeightValue</span>: <span class="built_in">number</span> = <span class="number">0</span> <span class="comment">// 占位比例</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">4</span> &#125;)&#123;</span><br><span class="line">      <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.ic_common_search&#x27;</span>))</span><br><span class="line">        .<span class="title function_">width</span>(<span class="number">14</span>)</span><br><span class="line">        .<span class="title function_">aspectRatio</span>(<span class="number">1</span>)</span><br><span class="line">        .<span class="title function_">fillColor</span>(<span class="variable language_">this</span>.<span class="property">phColor</span>)</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">ph</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">14</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">phColor</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">boxWidth</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="variable language_">this</span>.<span class="property">boxHeight</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">bgColor</span>)</span><br><span class="line">    .<span class="title function_">borderRadius</span>(<span class="variable language_">this</span>.<span class="property">boxHeight</span> / <span class="number">2</span>)</span><br><span class="line">    .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">    .<span class="title function_">layoutWeight</span>(<span class="variable language_">this</span>.<span class="property">layoutWeightValue</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是很重要的封装思想，考虑清楚需要暴露的可修改设置以及默认值的设置。</p>
<h4 id="打卡组件封装"><a href="#打卡组件封装" class="headerlink" title="打卡组件封装"></a>打卡组件封装</h4><p>打卡组件有两种状态，一种是连续打卡状态，一种是未连续打卡状态。<br>而这两种状态通过传入已经打卡的天数来实现，所以我们需要传入一个天数接口。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 大于表示已打卡</span></span><br><span class="line"><span class="meta">@Param</span> <span class="attr">clockInCount</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/33.png" alt="33"></p>
<p><img src="/2025/02/27/MianShiTong/34.png" alt="34"></p>
<h4 id="轮播图组件封装"><a href="#轮播图组件封装" class="headerlink" title="轮播图组件封装"></a>轮播图组件封装</h4><p>轮播图组件并无单独额外的逻辑需求，或是重复利用的接口预留等问题，仅仅是在首页的中上部使用一次，所以我们直接使用性能更好，更加轻量化的<code>@Builder</code>来进行封装即可。<br>所以这里我们直接将需要展示的图片资源列成资源数组，然后进行循环渲染即可。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swiperImgList</span>:<span class="title class_">Resource</span>[] = [</span><br><span class="line">  $rawfile(<span class="string">&#x27;banner_qa.png&#x27;</span>),</span><br><span class="line">  $rawfile(<span class="string">&#x27;banner_ai.png&#x27;</span>),</span><br><span class="line">  $rawfile(<span class="string">&#x27;banner_pj.png&#x27;</span>)</span><br><span class="line">]</span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line"><span class="title class_">SwiperImgBuilder</span>(<span class="attr">img</span>: <span class="title class_">Resource</span>) &#123;</span><br><span class="line">  <span class="title class_">Row</span>() &#123;</span><br><span class="line">    <span class="title class_">Image</span>(img)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">padding</span>(&#123;</span><br><span class="line">    <span class="attr">left</span>: <span class="number">16</span>,</span><br><span class="line">    <span class="attr">right</span>: <span class="number">16</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="35.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<h4 id="试题分组组件封装"><a href="#试题分组组件封装" class="headerlink" title="试题分组组件封装"></a>试题分组组件封装</h4><p><img src="/2025/02/27/MianShiTong/36.png" alt="36"></p>
<p>我们可以看到，在中上部轮播图的下方便是试题分组组件，其大致分为两部分：</p>
<ol>
<li>试题分组标题</li>
<li>试题分组列表</li>
</ol>
<p>这个效果我们可以用两种手段来实现：</p>
<ul>
<li>一种是用一个<strong>横向</strong>的<code>List</code>配合<strong>纵向</strong>的<code>List</code>，在<strong>点击横向</strong>的<code>List</code>时更新纵向<code>List</code>的数据。</li>
<li>另一种是通过<code>Tabs</code>组件配合多个<code>List</code>来实现。</li>
</ul>
<p>为了整个结构更加清晰同时减少反复的数据更新计算导致的性能负担，我们采用第二种方案。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QuestionType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../ExportCentre&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">HomeCategory</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">mockData</span>: <span class="title class_">QuestionType</span>[] = [ <span class="comment">//测试数据，后期通过网络请求获取后端数据</span></span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;ArkTS&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;ArkUI&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&#x27;Hap&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&#x27;Hsp&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;Har&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">6</span>, <span class="attr">name</span>: <span class="string">&#x27;Ability&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">7</span>, <span class="attr">name</span>: <span class="string">&#x27;Stage&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">8</span>, <span class="attr">name</span>: <span class="string">&#x27;Kit&#x27;</span>, <span class="attr">displayNewestFlag</span>: <span class="number">0</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">  <span class="title function_">build</span> () &#123;</span><br><span class="line">    <span class="title class_">Tabs</span>()&#123;</span><br><span class="line">      <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">mockData</span>,<span class="function">(<span class="params"><span class="attr">item</span>:<span class="title class_">QuestionType</span>,i</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="title class_">TabContent</span>()</span><br><span class="line">          .<span class="title function_">tabBar</span>(item.<span class="property">name</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">scrollable</span>(<span class="literal">false</span>)</span><br><span class="line">    .<span class="title function_">barMode</span>(<span class="title class_">BarMode</span>.<span class="property">Scrollable</span>)</span><br><span class="line">    .<span class="title function_">barHeight</span>(<span class="number">44</span>)</span><br><span class="line">    .<span class="title function_">divider</span>(&#123;</span><br><span class="line">      <span class="attr">strokeWidth</span>:<span class="number">0.5</span>,</span><br><span class="line">      <span class="attr">color</span>:$r(<span class="string">&#x27;app.color.common_gray_border&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处由于我们还没有封装网络请求组件，所以暂时采用本地测试数据。</p>
<p>对于<code>TabBar</code>中的动画效果的选中提示下划线我们可以利用层叠布局，在最下方覆盖一层组件，设置其宽高，并附以动画效果即可实现。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Stack</span>(&#123; <span class="attr">alignContent</span>: <span class="title class_">Alignment</span>.<span class="property">Bottom</span> &#125;) &#123;</span><br><span class="line">  <span class="title class_">Text</span>(item.<span class="property">name</span>)</span><br><span class="line">    .<span class="title function_">fontSize</span>(<span class="number">15</span>)</span><br><span class="line">    .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">activeIndex</span> === i ? $r(<span class="string">&#x27;app.color.black&#x27;</span>) : $r(<span class="string">&#x27;app.color.common_gray_01&#x27;</span>))</span><br><span class="line">    .<span class="title function_">height</span>(<span class="number">45</span>)</span><br><span class="line">  <span class="title class_">Text</span>()</span><br><span class="line">    .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">activeIndex</span> === i ? <span class="number">20</span> : <span class="number">0</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="number">2</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.black&#x27;</span>))</span><br><span class="line">    .<span class="title function_">animation</span>(&#123; <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">activeIndex</span> === i ? <span class="number">300</span> : <span class="number">0</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="37.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>这样就实现了动画选中提示效果。</p>
<h4 id="试题标签组件封装"><a href="#试题标签组件封装" class="headerlink" title="试题标签组件封装"></a>试题标签组件封装</h4><p>在试题列表中不同的试题有着不同的难度，不同的难度对应着不同的标签。<br>总共氛围三种标签：难度1、2对应着简单，3-4 是一般，5 是困难。</p>
<p>这个组件的封装难点在于数据接口的定义，而非UI布局。</p>
<h5 id="数据接口定义"><a href="#数据接口定义" class="headerlink" title="数据接口定义"></a>数据接口定义</h5><p>所以我们先来看一下我们需求的数据样式：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="number">1</span>:&#123;<span class="attr">text</span>:<span class="string">&#x27;简单&#x27;</span>,<span class="attr">color</span>:<span class="title class_">Color</span>.<span class="property">Green</span>&#125;,</span><br><span class="line">  <span class="number">2</span>:&#123;<span class="attr">text</span>:<span class="string">&#x27;简单&#x27;</span>,<span class="attr">color</span>:<span class="title class_">Color</span>.<span class="property">Green</span>&#125;,</span><br><span class="line">  <span class="number">3</span>:&#123;<span class="attr">text</span>:<span class="string">&#x27;一般&#x27;</span>,<span class="attr">color</span>:<span class="title class_">Color</span>.<span class="property">Yellow</span>&#125;,</span><br><span class="line">  <span class="number">4</span>:&#123;<span class="attr">text</span>:<span class="string">&#x27;一般&#x27;</span>,<span class="attr">color</span>:<span class="title class_">Color</span>.<span class="property">Yellow</span>&#125;,</span><br><span class="line">  <span class="number">5</span>:&#123;<span class="attr">text</span>:<span class="string">&#x27;困难&#x27;</span>,<span class="attr">color</span>:<span class="title class_">Color</span>.<span class="property">Red</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到最外层的键值对的<strong>键</strong>是难度值是<code>number</code>类型，而其对应的<strong>值又是一个对象</strong>。<br>这个对象这种包含了两个键值对，一个是显示的文本<code>text</code>，另一个是对应的颜色值<code>color</code>。</p>
<p>我们可以利用<code>ArkTS</code>的内置函数<code>Record</code>来进行数据的定义。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">HcTagInfo</span> &#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">color</span>: <span class="title class_">ResourceColor</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">infoMap</span>: <span class="title class_">Record</span>&lt;<span class="built_in">number</span>, <span class="title class_">HcTagInfo</span>&gt; = &#123;</span><br><span class="line">  <span class="number">1</span>: &#123; <span class="attr">text</span>: <span class="string">&quot;简单&quot;</span>, <span class="attr">color</span>: $r(<span class="string">&quot;app.color.common_green&quot;</span>) &#125;,</span><br><span class="line">  <span class="number">2</span>: &#123; <span class="attr">text</span>: <span class="string">&quot;简单&quot;</span>, <span class="attr">color</span>: $r(<span class="string">&quot;app.color.common_green&quot;</span>) &#125;,</span><br><span class="line">  <span class="number">3</span>: &#123; <span class="attr">text</span>: <span class="string">&quot;一般&quot;</span>, <span class="attr">color</span>: $r(<span class="string">&quot;app.color.common_blue&quot;</span>) &#125;,</span><br><span class="line">  <span class="number">4</span>: &#123; <span class="attr">text</span>: <span class="string">&quot;一般&quot;</span>, <span class="attr">color</span>: $r(<span class="string">&quot;app.color.common_blue&quot;</span>) &#125;,</span><br><span class="line">  <span class="number">5</span>: &#123; <span class="attr">text</span>: <span class="string">&quot;困难&quot;</span>, <span class="attr">color</span>: $r(<span class="string">&quot;app.color.common_main_color&quot;</span>) &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Record</code>内置函数可以自动生成一个键值对类型，会将<strong>第一个</strong>泛型参数作为<strong>键</strong>的类型，<strong>第二个</strong>泛型参数作为<strong>值</strong>的类型。<br><code>Record&lt;number, HcTagInfo&gt;</code>就表示键是<code>number</code>类型，值是<code>HcTagInfo</code>类型。</p>
<p>当然我们也有另一种方法就是再定义一个接口来进行数据的定义。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> info&#123;</span><br><span class="line">  <span class="string">&#x27;1&#x27;</span>:<span class="title class_">HcTagInfo</span></span><br><span class="line">  <span class="string">&#x27;2&#x27;</span>:<span class="title class_">HcTagInfo</span></span><br><span class="line">  <span class="string">&#x27;3&#x27;</span>:<span class="title class_">HcTagInfo</span></span><br><span class="line">  <span class="string">&#x27;4&#x27;</span>:<span class="title class_">HcTagInfo</span></span><br><span class="line">  <span class="string">&#x27;5&#x27;</span>:<span class="title class_">HcTagInfo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但很显然这种方法就无法做到使难度类型键为<code>number</code>类型了，所以我们采用第一种方法。</p>
<div class="note warning flat"><p><strong>注意：</strong>用这种方法定义的接口，在使用时需要使用<code>infoMap[1].text</code>的方式来获取数据，而不能使用<code>infoMap.1.text</code>的方式来获取数据。</p>
</div>
<h5 id="UI封装"><a href="#UI封装" class="headerlink" title="UI封装"></a>UI封装</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">HcTag</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">difficulty</span>: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">text</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">fontcolor</span>: <span class="title class_">ResourceColor</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">text</span> || <span class="title class_">HcTagInfoMap</span>[<span class="variable language_">this</span>.<span class="property">difficulty</span>].<span class="property">text</span>)</span><br><span class="line">      .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontcolor</span> || <span class="title class_">HcTagInfoMap</span>[<span class="variable language_">this</span>.<span class="property">difficulty</span>].<span class="property">color</span>)</span><br><span class="line">      .<span class="title function_">fontSize</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">6</span>, <span class="attr">right</span>: <span class="number">6</span> &#125;)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">18</span>)</span><br><span class="line">      .<span class="title function_">constraintSize</span>(&#123; <span class="attr">minWidth</span>: <span class="number">34</span> &#125;)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">2</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.common_gray_bg&#x27;</span>))</span><br><span class="line">      .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="note warning flat"><p>在使用<code>||</code>运算符时会从左向右注意判断是否为空，这样就可以做到<strong>优先使用传入的值</strong>，在没有传入值时使用默认值。</p>
</div>
<h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tabs</span>() &#123;</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">questionList</span>, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">QuestionType</span>, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">TabContent</span>()&#123;</span><br><span class="line">      <span class="title class_">Column</span>()&#123;</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123;<span class="attr">difficulty</span>:<span class="number">1</span>&#125;)</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123;<span class="attr">difficulty</span>:<span class="number">2</span>&#125;)</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123;<span class="attr">difficulty</span>:<span class="number">3</span>&#125;)</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123;<span class="attr">difficulty</span>:<span class="number">4</span>&#125;)</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123;<span class="attr">difficulty</span>:<span class="number">5</span>&#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">      .<span class="title function_">tabBar</span>(<span class="variable language_">this</span>.<span class="title class_">TabBarBuilder</span>(item, i))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">onChange</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">activeIndex</span> = i</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">barMode</span>(<span class="title class_">BarMode</span>.<span class="property">Scrollable</span>)</span><br><span class="line">.<span class="title function_">barHeight</span>(<span class="number">44</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/38.png" alt="38"><br>这样我们就实现了标签组件的封装。</p>
<h4 id="试题列表Item组件封装"><a href="#试题列表Item组件封装" class="headerlink" title="试题列表Item组件封装"></a>试题列表Item组件封装</h4><p><img src="/2025/02/27/MianShiTong/39.png" alt="39"></p>
<p>首先我们通过对效果图的布局进行分析，可以看到整体布局还是较为简洁的，大致可以分为上下两个部分：</p>
<ol>
<li>上半部分由刚才封装的试题难度标签以及试题标题组成</li>
<li>下半部分由点赞量，浏览量，阅读状态组成</li>
</ol>
<p>这里重点解系一下下半部分的UI布局，因为要用到一个新的组件<code>RowSplite</code></p>
<p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V14/ts-container-rowsplit-V14">RowSplite文档传送门</a></p>
<p>这个组件的特点在于会将每个子组件之间加上一个分割线，这样一来就不需要自己在封装组件来去处理分割线问题了。</p>
<p>这个组件可以配合<code>@Extends</code>关键字来使用，这样就可以为组件内的多块信息一次性设定相同的样式了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HcTag</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../ExportCentre&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">QuestionItemComp</span> &#123;</span><br><span class="line">  <span class="comment">// @Param</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123;<span class="attr">space</span>:<span class="number">10</span>&#125;) &#123;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123; <span class="attr">difficulty</span>: <span class="number">1</span> &#125;)</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">15</span>)</span><br><span class="line">          .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">          .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">          .<span class="title function_">textOverflow</span>(&#123; <span class="attr">overflow</span>: <span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">RowSplit</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`点赞 6`</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>(<span class="literal">true</span>)</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`浏览 1000`</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>()</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;已看过&#x27;</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(&#123;<span class="attr">left</span>:<span class="number">16</span>,<span class="attr">right</span>:<span class="number">16</span>&#125;)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.common_blue_bg&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Extend</span>(<span class="title class_">Text</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">grayText</span>(<span class="params"><span class="attr">isStart</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span>) &#123;</span><br><span class="line">  .<span class="title function_">lineHeight</span>(<span class="number">13</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">13</span>)</span><br><span class="line">  .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.common_gray_01&#x27;</span>))</span><br><span class="line">  .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: isStart ? <span class="number">0</span> : <span class="number">12</span>, <span class="attr">right</span>: <span class="number">12</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/40.png" alt="40"></p>
<h4 id="完成试题列表渲染"><a href="#完成试题列表渲染" class="headerlink" title="完成试题列表渲染"></a>完成试题列表渲染</h4><p>刚才完成了试题列表的单个Item组件封装，接下来我们就可以在试题列表页面中使用这个组件了。<br>在使用之前我们要先进行数据接口的定义与状态变量的接口暴露，然后再进行数据的传入与渲染。</p>
<h5 id="试题列表信息数据接口定义"><a href="#试题列表信息数据接口定义" class="headerlink" title="试题列表信息数据接口定义"></a>试题列表信息数据接口定义</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">QuestionListItem</span>&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/* 题干 */</span></span><br><span class="line">  <span class="attr">stem</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/* 难度 */</span></span><br><span class="line">  <span class="attr">difficulty</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/* 点赞数 */</span></span><br><span class="line">  <span class="attr">likeCount</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/* 浏览数 */</span></span><br><span class="line">  <span class="attr">views</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/* 是否已看 */</span></span><br><span class="line">  <span class="attr">readFlag</span>: <span class="number">0</span> | <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="适配数据接口"><a href="#适配数据接口" class="headerlink" title="适配数据接口"></a>适配数据接口</h5><p>由于这个数据是必须传入的并没有默认值选项，所以我们在使用<code>@Param</code>装饰器后还需配合<code>@Require</code>装饰器后才能使组件正常工作。<br>随后将组件原本写死的测试用例替换为接口数据即可。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 面试问题列表Item组件</span></span><br><span class="line"><span class="comment"> * 必须传入一个QuestionListItem对象</span></span><br><span class="line"><span class="comment"> * 包含问题的id，题目，点赞数，阅读量，是否看过等信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Preview</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">QuestionItemComp</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="meta">@Require</span> <span class="attr">questionItem</span>: <span class="title class_">QuestionListItem</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">HcTag</span>(&#123; <span class="attr">difficulty</span>: <span class="variable language_">this</span>.<span class="property">questionItem</span>.<span class="property">difficulty</span> &#125;)</span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">questionItem</span>.<span class="property">stem</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">15</span>)</span><br><span class="line">          .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">          .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">          .<span class="title function_">textOverflow</span>(&#123; <span class="attr">overflow</span>: <span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">RowSplit</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`点赞 <span class="subst">$&#123;<span class="variable language_">this</span>.questionItem.likeCount&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>(<span class="literal">true</span>)</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`浏览 <span class="subst">$&#123;<span class="variable language_">this</span>.questionItem.views&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>()</span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">questionItem</span>.<span class="property">readFlag</span> === <span class="number">1</span> ? <span class="string">&#x27;已看过&#x27;</span> : <span class="string">&#x27;待阅读&#x27;</span>)</span><br><span class="line">          .<span class="title function_">grayText</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">16</span>, <span class="attr">right</span>: <span class="number">16</span> &#125;)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.common_blue_bg&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Extend</span>(<span class="title class_">Text</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">grayText</span>(<span class="params"><span class="attr">isStart</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span>) &#123;</span><br><span class="line">  .<span class="title function_">lineHeight</span>(<span class="number">13</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">13</span>)</span><br><span class="line">  .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.common_gray_01&#x27;</span>))</span><br><span class="line">  .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: isStart ? <span class="number">0</span> : <span class="number">12</span>, <span class="attr">right</span>: <span class="number">12</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试UI显示"><a href="#测试UI显示" class="headerlink" title="测试UI显示"></a>测试UI显示</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tabs</span>() &#123;</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">questionList</span>, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">QuestionTabBarType</span>, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">TabContent</span>() &#123;</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">10</span>).<span class="title function_">fill</span>(&#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">          <span class="attr">stem</span>: <span class="string">&#x27;测试标题&#x27;</span>,</span><br><span class="line">          <span class="attr">difficulty</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">likeCount</span>: <span class="number">3000</span>,</span><br><span class="line">          <span class="attr">views</span>: <span class="number">9999</span>,</span><br><span class="line">          <span class="attr">readFlag</span>: <span class="number">0</span></span><br><span class="line">        &#125;), <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">QuestionListItem</span>, i</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">              <span class="title class_">QuestionItemComp</span>(&#123;</span><br><span class="line">                <span class="attr">questionListItem</span>: item</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="title class_">Divider</span>()</span><br><span class="line">                .<span class="title function_">strokeWidth</span>(<span class="number">1</span>)</span><br><span class="line">                .<span class="title function_">color</span>($r(<span class="string">&#x27;app.color.common_gray_02&#x27;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: i === <span class="number">0</span> ? <span class="number">10</span> : <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">tabBar</span>(<span class="variable language_">this</span>.<span class="title class_">TabBarBuilder</span>(item, i))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">divider</span>(&#123; <span class="attr">strokeWidth</span>: <span class="number">1</span>, <span class="attr">color</span>: $r(<span class="string">&#x27;app.color.common_gray_02&#x27;</span>) &#125;)</span><br><span class="line">.<span class="title function_">onChange</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">activeIndex</span> = i</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">barMode</span>(<span class="title class_">BarMode</span>.<span class="property">Scrollable</span>)</span><br><span class="line">.<span class="title function_">barHeight</span>(<span class="number">44</span>)</span><br></pre></td></tr></table></figure>
<p>在测试中我们发现直接的硬拼接各个组件还是有点难看的，所以就新进行了一些微调，像是增加了分割线与文本的距离，以及增加<code>tabBar</code>的下边界分界线与选中高亮提示下划线间的距离等。<br>这些东西其实也无伤大雅，但还是在细节上提升了些许美观度。</p>
<video width="100%" controls>
  <source src="41.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>虽然单个Item已经封装完成，但是整个列表还需要根据不同的问题类型去分类渲染，同时包括触底加载和下拉刷新等操作，所以我们接下来还需要继续去进行问题列表组件的封装。</p>
<h4 id="问题列表组件封装"><a href="#问题列表组件封装" class="headerlink" title="问题列表组件封装"></a>问题列表组件封装</h4><p>问题列表组件会包括N个问题列表Item组件，同时还需要封装下拉刷新和触底加载的功能。<br>这部分功能我在<a target="_blank" rel="noopener" href="https://xbxyftx.github.io/2025/01/30/%E5%BC%80%E5%BF%83%E4%B8%80%E7%AC%91%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/">开心一笑</a>项目中有较详细的使用教程和思路，这里不再过多赘述。</p>
<p>封装目标：</p>
<ol>
<li>使用 <code>Refresh</code> <code>List</code> 和 <code>QuestionItemComp</code> 组件搭建基础结构和样式</li>
<li>完成 <strong>下拉刷新</strong> 效果，不含数据刷新</li>
<li>完成 <strong>上拉加载</strong> Builder</li>
<li>完成 <strong>上拉加载</strong> 完整效果</li>
<li>完成 <strong>下拉刷新</strong> 完整效果</li>
</ol>
<h5 id="下拉刷新功能测试"><a href="#下拉刷新功能测试" class="headerlink" title="下拉刷新功能测试"></a>下拉刷新功能测试</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QuestionItemComp</span>, <span class="title class_">QuestionListItem</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../ExportCentre&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">QuestionListComp</span>&#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isLoading</span>:<span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="title function_">onRefresh</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span></span><br><span class="line">    &#125;,<span class="number">3000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Refresh</span>(&#123;<span class="attr">refreshing</span>:$$this.<span class="property">isLoading</span>&#125;)&#123;</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">10</span>).<span class="title function_">fill</span>(&#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">          <span class="attr">stem</span>: <span class="string">&#x27;测试标题&#x27;</span>,</span><br><span class="line">          <span class="attr">difficulty</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">likeCount</span>: <span class="number">3000</span>,</span><br><span class="line">          <span class="attr">views</span>: <span class="number">9999</span>,</span><br><span class="line">          <span class="attr">readFlag</span>: <span class="number">0</span></span><br><span class="line">        &#125;), <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">QuestionListItem</span>, i</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">              <span class="title class_">QuestionItemComp</span>(&#123;</span><br><span class="line">                <span class="attr">questionListItem</span>: item</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: i === <span class="number">0</span> ? <span class="number">10</span> : <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">divider</span>(&#123;</span><br><span class="line">        <span class="attr">strokeWidth</span>:<span class="number">1</span>,</span><br><span class="line">        <span class="attr">color</span>:$r(<span class="string">&#x27;app.color.common_gray_border&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>)</span><br><span class="line">      .<span class="title function_">edgeEffect</span>(<span class="title class_">EdgeEffect</span>.<span class="property">None</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">onRefreshing</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onRefresh</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于当前还没有封装网络请求模块所以暂时先试用定时器来默契网络请求成功的情况。</p>
<video width="100%" controls>
  <source src="42.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<h5 id="上拉加载Builder封装与功能测试"><a href="#上拉加载Builder封装与功能测试" class="headerlink" title="上拉加载Builder封装与功能测试"></a>上拉加载<code>Builder</code>封装与功能测试</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QuestionItemComp</span>, <span class="title class_">IQuestionListItem</span>, <span class="title class_">QuestionListCompTestData</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../ExportCentre&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页问题分类区域，单个问题分类分页的问题列表组件</span></span><br><span class="line"><span class="comment"> * 拥有触底加载以及下拉刷新功能</span></span><br><span class="line"><span class="comment"> * isRefreshing     加载函数触发标识符</span></span><br><span class="line"><span class="comment"> * isLoading        正是否加载达到上限标识符</span></span><br><span class="line"><span class="comment"> * isFinish         是否加载完成标识符</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">QuestionListComp</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isRefreshing</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isLoading</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">isFinish</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title function_">isLoadingMore</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isFinish</span>) &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;没有更多了&#x27;</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">15</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.common_gray_03&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isLoading</span>) &#123;</span><br><span class="line">        <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">5</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">LoadingProgress</span>()</span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">20</span>)</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;正在加载中&#x27;</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">15</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.common_gray_03&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">false</span></span><br><span class="line">    &#125;, <span class="number">3000</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Refresh</span>(&#123; <span class="attr">refreshing</span>: $$this.<span class="property">isRefreshing</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">10</span>).<span class="title function_">fill</span>(<span class="title class_">QuestionListCompTestData</span>), <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">IQuestionListItem</span>, i</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">              <span class="title class_">QuestionItemComp</span>(&#123;</span><br><span class="line">                <span class="attr">questionListItem</span>: item</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: i === <span class="number">0</span> ? <span class="number">10</span> : <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">isLoadingMore</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">divider</span>(&#123;</span><br><span class="line">        <span class="attr">strokeWidth</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">color</span>: $r(<span class="string">&#x27;app.color.common_gray_border&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>)</span><br><span class="line">      .<span class="title function_">edgeEffect</span>(<span class="title class_">EdgeEffect</span>.<span class="property">None</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">onRefreshing</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onRefresh</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于题库的题目数量是有限的不能一直无限制的向下获取新的题目所以需要去在<strong>开心一笑</strong>项目的基础上新增一个是否加载完成的标识符，用来标志是否成功获取新的题目。</p>
<p>然后通过修改状态变量的初始默认值来测试效果</p>
<p><img src="/2025/02/27/MianShiTong/43.png" alt="43"></p>
<p>随后我们依旧使用定时器来模拟网络请求的成功情况。<br>这里我们将获取的问题条数<strong>上限设为40条</strong>以免过多的加载数据导致页面卡顿。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isFinish</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="title function_">push</span>(<span class="title class_">QuestionListCompTestData</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="property">length</span> === <span class="number">40</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isFinish</span> = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">2000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>enm经过测试发现由于<code>onReachEnd</code>事件的机制，<strong>在触底时触发一次，在回弹时再触发一次</strong>，这里忘记做<strong>防过加载</strong>处理了，所以导致一次会加载20条，而且最后会因为多加载一次而<strong>使总数达到50条</strong>。所以我们还需要对代码进行微调。</p>
<div class="note info flat"><p>利用延时器实现防抖功能是很常见有效，而且低成本的处理方式，可以显著减少因为一些可能频繁触发的事件，像是滚动、点击等，而导致的性能问题。</p>
</div>
<p>首先就是修改<code>onReachEnd</code>事件中的代码，判断一下是否正在下拉刷新、加载中、加载达到上限等状态，只有在这些状态都不满足时才会去进行数据的加载。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">onReachEnd</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isRefreshing</span> || <span class="variable language_">this</span>.<span class="property">isLoading</span> || <span class="variable language_">this</span>.<span class="property">isFinish</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onLoad</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>随后修改<code>onLoad</code>方法，在加载后打印当前问题列表数组长度，用于Debug。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="title function_">push</span>(<span class="title class_">QuestionListCompTestData</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="property">length</span> === <span class="variable constant_">QUESTION_LIST_MAX_LENGTH</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isFinish</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;当前问题列表长度&#x27;</span> + <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="property">length</span>)</span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="44.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p><img src="/2025/02/27/MianShiTong/45.png" alt="45"></p>
<p>至此本功能组件封装测试完毕。</p>
<h5 id="下拉刷新的数组数据重置"><a href="#下拉刷新的数组数据重置" class="headerlink" title="下拉刷新的数组数据重置"></a>下拉刷新的数组数据重置</h5><p>刷新的逻辑与加载不同，刷新是先将原有数组清空，然后再重新加载数据。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;进入onRefresh&#x27;</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">QuestionList</span> = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="title function_">push</span>(<span class="title class_">QuestionListCompTestData</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;onRefresh:  当前问题列表长度&#x27;</span> + <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="property">length</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">false</span></span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/46.png" alt="46"></p>
<p>通过日志我们可以明确的看到，在下拉刷新时，数组数据会被清空，然后再重新加载数据。</p>
<p>不过这里我们在测试时又发现了新的问题，在触发一次下拉刷新之后，无法再次触发触底加载。</p>
<p>经过简单的推理，其实这个问题也不难排查。问题就出在下拉刷新后我们没有将加载问题数上限标志符<code>isFinish</code>重置为<code>false</code>。<br>所以我们需要在下拉刷新后将<code>isFinish</code>重置为<code>false</code>，这样一来就可以再次触发触底加载了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下拉刷新函数</span></span><br><span class="line"><span class="comment"> * 将原数组设为空随后从新获取数据</span></span><br><span class="line"><span class="comment"> * 并将试题列表获取上限标识刷新</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">onRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;进入onRefresh&#x27;</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">QuestionList</span> = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="title function_">push</span>(<span class="title class_">QuestionListCompTestData</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;onRefresh:  当前问题列表长度&#x27;</span> + <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="property">length</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isFinish</span> = <span class="literal">false</span></span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/47.png" alt="47"></p>
<p>至此本功能组件封装测试完毕。</p>
<h3 id="首页网络交互"><a href="#首页网络交互" class="headerlink" title="首页网络交互"></a>首页网络交互</h3><p>这个项目的网络请求我们统一使用axios第三方库来进行发送和管理，axios相比鸿蒙自带的网络请求模块更加便捷，详情可以参考<a target="_blank" rel="noopener" href="https://xbxyftx.github.io/2025/01/27/%E9%B8%BF%E8%92%99%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">鸿蒙网络请求学习笔记</a>这篇博客的内容。</p>
<h4 id="下载axios"><a href="#下载axios" class="headerlink" title="下载axios"></a>下载axios</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ohpm i @ohos/axios</span><br></pre></td></tr></table></figure>
<p>随后开启网络权限：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;requestPermissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ohos.permission.INTERNET&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<h4 id="封装Axios请求实例"><a href="#封装Axios请求实例" class="headerlink" title="封装Axios请求实例"></a>封装Axios请求实例</h4><p>首先在<code>utils</code>文件夹下创建一个<code>AxiosHttp.ets</code>文件，用于封装Axios请求实例以及拦截器。</p>
<p>配置基地址是很重要的，一旦公司后端的基地址发生了改变，如果没有统一的配置基地址，那么我们就需要在每个网络请求中都去修改基地址，这样一来就会很麻烦。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * axios请求实例</span></span><br><span class="line"><span class="comment"> * 配置基地址和请求超时时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> axiosInstance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>:<span class="string">&#x27;https://api-harmony-teach.itheima.net&#x27;</span>,</span><br><span class="line">  <span class="attr">timeout</span>:<span class="number">10000</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="封装Axios相应拦截器"><a href="#封装Axios相应拦截器" class="headerlink" title="封装Axios相应拦截器"></a>封装Axios相应拦截器</h4><p><code>axios</code>第三方库虽然在鸿蒙原有的网络模块的基础上优化了许多，但也依旧存在以下痛点问题：</p>
<ol>
<li>泛型参数的填写较为繁琐，在<code>get</code>请求时<strong>第一个参数无关紧要可以为<code>null</code></strong>，第二个参数是结果的类型，第三个参数由于没有需要传递的请求体参数，就可以不用填写，或者为<code>null</code>。在<code>post</code>请求时，<strong>第一个参数依旧无关紧要可以为<code>null</code></strong>，第二个参数是响应结果的类型，第三个参数是请求体类型<strong>不可省略</strong>。</li>
<li>从数据接口获取所需数据的路径过长，像是想要获取下图所示结构中的<code>account</code>字段的值，我们需要写成<code>res.data.data.account</code>，这样一来就会很麻烦。</li>
</ol>
<p><img src="/2025/02/27/MianShiTong/48.png" alt="48"></p>
<p>而且在相应信息中并非所有信息都是我们所需要的，所以我们可以针对axios的响应结果进行拦截，将我们不需要的数据剔除掉。</p>
<p>所谓拦截器是axios库提供的一种机制，它可以在请求发送前或者响应返回后对数据进行处理。<br>在axios中，拦截器分为请求拦截器和响应拦截器。<br>请求拦截器可以在请求发送前对请求数据进行处理，例如添加请求头、修改请求参数等。<br>响应拦截器可以在响应返回后对响应数据进行处理，例如对响应数据进行统一处理、判断响应状态码等。</p>
<p>我们就可以利用这个机制来对现有的<strong>响应数据进行修改</strong>使得我们能够更加方便的获取到所需要的数据。</p>
<h5 id="响应拦截器基础结构"><a href="#响应拦截器基础结构" class="headerlink" title="响应拦截器基础结构"></a>响应拦截器基础结构</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置响应拦截器拦截器</span></span><br><span class="line"><span class="comment"> * interceptors:    拦截器</span></span><br><span class="line"><span class="comment"> * response:        响应</span></span><br><span class="line"><span class="comment"> * 由这个axiosInstance实例发送到请求的响应都会经过它再返回</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">axiosInstance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params"><span class="attr">res</span>:<span class="title class_">AxiosResponse</span></span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;,<span class="function">(<span class="params"><span class="attr">err</span>:<span class="title class_">AxiosError</span></span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>所有由这个<code>axiosInstance</code>实例发送到请求的响应都会经过它再返回，这一点很重要，这意味着我们无需特意调用额外的回调函数即可完成对相应数据的拦截操作。</p>
<h5 id="响应拦截器具体实现"><a href="#响应拦截器具体实现" class="headerlink" title="响应拦截器具体实现"></a>响应拦截器具体实现</h5><p>我们直接将成功时的响应结果中的<code>data</code>字段返回，这样我们就可以直接通过<code>res.data</code>来获取到数据了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> res.<span class="property">data</span></span><br></pre></td></tr></table></figure>
<p>第一层<code>data</code>字段是axios库自动添加的，<strong>并非</strong>我们在接口文档里所看到的响应体数据，我们不需要关心它。<br>本项目的接口响应数据基本都如下图所示：</p>
<p><img src="/2025/02/27/MianShiTong/49.png" alt="49"></p>
<p>所以我们其实可以对返回值再加一层<code>data</code>字段，这样我们就可以直接通过<code>res.字段</code>来获取到数据了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> res.<span class="property">data</span>.<span class="property">data</span></span><br></pre></td></tr></table></figure>
<h4 id="封装AxiosHttp类"><a href="#封装AxiosHttp类" class="headerlink" title="封装AxiosHttp类"></a>封装AxiosHttp类</h4><p>封装这个类的目的是减少泛型参数的冗余，使得代码更加简洁。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AxiosHttp</span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Axios包装过的请求函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> config 网络请求配置项</span></span><br><span class="line"><span class="comment">   * res:相应数据类型</span></span><br><span class="line"><span class="comment">   * req:响应体参数类型 - get不需要传</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  request&lt;res,req&gt;(<span class="attr">config</span>:<span class="title class_">AxiosRequestConfig</span>&lt;req&gt;)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">axiosInstance</span>(config)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> axiosHttp = <span class="keyword">new</span> <span class="title class_">AxiosHttp</span>()</span><br></pre></td></tr></table></figure>
<p>先填写相应数据类型，再填写请求体参数类型主要是因为<code>get</code>请求并不需要传入请求体数据类型，但由于并没有默认值所以不填会报错，这里我们再给第二个参数设置一个默认值<code>Object</code>即可。</p>
<h4 id="利用AxiosHttp类获取问题分组标签列表"><a href="#利用AxiosHttp类获取问题分组标签列表" class="headerlink" title="利用AxiosHttp类获取问题分组标签列表"></a>利用AxiosHttp类获取问题分组标签列表</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Local</span> <span class="attr">questionList</span>: <span class="title class_">IQuestionTabBarType</span>[] = []</span><br><span class="line"></span><br><span class="line"><span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getQuestionList</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getQuestionList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">questionList</span> = <span class="keyword">await</span> axiosHttp.<span class="property">request</span>&lt;<span class="title class_">IQuestionTabBarType</span>[]&gt;(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/hm/question/type&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/50.png" alt="50"></p>
<p>我们可以看到此处是在报错的，由报错信息可以分析出，当前我们虽然传入了一个泛型参数，第二个泛型参数我们也设置了默认值非必要填写，但这个泛型参数并没有正确的传递给<code>axiosInstance</code>实例，导致<code>axiosInstance</code>实例无法正确的解析泛型参数。</p>
<p>于是我们回到<code>AxiosHttp.ets</code>文件中，检查代码，发现我们只反悔了实例而没有携带泛型参数。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request&lt;res, req = <span class="title class_">Object</span>&gt;(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>&lt;req&gt;) &#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="variable constant_">AXIOS_HTTP_LOG_TAG</span>+<span class="string">&#x27;进入AxiosHttp.request&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> axiosInstance&lt;<span class="literal">null</span>,res,req&gt;(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改后再次测试功能正常。</p>
<p><img src="/2025/02/27/MianShiTong/51.png" alt="51"></p>
<h4 id="响应请求码判断"><a href="#响应请求码判断" class="headerlink" title="响应请求码判断"></a>响应请求码判断</h4><p>我们当前的拦截器捕获了异常，并返回正常响应结果的数据，但如果响应是正常的，只是因为我们的传参不正确导致返回的结果是错误信息提示，而我们的<code>try catch</code>函数就无法捕获异常弹出报错，所以我们还需要去对响应状态码进行判别，一旦出现非正常状态码就需要进行弹窗以及日志提示，避免上述情况出现。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置响应拦截器拦截器</span></span><br><span class="line"><span class="comment"> * interceptors:    拦截器</span></span><br><span class="line"><span class="comment"> * response:        响应</span></span><br><span class="line"><span class="comment"> * 由这个axiosInstance实例发送到请求的响应都会经过它再返回</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">axiosInstance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">code</span> === <span class="number">10000</span>) &#123;</span><br><span class="line">    logger.<span class="title function_">debug</span>(<span class="string">&#x27;Req Success&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>.<span class="property">data</span>))</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">  &#125;</span><br><span class="line">  logger.<span class="title function_">error</span>(<span class="string">&#x27;Req Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>))</span><br><span class="line">  promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;Req Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>) &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(res.<span class="property">data</span>)</span><br><span class="line">&#125;, <span class="function">(<span class="params"><span class="attr">err</span>: <span class="title class_">AxiosError</span></span>) =&gt;</span> &#123;</span><br><span class="line">  logger.<span class="title function_">error</span>(<span class="string">&#x27;Req Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err))</span><br><span class="line">  promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;Req Error&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err) &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样一来，只要不是10000状态码，就会弹出提示。</p>
<div class="note warning flat"><p>请求码并不是通用的，每个后端的API所返回的状态码所代表的含义可能都有差异，要仔细阅读你后端的API文档，了解每个状态码所代表的含义，以便于我们更好的处理异常。</p>
</div>
<h3 id="首页问题列表的完整功能实现"><a href="#首页问题列表的完整功能实现" class="headerlink" title="首页问题列表的完整功能实现"></a>首页问题列表的完整功能实现</h3><p>之前我们仅仅使用静态的测试数据实现了问题列表的渲染，还没有接入网络请求动态获取数据，同时还缺少分类标签的半模态弹窗。</p>
<h4 id="动态获取试题列表"><a href="#动态获取试题列表" class="headerlink" title="动态获取试题列表"></a>动态获取试题列表</h4><h5 id="根据后端文档定义数据类型"><a href="#根据后端文档定义数据类型" class="headerlink" title="根据后端文档定义数据类型"></a>根据后端文档定义数据类型</h5><p><img src="/2025/02/27/MianShiTong/52.png" alt="52"></p>
<p>我们可以看，这个接口的返回数据还是相当多的，所以我们还需要慢慢分析。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 试题列表数据外层对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment"> * total:       问题总数</span></span><br><span class="line"><span class="comment"> * pageTotal:   总页数</span></span><br><span class="line"><span class="comment"> * rows:        数据集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IPageData</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">total</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">pageTotal</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">rows</span>: T[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后我们还需要去对<code>url</code>所需参数来定义一个对象，以便于包装后传参。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 排序模式常量</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@enum</span></span></span><br><span class="line"><span class="comment"> * Default:           默认量可以不传</span></span><br><span class="line"><span class="comment"> * DifficultyLow:     从易到难</span></span><br><span class="line"><span class="comment"> * DifficultyHigh:    从难道易</span></span><br><span class="line"><span class="comment"> * ViewLow:           浏览量从低到高</span></span><br><span class="line"><span class="comment"> * ViewHigh:          从高到底</span></span><br><span class="line"><span class="comment"> * Commend:           推荐数据（按照权重倒序）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">SortType</span> &#123;</span><br><span class="line">  <span class="title class_">Default</span> = <span class="number">0</span>,</span><br><span class="line">  <span class="title class_">DifficultyLow</span> = <span class="number">10</span>,</span><br><span class="line">  <span class="title class_">DifficultyHigh</span> = <span class="number">11</span>,</span><br><span class="line">  <span class="title class_">ViewLow</span> = <span class="number">20</span>,</span><br><span class="line">  <span class="title class_">ViewHigh</span> = <span class="number">21</span>,</span><br><span class="line">  <span class="title class_">Commend</span> = <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询试题请求Url参数数据类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment"> * type:                0或者不传，查询全部 或者类型id</span></span><br><span class="line"><span class="comment"> * sort:                排序,用SortType常量</span></span><br><span class="line"><span class="comment"> * pageSize:            每页大小，为空默认是10</span></span><br><span class="line"><span class="comment"> * page:                当前页数，为空默认是1</span></span><br><span class="line"><span class="comment"> * questionBankType:    9面经10小程序面试题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IGetQuestionListUrlParams</span> &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">questionBankType</span>: <span class="number">9</span> | <span class="number">10</span></span><br><span class="line">  <span class="attr">sort</span>?: <span class="title class_">SortType</span></span><br><span class="line">  <span class="attr">page</span>?: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">pageSize</span>?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>详尽的注释还是挺有必要的……前两天写的代码都需要联系着看才能回想起来了……<br>(回去补了一大堆注释……)</p>
<h5 id="暴露分类biaoqianID接口"><a href="#暴露分类biaoqianID接口" class="headerlink" title="暴露分类biaoqianID接口"></a>暴露分类biaoqianID接口</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Param</span> <span class="meta">@Require</span> <span class="attr">typeId</span>:<span class="built_in">number</span> = -<span class="number">1</span></span><br><span class="line"><span class="meta">@Param</span> <span class="attr">sortType</span>:<span class="title class_">SortType</span> = <span class="title class_">SortType</span>.<span class="property">Default</span></span><br></pre></td></tr></table></figure>
<p>我们需要依据分类标签ID和排序模式来获取试题列表，所以我们需要将这两个参数暴露出去。</p>
<h5 id="发送请求"><a href="#发送请求" class="headerlink" title="发送请求"></a>发送请求</h5><p>在过去我们利用<code>axios</code>发送请求时都是通过在后端文档复制字段名然后填写数据的，但我们定义了参数接口之后，利用<code>as</code>关键字就可以将<code>params</code>转换为指定类型这样就有字段提示了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> req = axiosHttp.<span class="property">request</span>&lt;<span class="title class_">IPageData</span>&lt;<span class="title class_">IQuestionListItem</span>&gt;&gt;(&#123;</span><br><span class="line">  <span class="attr">url</span>:<span class="string">&#x27;/hm/question/list&#x27;</span>,</span><br><span class="line">  <span class="attr">params</span>:&#123;</span><br><span class="line">      </span><br><span class="line">  &#125; <span class="keyword">as</span> <span class="title class_">IGetQuestionListUrlParams</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/53.png" alt="53"></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 触底加载逻辑函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;进入onLoad&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isRefreshing</span> || <span class="variable language_">this</span>.<span class="property">isLoading</span> || <span class="variable language_">this</span>.<span class="property">isFinish</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> axiosHttp.<span class="property">request</span>&lt;<span class="title class_">IPageData</span>&lt;<span class="title class_">IQuestionListItem</span>&gt;&gt;(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/hm/question/list&#x27;</span>,</span><br><span class="line">      <span class="attr">params</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable language_">this</span>.<span class="property">typeId</span>,</span><br><span class="line">        <span class="attr">sort</span>: <span class="variable language_">this</span>.<span class="property">sortType</span>,</span><br><span class="line">        <span class="attr">questionBankType</span>: <span class="number">9</span>,</span><br><span class="line">        <span class="attr">pageSize</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">page</span>: <span class="variable language_">this</span>.<span class="property">currentPageTotalNumber</span></span><br><span class="line">      &#125; <span class="keyword">as</span> <span class="title class_">IGetQuestionListUrlParams</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">QuestionList</span>.<span class="title function_">push</span>(...res.<span class="property">rows</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentPageTotalNumber</span> &gt;= res.<span class="property">pageTotal</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isFinish</span> = <span class="literal">true</span></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currentPageTotalNumber</span>++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但在测试时发现此处代码还有问题。</p>
<p><img src="/2025/02/27/MianShiTong/54.png" alt="54"></p>
<p>列表并没有成功的获取，我们来查看一下日志。</p>
<p><img src="/2025/02/27/MianShiTong/55.png" alt="55"></p>
<p>我们可以看到请求是成功了的，这里也成功的传回了响应值，但不知道为什么是空的，我们进行进一步排查。</p>
<p>……</p>
<p>在仔细排查了代码的问题后发现好像并没有什么问题(乐了……)，于是我们又去看了看文档，发现好像是我们<code>questionBankType</code>字段值填反了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">questionBankType</span>: <span class="number">10</span>,</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/56.png" alt="56"></p>
<p>我们可以看到修改后数据就正常获取了。</p>
<p>enm……还能怎么说呢，认真读文档吧……</p>
<h5 id="下拉刷新逻辑更新"><a href="#下拉刷新逻辑更新" class="headerlink" title="下拉刷新逻辑更新"></a>下拉刷新逻辑更新</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下拉刷新函数</span></span><br><span class="line"><span class="comment"> * 将原数组设为空随后从新获取数据</span></span><br><span class="line"><span class="comment"> * 并将试题列表获取上限标识刷新</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">onRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">  logger.<span class="title function_">debug</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span> + <span class="string">&#x27;进入onRefresh&#x27;</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">true</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">currentPageTotalNumber</span> = <span class="number">1</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">QuestionList</span> = []</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> axiosHttp.<span class="property">request</span>&lt;<span class="title class_">IPageData</span>&lt;<span class="title class_">IQuestionListItem</span>&gt;&gt;(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/hm/question/list&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable language_">this</span>.<span class="property">typeId</span>,</span><br><span class="line">      <span class="attr">sort</span>: <span class="variable language_">this</span>.<span class="property">sortType</span>,</span><br><span class="line">      <span class="attr">questionBankType</span>: <span class="number">10</span>,</span><br><span class="line">      <span class="attr">pageSize</span>: <span class="number">10</span>,</span><br><span class="line">      <span class="attr">page</span>: <span class="variable language_">this</span>.<span class="property">currentPageTotalNumber</span></span><br><span class="line">    &#125; <span class="keyword">as</span> <span class="title class_">IGetQuestionListUrlParams</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">QuestionList</span> = res.<span class="property">rows</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">false</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">isFinish</span> = (<span class="variable language_">this</span>.<span class="property">currentPageTotalNumber</span> &gt;= res.<span class="property">pageTotal</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经测试功能正常。</p>
<h4 id="分类标签半模态弹窗按钮图标"><a href="#分类标签半模态弹窗按钮图标" class="headerlink" title="分类标签半模态弹窗按钮图标"></a>分类标签半模态弹窗按钮图标</h4><p>在试题标签栏右侧会有一个小按钮用于拉起半模态弹窗来快速筛选标签。</p>
<p><img src="/2025/02/27/MianShiTong/57.png" alt="57"></p>
<p>这个图标我们可以通过层叠布局来盖在标签栏上。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Row</span>() &#123;</span><br><span class="line">  <span class="title class_">Image</span>($rawfile(<span class="string">&#x27;ic_home_filter.png&#x27;</span>))</span><br><span class="line">    .<span class="title function_">width</span>(<span class="number">24</span>)</span><br><span class="line">    .<span class="title function_">aspectRatio</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">width</span>(<span class="number">56</span>)</span><br><span class="line">.<span class="title function_">height</span>(<span class="number">44</span>)</span><br><span class="line">.<span class="title function_">linearGradient</span>(&#123;</span><br><span class="line">  <span class="attr">angle</span>: <span class="number">90</span>,</span><br><span class="line">  <span class="attr">colors</span>: [[<span class="string">&#x27;#00ffffff&#x27;</span>, <span class="number">0</span>], [<span class="string">&#x27;#ffffff&#x27;</span>, <span class="number">0.285</span>]]</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br></pre></td></tr></table></figure>
<p>通过添加白色到透明色的渐变过度就可以做到让整个分类标签列表像是缓慢浮现出来一样的效果。</p>
<video width="100%" controls>
  <source src="58.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<h5 id="半模态弹窗主体"><a href="#半模态弹窗主体" class="headerlink" title="半模态弹窗主体"></a>半模态弹窗主体</h5><p>半模态的UI布局还是相对来说很简单的这里就不过多讲解了，我们重点来说逻辑部分。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Text</span>(<span class="string">&#x27;题目排序&#x27;</span>)</span><br><span class="line">  .<span class="title function_">textTitle</span>()</span><br><span class="line"><span class="comment">// TODO 筛选按钮</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Text</span>(<span class="string">&#x27;选择分类&#x27;</span>)</span><br><span class="line">  .<span class="title function_">textTitle</span>()</span><br><span class="line"><span class="comment">// TODO 筛选按钮</span></span><br></pre></td></tr></table></figure>
<p>现在的核心任务就是完成排序和分类的筛选。</p>
<h5 id="筛选按钮组件封装"><a href="#筛选按钮组件封装" class="headerlink" title="筛选按钮组件封装"></a>筛选按钮组件封装</h5><p>在筛选半模态页面中，每个按钮我们都应当封装成一个组件，因为它内部还包括了其他的逻辑，以及依据数据的不同提示出不同的脚标以及UI，不能单纯的使用<code>Button</code>组件来进行渲染。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页标签筛选半模态单个按钮组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>:&#123;</span></span><br><span class="line"><span class="comment"> *   text:标签文字</span></span><br><span class="line"><span class="comment"> *   isNew:是否显示new脚标</span></span><br><span class="line"><span class="comment"> *   isSort:是否显示排序上下箭头</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">FilterButton</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">text</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">isNew</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">isSort</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">text</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">12</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.black&#x27;</span>))</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isNew</span>) &#123;</span><br><span class="line">        <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.ic_home_new&#x27;</span>))</span><br><span class="line">          .<span class="title function_">width</span>(<span class="number">32</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">14</span>)</span><br><span class="line">          .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Contain</span>)</span><br><span class="line">          .<span class="title function_">position</span>(&#123; <span class="attr">right</span>: -<span class="number">26</span>, <span class="attr">top</span>: -<span class="number">7</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isSort</span>) &#123;</span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="title class_">Image</span>($r(<span class="string">&#x27;sys.media.ohos_ic_public_arrow_up&#x27;</span>))</span><br><span class="line">            .<span class="title function_">size</span>(&#123; <span class="attr">width</span>: <span class="number">12</span>, <span class="attr">height</span>: <span class="number">6</span> &#125;)</span><br><span class="line">          <span class="title class_">Image</span>($r(<span class="string">&#x27;sys.media.ohos_ic_public_arrow_down&#x27;</span>))</span><br><span class="line">            .<span class="title function_">size</span>(&#123; <span class="attr">width</span>: <span class="number">12</span>, <span class="attr">height</span>: <span class="number">6</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: -<span class="number">0.5</span>, <span class="attr">left</span>: <span class="number">2</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="number">30</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">10</span>, <span class="attr">right</span>: <span class="number">10</span> &#125;)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.common_gray_bg&#x27;</span>))</span><br><span class="line">    .<span class="title function_">borderRadius</span>(<span class="number">4</span>)</span><br><span class="line">    .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">12</span>, <span class="attr">right</span>: <span class="variable language_">this</span>.<span class="property">isNew</span> ? <span class="number">26</span> : <span class="number">10</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的上下排序箭头我们直接使用系统自带图标即可。<br>此时我们就可以利用封装好的组件来进行渲染了。</p>
<h4 id="半模态筛选按钮渲染"><a href="#半模态筛选按钮渲染" class="headerlink" title="半模态筛选按钮渲染"></a>半模态筛选按钮渲染</h4><p>我们回到半模态<code>Builder</code>中采用<code>Flex</code>弹性布局来实现自动换行效果。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO 筛选按钮</span></span><br><span class="line"><span class="title class_">Flex</span>(&#123;<span class="attr">wrap</span>:<span class="title class_">FlexWrap</span>.<span class="property">Wrap</span>&#125;)&#123;</span><br><span class="line">  <span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">    <span class="attr">text</span>:<span class="string">&#x27;默认&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">    <span class="attr">text</span>:<span class="string">&#x27;浏览量&#x27;</span>,</span><br><span class="line">    <span class="attr">isNew</span>:<span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">    <span class="attr">text</span>:<span class="string">&#x27;排序&#x27;</span>,</span><br><span class="line">    <span class="attr">isSort</span>:<span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">    <span class="attr">text</span>:<span class="string">&#x27;默认&#x27;</span>,</span><br><span class="line">    <span class="attr">isNew</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">isSort</span>:<span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/59.jpg" alt="59"></p>
<p>由此我们可以看到我们可以很轻松的控制每个按钮的样式。</p>
<p>然后对于分类选择栏的数据我们就可以直接沿用上面已经通过网络请求获取的问题类型列表来进行渲染和测试。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123;</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">questionTabBarList</span>, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="title class_">IQuestionTabBarType</span>, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">      <span class="attr">text</span>: item.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">isNew</span>: item.<span class="property">displayNewestFlag</span> == <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/27/MianShiTong/60.jpg" alt="60"></p>
<h4 id="半模态筛选按钮点击事件"><a href="#半模态筛选按钮点击事件" class="headerlink" title="半模态筛选按钮点击事件"></a>半模态筛选按钮点击事件</h4><h5 id="类型筛选按钮"><a href="#类型筛选按钮" class="headerlink" title="类型筛选按钮"></a>类型筛选按钮</h5><p>以上暴露的变量接口仅仅是为了方便UI的渲染还没有实现逻辑上的切换功能，而为了标明选中状态我们还需要再暴露一个变量接口<code>isSelected</code>。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Param</span> <span class="attr">isSelected</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">.<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">isSelected</span> ? $r(<span class="string">&#x27;app.color.common_main_color&#x27;</span>) : $r(<span class="string">&#x27;app.color.black&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>然后在首页问题列表的下半区组件中再添加一个变量用于标明被选中的标签ID，随后在半模态中通过点击事件来改变这个变量的值。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Local</span> <span class="attr">filterSelectedIndex</span>: <span class="built_in">number</span> = -<span class="number">1</span></span><br><span class="line"><span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">  <span class="attr">text</span>: item.<span class="property">name</span>,</span><br><span class="line">  <span class="attr">isNew</span>: item.<span class="property">displayNewestFlag</span> == <span class="number">1</span>,</span><br><span class="line">  <span class="attr">isSelected</span>: <span class="variable language_">this</span>.<span class="property">filterSelectedIndex</span> === i</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">filterSelectedIndex</span> = i</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h5 id="排序筛选按钮"><a href="#排序筛选按钮" class="headerlink" title="排序筛选按钮"></a>排序筛选按钮</h5><p>首先我们先考虑默认和推荐两种排序方式，因为这两种方式最简单，观看量和难度都有<strong>正逆序</strong>需要考虑我们后面再说。<br>我们需要依赖于之前定义的枚举类型<code>SortType</code>来进行排序。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Local</span> <span class="attr">filterSortType</span>: <span class="title class_">SortType</span> = <span class="title class_">SortType</span>.<span class="property">Default</span> <span class="comment">//高亮显示当前的排序方式</span></span><br><span class="line"><span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&#x27;默认&#x27;</span>,</span><br><span class="line">  <span class="attr">isSelected</span>: <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">Default</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">filterSortType</span> = <span class="title class_">SortType</span>.<span class="property">Default</span></span><br><span class="line">  &#125;)</span><br><span class="line"><span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&#x27;浏览量&#x27;</span>,</span><br><span class="line">  <span class="attr">isSort</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">isSelected</span>: <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">ViewLow</span> || <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">ViewHigh</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&#x27;难度&#x27;</span>,</span><br><span class="line">  <span class="attr">isSort</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">isSelected</span>: <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">DifficultyLow</span> || <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">DifficultyHigh</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&#x27;推荐&#x27;</span>,</span><br><span class="line">  <span class="attr">isSelected</span>: <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">Commend</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">filterSortType</span> = <span class="title class_">SortType</span>.<span class="property">Commend</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>利用<code>filterSortType</code>变量来标志当前选中的排序方式。</p>
<video width="100%" controls>
  <source src="61.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>再配合上日志信息我们可以看到排序方式已经成功的切换了。</p>
<p><img src="/2025/02/27/MianShiTong/62.png" alt="62"></p>
<h5 id="正逆序的实现"><a href="#正逆序的实现" class="headerlink" title="正逆序的实现"></a>正逆序的实现</h5><p>首先我们在<code>FilterButton</code>是预留了正逆序的上下箭头的，而这个箭头是<code>svg</code>图标，可以通过<code>fillColor</code>属性来调整图标颜色。</p>
<p>我们可以直接<strong>分类判断难度和观看量的正逆序</strong>来高亮显示，但那样还是比较<strong>冗余</strong>，我们可以用更简单的方式，不过这就需要我们善于观察并<strong>发现规律</strong>了。</p>
<p><img src="/2025/02/27/MianShiTong/63.png" alt="63"></p>
<p>我们通过观察可以看出两者正逆序代表的数字<strong>奇偶性一致</strong>，这样我们就可以通过<strong>判断奇偶</strong>来统一的管理正逆序。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Image</span>($r(<span class="string">&#x27;sys.media.ohos_ic_public_arrow_up&#x27;</span>))</span><br><span class="line">  .<span class="title function_">size</span>(&#123; <span class="attr">width</span>: <span class="number">12</span>, <span class="attr">height</span>: <span class="number">6</span> &#125;)</span><br><span class="line">  .<span class="title function_">fillColor</span>(<span class="variable language_">this</span>.<span class="property">isSelected</span> &amp;&amp; (<span class="variable language_">this</span>.<span class="property">sortType</span> % <span class="number">2</span> === <span class="number">1</span>) ? $r(<span class="string">&#x27;app.color.common_main_color&#x27;</span>) :</span><br><span class="line">  $r(<span class="string">&#x27;app.color.black&#x27;</span>))</span><br><span class="line"><span class="title class_">Image</span>($r(<span class="string">&#x27;sys.media.ohos_ic_public_arrow_down&#x27;</span>))</span><br><span class="line">  .<span class="title function_">size</span>(&#123; <span class="attr">width</span>: <span class="number">12</span>, <span class="attr">height</span>: <span class="number">6</span> &#125;)</span><br><span class="line">  .<span class="title function_">fillColor</span>(<span class="variable language_">this</span>.<span class="property">isSelected</span> &amp;&amp; (<span class="variable language_">this</span>.<span class="property">sortType</span> % <span class="number">2</span> === <span class="number">0</span>) ? $r(<span class="string">&#x27;app.color.common_main_color&#x27;</span>) :</span><br><span class="line">  $r(<span class="string">&#x27;app.color.black&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>对于点击事件我们需要进行判断，首先是判断是否已经是<strong>选中高亮状态</strong>，其次是判断当前是<strong>升序还是降序</strong>，然后进行切换。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&#x27;浏览量&#x27;</span>,</span><br><span class="line">  <span class="attr">isSort</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">isSelected</span>: <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">ViewLow</span> || <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">ViewHigh</span>,</span><br><span class="line">  <span class="attr">sortType</span>: <span class="variable language_">this</span>.<span class="property">filterSortType</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//如果已经是高亮状态就上下箭头切换</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">filterSortType</span> == <span class="title class_">SortType</span>.<span class="property">ViewLow</span> || <span class="variable language_">this</span>.<span class="property">filterSortType</span> == <span class="title class_">SortType</span>.<span class="property">ViewHigh</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">filterSortType</span> = <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">ViewLow</span> ? <span class="title class_">SortType</span>.<span class="property">ViewHigh</span> : <span class="title class_">SortType</span>.<span class="property">ViewLow</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//若不是高亮状态则设为高亮</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">filterSortType</span> = <span class="title class_">SortType</span>.<span class="property">ViewLow</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="title class_">FilterButton</span>(&#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&#x27;难度&#x27;</span>,</span><br><span class="line">  <span class="attr">isSort</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">isSelected</span>: <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">DifficultyLow</span> || <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">DifficultyHigh</span>,</span><br><span class="line">  <span class="attr">sortType</span>: <span class="variable language_">this</span>.<span class="property">filterSortType</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//如果已经是高亮状态就上下箭头切换</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">filterSortType</span> == <span class="title class_">SortType</span>.<span class="property">DifficultyLow</span> || <span class="variable language_">this</span>.<span class="property">filterSortType</span> == <span class="title class_">SortType</span>.<span class="property">DifficultyHigh</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">filterSortType</span> =</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">DifficultyLow</span> ? <span class="title class_">SortType</span>.<span class="property">DifficultyHigh</span> : <span class="title class_">SortType</span>.<span class="property">DifficultyLow</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//若不是高亮状态则设为高亮</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">filterSortType</span> = <span class="title class_">SortType</span>.<span class="property">DifficultyLow</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>这里面的判断赋值代码看着有点奇怪，但这也是巧妙利用三元运算符来简化<code>ifelse</code>语句嵌套的一种方式。</p>
<video width="100%" controls>
  <source src="64.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>这样我们就完成了正逆序的切换。</p>
<h5 id="正逆序逻辑优化"><a href="#正逆序逻辑优化" class="headerlink" title="正逆序逻辑优化"></a>正逆序逻辑优化</h5><p>在仔细分析了上面的代码后，我发现其实还是有优化的余地的。</p>
<p>我们的第一步是判断他是否是高亮状态，也就是说在四种正逆序的可能中，有两种情况是<strong>非高亮状态</strong>，有两种情况是<strong>高亮状态</strong>。<br>但这两种非高亮状态恰好包含在了判断是否为制定变量的正逆序的三种假情况中。</p>
<p>比如说：当我们当前是<strong>浏览量的正序</strong>时，第一步代码判断出的<strong>假</strong>情况有<strong>难度的正逆序</strong>两种，而在第二步判断是否为<strong>浏览量的正序</strong>时，假的情况有三种：<strong>难度的正逆序和浏览量的逆序</strong>恰好包含了第一步所判断出的情况，说明我们<strong>没有必要去进行第一步判断</strong>，直接进行第二步的三元判断赋值即可。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">filterSortType</span> = <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">ViewLow</span> ? <span class="title class_">SortType</span>.<span class="property">ViewHigh</span> : <span class="title class_">SortType</span>.<span class="property">ViewLow</span></span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">filterSortType</span> =</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">filterSortType</span> === <span class="title class_">SortType</span>.<span class="property">DifficultyLow</span> ? <span class="title class_">SortType</span>.<span class="property">DifficultyHigh</span> : <span class="title class_">SortType</span>.<span class="property">DifficultyLow</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>经过测试，结果与我们推测的一样，正逆序切换到效果一致，代码也更加简洁了。</p>
<h4 id="半模态完成按钮点击事件"><a href="#半模态完成按钮点击事件" class="headerlink" title="半模态完成按钮点击事件"></a>半模态完成按钮点击事件</h4><p>对于半模态的完成按钮，我们首先需要在点击时将我们选中的排序方式和试题类型回传到首页状态变量后再关闭半模态。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Text</span>(<span class="string">&#x27;完成&#x27;</span>)</span><br><span class="line">  .<span class="title function_">fontWeight</span>(<span class="number">500</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">  .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.common_main_color&#x27;</span>))</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="variable constant_">HOME_CATEGORY_LOG_TAG</span> + <span class="string">&#x27;完成按钮被点击&#x27;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">activeIndex</span> = <span class="variable language_">this</span>.<span class="property">filterSelectedIndex</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sort</span> = <span class="variable language_">this</span>.<span class="property">filterSortType</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">filterSheetIsShow</span> = <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>但这个逻辑看起来似乎没错，但在测试中我们发现遗漏了一个很重要的点。</p>
<video width="100%" controls>
  <source src="65.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>正如上面视频所示，我们的<code>TabBar</code>虽然切换过来了，但<code>TabContent</code>并没有跟着进行数据更新。<br>这是因为<code>Tabs</code>的<code>onChange</code>函数并非是双向绑定，这就导致来了我们直接操作<code>TabBar</code>的状态变量，而<code>TabContent</code>却没有进行响应。</p>
<p>我们可以通过在<code>Tabs</code>组件的参数中强行规定<code>Tabs</code>的状态变量，这样才能通过改变状态变量来实现对问题列表内容改变的映射。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tabs</span>(&#123;<span class="attr">index</span>:$$this.<span class="property">activeIndex</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>我们将<code>onChange</code>函数删除，改为利用双向绑定传参的方式来实现对<code>TabContent</code>的映射。</p>
<video width="100%" controls>
  <source src="66.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>测试后功能正常。</p>
<p>随后我们将当前获取到的排序方式传入列表组件中，监听排序方式的改变，并重新执行刷新函数就可以实现排序方式的改变了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Monitor</span>(<span class="string">&#x27;sortType&#x27;</span>)</span><br><span class="line"><span class="title function_">onSortType</span>(<span class="params"></span>)&#123;</span><br><span class="line">  logger.<span class="title function_">warn</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span>+<span class="string">&#x27;检测到排序类型变换，即将更新typeId=&#x27;</span>+<span class="variable language_">this</span>.<span class="property">typeId</span>+<span class="string">&#x27;的列表数据&#x27;</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">onRefresh</span>()</span><br><span class="line">  logger.<span class="title function_">warn</span>(<span class="variable constant_">QUESTION_LIST_COMP_TAG</span>+<span class="string">&#x27;当前排序类型为:&#x27;</span>+<span class="variable language_">this</span>.<span class="property">sortType</span>.<span class="title function_">toString</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="半模态重置按钮点击事件"><a href="#半模态重置按钮点击事件" class="headerlink" title="半模态重置按钮点击事件"></a>半模态重置按钮点击事件</h4><p>这个就很简单了，直接重置所有的状态变量即可。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">resetFilterStates</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">filterSelectedIndex</span> = -<span class="number">1</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">filterSortType</span> = <span class="title class_">SortType</span>.<span class="property">Default</span></span><br><span class="line">  logger.<span class="title function_">warn</span>(<span class="variable constant_">HOME_CATEGORY_LOG_TAG</span> + <span class="string">&#x27;已经重置筛选半模态&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="细节优化"><a href="#细节优化" class="headerlink" title="细节优化"></a>细节优化</h4><p>现在我们虽然实现了半模态筛选对<code>TabBar</code>的映射，但是我们点击<code>TabBar</code>的选项时，半模态中的默认值并没有改变，这很显然是不符合直觉的。</p>
<video width="100%" controls>
  <source src="67.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>在监听函数中添加同步代码或是在<code>onChange</code>函数中添加同步代码都可以实现这个功能。</p>
<h3 id="首页骨架屏效果-可入建立的性能优化小点"><a href="#首页骨架屏效果-可入建立的性能优化小点" class="headerlink" title="首页骨架屏效果(可入建立的性能优化小点)"></a>首页骨架屏效果(可入建立的性能优化小点)</h3><p>骨架屏这个东西还是挺常见的，是一种用于替换加载动画的的效果，它可以在加载数据时显示一个占位的页面，让用户知道数据正在加载中。</p>
<p><img src="/2025/02/27/MianShiTong/68.jpg" alt="68"></p>
<p>饿了吗的骨架屏效果就是很典型的客户端骨架屏效果。</p>
<p>关于为什么要用骨架屏效果，我们可以参考github上的这段话：</p>
<p><img src="/2025/02/27/MianShiTong/69.png" alt="69"></p>
<p><strong>用户不喜欢看到白屏</strong>，骨架屏会让用户感到数据马上就会出现在眼前，虽然只是心里安慰，但却依旧可以有效的<strong>提升用户体验</strong>。</p>
<h4 id="骨架屏组件的封装"><a href="#骨架屏组件的封装" class="headerlink" title="骨架屏组件的封装"></a>骨架屏组件的封装</h4><p>首先这属于通用组件所以我们要在<code>components</code>文件夹下新建一个<code>Skeleton</code>文件夹，然后在该文件夹里面去进行封装。</p>
<p>首先骨架是分为两种组件，一种是单个小灰色块，另一种则是包含了动画效果以及UI自定义布局接口的大组件。</p>
<h5 id="单个小灰色块"><a href="#单个小灰色块" class="headerlink" title="单个小灰色块"></a>单个小灰色块</h5><p>首先我们新建一个<code>HcSkeletonItem</code>组件，然后在该组件中定义一个<code>widthValue</code>的样式变量，用于定义小灰色块的大小。<br>它的变量类型是<code>Length</code>我们平常在写长宽时既可以写数字也可以写字符串，这个类型就是<code>Length</code>类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">HcSkeletonItem</span> &#123;</span><br><span class="line">  <span class="meta">@Param</span> <span class="attr">widthValue</span>: <span class="title class_">Length</span> = <span class="string">&#x27;100%&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Text</span>()</span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">16</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">widthValue</span>)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">2</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.common_gray_bg&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="骨架屏组件"><a href="#骨架屏组件" class="headerlink" title="骨架屏组件"></a>骨架屏组件</h5><p>然后我们新建一个<code>HcSkeleton</code>组件，由于该通用组件的适用范围广泛，我们需要去利用<code>@BuilderParam</code>来进行UI自定义的接口暴露。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentV2</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">HcSkeleton</span> &#123;</span><br><span class="line">  <span class="meta">@Local</span> <span class="attr">opacityValue</span>: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title function_">defaultBuilder</span>(<span class="params"></span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@BuilderParam</span></span><br><span class="line">  <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span> = <span class="variable language_">this</span>.<span class="property">defaultBuilder</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">15</span> &#125;) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">default</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">opacity</span>(<span class="variable language_">this</span>.<span class="property">opacityValue</span>)</span><br><span class="line">    .<span class="title function_">animation</span>(&#123;</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">600</span>,</span><br><span class="line">      <span class="attr">playMode</span>: <span class="title class_">PlayMode</span>.<span class="property">Alternate</span>,</span><br><span class="line">      <span class="attr">iterations</span>: -<span class="number">1</span>,</span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseInOut</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">onAppear</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">opacityValue</span> = <span class="number">0.5</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="note info flat"><p>这里还要复习一个重要的知识点在于，单个和多个<code>@BuilderParam</code>传参方式上是有区别的，当只有一个时，我们只需要在调用该自定义组件时利用<strong>尾随闭包</strong>的方式进行传参即可，也就是所谓的<strong>包含子组件</strong>，而当存在多个时我们则需要在调用时通过键值对传参的形式来传入。</p>
</div>
<p>而在当前组件中是单个的，所以我们只需要在调用时利用<strong>尾随闭包</strong>的方式进行传参即可。</p>
<p>这里的动画效果是为了模拟呼吸灯的效果。<br>整体实现的逻辑有以下几步：</p>
<ol>
<li>定义状态变量<code>opacityValue</code>，用于控制透明度。</li>
<li>为展示区域添加动画效果，单次播放时长为<code>600ms</code>。</li>
<li>但很显然，在网络不好的情况下，加载动画不能只播放<code>600ms</code>后就停止，所以我们需要设置动画的播放次数为无限次。</li>
<li>随后为了防止在单次播放结束后透明度突然跳帧到1，我们需要设置循环播放动画模式<code>PlayMode.Alternate</code>。</li>
<li>最后，为了模拟呼吸灯的效果，我们需要设置动画的播放曲线为<code>Curve.EaseInOut</code>。</li>
</ol>
<h4 id="骨架屏效果实现"><a href="#骨架屏效果实现" class="headerlink" title="骨架屏效果实现"></a>骨架屏效果实现</h4><p>首先我们来思考一下骨架需要在哪些地方使用。</p>
<p>问题分类栏和问题列表是需求量最大的地方，轮播图的话目前是直接内嵌在程序里的所以暂时不需要添加骨架。<br>而整个问题列表区域加载都是在<code>HomeCategory</code>组件的<code>aboutToAppear</code>生命周期函数中完成的，所以我们就需要在<code>aboutToAppear</code>生命周期函数中控制我们骨架的显示。</p>
<p>为了防止骨架代码的添加导致整体代码可读性变差，我们将其封装为一个<code>Builder</code>。</p>
<h5 id="测试骨架屏效果"><a href="#测试骨架屏效果" class="headerlink" title="测试骨架屏效果"></a>测试骨架屏效果</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="title class_">HcSkeleton</span>() &#123;</span><br><span class="line">  <span class="title class_">HcSkeleton</span>() &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">HcSkeletonItem</span>(&#123; <span class="attr">widthValue</span>: <span class="string">&#x27;20%&#x27;</span> &#125;)</span><br><span class="line">        <span class="title class_">HcSkeletonItem</span>(&#123; <span class="attr">widthValue</span>: <span class="string">&#x27;13%&#x27;</span> &#125;)</span><br><span class="line">        <span class="title class_">HcSkeletonItem</span>(&#123; <span class="attr">widthValue</span>: <span class="string">&#x27;16%&#x27;</span> &#125;)</span><br><span class="line">        <span class="title class_">HcSkeletonItem</span>(&#123; <span class="attr">widthValue</span>: <span class="string">&#x27;18%&#x27;</span> &#125;)</span><br><span class="line">        <span class="title class_">HcSkeletonItem</span>(&#123; <span class="attr">widthValue</span>: <span class="string">&#x27;13%&#x27;</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: <span class="number">10</span> &#125;), <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>(&#123;<span class="attr">space</span>:<span class="number">10</span>&#125;) &#123;</span><br><span class="line">              <span class="title class_">HcSkeletonItem</span>(&#123; <span class="attr">widthValue</span>: <span class="string">&#x27;30%&#x27;</span> &#125;)</span><br><span class="line">              <span class="title class_">HcSkeletonItem</span>(&#123; <span class="attr">widthValue</span>: <span class="string">&#x27;58%&#x27;</span> &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>)</span><br><span class="line">      .<span class="title function_">edgeEffect</span>(<span class="title class_">EdgeEffect</span>.<span class="property">None</span>)</span><br><span class="line">      .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)</span><br><span class="line">      .<span class="title function_">divider</span>(&#123;</span><br><span class="line">        <span class="attr">strokeWidth</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">color</span>: $r(<span class="string">&#x27;app.color.common_gray_border&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断是否显示骨架</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isLoading</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title class_">HcSkeleton</span>()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<video width="100%" controls>
  <source src="70.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>这里我们为了延长骨架屏的效果暂时将加载结束的标识取消了。<br>可以看到整体效果还是很理想的，复刻了有数据时的UI形状，这样就可以实现了骨架屏的效果了。</p>
<video width="100%" controls>
  <source src="71.mp4" type="video/mp4">
  您的浏览器不支持视频标签。
</video>

<p>短短一瞬间的骨架屏也可以看出来我们的校园网还是可以的。</p>
<p>至此首页也就做完了！！！</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/XBXyftx">XBXyftx</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://xbxyftx.top">https://xbxyftx.top</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">此文章版权归XBXyftx所有，如有转载，请註明来自原作者</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%B8%BF%E8%92%99/">鸿蒙</a><a class="post-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF%E5%90%91/">技术向</a><a class="post-meta__tags" href="/tags/V2/">V2</a><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE/">项目</a></div><div class="post-share"><div class="social-share" data-image="/img/ArticleTopImgs/MSTTopImg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/02/19/%E9%B8%BF%E8%92%99%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/" title="鸿蒙图片上传下载"><img class="cover" src="/img/ArticleTopImgs/ImgTopImg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">鸿蒙图片上传下载</div></div><div class="info-2"><div class="info-item-1">鸿蒙图片上传下载的方式</div></div></div></a><a class="pagination-related" href="/2025/03/11/MianShiTong2/" title="面试通项目开发笔记2"><img class="cover" src="/img/ArticleTopImgs/MSTTopImg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">面试通项目开发笔记2</div></div><div class="info-2"><div class="info-item-1">面试通项目开发笔记2（暂时停更）</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/03/31/%E2%80%9CHongXiaoYi%E2%80%9D/" title="鸿小易项目开发笔记"><img class="cover" src="/img/ArticleTopImgs/hxyTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-31</div><div class="info-item-2">鸿小易项目开发笔记</div></div><div class="info-2"><div class="info-item-1">鸿小易，你的鸿蒙开发好帮手。</div></div></div></a><a class="pagination-related" href="/2025/03/11/MianShiTong2/" title="面试通项目开发笔记2"><img class="cover" src="/img/ArticleTopImgs/MSTTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-11</div><div class="info-item-2">面试通项目开发笔记2</div></div><div class="info-2"><div class="info-item-1">面试通项目开发笔记2（暂时停更）</div></div></div></a><a class="pagination-related" href="/2025/02/08/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="我的书架项目笔记"><img class="cover" src="/img/ArticleTopImgs/BookShelfTopImg.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-08</div><div class="info-item-2">我的书架项目笔记</div></div><div class="info-2"><div class="info-item-1">一个对利用NetWork Kit发送HTTP请求的实战练习项目</div></div></div></a><a class="pagination-related" href="/2025/05/14/AccountKitTest/" title="华为账户一键登录功能测试"><img class="cover" src="/img/ArticleTopImgs/AccountTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">华为账户一键登录功能测试</div></div><div class="info-2"><div class="info-item-1">Account Kit的官方demo测试与华为账户登录的功能实现分析。</div></div></div></a><a class="pagination-related" href="/2025/03/16/yiDuo/" title="关于鸿蒙的一多能力"><img class="cover" src="/img/ArticleTopImgs/yiduoTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-16</div><div class="info-item-2">关于鸿蒙的一多能力</div></div><div class="info-2"><div class="info-item-1">一多能力的学习笔记</div></div></div></a><a class="pagination-related" href="/2025/03/13/Navigation/" title="Navigation与NavDestination"><img class="cover" src="/img/ArticleTopImgs/NavTopImg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-13</div><div class="info-item-2">Navigation与NavDestination</div></div><div class="info-2"><div class="info-item-1">本文将介绍Navigation与NavDestination的使用方法。</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">XBXyftx</div><div class="author-info-description">博安千古情如此，璇玉如华自醉从</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/XBXyftx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/XBXyftx" target="_blank" title="Github"><i class="fab fa-github" style="color: #c3ffff;"></i></a><a class="social-icon" href="mailto:shuaixbx02@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="/img/wechat.png" target="_blank" title="WeChat"><i class="fa-brands fa-weixin" style="color: #7bb342;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">ICP备案完成！xbxyftx.top正式恢复运营！！！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">项目简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E9%98%B6%E6%AE%B5"><span class="toc-number">3.</span> <span class="toc-text">准备阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE%E4%B8%8E%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E6%90%AD%E5%BB%BA"><span class="toc-number">3.1.</span> <span class="toc-text">新建项目与项目结构搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E6%90%AD%E5%BB%BA"><span class="toc-number">3.1.1.</span> <span class="toc-text">项目结构搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.2.</span> <span class="toc-text">项目资源配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A2%9C%E8%89%B2%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">颜色配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">图片资源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9B%BE%E6%A0%87"><span class="toc-number">3.1.2.3.</span> <span class="toc-text">应用图标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%90%8D%E7%A7%B0"><span class="toc-number">3.1.2.4.</span> <span class="toc-text">应用名称</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BA%94%E7%94%A8%E4%B8%8E%E5%85%83%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%9B%BE%E6%A0%87%E5%92%8C%E5%90%8D%E7%A7%B0"><span class="toc-number">3.1.2.5.</span> <span class="toc-text">设置应用与元服务的图标和名称</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAgit%E5%92%8C%E6%9C%AC%E5%9C%B0%E4%BB%A5%E5%8F%8A%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93"><span class="toc-number">3.2.</span> <span class="toc-text">创建git和本地以及远程仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hilog%E6%97%A5%E5%BF%97"><span class="toc-number">3.3.</span> <span class="toc-text">hilog日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85Logger"><span class="toc-number">3.4.</span> <span class="toc-text">封装Logger</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85-commons-utils-Logger-ets"><span class="toc-number">3.4.1.</span> <span class="toc-text">封装 commons&#x2F;utils&#x2F;Logger.ets</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E4%B8%8E%E4%BD%BF%E7%94%A8Logger"><span class="toc-number">3.4.2.</span> <span class="toc-text">导出与使用Logger</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E6%B2%89%E6%B5%B8%E5%BC%8F%E5%B7%A5%E5%85%B7"><span class="toc-number">3.5.</span> <span class="toc-text">封装沉浸式工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">3.5.1.</span> <span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%B2%89%E6%B5%B8%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.5.2.</span> <span class="toc-text">开启沉浸模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.5.2.1.</span> <span class="toc-text">应用上下文对象</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B1%8F%E5%B9%95%E5%B0%BA%E5%AF%B8"><span class="toc-number">3.5.3.</span> <span class="toc-text">获取屏幕尺寸</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AppStorageV2%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E9%97%AE%E9%A2%98"><span class="toc-number">3.5.3.1.</span> <span class="toc-text">AppStorageV2数据存储问题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E9%97%B4%E9%97%AE%E9%A2%98"><span class="toc-number">3.5.3.2.</span> <span class="toc-text">初始化时间问题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E9%97%B4%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">3.5.3.3.</span> <span class="toc-text">初始化时间问题解决方案</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E6%B2%89%E6%B5%B8%E5%BC%8F%E5%87%BD%E6%95%B0"><span class="toc-number">3.5.4.</span> <span class="toc-text">关闭沉浸式函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E7%8A%B6%E6%80%81%E6%A0%8F%E5%B7%A5%E5%85%B7"><span class="toc-number">3.6.</span> <span class="toc-text">封装状态栏工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%8A%B6%E6%80%81%E6%A0%8F%E5%87%BD%E6%95%B0"><span class="toc-number">3.6.1.</span> <span class="toc-text">设置状态栏函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%8A%9F%E8%83%BD"><span class="toc-number">3.6.1.1.</span> <span class="toc-text">测试功能</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%BC%8F%E5%86%85%E5%AE%B9%E9%98%B6%E6%AE%B5"><span class="toc-number">4.</span> <span class="toc-text">正式内容阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E6%A8%A1%E5%9D%97"><span class="toc-number">4.1.</span> <span class="toc-text">首页模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E5%B8%83%E5%B1%80"><span class="toc-number">4.1.1.</span> <span class="toc-text">首页布局</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tabs"><span class="toc-number">4.1.2.</span> <span class="toc-text">tabs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E6%A0%8F%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.3.</span> <span class="toc-text">搜索栏组件封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8D%A1%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.4.</span> <span class="toc-text">打卡组件封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AE%E6%92%AD%E5%9B%BE%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.5.</span> <span class="toc-text">轮播图组件封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E9%A2%98%E5%88%86%E7%BB%84%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.6.</span> <span class="toc-text">试题分组组件封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E9%A2%98%E6%A0%87%E7%AD%BE%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.7.</span> <span class="toc-text">试题标签组件封装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">4.1.7.1.</span> <span class="toc-text">数据接口定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UI%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.7.2.</span> <span class="toc-text">UI封装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">4.1.7.3.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E9%A2%98%E5%88%97%E8%A1%A8Item%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.8.</span> <span class="toc-text">试题列表Item组件封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E8%AF%95%E9%A2%98%E5%88%97%E8%A1%A8%E6%B8%B2%E6%9F%93"><span class="toc-number">4.1.9.</span> <span class="toc-text">完成试题列表渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%95%E9%A2%98%E5%88%97%E8%A1%A8%E4%BF%A1%E6%81%AF%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">4.1.9.1.</span> <span class="toc-text">试题列表信息数据接口定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.1.9.2.</span> <span class="toc-text">适配数据接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95UI%E6%98%BE%E7%A4%BA"><span class="toc-number">4.1.9.3.</span> <span class="toc-text">测试UI显示</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.1.10.</span> <span class="toc-text">问题列表组件封装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-number">4.1.10.1.</span> <span class="toc-text">下拉刷新功能测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8A%E6%8B%89%E5%8A%A0%E8%BD%BDBuilder%E5%B0%81%E8%A3%85%E4%B8%8E%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-number">4.1.10.2.</span> <span class="toc-text">上拉加载Builder封装与功能测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0%E7%9A%84%E6%95%B0%E7%BB%84%E6%95%B0%E6%8D%AE%E9%87%8D%E7%BD%AE"><span class="toc-number">4.1.10.3.</span> <span class="toc-text">下拉刷新的数组数据重置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E7%BD%91%E7%BB%9C%E4%BA%A4%E4%BA%92"><span class="toc-number">4.2.</span> <span class="toc-text">首页网络交互</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BDaxios"><span class="toc-number">4.2.1.</span> <span class="toc-text">下载axios</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85Axios%E8%AF%B7%E6%B1%82%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.2.2.</span> <span class="toc-text">封装Axios请求实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85Axios%E7%9B%B8%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">4.2.3.</span> <span class="toc-text">封装Axios相应拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%E5%9F%BA%E7%A1%80%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">响应拦截器基础结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.3.2.</span> <span class="toc-text">响应拦截器具体实现</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85AxiosHttp%E7%B1%BB"><span class="toc-number">4.2.4.</span> <span class="toc-text">封装AxiosHttp类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8AxiosHttp%E7%B1%BB%E8%8E%B7%E5%8F%96%E9%97%AE%E9%A2%98%E5%88%86%E7%BB%84%E6%A0%87%E7%AD%BE%E5%88%97%E8%A1%A8"><span class="toc-number">4.2.5.</span> <span class="toc-text">利用AxiosHttp类获取问题分组标签列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E8%AF%B7%E6%B1%82%E7%A0%81%E5%88%A4%E6%96%AD"><span class="toc-number">4.2.6.</span> <span class="toc-text">响应请求码判断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E9%97%AE%E9%A2%98%E5%88%97%E8%A1%A8%E7%9A%84%E5%AE%8C%E6%95%B4%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.3.</span> <span class="toc-text">首页问题列表的完整功能实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96%E8%AF%95%E9%A2%98%E5%88%97%E8%A1%A8"><span class="toc-number">4.3.1.</span> <span class="toc-text">动态获取试题列表</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%90%8E%E7%AB%AF%E6%96%87%E6%A1%A3%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">根据后端文档定义数据类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9A%B4%E9%9C%B2%E5%88%86%E7%B1%BBbiaoqianID%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.1.2.</span> <span class="toc-text">暴露分类biaoqianID接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="toc-number">4.3.1.3.</span> <span class="toc-text">发送请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0%E9%80%BB%E8%BE%91%E6%9B%B4%E6%96%B0"><span class="toc-number">4.3.1.4.</span> <span class="toc-text">下拉刷新逻辑更新</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%E6%A0%87%E7%AD%BE%E5%8D%8A%E6%A8%A1%E6%80%81%E5%BC%B9%E7%AA%97%E6%8C%89%E9%92%AE%E5%9B%BE%E6%A0%87"><span class="toc-number">4.3.2.</span> <span class="toc-text">分类标签半模态弹窗按钮图标</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%8A%E6%A8%A1%E6%80%81%E5%BC%B9%E7%AA%97%E4%B8%BB%E4%BD%93"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">半模态弹窗主体</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AD%9B%E9%80%89%E6%8C%89%E9%92%AE%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">4.3.2.2.</span> <span class="toc-text">筛选按钮组件封装</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8A%E6%A8%A1%E6%80%81%E7%AD%9B%E9%80%89%E6%8C%89%E9%92%AE%E6%B8%B2%E6%9F%93"><span class="toc-number">4.3.3.</span> <span class="toc-text">半模态筛选按钮渲染</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8A%E6%A8%A1%E6%80%81%E7%AD%9B%E9%80%89%E6%8C%89%E9%92%AE%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.3.4.</span> <span class="toc-text">半模态筛选按钮点击事件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E7%AD%9B%E9%80%89%E6%8C%89%E9%92%AE"><span class="toc-number">4.3.4.1.</span> <span class="toc-text">类型筛选按钮</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E7%AD%9B%E9%80%89%E6%8C%89%E9%92%AE"><span class="toc-number">4.3.4.2.</span> <span class="toc-text">排序筛选按钮</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A3%E9%80%86%E5%BA%8F%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.3.4.3.</span> <span class="toc-text">正逆序的实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A3%E9%80%86%E5%BA%8F%E9%80%BB%E8%BE%91%E4%BC%98%E5%8C%96"><span class="toc-number">4.3.4.4.</span> <span class="toc-text">正逆序逻辑优化</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8A%E6%A8%A1%E6%80%81%E5%AE%8C%E6%88%90%E6%8C%89%E9%92%AE%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.3.5.</span> <span class="toc-text">半模态完成按钮点击事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8A%E6%A8%A1%E6%80%81%E9%87%8D%E7%BD%AE%E6%8C%89%E9%92%AE%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.3.6.</span> <span class="toc-text">半模态重置按钮点击事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%86%E8%8A%82%E4%BC%98%E5%8C%96"><span class="toc-number">4.3.7.</span> <span class="toc-text">细节优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E9%AA%A8%E6%9E%B6%E5%B1%8F%E6%95%88%E6%9E%9C-%E5%8F%AF%E5%85%A5%E5%BB%BA%E7%AB%8B%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%B0%8F%E7%82%B9"><span class="toc-number">4.4.</span> <span class="toc-text">首页骨架屏效果(可入建立的性能优化小点)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%A8%E6%9E%B6%E5%B1%8F%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B0%81%E8%A3%85"><span class="toc-number">4.4.1.</span> <span class="toc-text">骨架屏组件的封装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E4%B8%AA%E5%B0%8F%E7%81%B0%E8%89%B2%E5%9D%97"><span class="toc-number">4.4.1.1.</span> <span class="toc-text">单个小灰色块</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%AA%A8%E6%9E%B6%E5%B1%8F%E7%BB%84%E4%BB%B6"><span class="toc-number">4.4.1.2.</span> <span class="toc-text">骨架屏组件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%A8%E6%9E%B6%E5%B1%8F%E6%95%88%E6%9E%9C%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.4.2.</span> <span class="toc-text">骨架屏效果实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E9%AA%A8%E6%9E%B6%E5%B1%8F%E6%95%88%E6%9E%9C"><span class="toc-number">4.4.2.1.</span> <span class="toc-text">测试骨架屏效果</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/05/23/HarmonyOSPersistent/" title="鸿蒙开发数据持久化简述"><img src="/img/ArticleTopImgs/persistentTopImg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="鸿蒙开发数据持久化简述"/></a><div class="content"><a class="title" href="/2025/05/23/HarmonyOSPersistent/" title="鸿蒙开发数据持久化简述">鸿蒙开发数据持久化简述</a><time datetime="2025-05-23T12:46:19.000Z" title="发表于 2025-05-23 20:46:19">2025-05-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/18/SAS/" title="《数据分析方法（第二版）》重要概念"><img src="/img/ArticleTopImgs/SASTopImg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="《数据分析方法（第二版）》重要概念"/></a><div class="content"><a class="title" href="/2025/05/18/SAS/" title="《数据分析方法（第二版）》重要概念">《数据分析方法（第二版）》重要概念</a><time datetime="2025-05-18T06:49:47.000Z" title="发表于 2025-05-18 14:49:47">2025-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/16/HuaWeiCloud/" title="华为云Flexus云服务L实例+宝塔面板+Git Hook自动部署解决方案"><img src="/img/ArticleTopImgs/HuaWeiCloudTopImg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="华为云Flexus云服务L实例+宝塔面板+Git Hook自动部署解决方案"/></a><div class="content"><a class="title" href="/2025/05/16/HuaWeiCloud/" title="华为云Flexus云服务L实例+宝塔面板+Git Hook自动部署解决方案">华为云Flexus云服务L实例+宝塔面板+Git Hook自动部署解决方案</a><time datetime="2025-05-16T01:11:23.000Z" title="发表于 2025-05-16 09:11:23">2025-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/14/AccountKitTest/" title="华为账户一键登录功能测试"><img src="/img/ArticleTopImgs/AccountTopImg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="华为账户一键登录功能测试"/></a><div class="content"><a class="title" href="/2025/05/14/AccountKitTest/" title="华为账户一键登录功能测试">华为账户一键登录功能测试</a><time datetime="2025-05-14T03:10:51.000Z" title="发表于 2025-05-14 11:10:51">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/30/ToTheApril2025/" title="致2025那个繁忙的4月"><img src="/img/ArticleTopImgs/AprilTopImg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="致2025那个繁忙的4月"/></a><div class="content"><a class="title" href="/2025/04/30/ToTheApril2025/" title="致2025那个繁忙的4月">致2025那个繁忙的4月</a><time datetime="2025-04-30T00:15:30.000Z" title="发表于 2025-04-30 08:15:30">2025-04-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/footerBg.png);"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By XBXyftx</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><span>备案号：京ICP备2025126467号</span></a></div><div></div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now = new Date(); 
function createtime() { 
var grt = new Date("4/25/2024 18:30"); // 在此处修改你的建站时间
now.setTime(now.getTime() + 250); 
days = (now - grt) / 1000 / 60 / 60 / 24; 
dnum = Math.floor(days); 
hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum); 
hnum = Math.floor(hours); 
if (String(hnum).length == 1) { hnum = "0" + hnum; } 
minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum); 
mnum = Math.floor(minutes); 
if (String(mnum).length == 1) { mnum = "0" + mnum; } 
seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
snum = Math.round(seconds); 
if (String(snum).length == 1) { snum = "0" + snum; } 
document.getElementById("timeDate").innerHTML = "本网站已运行 " + dnum + " 天 "; 
document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
} 
setInterval(createtime, 250);</script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa-solid fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa-solid fa-arrow-rotate-right"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa-solid fa-arrow-right"></i></a><a class="rightMenu-item" id="menu-radompage" href="javascript:window.location.href = window.location.origin;"><i class="fa-solid fa-house"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa-solid fa-copy"></i><span>复制</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:rmf.switchReadMode();"><i class="fa-solid fa-book"></i><span>阅读模式</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikooxbx.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikooxbx.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script>localStorage.setItem('theme','dark')</script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script> // 强制锁定为暗黑模式 localStorage.setItem('theme', 'dark'); // 防止其他脚本覆盖模式 document.documentElement.setAttribute('data-theme', 'dark'); </script><link rel="stylesheet" href="/css/styles.css"><script> document.querySelectorAll('#post-comment).forEach(el => { el.style.backgroundColor = 'rgba(255, 255, 255, 0.6)'; }); </script><script src="/js/jquery-3.6.0.min.js"></script><script src="/js/rightmenu.js"></script><link rel="twikoo" href="/css/twikoo.css"><script src="/js/happy-title.js" async></script><script src="/js/cache-manager.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="/%5Bobject%20Object%5D"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="99" count="99" mobile="true" src="/%5Bobject%20Object%5D"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementsByClassName('recent-posts')[0];
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/04/30/ToTheApril2025/" alt=""><img width="48" height="48" src="/img/ArticleTopImgs/AprilTopImg.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-30</span><a class="blog-slider__title" href="2025/04/30/ToTheApril2025/" alt="">致2025那个繁忙的4月</a><div class="blog-slider__text">人们总是匆匆向前，殊不知时光易逝啊……</div><a class="blog-slider__button" href="2025/04/30/ToTheApril2025/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/03/16/yiDuo/" alt=""><img width="48" height="48" src="/img/ArticleTopImgs/yiduoTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-03-16</span><a class="blog-slider__title" href="2025/03/16/yiDuo/" alt="">关于鸿蒙的一多能力</a><div class="blog-slider__text">一多能力的学习笔记</div><a class="blog-slider__button" href="2025/03/16/yiDuo/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/02/04/V2/" alt=""><img width="48" height="48" src="/img/ArticleTopImgs/V2TopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-02-04</span><a class="blog-slider__title" href="2025/02/04/V2/" alt="">浅谈鸿蒙状态管理V1——&gt;V2</a><div class="blog-slider__text">用实际代码测试与我的开发经验，解析鸿蒙状态管理V2中难以理解的内容，帮助开发者们更好的理解和使用状态管理V2版本。</div><a class="blog-slider__button" href="2025/02/04/V2/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/04/20/RemoteCommunication/" alt=""><img width="48" height="48" src="/img/ArticleTopImgs/RCPTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-20</span><a class="blog-slider__title" href="2025/04/20/RemoteCommunication/" alt="">远场通信服务</a><div class="blog-slider__text">本文将介绍鸿蒙远场通信服务</div><a class="blog-slider__button" href="2025/04/20/RemoteCommunication/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/05/14/AccountKitTest/" alt=""><img width="48" height="48" src="/img/ArticleTopImgs/AccountTopImg.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-14</span><a class="blog-slider__title" href="2025/05/14/AccountKitTest/" alt="">华为账户一键登录功能测试</a><div class="blog-slider__text">Account Kit的官方demo测试与华为账户登录的功能实现分析。</div><a class="blog-slider__button" href="2025/05/14/AccountKitTest/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'da54ed7504284b8d97ecdbf93f821cdf';
  var gaud_map_key = 'c25dd516b6a1aa4c5269e50077fac6f4';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '115.982279,40.19409';
  var clock_default_rectangle_enable = 'true';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>